import{S as qt,i as Ot,s as Ht,k as h,l as m,m as p,h as i,n as C,b as V,D as o,B as Et,o as ee,q as S,a as y,w as St,r as T,c as P,x as yt,R as X,y as Tt,I as D,T as Y,u as gt,f as Pt,t as Ct,z as zt,J as oe,K as ne}from"../../../chunks/index-689c9b92.js";import{_ as ae}from"../../../chunks/preload-helper-41c905a7.js";import{A as re}from"../../../chunks/AttractionTableChoice-fd543907.js";import{A as le}from"../../../chunks/AttractionTableComponent-d5de4049.js";const xt=function(e,l,r,n,a){const u=(e-l)/(r-l)*(a-n)+n;return n<a?$t(u,n,a):$t(u,a,n)},$t=function(e,l,r){return Math.max(Math.min(e,r),l)},se=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}}),te=["white","red","green","blue"],ie=()=>{const e=Math.floor(Math.random()*te.length);return te[e]},fe=(e,l)=>{const r=[];for(let n=0;n<l;n++){const a={id:n,pos:{x:Math.random()*e.x,y:Math.random()*e.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:ie()};r.push(a)}return r};function ue(e){let l,r;return{c(){l=h("div"),r=h("canvas"),this.h()},l(n){l=m(n,"DIV",{class:!0});var a=p(l);r=m(a,"CANVAS",{id:!0,class:!0}),p(r).forEach(i),a.forEach(i),this.h()},h(){C(r,"id","canvas"),C(r,"class","svelte-bkdgvm"),C(l,"class","container svelte-bkdgvm")},m(n,a){V(n,l,a),o(l,r)},p:Et,i:Et,o:Et,d(n){n&&i(l)}}}function ce(e,l,r){let{cellSize:n}=l,{cells:a}=l,{worldSize:u}=l,{drewFrame:g}=l,R;const H=["white","red","green","blue"],c={white:0,red:1,green:2,blue:3},k={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},v=H.length,b=n,w=b*2;function L(){const s=document.getElementById("canvas");if(!s||!R)throw new Error("Canvas is not ready");const E=s.getContext("2d");if(E.fillStyle=k.background,E.fillRect(0,0,s.width,s.height),!a?.length){window.requestAnimationFrame(L);return}for(let W=0;W<a.length;W++){const U=a[W],N=Math.floor(xt(U.pos.x,0,u.x,0,s.width)),I=Math.floor(xt(U.pos.y,0,u.y,0,s.height));var z=c[U.color];const Z=z*w,x=0,A=w,$=w,J=N-b,_=I-b,M=w,d=w;E.drawImage(R,Z,x,A,$,J,_,M,d)}g(),window.requestAnimationFrame(L)}return ee(()=>{const s=document.getElementById("canvas");if(!s)throw new Error("Canvas is not ready");s.getContext("2d"),s.width=1600,s.height=960,R=document.createElement("canvas"),R.width=v*w,R.height=w;const E=R.getContext("2d");if(!E)throw new Error("Offscreen canvas is not ready");for(var z=0;z<v;++z){const W=H[z],U=k[W];E.fillStyle=U,E.beginPath(),E.arc(z*w+b,b,b,0,2*Math.PI),E.closePath(),E.fill()}window.requestAnimationFrame(L)}),e.$$set=s=>{"cellSize"in s&&r(0,n=s.cellSize),"cells"in s&&r(1,a=s.cells),"worldSize"in s&&r(2,u=s.worldSize),"drewFrame"in s&&r(3,g=s.drewFrame)},[n,a,u,g]}class he extends qt{constructor(l){super(),Ot(this,l,ce,ue,Ht,{cellSize:0,cells:1,worldSize:2,drewFrame:3})}}function me(e){let l,r,n,a,u,g,R,H,c,k,v,b,w,L,s,E,z=e[7]*e[5]+"",W,U,N,I,Z,x,A,$,J=e[8]*e[5]+"",_,M,d,B,tt,It,q,ht,K,mt,j,nt,At,ct=(e[1]?.length||0)+"",dt,Rt,at,kt,pt,bt,O,rt,Nt,Wt,lt,Bt,Ft,st,Lt,_t,et,vt,G,Q,Ut,Jt;return K=new he({props:{cells:e[0],worldSize:e[4],cellSize:de,drewFrame:e[14]}}),et=new re({props:{updateTable:e[9]}}),G=new le({props:{attractionTable:e[2],onUpdateTable:e[9]}}),{c(){l=h("h2"),r=S("V3 WIP"),n=y(),a=h("div"),u=h("p"),g=h("label"),R=S("Simulation definition"),H=y(),c=h("input"),k=y(),v=h("p"),b=h("label"),w=S("Simulation horizontal resolution"),L=y(),s=h("input"),E=S(`
        = `),W=S(z),U=y(),N=h("p"),I=h("label"),Z=S("Simulation vertical resolution"),x=y(),A=h("input"),$=S(`
        = `),_=S(J),M=y(),d=h("p"),B=h("label"),tt=S("Number of particles"),It=y(),q=h("input"),ht=y(),St(K.$$.fragment),mt=y(),j=h("div"),nt=h("span"),At=S("Buffer size: "),dt=S(ct),Rt=y(),at=h("span"),kt=S("Waited for frame: "),pt=S(e[3]),bt=y(),O=h("div"),rt=h("button"),Nt=S("Reset simulation"),Wt=y(),lt=h("button"),Bt=S("Center cells"),Ft=y(),st=h("button"),Lt=S("Rainbow cells"),_t=y(),St(et.$$.fragment),vt=y(),St(G.$$.fragment),this.h()},l(t){l=m(t,"H2",{});var f=p(l);r=T(f,"V3 WIP"),f.forEach(i),n=P(t),a=m(t,"DIV",{});var F=p(a);u=m(F,"P",{});var ot=p(u);g=m(ot,"LABEL",{for:!0});var Kt=p(g);R=T(Kt,"Simulation definition"),Kt.forEach(i),H=P(ot),c=m(ot,"INPUT",{id:!0,type:!0}),ot.forEach(i),k=P(F),v=m(F,"P",{});var it=p(v);b=m(it,"LABEL",{for:!0});var jt=p(b);w=T(jt,"Simulation horizontal resolution"),jt.forEach(i),L=P(it),s=m(it,"INPUT",{id:!0,type:!0}),E=T(it,`
        = `),W=T(it,z),it.forEach(i),U=P(F),N=m(F,"P",{});var ft=p(N);I=m(ft,"LABEL",{for:!0});var Gt=p(I);Z=T(Gt,"Simulation vertical resolution"),Gt.forEach(i),x=P(ft),A=m(ft,"INPUT",{id:!0,type:!0}),$=T(ft,`
        = `),_=T(ft,J),ft.forEach(i),M=P(F),d=m(F,"P",{});var wt=p(d);B=m(wt,"LABEL",{for:!0});var Qt=p(B);tt=T(Qt,"Number of particles"),Qt.forEach(i),It=P(wt),q=m(wt,"INPUT",{id:!0,type:!0}),wt.forEach(i),F.forEach(i),ht=P(t),yt(K.$$.fragment,t),mt=P(t),j=m(t,"DIV",{});var Mt=p(j);nt=m(Mt,"SPAN",{});var Dt=p(nt);At=T(Dt,"Buffer size: "),dt=T(Dt,ct),Dt.forEach(i),Rt=P(Mt),at=m(Mt,"SPAN",{});var Vt=p(at);kt=T(Vt,"Waited for frame: "),pt=T(Vt,e[3]),Vt.forEach(i),Mt.forEach(i),bt=P(t),O=m(t,"DIV",{});var ut=p(O);rt=m(ut,"BUTTON",{});var Xt=p(rt);Nt=T(Xt,"Reset simulation"),Xt.forEach(i),Wt=P(ut),lt=m(ut,"BUTTON",{});var Yt=p(lt);Bt=T(Yt,"Center cells"),Yt.forEach(i),Ft=P(ut),st=m(ut,"BUTTON",{});var Zt=p(st);Lt=T(Zt,"Rainbow cells"),Zt.forEach(i),ut.forEach(i),_t=P(t),yt(et.$$.fragment,t),vt=P(t),yt(G.$$.fragment,t),this.h()},h(){C(g,"for","attractionRadius"),C(c,"id","attractionRadius"),C(c,"type","number"),C(b,"for","horizontalResolution"),C(s,"id","horizontalResolution"),C(s,"type","number"),C(I,"for","verticalResolution"),C(A,"id","verticalResolution"),C(A,"type","number"),C(B,"for","nbParticles"),C(q,"id","nbParticles"),C(q,"type","number")},m(t,f){V(t,l,f),o(l,r),V(t,n,f),V(t,a,f),o(a,u),o(u,g),o(g,R),o(u,H),o(u,c),X(c,e[5]),o(a,k),o(a,v),o(v,b),o(b,w),o(v,L),o(v,s),X(s,e[7]),o(v,E),o(v,W),o(a,U),o(a,N),o(N,I),o(I,Z),o(N,x),o(N,A),X(A,e[8]),o(N,$),o(N,_),o(a,M),o(a,d),o(d,B),o(B,tt),o(d,It),o(d,q),X(q,e[6]),V(t,ht,f),Tt(K,t,f),V(t,mt,f),V(t,j,f),o(j,nt),o(nt,At),o(nt,dt),o(j,Rt),o(j,at),o(at,kt),o(at,pt),V(t,bt,f),V(t,O,f),o(O,rt),o(rt,Nt),o(O,Wt),o(O,lt),o(lt,Bt),o(O,Ft),o(O,st),o(st,Lt),V(t,_t,f),Tt(et,t,f),V(t,vt,f),Tt(G,t,f),Q=!0,Ut||(Jt=[D(c,"input",e[15]),D(c,"change",e[10]),D(s,"input",e[16]),D(s,"change",e[10]),D(A,"input",e[17]),D(A,"change",e[10]),D(q,"input",e[18]),D(q,"change",e[10]),D(rt,"click",e[13]),D(lt,"click",e[11]),D(st,"click",e[12])],Ut=!0)},p(t,[f]){f&32&&Y(c.value)!==t[5]&&X(c,t[5]),f&128&&Y(s.value)!==t[7]&&X(s,t[7]),(!Q||f&160)&&z!==(z=t[7]*t[5]+"")&&gt(W,z),f&256&&Y(A.value)!==t[8]&&X(A,t[8]),(!Q||f&288)&&J!==(J=t[8]*t[5]+"")&&gt(_,J),f&64&&Y(q.value)!==t[6]&&X(q,t[6]);const F={};f&1&&(F.cells=t[0]),f&16&&(F.worldSize=t[4]),K.$set(F),(!Q||f&2)&&ct!==(ct=(t[1]?.length||0)+"")&&gt(dt,ct),(!Q||f&8)&&gt(pt,t[3]);const ot={};f&4&&(ot.attractionTable=t[2]),G.$set(ot)},i(t){Q||(Pt(K.$$.fragment,t),Pt(et.$$.fragment,t),Pt(G.$$.fragment,t),Q=!0)},o(t){Ct(K.$$.fragment,t),Ct(et.$$.fragment,t),Ct(G.$$.fragment,t),Q=!1},d(t){t&&i(l),t&&i(n),t&&i(a),t&&i(ht),zt(K,t),t&&i(mt),t&&i(j),t&&i(bt),t&&i(O),t&&i(_t),zt(et,t),t&&i(vt),zt(G,t),Ut=!1,oe(Jt)}}}const de=1;function pe(e,l,r){let n,a,u,g,R=0,H=0;const c={x:1600,y:960};let k=32,v=4e3,b=60,w=40,L;const s=async()=>{L=(await ae(()=>import("../../../chunks/simulation.worker-a89055d5.js"),[],import.meta.url)).default,I()},E=_=>{r(2,g=_),n.postMessage({msg:"updateTable",attractionTable:g}),r(1,u=[a.map(M=>M.pos)])},z=()=>{r(4,c.x=k*b,c),r(4,c.y=k*w,c),I()},W=()=>{for(const _ of a){const M=2*Math.random(),d=Math.random()*2*Math.PI,B=c.x/2+M*Math.cos(d),tt=c.y/2+M*Math.sin(d);_.pos={x:B,y:tt}}I(!0,!0)},U=()=>{const _=["white","red","green","blue"],M=c.x/4;for(const d of a){const B=Math.floor(d.pos.x/M),tt=_[B];d.color=tt}I(!0,!0)},N=()=>{I(!1,!1)},I=(_,M)=>{if(L===void 0)throw new Error("Worker is not initialized");n&&(n.postMessage({msg:"destroy"}),n.terminate()),n=new L;const d=B=>{u.push(B.data.positions)};n.onmessage=d,_||r(0,a=fe(c,v)),M||r(2,g=se()),r(1,u=[]),n.postMessage({msg:"start",cells:a,attractionTable:g,worldSize:c,maxAttractionRadius:k})},Z=()=>{if(u.length>0){const _=Date.now();r(3,H=_-R),R=_;const M=u.shift()||[];if(r(1,u),M.length!==a.length)return;for(let d=0;d<a.length;d++)r(0,a[d].pos=M[d],a)}};ee(s),ne(()=>n?.terminate());function x(){k=Y(this.value),r(5,k)}function A(){b=Y(this.value),r(7,b)}function $(){w=Y(this.value),r(8,w)}function J(){v=Y(this.value),r(6,v)}return[a,u,g,H,c,k,v,b,w,E,z,W,U,N,Z,x,A,$,J]}class be extends qt{constructor(l){super(),Ot(this,l,pe,me,Ht,{})}}function _e(e){let l,r;return l=new be({}),{c(){St(l.$$.fragment)},l(n){yt(l.$$.fragment,n)},m(n,a){Tt(l,n,a),r=!0},p:Et,i(n){r||(Pt(l.$$.fragment,n),r=!0)},o(n){Ct(l.$$.fragment,n),r=!1},d(n){zt(l,n)}}}class Ee extends qt{constructor(l){super(),Ot(this,l,null,_e,Ht,{})}}export{Ee as default};
