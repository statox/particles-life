import{S as Nt,i as Wt,s as Ft,k as m,l as d,m as w,h as i,n as C,b as D,D as a,B as bt,o as Qt,q as A,a as y,w as _t,r as R,c as S,x as vt,R as G,y as wt,I as V,T as Q,u as Bt,f as Mt,t as gt,z as Et,J as Xt,K as Yt}from"../../../chunks/index-689c9b92.js";import{_ as Zt}from"../../../chunks/preload-helper-41c905a7.js";import{A as xt}from"../../../chunks/AttractionTableChoice-fd543907.js";import{A as $t}from"../../../chunks/AttractionTableComponent-d5de4049.js";const Kt=["white","red","green","blue"],te=()=>{const e=Math.floor(Math.random()*Kt.length);return Kt[e]},ee=(e,r)=>{const l=[];for(let o=0;o<r;o++){const n={id:o,pos:{x:Math.random()*e.x,y:Math.random()*e.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:te()};l.push(n)}return l},jt=function(e,r,l,o,n){const f=(e-r)/(l-r)*(n-o)+o;return o<n?Gt(f,o,n):Gt(f,n,o)},Gt=function(e,r,l){return Math.max(Math.min(e,l),r)},oe=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}});function ne(e){let r,l;return{c(){r=m("div"),l=m("canvas"),this.h()},l(o){r=d(o,"DIV",{class:!0});var n=w(r);l=d(n,"CANVAS",{id:!0,class:!0}),w(l).forEach(i),n.forEach(i),this.h()},h(){C(l,"id","canvas"),C(l,"class","svelte-bkdgvm"),C(r,"class","container svelte-bkdgvm")},m(o,n){D(o,r,n),a(r,l)},p:bt,i:bt,o:bt,d(o){o&&i(r)}}}function re(e,r,l){let{cellSize:o}=r,{cells:n}=r,{worldSize:f}=r,{drewFrame:M}=r,c;const k=["white","red","green","blue"],p={white:0,red:1,green:2,blue:3},L={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},b=k.length,_=o,P=_*2;function J(){const s=document.getElementById("canvas");if(!s||!c)throw new Error("Canvas is not ready");const g=s.getContext("2d");if(g.fillStyle=L.background,g.fillRect(0,0,s.width,s.height),!n?.length){window.requestAnimationFrame(J);return}for(let W=0;W<n.length;W++){const E=n[W],B=Math.floor(jt(E.pos.x,0,f.x,0,s.width)),q=Math.floor(jt(E.pos.y,0,f.y,0,s.height));var T=p[E.color];const X=T*P,Y=0,z=P,v=P,h=B-_,I=q-_,U=P,N=P;g.drawImage(c,X,Y,z,v,h,I,U,N)}M(),window.requestAnimationFrame(J)}return Qt(()=>{const s=document.getElementById("canvas");if(!s)throw new Error("Canvas is not ready");s.getContext("2d"),s.width=1600,s.height=960,c=document.createElement("canvas"),c.width=b*P,c.height=P;const g=c.getContext("2d");if(!g)throw new Error("Offscreen canvas is not ready");for(var T=0;T<b;++T){const W=k[T],E=L[W];g.fillStyle=E,g.beginPath(),g.arc(T*P+_,_,_,0,2*Math.PI),g.closePath(),g.fill()}window.requestAnimationFrame(J)}),e.$$set=s=>{"cellSize"in s&&l(0,o=s.cellSize),"cells"in s&&l(1,n=s.cells),"worldSize"in s&&l(2,f=s.worldSize),"drewFrame"in s&&l(3,M=s.drewFrame)},[o,n,f,M]}class le extends Nt{constructor(r){super(),Wt(this,r,re,ne,Ft,{cellSize:0,cells:1,worldSize:2,drewFrame:3})}}function ae(e){let r,l,o,n,f,M,c,k,p,L,b,_,P,J,s,g,T=e[6]*e[4]+"",W,E,B,q,X,Y,z,v,h=e[7]*e[4]+"",I,U,N,et,yt,St,O,ut,K,ft,Z,Ct,it=(e[1]?.length||0)+"",ct,ht,H,ot,Pt,Tt,nt,zt,It,rt,At,mt,x,dt,j,$,Rt,Lt;return K=new le({props:{cells:e[0],worldSize:e[3],cellSize:se,drewFrame:e[13]}}),x=new xt({props:{updateTable:e[8]}}),j=new $t({props:{attractionTable:e[2],onUpdateTable:e[8]}}),{c(){r=m("h2"),l=A("V3 WIP"),o=y(),n=m("div"),f=m("p"),M=m("label"),c=A("Simulation definition"),k=y(),p=m("input"),L=y(),b=m("p"),_=m("label"),P=A("Simulation horizontal resolution"),J=y(),s=m("input"),g=A(`
        = `),W=A(T),E=y(),B=m("p"),q=m("label"),X=A("Simulation vertical resolution"),Y=y(),z=m("input"),v=A(`
        = `),I=A(h),U=y(),N=m("p"),et=m("label"),yt=A("Number of particles"),St=y(),O=m("input"),ut=y(),_t(K.$$.fragment),ft=y(),Z=m("span"),Ct=A("Buffer size: "),ct=A(it),ht=y(),H=m("div"),ot=m("button"),Pt=A("Reset simulation"),Tt=y(),nt=m("button"),zt=A("Center cells"),It=y(),rt=m("button"),At=A("Rainbow cells"),mt=y(),_t(x.$$.fragment),dt=y(),_t(j.$$.fragment),this.h()},l(t){r=d(t,"H2",{});var u=w(r);l=R(u,"V3 WIP"),u.forEach(i),o=S(t),n=d(t,"DIV",{});var F=w(n);f=d(F,"P",{});var tt=w(f);M=d(tt,"LABEL",{for:!0});var Ut=w(M);c=R(Ut,"Simulation definition"),Ut.forEach(i),k=S(tt),p=d(tt,"INPUT",{id:!0,type:!0}),tt.forEach(i),L=S(F),b=d(F,"P",{});var lt=w(b);_=d(lt,"LABEL",{for:!0});var Vt=w(_);P=R(Vt,"Simulation horizontal resolution"),Vt.forEach(i),J=S(lt),s=d(lt,"INPUT",{id:!0,type:!0}),g=R(lt,`
        = `),W=R(lt,T),lt.forEach(i),E=S(F),B=d(F,"P",{});var at=w(B);q=d(at,"LABEL",{for:!0});var Dt=w(q);X=R(Dt,"Simulation vertical resolution"),Dt.forEach(i),Y=S(at),z=d(at,"INPUT",{id:!0,type:!0}),v=R(at,`
        = `),I=R(at,h),at.forEach(i),U=S(F),N=d(F,"P",{});var pt=w(N);et=d(pt,"LABEL",{for:!0});var qt=w(et);yt=R(qt,"Number of particles"),qt.forEach(i),St=S(pt),O=d(pt,"INPUT",{id:!0,type:!0}),pt.forEach(i),F.forEach(i),ut=S(t),vt(K.$$.fragment,t),ft=S(t),Z=d(t,"SPAN",{});var kt=w(Z);Ct=R(kt,"Buffer size: "),ct=R(kt,it),kt.forEach(i),ht=S(t),H=d(t,"DIV",{});var st=w(H);ot=d(st,"BUTTON",{});var Ot=w(ot);Pt=R(Ot,"Reset simulation"),Ot.forEach(i),Tt=S(st),nt=d(st,"BUTTON",{});var Ht=w(nt);zt=R(Ht,"Center cells"),Ht.forEach(i),It=S(st),rt=d(st,"BUTTON",{});var Jt=w(rt);At=R(Jt,"Rainbow cells"),Jt.forEach(i),st.forEach(i),mt=S(t),vt(x.$$.fragment,t),dt=S(t),vt(j.$$.fragment,t),this.h()},h(){C(M,"for","attractionRadius"),C(p,"id","attractionRadius"),C(p,"type","number"),C(_,"for","horizontalResolution"),C(s,"id","horizontalResolution"),C(s,"type","number"),C(q,"for","verticalResolution"),C(z,"id","verticalResolution"),C(z,"type","number"),C(et,"for","nbParticles"),C(O,"id","nbParticles"),C(O,"type","number")},m(t,u){D(t,r,u),a(r,l),D(t,o,u),D(t,n,u),a(n,f),a(f,M),a(M,c),a(f,k),a(f,p),G(p,e[4]),a(n,L),a(n,b),a(b,_),a(_,P),a(b,J),a(b,s),G(s,e[6]),a(b,g),a(b,W),a(n,E),a(n,B),a(B,q),a(q,X),a(B,Y),a(B,z),G(z,e[7]),a(B,v),a(B,I),a(n,U),a(n,N),a(N,et),a(et,yt),a(N,St),a(N,O),G(O,e[5]),D(t,ut,u),wt(K,t,u),D(t,ft,u),D(t,Z,u),a(Z,Ct),a(Z,ct),D(t,ht,u),D(t,H,u),a(H,ot),a(ot,Pt),a(H,Tt),a(H,nt),a(nt,zt),a(H,It),a(H,rt),a(rt,At),D(t,mt,u),wt(x,t,u),D(t,dt,u),wt(j,t,u),$=!0,Rt||(Lt=[V(p,"input",e[14]),V(p,"change",e[9]),V(s,"input",e[15]),V(s,"change",e[9]),V(z,"input",e[16]),V(z,"change",e[9]),V(O,"input",e[17]),V(O,"change",e[9]),V(ot,"click",e[12]),V(nt,"click",e[10]),V(rt,"click",e[11])],Rt=!0)},p(t,[u]){u&16&&Q(p.value)!==t[4]&&G(p,t[4]),u&64&&Q(s.value)!==t[6]&&G(s,t[6]),(!$||u&80)&&T!==(T=t[6]*t[4]+"")&&Bt(W,T),u&128&&Q(z.value)!==t[7]&&G(z,t[7]),(!$||u&144)&&h!==(h=t[7]*t[4]+"")&&Bt(I,h),u&32&&Q(O.value)!==t[5]&&G(O,t[5]);const F={};u&1&&(F.cells=t[0]),u&8&&(F.worldSize=t[3]),K.$set(F),(!$||u&2)&&it!==(it=(t[1]?.length||0)+"")&&Bt(ct,it);const tt={};u&4&&(tt.attractionTable=t[2]),j.$set(tt)},i(t){$||(Mt(K.$$.fragment,t),Mt(x.$$.fragment,t),Mt(j.$$.fragment,t),$=!0)},o(t){gt(K.$$.fragment,t),gt(x.$$.fragment,t),gt(j.$$.fragment,t),$=!1},d(t){t&&i(r),t&&i(o),t&&i(n),t&&i(ut),Et(K,t),t&&i(ft),t&&i(Z),t&&i(ht),t&&i(H),t&&i(mt),Et(x,t),t&&i(dt),Et(j,t),Rt=!1,Xt(Lt)}}}const se=1;function ie(e,r,l){let o,n,f,M;const c={x:1600,y:960};let k=32,p=4e3,L=60,b=40,_;const P=async()=>{_=(await Zt(()=>import("../../../chunks/simulation.worker-56f31538.js"),[],import.meta.url)).default,E()},J=v=>{l(2,M=v),o.postMessage({msg:"updateTable",attractionTable:M}),l(1,f=[n.map(h=>h.pos)])},s=()=>{l(3,c.x=k*L,c),l(3,c.y=k*b,c),E()},g=()=>{for(const v of n){const h=2*Math.random(),I=Math.random()*2*Math.PI,U=c.x/2+h*Math.cos(I),N=c.y/2+h*Math.sin(I);v.pos={x:U,y:N}}E(!0,!0)},T=()=>{const v=["white","red","green","blue"],h=c.x/4;for(const I of n){const U=Math.floor(I.pos.x/h),N=v[U];I.color=N}E(!0,!0)},W=()=>{E(!1,!1)},E=(v,h)=>{if(_===void 0)throw new Error("Worker is not initialized");o&&(o.postMessage({msg:"destroy"}),o.terminate()),o=new _;const I=U=>{f.push(U.data.positions)};o.onmessage=I,v||l(0,n=ee(c,p)),h||l(2,M=oe()),l(1,f=[]),o.postMessage({msg:"start",cells:n,attractionTable:M,worldSize:c,maxAttractionRadius:k})},B=()=>{if(f.length>0){const v=f.shift()||[];if(l(1,f),v.length!==n.length)return;for(let h=0;h<n.length;h++)l(0,n[h].pos=v[h],n)}};Qt(P),Yt(()=>o?.terminate());function q(){k=Q(this.value),l(4,k)}function X(){L=Q(this.value),l(6,L)}function Y(){b=Q(this.value),l(7,b)}function z(){p=Q(this.value),l(5,p)}return[n,f,M,c,k,p,L,b,J,s,g,T,W,B,q,X,Y,z]}class ue extends Nt{constructor(r){super(),Wt(this,r,ie,ae,Ft,{})}}function fe(e){let r,l;return r=new ue({}),{c(){_t(r.$$.fragment)},l(o){vt(r.$$.fragment,o)},m(o,n){wt(r,o,n),l=!0},p:bt,i(o){l||(Mt(r.$$.fragment,o),l=!0)},o(o){gt(r.$$.fragment,o),l=!1},d(o){Et(r,o)}}}class pe extends Nt{constructor(r){super(),Wt(this,r,null,fe,Ft,{})}}export{pe as default};
