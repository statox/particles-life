import{S as bt,i as vt,s as wt,k as u,a as v,q as E,l as f,m as p,h as s,c as w,r as S,n as g,b as Y,D as t,P as Q,I,Q as Z,B as _t,J as Lt,o as Dt,w as qe,x as He,y as Je,u as me,f as Ke,t as Qe,z as je,K as Vt}from"../../../chunks/index-ffa1d1d4.js";import{_ as Wt}from"../../../chunks/preload-helper-41c905a7.js";import{A as Ot,a as qt}from"../../../chunks/AttractionTableChoice-db9eeac0.js";const Bt=function(o,l,n,a,r){const _=(o-l)/(n-l)*(r-a)+a;return a<r?Rt(_,a,r):Rt(_,r,a)},Rt=function(o,l,n){return Math.max(Math.min(o,n),l)},Ht=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}}),Ut=["white","red","green","blue"],Jt=()=>{const o=Math.floor(Math.random()*Ut.length);return Ut[o]},Kt=(o,l)=>{const n=[];for(let a=0;a<l;a++){const r={id:a,pos:{x:Math.random()*o.x,y:Math.random()*o.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:Jt()};n.push(r)}return n};function Qt(o){let l,n,a,r,_,T,P,z,C;return{c(){l=u("div"),n=u("canvas"),a=v(),r=u("label"),_=E("Limit FPS"),T=v(),P=u("input"),this.h()},l(k){l=f(k,"DIV",{class:!0});var h=p(l);n=f(h,"CANVAS",{id:!0,class:!0}),p(n).forEach(s),a=w(h),r=f(h,"LABEL",{for:!0});var A=p(r);_=S(A,"Limit FPS"),A.forEach(s),T=w(h),P=f(h,"INPUT",{id:!0,type:!0,min:!0}),h.forEach(s),this.h()},h(){g(n,"id","canvas"),g(n,"class","svelte-bkdgvm"),g(r,"for","maxFPSInput"),g(P,"id","maxFPSInput"),g(P,"type","number"),g(P,"min","1"),g(l,"class","container svelte-bkdgvm")},m(k,h){Y(k,l,h),t(l,n),t(l,a),t(l,r),t(r,_),t(l,T),t(l,P),Q(P,o[1]),z||(C=[I(P,"input",o[8]),I(P,"change",o[9])],z=!0)},p(k,[h]){h&2&&Z(P.value)!==k[1]&&Q(P,k[1])},i:_t,o:_t,d(k){k&&s(l),z=!1,Lt(C)}}}function jt(o,l,n){let{cellSize:a}=l,{cells:r}=l,{worldSize:_}=l,{drewFrame:T}=l,{showColors:P}=l,z;const C=["white","red","green","blue"],k={white:0,red:1,green:2,blue:3},h={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},A=C.length,B=a,N=B*2;let m=25,O=m,L,x,ee,R;function q(){const i=document.getElementById("canvas");if(!i||!z)throw new Error("Canvas is not ready");if(window.requestAnimationFrame(q),ee=Date.now(),R=ee-x,R<=L)return;x=ee-R%L;const F=i.getContext("2d");if(!F)throw new Error("Ctx is not ready");if(F.fillStyle=h.background,F.fillRect(0,0,i.width,i.height),!r?.length){window.requestAnimationFrame(q);return}for(let H=0;H<r.length;H++){const j=r[H],G=Math.floor(Bt(j.pos.x,0,_.x,0,i.width)),$=Math.floor(Bt(j.pos.y,0,_.y,0,i.height));var M=P?k[j.color]:0;const ie=M*N,ue=0,D=N,fe=N,X=G-B,y=$-B,d=N,b=N;F.drawImage(z,ie,ue,D,fe,X,y,d,b)}T()}Dt(()=>{const i=document.getElementById("canvas");if(!i)throw new Error("Canvas is not ready");i.width=1600,i.height=960,z=document.createElement("canvas"),z.width=A*N,z.height=N;const F=z.getContext("2d");if(!F)throw new Error("Offscreen canvas is not ready");for(var M=0;M<A;++M){const H=C[M],j=h[H];F.fillStyle=j,F.beginPath(),F.arc(M*N+B,B,B,0,2*Math.PI),F.closePath(),F.fill()}n(2,L=1e3/m),x=Date.now(),window.requestAnimationFrame(q)});function ae(){O=Z(this.value),n(1,O)}const se=()=>{n(0,m=O),n(2,L=1e3/m)};return o.$$set=i=>{"cellSize"in i&&n(3,a=i.cellSize),"cells"in i&&n(4,r=i.cells),"worldSize"in i&&n(5,_=i.worldSize),"drewFrame"in i&&n(6,T=i.drewFrame),"showColors"in i&&n(7,P=i.showColors)},[m,O,L,a,r,_,T,P,ae,se]}class Gt extends bt{constructor(l){super(),vt(this,l,jt,Qt,wt,{cellSize:3,cells:4,worldSize:5,drewFrame:6,showColors:7})}}function Xt(o){let l,n,a,r,_,T,P,z,C,k,h,A,B,N,m,O,L=o[8]*o[6]+"",x,ee,R,q,ae,se,i,F,M=o[9]*o[6]+"",H,j,G,$,ie,ue,D,fe,X,y,d,b,U,te,Ie=(o[1]?.length||0)-o[11]+"",Ae,Ge,de,Xe,Fe,Ye,pe,Ze,Be,xe,V,Re,$e,oe,_e,et,tt,be,ot,nt,ve,ke=o[4]?"Play":"Pause",Ue,lt,Ne,we,ze=o[5]?"Hide colors":"Show colors",Le,De,J,ge,rt,at,Me,st,it,Ee,ut,ft,Se,ct,Ve,ce,We,ne,K,ht,gt;return X=new Gt({props:{cells:o[0],worldSize:o[10],cellSize:Yt,showColors:o[5],drewFrame:o[19]}}),ce=new Ot({props:{updateTable:o[12]}}),ne=new qt({props:{attractionTable:o[2],onUpdateTable:o[12]}}),{c(){l=u("h2"),n=E("V3 WIP"),a=v(),r=u("div"),_=u("p"),T=u("label"),P=E("Simulation definition"),z=v(),C=u("input"),k=v(),h=u("p"),A=u("label"),B=E("Simulation horizontal resolution"),N=v(),m=u("input"),O=E(`
        = `),x=E(L),ee=v(),R=u("p"),q=u("label"),ae=E("Simulation vertical resolution"),se=v(),i=u("input"),F=E(`
        = `),H=E(M),j=v(),G=u("p"),$=u("label"),ie=E("Number of particles"),ue=v(),D=u("input"),fe=v(),qe(X.$$.fragment),y=v(),d=u("div"),b=u("div"),U=u("span"),te=E("Buffer size: "),Ae=E(Ie),Ge=v(),de=u("span"),Xe=E("Current frame: "),Fe=E(o[11]),Ye=v(),pe=u("span"),Ze=E("Frame length (ms): "),Be=E(o[3]),xe=v(),V=u("input"),$e=v(),oe=u("div"),_e=u("button"),et=E("Replay from start"),tt=v(),be=u("button"),ot=E("Catchup last frame"),nt=v(),ve=u("button"),Ue=E(ke),lt=v(),Ne=u("div"),we=u("button"),Le=E(ze),De=v(),J=u("div"),ge=u("button"),rt=E("Reset cells"),at=v(),Me=u("button"),st=E("Center cells"),it=v(),Ee=u("button"),ut=E("Large Center cells"),ft=v(),Se=u("button"),ct=E("Rainbow cells"),Ve=v(),qe(ce.$$.fragment),We=v(),qe(ne.$$.fragment),this.h()},l(e){l=f(e,"H2",{});var c=p(l);n=S(c,"V3 WIP"),c.forEach(s),a=w(e),r=f(e,"DIV",{});var W=p(r);_=f(W,"P",{});var he=p(_);T=f(he,"LABEL",{for:!0});var Mt=p(T);P=S(Mt,"Simulation definition"),Mt.forEach(s),z=w(he),C=f(he,"INPUT",{id:!0,type:!0}),he.forEach(s),k=w(W),h=f(W,"P",{});var Pe=p(h);A=f(Pe,"LABEL",{for:!0});var Et=p(A);B=S(Et,"Simulation horizontal resolution"),Et.forEach(s),N=w(Pe),m=f(Pe,"INPUT",{id:!0,type:!0}),O=S(Pe,`
        = `),x=S(Pe,L),Pe.forEach(s),ee=w(W),R=f(W,"P",{});var Ce=p(R);q=f(Ce,"LABEL",{for:!0});var St=p(q);ae=S(St,"Simulation vertical resolution"),St.forEach(s),se=w(Ce),i=f(Ce,"INPUT",{id:!0,type:!0}),F=S(Ce,`
        = `),H=S(Ce,M),Ce.forEach(s),j=w(W),G=f(W,"P",{});var Oe=p(G);$=f(Oe,"LABEL",{for:!0});var Pt=p($);ie=S(Pt,"Number of particles"),Pt.forEach(s),ue=w(Oe),D=f(Oe,"INPUT",{id:!0,type:!0}),Oe.forEach(s),W.forEach(s),fe=w(e),He(X.$$.fragment,e),y=w(e),d=f(e,"DIV",{});var le=p(d);b=f(le,"DIV",{});var Te=p(b);U=f(Te,"SPAN",{});var mt=p(U);te=S(mt,"Buffer size: "),Ae=S(mt,Ie),mt.forEach(s),Ge=w(Te),de=f(Te,"SPAN",{});var dt=p(de);Xe=S(dt,"Current frame: "),Fe=S(dt,o[11]),dt.forEach(s),Ye=w(Te),pe=f(Te,"SPAN",{});var pt=p(pe);Ze=S(pt,"Frame length (ms): "),Be=S(pt,o[3]),pt.forEach(s),Te.forEach(s),xe=w(le),V=f(le,"INPUT",{type:!0,min:!0,max:!0,class:!0,id:!0}),$e=w(le),oe=f(le,"DIV",{});var ye=p(oe);_e=f(ye,"BUTTON",{});var Ct=p(_e);et=S(Ct,"Replay from start"),Ct.forEach(s),tt=w(ye),be=f(ye,"BUTTON",{});var Tt=p(be);ot=S(Tt,"Catchup last frame"),Tt.forEach(s),nt=w(ye),ve=f(ye,"BUTTON",{});var yt=p(ve);Ue=S(yt,ke),yt.forEach(s),ye.forEach(s),lt=w(le),Ne=f(le,"DIV",{});var It=p(Ne);we=f(It,"BUTTON",{});var kt=p(we);Le=S(kt,ze),kt.forEach(s),It.forEach(s),le.forEach(s),De=w(e),J=f(e,"DIV",{});var re=p(J);ge=f(re,"BUTTON",{});var Nt=p(ge);rt=S(Nt,"Reset cells"),Nt.forEach(s),at=w(re),Me=f(re,"BUTTON",{});var zt=p(Me);st=S(zt,"Center cells"),zt.forEach(s),it=w(re),Ee=f(re,"BUTTON",{});var At=p(Ee);ut=S(At,"Large Center cells"),At.forEach(s),ft=w(re),Se=f(re,"BUTTON",{});var Ft=p(Se);ct=S(Ft,"Rainbow cells"),Ft.forEach(s),re.forEach(s),Ve=w(e),He(ce.$$.fragment,e),We=w(e),He(ne.$$.fragment,e),this.h()},h(){g(T,"for","attractionRadius"),g(C,"id","attractionRadius"),g(C,"type","number"),g(A,"for","horizontalResolution"),g(m,"id","horizontalResolution"),g(m,"type","number"),g(q,"for","verticalResolution"),g(i,"id","verticalResolution"),g(i,"type","number"),g($,"for","nbParticles"),g(D,"id","nbParticles"),g(D,"type","number"),g(V,"type","range"),g(V,"min","1"),g(V,"max",Re=o[1]?.length?o[1].length-1:0),g(V,"class","slider"),g(V,"id","frameIndexSlider")},m(e,c){Y(e,l,c),t(l,n),Y(e,a,c),Y(e,r,c),t(r,_),t(_,T),t(T,P),t(_,z),t(_,C),Q(C,o[6]),t(r,k),t(r,h),t(h,A),t(A,B),t(h,N),t(h,m),Q(m,o[8]),t(h,O),t(h,x),t(r,ee),t(r,R),t(R,q),t(q,ae),t(R,se),t(R,i),Q(i,o[9]),t(R,F),t(R,H),t(r,j),t(r,G),t(G,$),t($,ie),t(G,ue),t(G,D),Q(D,o[7]),Y(e,fe,c),Je(X,e,c),Y(e,y,c),Y(e,d,c),t(d,b),t(b,U),t(U,te),t(U,Ae),t(b,Ge),t(b,de),t(de,Xe),t(de,Fe),t(b,Ye),t(b,pe),t(pe,Ze),t(pe,Be),t(d,xe),t(d,V),Q(V,o[11]),t(d,$e),t(d,oe),t(oe,_e),t(_e,et),t(oe,tt),t(oe,be),t(be,ot),t(oe,nt),t(oe,ve),t(ve,Ue),t(d,lt),t(d,Ne),t(Ne,we),t(we,Le),Y(e,De,c),Y(e,J,c),t(J,ge),t(ge,rt),t(J,at),t(J,Me),t(Me,st),t(J,it),t(J,Ee),t(Ee,ut),t(J,ft),t(J,Se),t(Se,ct),Y(e,Ve,c),Je(ce,e,c),Y(e,We,c),Je(ne,e,c),K=!0,ht||(gt=[I(C,"input",o[20]),I(C,"change",o[13]),I(m,"input",o[21]),I(m,"change",o[13]),I(i,"input",o[22]),I(i,"change",o[13]),I(D,"input",o[23]),I(D,"change",o[13]),I(V,"change",o[24]),I(V,"input",o[24]),I(_e,"click",o[18]),I(be,"click",o[25]),I(ve,"click",o[26]),I(we,"click",o[27]),I(ge,"click",o[17]),I(Me,"click",o[14]),I(Ee,"click",o[15]),I(Se,"click",o[16])],ht=!0)},p(e,c){c[0]&64&&Z(C.value)!==e[6]&&Q(C,e[6]),c[0]&256&&Z(m.value)!==e[8]&&Q(m,e[8]),(!K||c[0]&320)&&L!==(L=e[8]*e[6]+"")&&me(x,L),c[0]&512&&Z(i.value)!==e[9]&&Q(i,e[9]),(!K||c[0]&576)&&M!==(M=e[9]*e[6]+"")&&me(H,M),c[0]&128&&Z(D.value)!==e[7]&&Q(D,e[7]);const W={};c[0]&1&&(W.cells=e[0]),c[0]&1024&&(W.worldSize=e[10]),c[0]&32&&(W.showColors=e[5]),X.$set(W),(!K||c[0]&2050)&&Ie!==(Ie=(e[1]?.length||0)-e[11]+"")&&me(Ae,Ie),(!K||c[0]&2048)&&me(Fe,e[11]),(!K||c[0]&8)&&me(Be,e[3]),(!K||c[0]&2&&Re!==(Re=e[1]?.length?e[1].length-1:0))&&g(V,"max",Re),c[0]&2048&&Q(V,e[11]),(!K||c[0]&16)&&ke!==(ke=e[4]?"Play":"Pause")&&me(Ue,ke),(!K||c[0]&32)&&ze!==(ze=e[5]?"Hide colors":"Show colors")&&me(Le,ze);const he={};c[0]&4&&(he.attractionTable=e[2]),ne.$set(he)},i(e){K||(Ke(X.$$.fragment,e),Ke(ce.$$.fragment,e),Ke(ne.$$.fragment,e),K=!0)},o(e){Qe(X.$$.fragment,e),Qe(ce.$$.fragment,e),Qe(ne.$$.fragment,e),K=!1},d(e){e&&s(l),e&&s(a),e&&s(r),e&&s(fe),je(X,e),e&&s(y),e&&s(d),e&&s(De),e&&s(J),e&&s(Ve),je(ce,e),e&&s(We),je(ne,e),ht=!1,Lt(gt)}}}const Yt=1;function Zt(o,l,n){let a,r,_,T,P=0,z=0,C=!1,k=!0,h=32,A=4e3,B=30,N=20;const m={x:h*B,y:h*N};let O;const L=async()=>{O=(await Wt(()=>import("../../../chunks/simulation.worker-f2100e46.js"),[],import.meta.url)).default,i()},x=y=>{n(2,T=y),a.postMessage({msg:"updateTable",attractionTable:T}),n(1,_=[r.map(d=>d.pos)]),n(11,M=0)},ee=()=>{n(10,m.x=h*B,m),n(10,m.y=h*N,m),i()},R=()=>{for(const y of r){const d=2*Math.random(),b=Math.random()*2*Math.PI,U=m.x/2+d*Math.cos(b),te=m.y/2+d*Math.sin(b);y.pos={x:U,y:te}}i(!0,!0)},q=()=>{for(const y of r){const d=200*Math.random(),b=Math.random()*2*Math.PI,U=m.x/2+d*Math.cos(b),te=m.y/2+d*Math.sin(b);y.pos={x:U,y:te}}i(!0,!0)},ae=()=>{const y=["white","red","green","blue"],d=m.x/4;for(const b of r){const U=Math.floor(b.pos.x/d),te=y[U];b.color=te}i(!0,!0)},se=()=>{i(!1,!0)},i=(y,d)=>{if(O===void 0)throw new Error("Worker is not initialized");a&&(a.postMessage({msg:"destroy"}),a.terminate()),a=new O;const b=U=>{_.push(U.data.positions)};a.onmessage=b,y||n(0,r=Kt(m,A)),d||n(2,T=Ht()),n(1,_=[]),n(11,M=0),a.postMessage({msg:"start",cells:r,attractionTable:T,worldSize:m,maxAttractionRadius:h})},F=()=>{n(11,M=0)};let M=0;const H=()=>{if(_.length-1>M){const y=Date.now();n(3,z=y-P),P=y,C||n(11,M++,M);const d=_[M];if(n(1,_),d.length!==r.length)return;for(let b=0;b<r.length;b++)n(0,r[b].pos=d[b],r)}};Dt(L),Vt(()=>a?.terminate());function j(){h=Z(this.value),n(6,h)}function G(){B=Z(this.value),n(8,B)}function $(){N=Z(this.value),n(9,N)}function ie(){A=Z(this.value),n(7,A)}function ue(){M=Z(this.value),n(11,M)}return[r,_,T,z,C,k,h,A,B,N,m,M,x,ee,R,q,ae,se,F,H,j,G,$,ie,ue,()=>n(11,M=_.length-1||0),()=>n(4,C=!C),()=>n(5,k=!k)]}class xt extends bt{constructor(l){super(),vt(this,l,Zt,Xt,wt,{},null,[-1,-1])}}function $t(o){let l,n;return l=new xt({}),{c(){qe(l.$$.fragment)},l(a){He(l.$$.fragment,a)},m(a,r){Je(l,a,r),n=!0},p:_t,i(a){n||(Ke(l.$$.fragment,a),n=!0)},o(a){Qe(l.$$.fragment,a),n=!1},d(a){je(l,a)}}}class no extends bt{constructor(l){super(),vt(this,l,null,$t,wt,{})}}export{no as default};
