import{S as Pt,i as It,s as zt,k as m,l as d,m as M,h as i,n as E,b as J,D as l,B as ht,o as Ot,q as B,a as I,w as mt,r as F,c as z,x as dt,R as G,y as pt,I as V,T as Q,u as Ut,f as bt,t as _t,z as vt,J as Ht,K as Jt}from"../../../chunks/index-689c9b92.js";import{_ as Kt}from"../../../chunks/preload-helper-41c905a7.js";import{A as jt}from"../../../chunks/AttractionTableChoice-fd543907.js";import{A as Gt}from"../../../chunks/AttractionTableComponent-d5de4049.js";const Vt=["white","red","green","blue"],Qt=()=>{const n=Math.floor(Math.random()*Vt.length);return Vt[n]},Xt=(n,a)=>{const r=[];for(let e=0;e<a;e++){const o={id:e,pos:{x:Math.random()*n.x,y:Math.random()*n.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:Qt()};r.push(o)}return r},Dt=function(n,a,r,e,o){const c=(n-a)/(r-a)*(o-e)+e;return e<o?qt(c,e,o):qt(c,o,e)},qt=function(n,a,r){return Math.max(Math.min(n,r),a)},Yt=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}});function Zt(n){let a,r;return{c(){a=m("div"),r=m("canvas"),this.h()},l(e){a=d(e,"DIV",{class:!0});var o=M(a);r=d(o,"CANVAS",{id:!0,class:!0}),M(r).forEach(i),o.forEach(i),this.h()},h(){E(r,"id","canvas"),E(r,"class","svelte-bkdgvm"),E(a,"class","container svelte-bkdgvm")},m(e,o){J(e,a,o),l(a,r)},p:ht,i:ht,o:ht,d(e){e&&i(a)}}}function $t(n,a,r){let{cellSize:e}=a,{cells:o}=a,{worldSize:c}=a,{drewFrame:w}=a,f;const A=["white","red","green","blue"],p={white:0,red:1,green:2,blue:3},L={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},b=A.length,_=e,S=_*2;function H(){const s=document.getElementById("canvas");if(!s||!f)throw new Error("Canvas is not ready");const g=s.getContext("2d");if(g.fillStyle=L.background,g.fillRect(0,0,s.width,s.height),!o?.length){window.requestAnimationFrame(H);return}for(let N=0;N<o.length;N++){const y=o[N],R=Math.floor(Dt(y.pos.x,0,c.x,0,s.width)),D=Math.floor(Dt(y.pos.y,0,c.y,0,s.height));var C=p[y.color];const X=C*S,Y=0,T=S,v=S,h=R-_,P=D-_,U=S,k=S;g.drawImage(f,X,Y,T,v,h,P,U,k)}w(),window.requestAnimationFrame(H)}return Ot(()=>{const s=document.getElementById("canvas");if(!s)throw new Error("Canvas is not ready");s.getContext("2d"),s.width=1600,s.height=960,f=document.createElement("canvas"),f.width=b*S,f.height=S;const g=f.getContext("2d");if(!g)throw new Error("Offscreen canvas is not ready");for(var C=0;C<b;++C){const N=A[C],y=L[N];g.fillStyle=y,g.beginPath(),g.arc(C*S+_,_,_,0,2*Math.PI),g.closePath(),g.fill()}window.requestAnimationFrame(H)}),n.$$set=s=>{"cellSize"in s&&r(0,e=s.cellSize),"cells"in s&&r(1,o=s.cells),"worldSize"in s&&r(2,c=s.worldSize),"drewFrame"in s&&r(3,w=s.drewFrame)},[e,o,c,w]}class xt extends Pt{constructor(a){super(),It(this,a,$t,Zt,zt,{cellSize:0,cells:1,worldSize:2,drewFrame:3})}}function te(n){let a,r,e,o,c,w,f,A,p,L,b,_,S,H,s,g,C=n[5]*n[3]+"",N,y,R,D,X,Y,T,v,h=n[6]*n[3]+"",P,U,k,x,wt,gt,q,st,K,it,O,tt,Mt,yt,et,Et,St,ot,Ct,ut,Z,ct,j,nt,Tt,At;return K=new xt({props:{cells:n[0],worldSize:n[2],cellSize:ee,drewFrame:n[12]}}),Z=new jt({props:{updateTable:n[7]}}),j=new Gt({props:{attractionTable:n[1],onUpdateTable:n[7]}}),{c(){a=m("h2"),r=B("V3 WIP"),e=I(),o=m("div"),c=m("p"),w=m("label"),f=B("Simulation definition"),A=I(),p=m("input"),L=I(),b=m("p"),_=m("label"),S=B("Simulation horizontal resolution"),H=I(),s=m("input"),g=B(`
        = `),N=B(C),y=I(),R=m("p"),D=m("label"),X=B("Simulation vertical resolution"),Y=I(),T=m("input"),v=B(`
        = `),P=B(h),U=I(),k=m("p"),x=m("label"),wt=B("Number of particles"),gt=I(),q=m("input"),st=I(),mt(K.$$.fragment),it=I(),O=m("div"),tt=m("button"),Mt=B("Reset simulation"),yt=I(),et=m("button"),Et=B("Center cells"),St=I(),ot=m("button"),Ct=B("Rainbow cells"),ut=I(),mt(Z.$$.fragment),ct=I(),mt(j.$$.fragment),this.h()},l(t){a=d(t,"H2",{});var u=M(a);r=F(u,"V3 WIP"),u.forEach(i),e=z(t),o=d(t,"DIV",{});var W=M(o);c=d(W,"P",{});var $=M(c);w=d($,"LABEL",{for:!0});var Rt=M(w);f=F(Rt,"Simulation definition"),Rt.forEach(i),A=z($),p=d($,"INPUT",{id:!0,type:!0}),$.forEach(i),L=z(W),b=d(W,"P",{});var at=M(b);_=d(at,"LABEL",{for:!0});var kt=M(_);S=F(kt,"Simulation horizontal resolution"),kt.forEach(i),H=z(at),s=d(at,"INPUT",{id:!0,type:!0}),g=F(at,`
        = `),N=F(at,C),at.forEach(i),y=z(W),R=d(W,"P",{});var rt=M(R);D=d(rt,"LABEL",{for:!0});var Nt=M(D);X=F(Nt,"Simulation vertical resolution"),Nt.forEach(i),Y=z(rt),T=d(rt,"INPUT",{id:!0,type:!0}),v=F(rt,`
        = `),P=F(rt,h),rt.forEach(i),U=z(W),k=d(W,"P",{});var ft=M(k);x=d(ft,"LABEL",{for:!0});var Wt=M(x);wt=F(Wt,"Number of particles"),Wt.forEach(i),gt=z(ft),q=d(ft,"INPUT",{id:!0,type:!0}),ft.forEach(i),W.forEach(i),st=z(t),dt(K.$$.fragment,t),it=z(t),O=d(t,"DIV",{});var lt=M(O);tt=d(lt,"BUTTON",{});var Bt=M(tt);Mt=F(Bt,"Reset simulation"),Bt.forEach(i),yt=z(lt),et=d(lt,"BUTTON",{});var Ft=M(et);Et=F(Ft,"Center cells"),Ft.forEach(i),St=z(lt),ot=d(lt,"BUTTON",{});var Lt=M(ot);Ct=F(Lt,"Rainbow cells"),Lt.forEach(i),lt.forEach(i),ut=z(t),dt(Z.$$.fragment,t),ct=z(t),dt(j.$$.fragment,t),this.h()},h(){E(w,"for","attractionRadius"),E(p,"id","attractionRadius"),E(p,"type","number"),E(_,"for","horizontalResolution"),E(s,"id","horizontalResolution"),E(s,"type","number"),E(D,"for","verticalResolution"),E(T,"id","verticalResolution"),E(T,"type","number"),E(x,"for","nbParticles"),E(q,"id","nbParticles"),E(q,"type","number")},m(t,u){J(t,a,u),l(a,r),J(t,e,u),J(t,o,u),l(o,c),l(c,w),l(w,f),l(c,A),l(c,p),G(p,n[3]),l(o,L),l(o,b),l(b,_),l(_,S),l(b,H),l(b,s),G(s,n[5]),l(b,g),l(b,N),l(o,y),l(o,R),l(R,D),l(D,X),l(R,Y),l(R,T),G(T,n[6]),l(R,v),l(R,P),l(o,U),l(o,k),l(k,x),l(x,wt),l(k,gt),l(k,q),G(q,n[4]),J(t,st,u),pt(K,t,u),J(t,it,u),J(t,O,u),l(O,tt),l(tt,Mt),l(O,yt),l(O,et),l(et,Et),l(O,St),l(O,ot),l(ot,Ct),J(t,ut,u),pt(Z,t,u),J(t,ct,u),pt(j,t,u),nt=!0,Tt||(At=[V(p,"input",n[13]),V(p,"change",n[8]),V(s,"input",n[14]),V(s,"change",n[8]),V(T,"input",n[15]),V(T,"change",n[8]),V(q,"input",n[16]),V(q,"change",n[8]),V(tt,"click",n[11]),V(et,"click",n[9]),V(ot,"click",n[10])],Tt=!0)},p(t,[u]){u&8&&Q(p.value)!==t[3]&&G(p,t[3]),u&32&&Q(s.value)!==t[5]&&G(s,t[5]),(!nt||u&40)&&C!==(C=t[5]*t[3]+"")&&Ut(N,C),u&64&&Q(T.value)!==t[6]&&G(T,t[6]),(!nt||u&72)&&h!==(h=t[6]*t[3]+"")&&Ut(P,h),u&16&&Q(q.value)!==t[4]&&G(q,t[4]);const W={};u&1&&(W.cells=t[0]),u&4&&(W.worldSize=t[2]),K.$set(W);const $={};u&2&&($.attractionTable=t[1]),j.$set($)},i(t){nt||(bt(K.$$.fragment,t),bt(Z.$$.fragment,t),bt(j.$$.fragment,t),nt=!0)},o(t){_t(K.$$.fragment,t),_t(Z.$$.fragment,t),_t(j.$$.fragment,t),nt=!1},d(t){t&&i(a),t&&i(e),t&&i(o),t&&i(st),vt(K,t),t&&i(it),t&&i(O),t&&i(ut),vt(Z,t),t&&i(ct),vt(j,t),Tt=!1,Ht(At)}}}const ee=1;function oe(n,a,r){let e,o,c,w;const f={x:1600,y:960};let A=32,p=4e3,L=60,b=40,_;const S=async()=>{_=(await Kt(()=>import("../../../chunks/simulation.worker-56f31538.js"),[],import.meta.url)).default,y()},H=v=>{r(1,w=v),e.postMessage({msg:"updateTable",attractionTable:w}),c=[o.map(h=>h.pos)]},s=()=>{r(2,f.x=A*L,f),r(2,f.y=A*b,f),y()},g=()=>{for(const v of o){const h=2*Math.random(),P=Math.random()*2*Math.PI,U=f.x/2+h*Math.cos(P),k=f.y/2+h*Math.sin(P);v.pos={x:U,y:k}}y(!0,!0)},C=()=>{const v=["white","red","green","blue"],h=f.x/4;for(const P of o){const U=Math.floor(P.pos.x/h),k=v[U];P.color=k}y(!0,!0)},N=()=>{y(!1,!1)},y=(v,h)=>{if(_===void 0)throw new Error("Worker is not initialized");e&&(e.postMessage({msg:"destroy"}),e.terminate()),e=new _;const P=U=>{c.push(U.data.positions)};e.onmessage=P,v||r(0,o=Xt(f,p)),h||r(1,w=Yt()),c=[],e.postMessage({msg:"start",cells:o,attractionTable:w,worldSize:f,maxAttractionRadius:A})},R=()=>{if(c.length>0){const v=c.shift()||[];if(v.length!==o.length)return;for(let h=0;h<o.length;h++)r(0,o[h].pos=v[h],o)}};Ot(S),Jt(()=>e?.terminate());function D(){A=Q(this.value),r(3,A)}function X(){L=Q(this.value),r(5,L)}function Y(){b=Q(this.value),r(6,b)}function T(){p=Q(this.value),r(4,p)}return[o,w,f,A,p,L,b,H,s,g,C,N,R,D,X,Y,T]}class ne extends Pt{constructor(a){super(),It(this,a,oe,te,zt,{})}}function ae(n){let a,r;return a=new ne({}),{c(){mt(a.$$.fragment)},l(e){dt(a.$$.fragment,e)},m(e,o){pt(a,e,o),r=!0},p:ht,i(e){r||(bt(a.$$.fragment,e),r=!0)},o(e){_t(a.$$.fragment,e),r=!1},d(e){vt(a,e)}}}class ue extends Pt{constructor(a){super(),It(this,a,null,ae,zt,{})}}export{ue as default};
