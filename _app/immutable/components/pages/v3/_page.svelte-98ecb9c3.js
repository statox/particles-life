import{S as fe,i as ce,s as he,k as u,a as w,q as P,l as f,m as d,h as s,c as M,r as S,n as b,b as X,D as e,R as J,I as N,T as Y,B as ue,J as Ie,o as ke,w as Bt,x as Lt,y as Ut,u as Pt,f as Dt,t as Wt,z as Ot,K as Ae}from"../../../chunks/index-689c9b92.js";import{_ as ze}from"../../../chunks/preload-helper-41c905a7.js";import{A as Fe}from"../../../chunks/AttractionTableChoice-54d975cc.js";import{A as Ne}from"../../../chunks/AttractionTableComponent-68b8dc88.js";const ye=function(n,r,o,a,l){const h=(n-r)/(o-r)*(l-a)+a;return a<l?Te(h,a,l):Te(h,l,a)},Te=function(n,r,o){return Math.max(Math.min(n,o),r)},Re=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}}),Ce=["white","red","green","blue"],Be=()=>{const n=Math.floor(Math.random()*Ce.length);return Ce[n]},Le=(n,r)=>{const o=[];for(let a=0;a<r;a++){const l={id:a,pos:{x:Math.random()*n.x,y:Math.random()*n.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:Be()};o.push(l)}return o};function Ue(n){let r,o,a,l,h,k,p,U,A;return{c(){r=u("div"),o=u("canvas"),a=w(),l=u("label"),h=P("Limit FPS"),k=w(),p=u("input"),this.h()},l(v){r=f(v,"DIV",{class:!0});var m=d(r);o=f(m,"CANVAS",{id:!0,class:!0}),d(o).forEach(s),a=M(m),l=f(m,"LABEL",{for:!0});var y=d(l);h=S(y,"Limit FPS"),y.forEach(s),k=M(m),p=f(m,"INPUT",{id:!0,type:!0,min:!0}),m.forEach(s),this.h()},h(){b(o,"id","canvas"),b(o,"class","svelte-bkdgvm"),b(l,"for","maxFPSInput"),b(p,"id","maxFPSInput"),b(p,"type","number"),b(p,"min","1"),b(r,"class","container svelte-bkdgvm")},m(v,m){X(v,r,m),e(r,o),e(r,a),e(r,l),e(l,h),e(r,k),e(r,p),J(p,n[1]),U||(A=[N(p,"input",n[7]),N(p,"change",n[8])],U=!0)},p(v,[m]){m&2&&Y(p.value)!==v[1]&&J(p,v[1])},i:ue,o:ue,d(v){v&&s(r),U=!1,Ie(A)}}}function De(n,r,o){let{cellSize:a}=r,{cells:l}=r,{worldSize:h}=r,{drewFrame:k}=r,p;const U=["white","red","green","blue"],A={white:0,red:1,green:2,blue:3},v={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},m=U.length,y=a,R=y*2;let T=25,F=T,K,j,Z,et;function B(){const c=document.getElementById("canvas");if(!c||!p)throw new Error("Canvas is not ready");if(window.requestAnimationFrame(B),Z=Date.now(),et=Z-j,et<=K)return;j=Z-et%K;const E=c.getContext("2d");if(E.fillStyle=v.background,E.fillRect(0,0,c.width,c.height),!l?.length){window.requestAnimationFrame(B);return}for(let D=0;D<l.length;D++){const V=l[D],rt=Math.floor(ye(V.pos.x,0,h.x,0,c.width)),G=Math.floor(ye(V.pos.y,0,h.y,0,c.height));var I=A[V.color];const $=I*R,at=0,ut=R,W=R,z=rt-y,_=G-y,C=R,g=R;E.drawImage(p,$,at,ut,W,z,_,C,g)}k()}ke(()=>{const c=document.getElementById("canvas");if(!c)throw new Error("Canvas is not ready");c.getContext("2d"),c.width=1600,c.height=960,p=document.createElement("canvas"),p.width=m*R,p.height=R;const E=p.getContext("2d");if(!E)throw new Error("Offscreen canvas is not ready");for(var I=0;I<m;++I){const D=U[I],V=v[D];E.fillStyle=V,E.beginPath(),E.arc(I*R+y,y,y,0,2*Math.PI),E.closePath(),E.fill()}o(2,K=1e3/T),j=Date.now(),window.requestAnimationFrame(B)});function x(){F=Y(this.value),o(1,F)}const lt=()=>{o(0,T=F),o(2,K=1e3/T)};return n.$$set=c=>{"cellSize"in c&&o(3,a=c.cellSize),"cells"in c&&o(4,l=c.cells),"worldSize"in c&&o(5,h=c.worldSize),"drewFrame"in c&&o(6,k=c.drewFrame)},[T,F,K,a,l,h,k,x,lt]}class We extends fe{constructor(r){super(),ce(this,r,De,Ue,he,{cellSize:3,cells:4,worldSize:5,drewFrame:6})}}function Oe(n){let r,o,a,l,h,k,p,U,A,v,m,y,R,T,F,K,j=n[7]*n[5]+"",Z,et,B,x,lt,c,E,I,D=n[8]*n[5]+"",V,rt,G,$,at,ut,W,z,_,C,g,L,ft,Vt,St=(n[1]?.length||0)-n[10]+"",Tt,qt,ct,Ht,Ct,Jt,ht,Kt,It,jt,O,kt,Gt,mt,Qt,Xt,dt,Yt,Zt,pt,yt=n[4]?"Play":"Pause",At,zt,q,_t,xt,$t,bt,te,ee,vt,ne,oe,gt,le,Ft,st,Nt,nt,Q,re,me;return _=new We({props:{cells:n[0],worldSize:n[9],cellSize:Ve,drewFrame:n[18]}}),st=new Fe({props:{updateTable:n[11]}}),nt=new Ne({props:{attractionTable:n[2],onUpdateTable:n[11]}}),{c(){r=u("h2"),o=P("V3 WIP"),a=w(),l=u("div"),h=u("p"),k=u("label"),p=P("Simulation definition"),U=w(),A=u("input"),v=w(),m=u("p"),y=u("label"),R=P("Simulation horizontal resolution"),T=w(),F=u("input"),K=P(`
        = `),Z=P(j),et=w(),B=u("p"),x=u("label"),lt=P("Simulation vertical resolution"),c=w(),E=u("input"),I=P(`
        = `),V=P(D),rt=w(),G=u("p"),$=u("label"),at=P("Number of particles"),ut=w(),W=u("input"),z=w(),Bt(_.$$.fragment),C=w(),g=u("div"),L=u("div"),ft=u("span"),Vt=P("Buffer size: "),Tt=P(St),qt=w(),ct=u("span"),Ht=P("Current frame: "),Ct=P(n[10]),Jt=w(),ht=u("span"),Kt=P("Frame length (ms): "),It=P(n[3]),jt=w(),O=u("input"),Gt=w(),mt=u("button"),Qt=P("Replay from start"),Xt=w(),dt=u("button"),Yt=P("Catchup last frame"),Zt=w(),pt=u("button"),At=P(yt),zt=w(),q=u("div"),_t=u("button"),xt=P("Reset cells"),$t=w(),bt=u("button"),te=P("Center cells"),ee=w(),vt=u("button"),ne=P("Large Center cells"),oe=w(),gt=u("button"),le=P("Rainbow cells"),Ft=w(),Bt(st.$$.fragment),Nt=w(),Bt(nt.$$.fragment),this.h()},l(t){r=f(t,"H2",{});var i=d(r);o=S(i,"V3 WIP"),i.forEach(s),a=M(t),l=f(t,"DIV",{});var H=d(l);h=f(H,"P",{});var it=d(h);k=f(it,"LABEL",{for:!0});var de=d(k);p=S(de,"Simulation definition"),de.forEach(s),U=M(it),A=f(it,"INPUT",{id:!0,type:!0}),it.forEach(s),v=M(H),m=f(H,"P",{});var wt=d(m);y=f(wt,"LABEL",{for:!0});var pe=d(y);R=S(pe,"Simulation horizontal resolution"),pe.forEach(s),T=M(wt),F=f(wt,"INPUT",{id:!0,type:!0}),K=S(wt,`
        = `),Z=S(wt,j),wt.forEach(s),et=M(H),B=f(H,"P",{});var Mt=d(B);x=f(Mt,"LABEL",{for:!0});var _e=d(x);lt=S(_e,"Simulation vertical resolution"),_e.forEach(s),c=M(Mt),E=f(Mt,"INPUT",{id:!0,type:!0}),I=S(Mt,`
        = `),V=S(Mt,D),Mt.forEach(s),rt=M(H),G=f(H,"P",{});var Rt=d(G);$=f(Rt,"LABEL",{for:!0});var be=d($);at=S(be,"Number of particles"),be.forEach(s),ut=M(Rt),W=f(Rt,"INPUT",{id:!0,type:!0}),Rt.forEach(s),H.forEach(s),z=M(t),Lt(_.$$.fragment,t),C=M(t),g=f(t,"DIV",{});var tt=d(g);L=f(tt,"DIV",{});var Et=d(L);ft=f(Et,"SPAN",{});var ae=d(ft);Vt=S(ae,"Buffer size: "),Tt=S(ae,St),ae.forEach(s),qt=M(Et),ct=f(Et,"SPAN",{});var se=d(ct);Ht=S(se,"Current frame: "),Ct=S(se,n[10]),se.forEach(s),Jt=M(Et),ht=f(Et,"SPAN",{});var ie=d(ht);Kt=S(ie,"Frame length (ms): "),It=S(ie,n[3]),ie.forEach(s),Et.forEach(s),jt=M(tt),O=f(tt,"INPUT",{type:!0,min:!0,max:!0,class:!0,id:!0}),Gt=M(tt),mt=f(tt,"BUTTON",{});var ve=d(mt);Qt=S(ve,"Replay from start"),ve.forEach(s),Xt=M(tt),dt=f(tt,"BUTTON",{});var ge=d(dt);Yt=S(ge,"Catchup last frame"),ge.forEach(s),Zt=M(tt),pt=f(tt,"BUTTON",{});var we=d(pt);At=S(we,yt),we.forEach(s),tt.forEach(s),zt=M(t),q=f(t,"DIV",{});var ot=d(q);_t=f(ot,"BUTTON",{});var Me=d(_t);xt=S(Me,"Reset cells"),Me.forEach(s),$t=M(ot),bt=f(ot,"BUTTON",{});var Ee=d(bt);te=S(Ee,"Center cells"),Ee.forEach(s),ee=M(ot),vt=f(ot,"BUTTON",{});var Pe=d(vt);ne=S(Pe,"Large Center cells"),Pe.forEach(s),oe=M(ot),gt=f(ot,"BUTTON",{});var Se=d(gt);le=S(Se,"Rainbow cells"),Se.forEach(s),ot.forEach(s),Ft=M(t),Lt(st.$$.fragment,t),Nt=M(t),Lt(nt.$$.fragment,t),this.h()},h(){b(k,"for","attractionRadius"),b(A,"id","attractionRadius"),b(A,"type","number"),b(y,"for","horizontalResolution"),b(F,"id","horizontalResolution"),b(F,"type","number"),b(x,"for","verticalResolution"),b(E,"id","verticalResolution"),b(E,"type","number"),b($,"for","nbParticles"),b(W,"id","nbParticles"),b(W,"type","number"),b(O,"type","range"),b(O,"min","1"),b(O,"max",kt=n[1]?.length?n[1].length-1:0),b(O,"class","slider"),b(O,"id","frameIndexSlider")},m(t,i){X(t,r,i),e(r,o),X(t,a,i),X(t,l,i),e(l,h),e(h,k),e(k,p),e(h,U),e(h,A),J(A,n[5]),e(l,v),e(l,m),e(m,y),e(y,R),e(m,T),e(m,F),J(F,n[7]),e(m,K),e(m,Z),e(l,et),e(l,B),e(B,x),e(x,lt),e(B,c),e(B,E),J(E,n[8]),e(B,I),e(B,V),e(l,rt),e(l,G),e(G,$),e($,at),e(G,ut),e(G,W),J(W,n[6]),X(t,z,i),Ut(_,t,i),X(t,C,i),X(t,g,i),e(g,L),e(L,ft),e(ft,Vt),e(ft,Tt),e(L,qt),e(L,ct),e(ct,Ht),e(ct,Ct),e(L,Jt),e(L,ht),e(ht,Kt),e(ht,It),e(g,jt),e(g,O),J(O,n[10]),e(g,Gt),e(g,mt),e(mt,Qt),e(g,Xt),e(g,dt),e(dt,Yt),e(g,Zt),e(g,pt),e(pt,At),X(t,zt,i),X(t,q,i),e(q,_t),e(_t,xt),e(q,$t),e(q,bt),e(bt,te),e(q,ee),e(q,vt),e(vt,ne),e(q,oe),e(q,gt),e(gt,le),X(t,Ft,i),Ut(st,t,i),X(t,Nt,i),Ut(nt,t,i),Q=!0,re||(me=[N(A,"input",n[19]),N(A,"change",n[12]),N(F,"input",n[20]),N(F,"change",n[12]),N(E,"input",n[21]),N(E,"change",n[12]),N(W,"input",n[22]),N(W,"change",n[12]),N(O,"change",n[23]),N(O,"input",n[23]),N(mt,"click",n[17]),N(dt,"click",n[24]),N(pt,"click",n[25]),N(_t,"click",n[16]),N(bt,"click",n[13]),N(vt,"click",n[14]),N(gt,"click",n[15])],re=!0)},p(t,[i]){i&32&&Y(A.value)!==t[5]&&J(A,t[5]),i&128&&Y(F.value)!==t[7]&&J(F,t[7]),(!Q||i&160)&&j!==(j=t[7]*t[5]+"")&&Pt(Z,j),i&256&&Y(E.value)!==t[8]&&J(E,t[8]),(!Q||i&288)&&D!==(D=t[8]*t[5]+"")&&Pt(V,D),i&64&&Y(W.value)!==t[6]&&J(W,t[6]);const H={};i&1&&(H.cells=t[0]),i&512&&(H.worldSize=t[9]),_.$set(H),(!Q||i&1026)&&St!==(St=(t[1]?.length||0)-t[10]+"")&&Pt(Tt,St),(!Q||i&1024)&&Pt(Ct,t[10]),(!Q||i&8)&&Pt(It,t[3]),(!Q||i&2&&kt!==(kt=t[1]?.length?t[1].length-1:0))&&b(O,"max",kt),i&1024&&J(O,t[10]),(!Q||i&16)&&yt!==(yt=t[4]?"Play":"Pause")&&Pt(At,yt);const it={};i&4&&(it.attractionTable=t[2]),nt.$set(it)},i(t){Q||(Dt(_.$$.fragment,t),Dt(st.$$.fragment,t),Dt(nt.$$.fragment,t),Q=!0)},o(t){Wt(_.$$.fragment,t),Wt(st.$$.fragment,t),Wt(nt.$$.fragment,t),Q=!1},d(t){t&&s(r),t&&s(a),t&&s(l),t&&s(z),Ot(_,t),t&&s(C),t&&s(g),t&&s(zt),t&&s(q),t&&s(Ft),Ot(st,t),t&&s(Nt),Ot(nt,t),re=!1,Ie(me)}}}const Ve=1;function qe(n,r,o){let a,l,h,k,p=0,U=0,A=!1,v=32,m=4e3,y=30,R=20;const T={x:v*y,y:v*R};let F;const K=async()=>{F=(await ze(()=>import("../../../chunks/simulation.worker-f2100e46.js"),[],import.meta.url)).default,c()},j=z=>{o(2,k=z),a.postMessage({msg:"updateTable",attractionTable:k}),o(1,h=[l.map(_=>_.pos)])},Z=()=>{o(9,T.x=v*y,T),o(9,T.y=v*R,T),c()},et=()=>{for(const z of l){const _=2*Math.random(),C=Math.random()*2*Math.PI,g=T.x/2+_*Math.cos(C),L=T.y/2+_*Math.sin(C);z.pos={x:g,y:L}}c(!0,!0)},B=()=>{for(const z of l){const _=200*Math.random(),C=Math.random()*2*Math.PI,g=T.x/2+_*Math.cos(C),L=T.y/2+_*Math.sin(C);z.pos={x:g,y:L}}c(!0,!0)},x=()=>{const z=["white","red","green","blue"],_=T.x/4;for(const C of l){const g=Math.floor(C.pos.x/_),L=z[g];C.color=L}c(!0,!0)},lt=()=>{c(!1,!0)},c=(z,_)=>{if(F===void 0)throw new Error("Worker is not initialized");a&&(a.postMessage({msg:"destroy"}),a.terminate()),a=new F;const C=g=>{h.push(g.data.positions)};a.onmessage=C,z||o(0,l=Le(T,m)),_||o(2,k=Re()),o(1,h=[]),o(10,I=0),a.postMessage({msg:"start",cells:l,attractionTable:k,worldSize:T,maxAttractionRadius:v})},E=()=>{o(10,I=0)};let I=0;const D=()=>{if(h.length-1>I){const z=Date.now();o(3,U=z-p),p=z,A||o(10,I++,I);const _=h[I];if(o(1,h),_.length!==l.length)return;for(let C=0;C<l.length;C++)o(0,l[C].pos=_[C],l)}};ke(K),Ae(()=>a?.terminate());function V(){v=Y(this.value),o(5,v)}function rt(){y=Y(this.value),o(7,y)}function G(){R=Y(this.value),o(8,R)}function $(){m=Y(this.value),o(6,m)}function at(){I=Y(this.value),o(10,I)}return[l,h,k,U,A,v,m,y,R,T,I,j,Z,et,B,x,lt,E,D,V,rt,G,$,at,()=>o(10,I=h.length-1||0),()=>o(4,A=!A)]}class He extends fe{constructor(r){super(),ce(this,r,qe,Oe,he,{})}}function Je(n){let r,o;return r=new He({}),{c(){Bt(r.$$.fragment)},l(a){Lt(r.$$.fragment,a)},m(a,l){Ut(r,a,l),o=!0},p:ue,i(a){o||(Dt(r.$$.fragment,a),o=!0)},o(a){Wt(r.$$.fragment,a),o=!1},d(a){Ot(r,a)}}}class Xe extends fe{constructor(r){super(),ce(this,r,null,Je,he,{})}}export{Xe as default};
