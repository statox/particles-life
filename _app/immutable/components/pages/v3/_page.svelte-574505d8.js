import{S as fe,i as ce,s as he,k as f,l as c,m as h,h as s,n as M,b as G,D as e,B as Ft,o as Ie,q as _,a as b,w as Ut,r as v,c as g,x as Lt,R as Y,y as Wt,I,T as $,u as wt,f as Dt,t as Ot,z as Vt,J as ke,K as ze}from"../../../chunks/index-689c9b92.js";import{_ as Ae}from"../../../chunks/preload-helper-41c905a7.js";import{A as Ne}from"../../../chunks/AttractionTableChoice-fd543907.js";import{A as Re}from"../../../chunks/AttractionTableComponent-d5de4049.js";const Se=function(n,r,o,a,l){const m=(n-r)/(o-r)*(l-a)+a;return a<l?Pe(m,a,l):Pe(m,l,a)},Pe=function(n,r,o){return Math.max(Math.min(n,o),r)},Be=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}}),Ce=["white","red","green","blue"],Fe=()=>{const n=Math.floor(Math.random()*Ce.length);return Ce[n]},Ue=(n,r)=>{const o=[];for(let a=0;a<r;a++){const l={id:a,pos:{x:Math.random()*n.x,y:Math.random()*n.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:Fe()};o.push(l)}return o};function Le(n){let r,o;return{c(){r=f("div"),o=f("canvas"),this.h()},l(a){r=c(a,"DIV",{class:!0});var l=h(r);o=c(l,"CANVAS",{id:!0,class:!0}),h(o).forEach(s),l.forEach(s),this.h()},h(){M(o,"id","canvas"),M(o,"class","svelte-bkdgvm"),M(r,"class","container svelte-bkdgvm")},m(a,l){G(a,r,l),e(r,o)},p:Ft,i:Ft,o:Ft,d(a){a&&s(r)}}}function We(n,r,o){let{cellSize:a}=r,{cells:l}=r,{worldSize:m}=r,{drewFrame:k}=r,F;const Z=["white","red","green","blue"],P={white:0,red:1,green:2,blue:3},E={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},T=Z.length,y=a,C=y*2;function W(){const i=document.getElementById("canvas");if(!i||!F)throw new Error("Canvas is not ready");const z=i.getContext("2d");if(z.fillStyle=E.background,z.fillRect(0,0,i.width,i.height),!l?.length){window.requestAnimationFrame(W);return}for(let D=0;D<l.length;D++){const H=l[D],U=Math.floor(Se(H.pos.x,0,m.x,0,i.width)),Q=Math.floor(Se(H.pos.y,0,m.y,0,i.height));var R=P[H.color];const lt=R*C,O=0,B=C,A=C,x=U-y,tt=Q-y,at=C,J=C;z.drawImage(F,lt,O,B,A,x,tt,at,J)}k(),window.requestAnimationFrame(W)}return Ie(()=>{const i=document.getElementById("canvas");if(!i)throw new Error("Canvas is not ready");i.getContext("2d"),i.width=1600,i.height=960,F=document.createElement("canvas"),F.width=T*C,F.height=C;const z=F.getContext("2d");if(!z)throw new Error("Offscreen canvas is not ready");for(var R=0;R<T;++R){const D=Z[R],H=E[D];z.fillStyle=H,z.beginPath(),z.arc(R*C+y,y,y,0,2*Math.PI),z.closePath(),z.fill()}window.requestAnimationFrame(W)}),n.$$set=i=>{"cellSize"in i&&o(0,a=i.cellSize),"cells"in i&&o(1,l=i.cells),"worldSize"in i&&o(2,m=i.worldSize),"drewFrame"in i&&o(3,k=i.drewFrame)},[a,l,m,k]}class De extends fe{constructor(r){super(),ce(this,r,We,Le,he,{cellSize:0,cells:1,worldSize:2,drewFrame:3})}}function Oe(n){let r,o,a,l,m,k,F,Z,P,E,T,y,C,W,i,z,R=n[8]*n[6]+"",D,H,U,Q,lt,O,B,A,x=n[9]*n[6]+"",tt,at,J,et,Et,St,K,S,d,w,p,N,it,qt,Tt=(n[1]?.length||0)-n[10]+"",Pt,Ht,ut,Jt,Ct,Kt,ft,jt,It,Gt,L,kt,Qt,ct,Xt,Yt,ht,Zt,xt,mt,yt=n[4]?"Play":"Pause",zt,At,V,dt,$t,te,pt,ee,ne,_t,oe,le,bt,ae,Nt,rt,Rt,nt,j,re,me;return d=new De({props:{cells:n[0],worldSize:n[5],cellSize:Ve,drewFrame:n[18]}}),rt=new Ne({props:{updateTable:n[11]}}),nt=new Re({props:{attractionTable:n[2],onUpdateTable:n[11]}}),{c(){r=f("h2"),o=_("V3 WIP"),a=b(),l=f("div"),m=f("p"),k=f("label"),F=_("Simulation definition"),Z=b(),P=f("input"),E=b(),T=f("p"),y=f("label"),C=_("Simulation horizontal resolution"),W=b(),i=f("input"),z=_(`
        = `),D=_(R),H=b(),U=f("p"),Q=f("label"),lt=_("Simulation vertical resolution"),O=b(),B=f("input"),A=_(`
        = `),tt=_(x),at=b(),J=f("p"),et=f("label"),Et=_("Number of particles"),St=b(),K=f("input"),S=b(),Ut(d.$$.fragment),w=b(),p=f("div"),N=f("div"),it=f("span"),qt=_("Buffer size: "),Pt=_(Tt),Ht=b(),ut=f("span"),Jt=_("Current frame: "),Ct=_(n[10]),Kt=b(),ft=f("span"),jt=_("Frame length (ms): "),It=_(n[3]),Gt=b(),L=f("input"),Qt=b(),ct=f("button"),Xt=_("Replay from start"),Yt=b(),ht=f("button"),Zt=_("Catchup last frame"),xt=b(),mt=f("button"),zt=_(yt),At=b(),V=f("div"),dt=f("button"),$t=_("Reset simulation"),te=b(),pt=f("button"),ee=_("Center cells"),ne=b(),_t=f("button"),oe=_("Large Center cells"),le=b(),bt=f("button"),ae=_("Rainbow cells"),Nt=b(),Ut(rt.$$.fragment),Rt=b(),Ut(nt.$$.fragment),this.h()},l(t){r=c(t,"H2",{});var u=h(r);o=v(u,"V3 WIP"),u.forEach(s),a=g(t),l=c(t,"DIV",{});var q=h(l);m=c(q,"P",{});var st=h(m);k=c(st,"LABEL",{for:!0});var de=h(k);F=v(de,"Simulation definition"),de.forEach(s),Z=g(st),P=c(st,"INPUT",{id:!0,type:!0}),st.forEach(s),E=g(q),T=c(q,"P",{});var vt=h(T);y=c(vt,"LABEL",{for:!0});var pe=h(y);C=v(pe,"Simulation horizontal resolution"),pe.forEach(s),W=g(vt),i=c(vt,"INPUT",{id:!0,type:!0}),z=v(vt,`
        = `),D=v(vt,R),vt.forEach(s),H=g(q),U=c(q,"P",{});var gt=h(U);Q=c(gt,"LABEL",{for:!0});var _e=h(Q);lt=v(_e,"Simulation vertical resolution"),_e.forEach(s),O=g(gt),B=c(gt,"INPUT",{id:!0,type:!0}),A=v(gt,`
        = `),tt=v(gt,x),gt.forEach(s),at=g(q),J=c(q,"P",{});var Bt=h(J);et=c(Bt,"LABEL",{for:!0});var be=h(et);Et=v(be,"Number of particles"),be.forEach(s),St=g(Bt),K=c(Bt,"INPUT",{id:!0,type:!0}),Bt.forEach(s),q.forEach(s),S=g(t),Lt(d.$$.fragment,t),w=g(t),p=c(t,"DIV",{});var X=h(p);N=c(X,"DIV",{});var Mt=h(N);it=c(Mt,"SPAN",{});var se=h(it);qt=v(se,"Buffer size: "),Pt=v(se,Tt),se.forEach(s),Ht=g(Mt),ut=c(Mt,"SPAN",{});var ie=h(ut);Jt=v(ie,"Current frame: "),Ct=v(ie,n[10]),ie.forEach(s),Kt=g(Mt),ft=c(Mt,"SPAN",{});var ue=h(ft);jt=v(ue,"Frame length (ms): "),It=v(ue,n[3]),ue.forEach(s),Mt.forEach(s),Gt=g(X),L=c(X,"INPUT",{type:!0,min:!0,max:!0,class:!0,id:!0}),Qt=g(X),ct=c(X,"BUTTON",{});var ve=h(ct);Xt=v(ve,"Replay from start"),ve.forEach(s),Yt=g(X),ht=c(X,"BUTTON",{});var ge=h(ht);Zt=v(ge,"Catchup last frame"),ge.forEach(s),xt=g(X),mt=c(X,"BUTTON",{});var Me=h(mt);zt=v(Me,yt),Me.forEach(s),X.forEach(s),At=g(t),V=c(t,"DIV",{});var ot=h(V);dt=c(ot,"BUTTON",{});var we=h(dt);$t=v(we,"Reset simulation"),we.forEach(s),te=g(ot),pt=c(ot,"BUTTON",{});var Ee=h(pt);ee=v(Ee,"Center cells"),Ee.forEach(s),ne=g(ot),_t=c(ot,"BUTTON",{});var Te=h(_t);oe=v(Te,"Large Center cells"),Te.forEach(s),le=g(ot),bt=c(ot,"BUTTON",{});var ye=h(bt);ae=v(ye,"Rainbow cells"),ye.forEach(s),ot.forEach(s),Nt=g(t),Lt(rt.$$.fragment,t),Rt=g(t),Lt(nt.$$.fragment,t),this.h()},h(){M(k,"for","attractionRadius"),M(P,"id","attractionRadius"),M(P,"type","number"),M(y,"for","horizontalResolution"),M(i,"id","horizontalResolution"),M(i,"type","number"),M(Q,"for","verticalResolution"),M(B,"id","verticalResolution"),M(B,"type","number"),M(et,"for","nbParticles"),M(K,"id","nbParticles"),M(K,"type","number"),M(L,"type","range"),M(L,"min","1"),M(L,"max",kt=n[1]?.length?n[1].length-1:0),M(L,"class","slider"),M(L,"id","frameIndexSlider")},m(t,u){G(t,r,u),e(r,o),G(t,a,u),G(t,l,u),e(l,m),e(m,k),e(k,F),e(m,Z),e(m,P),Y(P,n[6]),e(l,E),e(l,T),e(T,y),e(y,C),e(T,W),e(T,i),Y(i,n[8]),e(T,z),e(T,D),e(l,H),e(l,U),e(U,Q),e(Q,lt),e(U,O),e(U,B),Y(B,n[9]),e(U,A),e(U,tt),e(l,at),e(l,J),e(J,et),e(et,Et),e(J,St),e(J,K),Y(K,n[7]),G(t,S,u),Wt(d,t,u),G(t,w,u),G(t,p,u),e(p,N),e(N,it),e(it,qt),e(it,Pt),e(N,Ht),e(N,ut),e(ut,Jt),e(ut,Ct),e(N,Kt),e(N,ft),e(ft,jt),e(ft,It),e(p,Gt),e(p,L),Y(L,n[10]),e(p,Qt),e(p,ct),e(ct,Xt),e(p,Yt),e(p,ht),e(ht,Zt),e(p,xt),e(p,mt),e(mt,zt),G(t,At,u),G(t,V,u),e(V,dt),e(dt,$t),e(V,te),e(V,pt),e(pt,ee),e(V,ne),e(V,_t),e(_t,oe),e(V,le),e(V,bt),e(bt,ae),G(t,Nt,u),Wt(rt,t,u),G(t,Rt,u),Wt(nt,t,u),j=!0,re||(me=[I(P,"input",n[19]),I(P,"change",n[12]),I(i,"input",n[20]),I(i,"change",n[12]),I(B,"input",n[21]),I(B,"change",n[12]),I(K,"input",n[22]),I(K,"change",n[12]),I(L,"change",n[23]),I(L,"input",n[23]),I(ct,"click",n[17]),I(ht,"click",n[24]),I(mt,"click",n[25]),I(dt,"click",n[16]),I(pt,"click",n[13]),I(_t,"click",n[14]),I(bt,"click",n[15])],re=!0)},p(t,[u]){u&64&&$(P.value)!==t[6]&&Y(P,t[6]),u&256&&$(i.value)!==t[8]&&Y(i,t[8]),(!j||u&320)&&R!==(R=t[8]*t[6]+"")&&wt(D,R),u&512&&$(B.value)!==t[9]&&Y(B,t[9]),(!j||u&576)&&x!==(x=t[9]*t[6]+"")&&wt(tt,x),u&128&&$(K.value)!==t[7]&&Y(K,t[7]);const q={};u&1&&(q.cells=t[0]),u&32&&(q.worldSize=t[5]),d.$set(q),(!j||u&1026)&&Tt!==(Tt=(t[1]?.length||0)-t[10]+"")&&wt(Pt,Tt),(!j||u&1024)&&wt(Ct,t[10]),(!j||u&8)&&wt(It,t[3]),(!j||u&2&&kt!==(kt=t[1]?.length?t[1].length-1:0))&&M(L,"max",kt),u&1024&&Y(L,t[10]),(!j||u&16)&&yt!==(yt=t[4]?"Play":"Pause")&&wt(zt,yt);const st={};u&4&&(st.attractionTable=t[2]),nt.$set(st)},i(t){j||(Dt(d.$$.fragment,t),Dt(rt.$$.fragment,t),Dt(nt.$$.fragment,t),j=!0)},o(t){Ot(d.$$.fragment,t),Ot(rt.$$.fragment,t),Ot(nt.$$.fragment,t),j=!1},d(t){t&&s(r),t&&s(a),t&&s(l),t&&s(S),Vt(d,t),t&&s(w),t&&s(p),t&&s(At),t&&s(V),t&&s(Nt),Vt(rt,t),t&&s(Rt),Vt(nt,t),re=!1,ke(me)}}}const Ve=1;function qe(n,r,o){let a,l,m,k,F=0,Z=0,P=!1;const E={x:1600,y:960};let T=32,y=4e3,C=60,W=40,i;const z=async()=>{i=(await Ae(()=>import("../../../chunks/simulation.worker-a89055d5.js"),[],import.meta.url)).default,O()},R=S=>{o(2,k=S),a.postMessage({msg:"updateTable",attractionTable:k}),o(1,m=[l.map(d=>d.pos)])},D=()=>{o(5,E.x=T*C,E),o(5,E.y=T*W,E),O()},H=()=>{for(const S of l){const d=2*Math.random(),w=Math.random()*2*Math.PI,p=E.x/2+d*Math.cos(w),N=E.y/2+d*Math.sin(w);S.pos={x:p,y:N}}O(!0,!0)},U=()=>{for(const S of l){const d=200*Math.random(),w=Math.random()*2*Math.PI,p=E.x/2+d*Math.cos(w),N=E.y/2+d*Math.sin(w);S.pos={x:p,y:N}}O(!0,!0)},Q=()=>{const S=["white","red","green","blue"],d=E.x/4;for(const w of l){const p=Math.floor(w.pos.x/d),N=S[p];w.color=N}O(!0,!0)},lt=()=>{O(!1,!1)},O=(S,d)=>{if(i===void 0)throw new Error("Worker is not initialized");a&&(a.postMessage({msg:"destroy"}),a.terminate()),a=new i;const w=p=>{m.push(p.data.positions)};a.onmessage=w,S||o(0,l=Ue(E,y)),d||o(2,k=Be()),o(1,m=[]),o(10,A=0),a.postMessage({msg:"start",cells:l,attractionTable:k,worldSize:E,maxAttractionRadius:T})},B=()=>{o(10,A=0)};let A=0;const x=()=>{if(m.length-1>A){const S=Date.now();o(3,Z=S-F),F=S,P||o(10,A++,A);const d=m[A];if(o(1,m),d.length!==l.length)return;for(let w=0;w<l.length;w++)o(0,l[w].pos=d[w],l)}};Ie(z),ze(()=>a?.terminate());function tt(){T=$(this.value),o(6,T)}function at(){C=$(this.value),o(8,C)}function J(){W=$(this.value),o(9,W)}function et(){y=$(this.value),o(7,y)}function Et(){A=$(this.value),o(10,A)}return[l,m,k,Z,P,E,T,y,C,W,A,R,D,H,U,Q,lt,B,x,tt,at,J,et,Et,()=>o(10,A=m.length-1||0),()=>o(4,P=!P)]}class He extends fe{constructor(r){super(),ce(this,r,qe,Oe,he,{})}}function Je(n){let r,o;return r=new He({}),{c(){Ut(r.$$.fragment)},l(a){Lt(r.$$.fragment,a)},m(a,l){Wt(r,a,l),o=!0},p:Ft,i(a){o||(Dt(r.$$.fragment,a),o=!0)},o(a){Ot(r.$$.fragment,a),o=!1},d(a){Vt(r,a)}}}class Xe extends fe{constructor(r){super(),ce(this,r,null,Je,he,{})}}export{Xe as default};
