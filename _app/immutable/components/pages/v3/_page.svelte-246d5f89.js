import{S as xt,i as $t,s as te,k as f,l as c,m as d,h as i,n as z,b as H,D as e,B as Pt,o as de,q as _,a as w,w as It,r as v,c as g,x as zt,R as tt,y as At,I as B,T as et,u as vt,f as Rt,t as kt,z as Nt,J as pe,K as be}from"../../../chunks/index-689c9b92.js";import{_ as _e}from"../../../chunks/preload-helper-41c905a7.js";import{A as ve}from"../../../chunks/AttractionTableChoice-fd543907.js";import{A as Me}from"../../../chunks/AttractionTableComponent-d5de4049.js";const ce=function(o,l,n,a,r){const m=(o-l)/(n-l)*(r-a)+a;return a<r?he(m,a,r):he(m,r,a)},he=function(o,l,n){return Math.max(Math.min(o,n),l)},we=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}}),me=["white","red","green","blue"],ge=()=>{const o=Math.floor(Math.random()*me.length);return me[o]},Ee=(o,l)=>{const n=[];for(let a=0;a<l;a++){const r={id:a,pos:{x:Math.random()*o.x,y:Math.random()*o.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:ge()};n.push(r)}return n};function ye(o){let l,n;return{c(){l=f("div"),n=f("canvas"),this.h()},l(a){l=c(a,"DIV",{class:!0});var r=d(l);n=c(r,"CANVAS",{id:!0,class:!0}),d(n).forEach(i),r.forEach(i),this.h()},h(){z(n,"id","canvas"),z(n,"class","svelte-bkdgvm"),z(l,"class","container svelte-bkdgvm")},m(a,r){H(a,l,r),e(l,n)},p:Pt,i:Pt,o:Pt,d(a){a&&i(l)}}}function Se(o,l,n){let{cellSize:a}=l,{cells:r}=l,{worldSize:m}=l,{drewFrame:P}=l,R;const j=["white","red","green","blue"],h={white:0,red:1,green:2,blue:3},k={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},C=j.length,E=a,T=E*2;function V(){const s=document.getElementById("canvas");if(!s||!R)throw new Error("Canvas is not ready");const I=s.getContext("2d");if(I.fillStyle=k.background,I.fillRect(0,0,s.width,s.height),!r?.length){window.requestAnimationFrame(V);return}for(let F=0;F<r.length;F++){const O=r[F],N=Math.floor(ce(O.pos.x,0,m.x,0,s.width)),J=Math.floor(ce(O.pos.y,0,m.y,0,s.height));var A=h[O.color];const L=A*T,ot=0,p=T,nt=T,G=N-E,X=J-E,rt=T,q=T;I.drawImage(R,L,ot,p,nt,G,X,rt,q)}P(),window.requestAnimationFrame(V)}return de(()=>{const s=document.getElementById("canvas");if(!s)throw new Error("Canvas is not ready");s.getContext("2d"),s.width=1600,s.height=960,R=document.createElement("canvas"),R.width=C*T,R.height=T;const I=R.getContext("2d");if(!I)throw new Error("Offscreen canvas is not ready");for(var A=0;A<C;++A){const F=j[A],O=k[F];I.fillStyle=O,I.beginPath(),I.arc(A*T+E,E,E,0,2*Math.PI),I.closePath(),I.fill()}window.requestAnimationFrame(V)}),o.$$set=s=>{"cellSize"in s&&n(0,a=s.cellSize),"cells"in s&&n(1,r=s.cells),"worldSize"in s&&n(2,m=s.worldSize),"drewFrame"in s&&n(3,P=s.drewFrame)},[a,r,m,P]}class Ce extends xt{constructor(l){super(),$t(this,l,Se,ye,te,{cellSize:0,cells:1,worldSize:2,drewFrame:3})}}function Te(o){let l,n,a,r,m,P,R,j,h,k,C,E,T,V,s,I,A=o[7]*o[5]+"",F,O,N,J,L,ot,p,nt,G=o[8]*o[5]+"",X,rt,q,b,y,M,S,K,Y,Mt,U,st,Bt,_t=(o[1]?.length||0)-o[9]+"",wt,Ft,it,Lt,gt,Ut,ut,Wt,Et,Dt,ft,Vt,yt,W,ct,Ot,qt,ht,Ht,Jt,mt,Kt,jt,dt,Gt,St,at,Ct,Z,Q,Qt,ee;return Y=new Ce({props:{cells:o[0],worldSize:o[4],cellSize:Pe,drewFrame:o[17]}}),at=new ve({props:{updateTable:o[10]}}),Z=new Me({props:{attractionTable:o[2],onUpdateTable:o[10]}}),{c(){l=f("h2"),n=_("V3 WIP"),a=w(),r=f("div"),m=f("p"),P=f("label"),R=_("Simulation definition"),j=w(),h=f("input"),k=w(),C=f("p"),E=f("label"),T=_("Simulation horizontal resolution"),V=w(),s=f("input"),I=_(`
        = `),F=_(A),O=w(),N=f("p"),J=f("label"),L=_("Simulation vertical resolution"),ot=w(),p=f("input"),nt=_(`
        = `),X=_(G),rt=w(),q=f("p"),b=f("label"),y=_("Number of particles"),M=w(),S=f("input"),K=w(),It(Y.$$.fragment),Mt=w(),U=f("div"),st=f("span"),Bt=_("Buffer size: "),wt=_(_t),Ft=w(),it=f("span"),Lt=_("Current frame: "),gt=_(o[9]),Ut=w(),ut=f("span"),Wt=_("Frame length (ms): "),Et=_(o[3]),Dt=w(),ft=f("button"),Vt=_("Replay from start"),yt=w(),W=f("div"),ct=f("button"),Ot=_("Reset simulation"),qt=w(),ht=f("button"),Ht=_("Center cells"),Jt=w(),mt=f("button"),Kt=_("Large Center cells"),jt=w(),dt=f("button"),Gt=_("Rainbow cells"),St=w(),It(at.$$.fragment),Ct=w(),It(Z.$$.fragment),this.h()},l(t){l=c(t,"H2",{});var u=d(l);n=v(u,"V3 WIP"),u.forEach(i),a=g(t),r=c(t,"DIV",{});var D=d(r);m=c(D,"P",{});var lt=d(m);P=c(lt,"LABEL",{for:!0});var oe=d(P);R=v(oe,"Simulation definition"),oe.forEach(i),j=g(lt),h=c(lt,"INPUT",{id:!0,type:!0}),lt.forEach(i),k=g(D),C=c(D,"P",{});var pt=d(C);E=c(pt,"LABEL",{for:!0});var ne=d(E);T=v(ne,"Simulation horizontal resolution"),ne.forEach(i),V=g(pt),s=c(pt,"INPUT",{id:!0,type:!0}),I=v(pt,`
        = `),F=v(pt,A),pt.forEach(i),O=g(D),N=c(D,"P",{});var bt=d(N);J=c(bt,"LABEL",{for:!0});var re=d(J);L=v(re,"Simulation vertical resolution"),re.forEach(i),ot=g(bt),p=c(bt,"INPUT",{id:!0,type:!0}),nt=v(bt,`
        = `),X=v(bt,G),bt.forEach(i),rt=g(D),q=c(D,"P",{});var Tt=d(q);b=c(Tt,"LABEL",{for:!0});var ae=d(b);y=v(ae,"Number of particles"),ae.forEach(i),M=g(Tt),S=c(Tt,"INPUT",{id:!0,type:!0}),Tt.forEach(i),D.forEach(i),K=g(t),zt(Y.$$.fragment,t),Mt=g(t),U=c(t,"DIV",{});var x=d(U);st=c(x,"SPAN",{});var Xt=d(st);Bt=v(Xt,"Buffer size: "),wt=v(Xt,_t),Xt.forEach(i),Ft=g(x),it=c(x,"SPAN",{});var Yt=d(it);Lt=v(Yt,"Current frame: "),gt=v(Yt,o[9]),Yt.forEach(i),Ut=g(x),ut=c(x,"SPAN",{});var Zt=d(ut);Wt=v(Zt,"Frame length (ms): "),Et=v(Zt,o[3]),Zt.forEach(i),Dt=g(x),ft=c(x,"BUTTON",{});var le=d(ft);Vt=v(le,"Replay from start"),le.forEach(i),x.forEach(i),yt=g(t),W=c(t,"DIV",{});var $=d(W);ct=c($,"BUTTON",{});var se=d(ct);Ot=v(se,"Reset simulation"),se.forEach(i),qt=g($),ht=c($,"BUTTON",{});var ie=d(ht);Ht=v(ie,"Center cells"),ie.forEach(i),Jt=g($),mt=c($,"BUTTON",{});var ue=d(mt);Kt=v(ue,"Large Center cells"),ue.forEach(i),jt=g($),dt=c($,"BUTTON",{});var fe=d(dt);Gt=v(fe,"Rainbow cells"),fe.forEach(i),$.forEach(i),St=g(t),zt(at.$$.fragment,t),Ct=g(t),zt(Z.$$.fragment,t),this.h()},h(){z(P,"for","attractionRadius"),z(h,"id","attractionRadius"),z(h,"type","number"),z(E,"for","horizontalResolution"),z(s,"id","horizontalResolution"),z(s,"type","number"),z(J,"for","verticalResolution"),z(p,"id","verticalResolution"),z(p,"type","number"),z(b,"for","nbParticles"),z(S,"id","nbParticles"),z(S,"type","number")},m(t,u){H(t,l,u),e(l,n),H(t,a,u),H(t,r,u),e(r,m),e(m,P),e(P,R),e(m,j),e(m,h),tt(h,o[5]),e(r,k),e(r,C),e(C,E),e(E,T),e(C,V),e(C,s),tt(s,o[7]),e(C,I),e(C,F),e(r,O),e(r,N),e(N,J),e(J,L),e(N,ot),e(N,p),tt(p,o[8]),e(N,nt),e(N,X),e(r,rt),e(r,q),e(q,b),e(b,y),e(q,M),e(q,S),tt(S,o[6]),H(t,K,u),At(Y,t,u),H(t,Mt,u),H(t,U,u),e(U,st),e(st,Bt),e(st,wt),e(U,Ft),e(U,it),e(it,Lt),e(it,gt),e(U,Ut),e(U,ut),e(ut,Wt),e(ut,Et),e(U,Dt),e(U,ft),e(ft,Vt),H(t,yt,u),H(t,W,u),e(W,ct),e(ct,Ot),e(W,qt),e(W,ht),e(ht,Ht),e(W,Jt),e(W,mt),e(mt,Kt),e(W,jt),e(W,dt),e(dt,Gt),H(t,St,u),At(at,t,u),H(t,Ct,u),At(Z,t,u),Q=!0,Qt||(ee=[B(h,"input",o[18]),B(h,"change",o[11]),B(s,"input",o[19]),B(s,"change",o[11]),B(p,"input",o[20]),B(p,"change",o[11]),B(S,"input",o[21]),B(S,"change",o[11]),B(ft,"click",o[16]),B(ct,"click",o[15]),B(ht,"click",o[12]),B(mt,"click",o[13]),B(dt,"click",o[14])],Qt=!0)},p(t,[u]){u&32&&et(h.value)!==t[5]&&tt(h,t[5]),u&128&&et(s.value)!==t[7]&&tt(s,t[7]),(!Q||u&160)&&A!==(A=t[7]*t[5]+"")&&vt(F,A),u&256&&et(p.value)!==t[8]&&tt(p,t[8]),(!Q||u&288)&&G!==(G=t[8]*t[5]+"")&&vt(X,G),u&64&&et(S.value)!==t[6]&&tt(S,t[6]);const D={};u&1&&(D.cells=t[0]),u&16&&(D.worldSize=t[4]),Y.$set(D),(!Q||u&514)&&_t!==(_t=(t[1]?.length||0)-t[9]+"")&&vt(wt,_t),(!Q||u&512)&&vt(gt,t[9]),(!Q||u&8)&&vt(Et,t[3]);const lt={};u&4&&(lt.attractionTable=t[2]),Z.$set(lt)},i(t){Q||(Rt(Y.$$.fragment,t),Rt(at.$$.fragment,t),Rt(Z.$$.fragment,t),Q=!0)},o(t){kt(Y.$$.fragment,t),kt(at.$$.fragment,t),kt(Z.$$.fragment,t),Q=!1},d(t){t&&i(l),t&&i(a),t&&i(r),t&&i(K),Nt(Y,t),t&&i(Mt),t&&i(U),t&&i(yt),t&&i(W),t&&i(St),Nt(at,t),t&&i(Ct),Nt(Z,t),Qt=!1,pe(ee)}}}const Pe=1;function Ie(o,l,n){let a,r,m,P,R=0,j=0;const h={x:1600,y:960};let k=32,C=4e3,E=60,T=40,V;const s=async()=>{V=(await _e(()=>import("../../../chunks/simulation.worker-a89055d5.js"),[],import.meta.url)).default,L()},I=b=>{n(2,P=b),a.postMessage({msg:"updateTable",attractionTable:P}),n(1,m=[r.map(y=>y.pos)])},A=()=>{n(4,h.x=k*E,h),n(4,h.y=k*T,h),L()},F=()=>{for(const b of r){const y=2*Math.random(),M=Math.random()*2*Math.PI,S=h.x/2+y*Math.cos(M),K=h.y/2+y*Math.sin(M);b.pos={x:S,y:K}}L(!0,!0)},O=()=>{for(const b of r){const y=200*Math.random(),M=Math.random()*2*Math.PI,S=h.x/2+y*Math.cos(M),K=h.y/2+y*Math.sin(M);b.pos={x:S,y:K}}L(!0,!0)},N=()=>{const b=["white","red","green","blue"],y=h.x/4;for(const M of r){const S=Math.floor(M.pos.x/y),K=b[S];M.color=K}L(!0,!0)},J=()=>{L(!1,!1)},L=(b,y)=>{if(V===void 0)throw new Error("Worker is not initialized");a&&(a.postMessage({msg:"destroy"}),a.terminate()),a=new V;const M=S=>{m.push(S.data.positions)};a.onmessage=M,b||n(0,r=Ee(h,C)),y||n(2,P=we()),n(1,m=[]),n(9,p=0),a.postMessage({msg:"start",cells:r,attractionTable:P,worldSize:h,maxAttractionRadius:k})},ot=()=>{n(9,p=0)};let p=0;const nt=()=>{if(m.length-1>p){const b=Date.now();n(3,j=b-R),R=b,n(9,p++,p);const y=m[p];if(n(1,m),y.length!==r.length)return;for(let M=0;M<r.length;M++)n(0,r[M].pos=y[M],r)}};de(s),be(()=>a?.terminate());function G(){k=et(this.value),n(5,k)}function X(){E=et(this.value),n(7,E)}function rt(){T=et(this.value),n(8,T)}function q(){C=et(this.value),n(6,C)}return[r,m,P,j,h,k,C,E,T,p,I,A,F,O,N,J,ot,nt,G,X,rt,q]}class ze extends xt{constructor(l){super(),$t(this,l,Ie,Te,te,{})}}function Ae(o){let l,n;return l=new ze({}),{c(){It(l.$$.fragment)},l(a){zt(l.$$.fragment,a)},m(a,r){At(l,a,r),n=!0},p:Pt,i(a){n||(Rt(l.$$.fragment,a),n=!0)},o(a){kt(l.$$.fragment,a),n=!1},d(a){Nt(l,a)}}}class Fe extends xt{constructor(l){super(),$t(this,l,null,Ae,te,{})}}export{Fe as default};
