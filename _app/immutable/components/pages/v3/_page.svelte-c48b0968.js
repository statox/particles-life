import{S as fe,i as ce,s as he,k as u,a as w,q as P,l as f,m as p,h as s,c as M,r as S,n as v,b as X,D as e,R as J,I as F,T as Y,B as ue,J as Ie,o as ke,w as Bt,x as Lt,y as Ut,u as Pt,f as Dt,t as Wt,z as Ot,K as Ae}from"../../../chunks/index-689c9b92.js";import{_ as ze}from"../../../chunks/preload-helper-41c905a7.js";import{A as Fe}from"../../../chunks/AttractionTableChoice-54d975cc.js";import{A as Ne}from"../../../chunks/AttractionTableComponent-68b8dc88.js";const ye=function(n,r,o,a,l){const m=(n-r)/(o-r)*(l-a)+a;return a<l?Te(m,a,l):Te(m,l,a)},Te=function(n,r,o){return Math.max(Math.min(n,o),r)},Re=()=>({white:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},red:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},green:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)},blue:{white:Math.floor(Math.random()*4-1),red:Math.floor(Math.random()*4-1),green:Math.floor(Math.random()*4-1),blue:Math.floor(Math.random()*4-1)}}),Ce=["white","red","green","blue"],Be=()=>{const n=Math.floor(Math.random()*Ce.length);return Ce[n]},Le=(n,r)=>{const o=[];for(let a=0;a<r;a++){const l={id:a,pos:{x:Math.random()*n.x,y:Math.random()*n.y},nextPos:{x:0,y:0},vel:{x:0,y:0},color:Be()};o.push(l)}return o};function Ue(n){let r,o,a,l,m,I,_,U,k;return{c(){r=u("div"),o=u("canvas"),a=w(),l=u("label"),m=P("Limit FPS"),I=w(),_=u("input"),this.h()},l(d){r=f(d,"DIV",{class:!0});var h=p(r);o=f(h,"CANVAS",{id:!0,class:!0}),p(o).forEach(s),a=M(h),l=f(h,"LABEL",{for:!0});var T=p(l);m=S(T,"Limit FPS"),T.forEach(s),I=M(h),_=f(h,"INPUT",{id:!0,type:!0,min:!0}),h.forEach(s),this.h()},h(){v(o,"id","canvas"),v(o,"class","svelte-bkdgvm"),v(l,"for","maxFPSInput"),v(_,"id","maxFPSInput"),v(_,"type","number"),v(_,"min","1"),v(r,"class","container svelte-bkdgvm")},m(d,h){X(d,r,h),e(r,o),e(r,a),e(r,l),e(l,m),e(r,I),e(r,_),J(_,n[1]),U||(k=[F(_,"input",n[7]),F(_,"change",n[8])],U=!0)},p(d,[h]){h&2&&Y(_.value)!==d[1]&&J(_,d[1])},i:ue,o:ue,d(d){d&&s(r),U=!1,Ie(k)}}}function De(n,r,o){let{cellSize:a}=r,{cells:l}=r,{worldSize:m}=r,{drewFrame:I}=r,_;const U=["white","red","green","blue"],k={white:0,red:1,green:2,blue:3},d={white:"#ffedff",red:"#fc2a51",green:"#8ff97c",blue:"#77cfff",background:"#383b3d"},h=U.length,T=a,N=T*2;let L=25,z=L,K,j,Z,et;function R(){const c=document.getElementById("canvas");if(!c||!_)throw new Error("Canvas is not ready");if(window.requestAnimationFrame(R),Z=Date.now(),et=Z-j,et<=K)return;j=Z-et%K;const E=c.getContext("2d");if(E.fillStyle=d.background,E.fillRect(0,0,c.width,c.height),!l?.length){window.requestAnimationFrame(R);return}for(let D=0;D<l.length;D++){const V=l[D],rt=Math.floor(ye(V.pos.x,0,m.x,0,c.width)),G=Math.floor(ye(V.pos.y,0,m.y,0,c.height));var C=k[V.color];const $=C*N,at=0,ut=N,W=N,A=rt-T,b=G-T,y=N,g=N;E.drawImage(_,$,at,ut,W,A,b,y,g)}I()}ke(()=>{const c=document.getElementById("canvas");if(!c)throw new Error("Canvas is not ready");c.getContext("2d"),c.width=1600,c.height=960,_=document.createElement("canvas"),_.width=h*N,_.height=N;const E=_.getContext("2d");if(!E)throw new Error("Offscreen canvas is not ready");for(var C=0;C<h;++C){const D=U[C],V=d[D];E.fillStyle=V,E.beginPath(),E.arc(C*N+T,T,T,0,2*Math.PI),E.closePath(),E.fill()}o(2,K=1e3/L),j=Date.now(),window.requestAnimationFrame(R)});function x(){z=Y(this.value),o(1,z)}const lt=()=>{o(0,L=z),o(2,K=1e3/L)};return n.$$set=c=>{"cellSize"in c&&o(3,a=c.cellSize),"cells"in c&&o(4,l=c.cells),"worldSize"in c&&o(5,m=c.worldSize),"drewFrame"in c&&o(6,I=c.drewFrame)},[L,z,K,a,l,m,I,x,lt]}class We extends fe{constructor(r){super(),ce(this,r,De,Ue,he,{cellSize:3,cells:4,worldSize:5,drewFrame:6})}}function Oe(n){let r,o,a,l,m,I,_,U,k,d,h,T,N,L,z,K,j=n[8]*n[6]+"",Z,et,R,x,lt,c,E,C,D=n[9]*n[6]+"",V,rt,G,$,at,ut,W,A,b,y,g,B,ft,Vt,St=(n[1]?.length||0)-n[10]+"",Tt,qt,ct,Ht,Ct,Jt,ht,Kt,It,jt,O,kt,Gt,mt,Qt,Xt,dt,Yt,Zt,pt,yt=n[4]?"Play":"Pause",At,zt,q,_t,xt,$t,bt,te,ee,vt,ne,oe,gt,le,Ft,st,Nt,nt,Q,re,me;return b=new We({props:{cells:n[0],worldSize:n[5],cellSize:Ve,drewFrame:n[18]}}),st=new Fe({props:{updateTable:n[11]}}),nt=new Ne({props:{attractionTable:n[2],onUpdateTable:n[11]}}),{c(){r=u("h2"),o=P("V3 WIP"),a=w(),l=u("div"),m=u("p"),I=u("label"),_=P("Simulation definition"),U=w(),k=u("input"),d=w(),h=u("p"),T=u("label"),N=P("Simulation horizontal resolution"),L=w(),z=u("input"),K=P(`
        = `),Z=P(j),et=w(),R=u("p"),x=u("label"),lt=P("Simulation vertical resolution"),c=w(),E=u("input"),C=P(`
        = `),V=P(D),rt=w(),G=u("p"),$=u("label"),at=P("Number of particles"),ut=w(),W=u("input"),A=w(),Bt(b.$$.fragment),y=w(),g=u("div"),B=u("div"),ft=u("span"),Vt=P("Buffer size: "),Tt=P(St),qt=w(),ct=u("span"),Ht=P("Current frame: "),Ct=P(n[10]),Jt=w(),ht=u("span"),Kt=P("Frame length (ms): "),It=P(n[3]),jt=w(),O=u("input"),Gt=w(),mt=u("button"),Qt=P("Replay from start"),Xt=w(),dt=u("button"),Yt=P("Catchup last frame"),Zt=w(),pt=u("button"),At=P(yt),zt=w(),q=u("div"),_t=u("button"),xt=P("Reset cells"),$t=w(),bt=u("button"),te=P("Center cells"),ee=w(),vt=u("button"),ne=P("Large Center cells"),oe=w(),gt=u("button"),le=P("Rainbow cells"),Ft=w(),Bt(st.$$.fragment),Nt=w(),Bt(nt.$$.fragment),this.h()},l(t){r=f(t,"H2",{});var i=p(r);o=S(i,"V3 WIP"),i.forEach(s),a=M(t),l=f(t,"DIV",{});var H=p(l);m=f(H,"P",{});var it=p(m);I=f(it,"LABEL",{for:!0});var de=p(I);_=S(de,"Simulation definition"),de.forEach(s),U=M(it),k=f(it,"INPUT",{id:!0,type:!0}),it.forEach(s),d=M(H),h=f(H,"P",{});var wt=p(h);T=f(wt,"LABEL",{for:!0});var pe=p(T);N=S(pe,"Simulation horizontal resolution"),pe.forEach(s),L=M(wt),z=f(wt,"INPUT",{id:!0,type:!0}),K=S(wt,`
        = `),Z=S(wt,j),wt.forEach(s),et=M(H),R=f(H,"P",{});var Mt=p(R);x=f(Mt,"LABEL",{for:!0});var _e=p(x);lt=S(_e,"Simulation vertical resolution"),_e.forEach(s),c=M(Mt),E=f(Mt,"INPUT",{id:!0,type:!0}),C=S(Mt,`
        = `),V=S(Mt,D),Mt.forEach(s),rt=M(H),G=f(H,"P",{});var Rt=p(G);$=f(Rt,"LABEL",{for:!0});var be=p($);at=S(be,"Number of particles"),be.forEach(s),ut=M(Rt),W=f(Rt,"INPUT",{id:!0,type:!0}),Rt.forEach(s),H.forEach(s),A=M(t),Lt(b.$$.fragment,t),y=M(t),g=f(t,"DIV",{});var tt=p(g);B=f(tt,"DIV",{});var Et=p(B);ft=f(Et,"SPAN",{});var ae=p(ft);Vt=S(ae,"Buffer size: "),Tt=S(ae,St),ae.forEach(s),qt=M(Et),ct=f(Et,"SPAN",{});var se=p(ct);Ht=S(se,"Current frame: "),Ct=S(se,n[10]),se.forEach(s),Jt=M(Et),ht=f(Et,"SPAN",{});var ie=p(ht);Kt=S(ie,"Frame length (ms): "),It=S(ie,n[3]),ie.forEach(s),Et.forEach(s),jt=M(tt),O=f(tt,"INPUT",{type:!0,min:!0,max:!0,class:!0,id:!0}),Gt=M(tt),mt=f(tt,"BUTTON",{});var ve=p(mt);Qt=S(ve,"Replay from start"),ve.forEach(s),Xt=M(tt),dt=f(tt,"BUTTON",{});var ge=p(dt);Yt=S(ge,"Catchup last frame"),ge.forEach(s),Zt=M(tt),pt=f(tt,"BUTTON",{});var we=p(pt);At=S(we,yt),we.forEach(s),tt.forEach(s),zt=M(t),q=f(t,"DIV",{});var ot=p(q);_t=f(ot,"BUTTON",{});var Me=p(_t);xt=S(Me,"Reset cells"),Me.forEach(s),$t=M(ot),bt=f(ot,"BUTTON",{});var Ee=p(bt);te=S(Ee,"Center cells"),Ee.forEach(s),ee=M(ot),vt=f(ot,"BUTTON",{});var Pe=p(vt);ne=S(Pe,"Large Center cells"),Pe.forEach(s),oe=M(ot),gt=f(ot,"BUTTON",{});var Se=p(gt);le=S(Se,"Rainbow cells"),Se.forEach(s),ot.forEach(s),Ft=M(t),Lt(st.$$.fragment,t),Nt=M(t),Lt(nt.$$.fragment,t),this.h()},h(){v(I,"for","attractionRadius"),v(k,"id","attractionRadius"),v(k,"type","number"),v(T,"for","horizontalResolution"),v(z,"id","horizontalResolution"),v(z,"type","number"),v(x,"for","verticalResolution"),v(E,"id","verticalResolution"),v(E,"type","number"),v($,"for","nbParticles"),v(W,"id","nbParticles"),v(W,"type","number"),v(O,"type","range"),v(O,"min","1"),v(O,"max",kt=n[1]?.length?n[1].length-1:0),v(O,"class","slider"),v(O,"id","frameIndexSlider")},m(t,i){X(t,r,i),e(r,o),X(t,a,i),X(t,l,i),e(l,m),e(m,I),e(I,_),e(m,U),e(m,k),J(k,n[6]),e(l,d),e(l,h),e(h,T),e(T,N),e(h,L),e(h,z),J(z,n[8]),e(h,K),e(h,Z),e(l,et),e(l,R),e(R,x),e(x,lt),e(R,c),e(R,E),J(E,n[9]),e(R,C),e(R,V),e(l,rt),e(l,G),e(G,$),e($,at),e(G,ut),e(G,W),J(W,n[7]),X(t,A,i),Ut(b,t,i),X(t,y,i),X(t,g,i),e(g,B),e(B,ft),e(ft,Vt),e(ft,Tt),e(B,qt),e(B,ct),e(ct,Ht),e(ct,Ct),e(B,Jt),e(B,ht),e(ht,Kt),e(ht,It),e(g,jt),e(g,O),J(O,n[10]),e(g,Gt),e(g,mt),e(mt,Qt),e(g,Xt),e(g,dt),e(dt,Yt),e(g,Zt),e(g,pt),e(pt,At),X(t,zt,i),X(t,q,i),e(q,_t),e(_t,xt),e(q,$t),e(q,bt),e(bt,te),e(q,ee),e(q,vt),e(vt,ne),e(q,oe),e(q,gt),e(gt,le),X(t,Ft,i),Ut(st,t,i),X(t,Nt,i),Ut(nt,t,i),Q=!0,re||(me=[F(k,"input",n[19]),F(k,"change",n[12]),F(z,"input",n[20]),F(z,"change",n[12]),F(E,"input",n[21]),F(E,"change",n[12]),F(W,"input",n[22]),F(W,"change",n[12]),F(O,"change",n[23]),F(O,"input",n[23]),F(mt,"click",n[17]),F(dt,"click",n[24]),F(pt,"click",n[25]),F(_t,"click",n[16]),F(bt,"click",n[13]),F(vt,"click",n[14]),F(gt,"click",n[15])],re=!0)},p(t,[i]){i&64&&Y(k.value)!==t[6]&&J(k,t[6]),i&256&&Y(z.value)!==t[8]&&J(z,t[8]),(!Q||i&320)&&j!==(j=t[8]*t[6]+"")&&Pt(Z,j),i&512&&Y(E.value)!==t[9]&&J(E,t[9]),(!Q||i&576)&&D!==(D=t[9]*t[6]+"")&&Pt(V,D),i&128&&Y(W.value)!==t[7]&&J(W,t[7]);const H={};i&1&&(H.cells=t[0]),i&32&&(H.worldSize=t[5]),b.$set(H),(!Q||i&1026)&&St!==(St=(t[1]?.length||0)-t[10]+"")&&Pt(Tt,St),(!Q||i&1024)&&Pt(Ct,t[10]),(!Q||i&8)&&Pt(It,t[3]),(!Q||i&2&&kt!==(kt=t[1]?.length?t[1].length-1:0))&&v(O,"max",kt),i&1024&&J(O,t[10]),(!Q||i&16)&&yt!==(yt=t[4]?"Play":"Pause")&&Pt(At,yt);const it={};i&4&&(it.attractionTable=t[2]),nt.$set(it)},i(t){Q||(Dt(b.$$.fragment,t),Dt(st.$$.fragment,t),Dt(nt.$$.fragment,t),Q=!0)},o(t){Wt(b.$$.fragment,t),Wt(st.$$.fragment,t),Wt(nt.$$.fragment,t),Q=!1},d(t){t&&s(r),t&&s(a),t&&s(l),t&&s(A),Ot(b,t),t&&s(y),t&&s(g),t&&s(zt),t&&s(q),t&&s(Ft),Ot(st,t),t&&s(Nt),Ot(nt,t),re=!1,Ie(me)}}}const Ve=1;function qe(n,r,o){let a,l,m,I,_=0,U=0,k=!1;const d={x:1600,y:960};let h=32,T=4e3,N=60,L=40,z;const K=async()=>{z=(await ze(()=>import("../../../chunks/simulation.worker-f2100e46.js"),[],import.meta.url)).default,c()},j=A=>{o(2,I=A),a.postMessage({msg:"updateTable",attractionTable:I}),o(1,m=[l.map(b=>b.pos)])},Z=()=>{o(5,d.x=h*N,d),o(5,d.y=h*L,d),c()},et=()=>{for(const A of l){const b=2*Math.random(),y=Math.random()*2*Math.PI,g=d.x/2+b*Math.cos(y),B=d.y/2+b*Math.sin(y);A.pos={x:g,y:B}}c(!0,!0)},R=()=>{for(const A of l){const b=200*Math.random(),y=Math.random()*2*Math.PI,g=d.x/2+b*Math.cos(y),B=d.y/2+b*Math.sin(y);A.pos={x:g,y:B}}c(!0,!0)},x=()=>{const A=["white","red","green","blue"],b=d.x/4;for(const y of l){const g=Math.floor(y.pos.x/b),B=A[g];y.color=B}c(!0,!0)},lt=()=>{c(!1,!0)},c=(A,b)=>{if(z===void 0)throw new Error("Worker is not initialized");a&&(a.postMessage({msg:"destroy"}),a.terminate()),a=new z;const y=g=>{m.push(g.data.positions)};a.onmessage=y,A||o(0,l=Le(d,T)),b||o(2,I=Re()),o(1,m=[]),o(10,C=0),a.postMessage({msg:"start",cells:l,attractionTable:I,worldSize:d,maxAttractionRadius:h})},E=()=>{o(10,C=0)};let C=0;const D=()=>{if(m.length-1>C){const A=Date.now();o(3,U=A-_),_=A,k||o(10,C++,C);const b=m[C];if(o(1,m),b.length!==l.length)return;for(let y=0;y<l.length;y++)o(0,l[y].pos=b[y],l)}};ke(K),Ae(()=>a?.terminate());function V(){h=Y(this.value),o(6,h)}function rt(){N=Y(this.value),o(8,N)}function G(){L=Y(this.value),o(9,L)}function $(){T=Y(this.value),o(7,T)}function at(){C=Y(this.value),o(10,C)}return[l,m,I,U,k,d,h,T,N,L,C,j,Z,et,R,x,lt,E,D,V,rt,G,$,at,()=>o(10,C=m.length-1||0),()=>o(4,k=!k)]}class He extends fe{constructor(r){super(),ce(this,r,qe,Oe,he,{})}}function Je(n){let r,o;return r=new He({}),{c(){Bt(r.$$.fragment)},l(a){Lt(r.$$.fragment,a)},m(a,l){Ut(r,a,l),o=!0},p:ue,i(a){o||(Dt(r.$$.fragment,a),o=!0)},o(a){Wt(r.$$.fragment,a),o=!1},d(a){Ot(r,a)}}}class Xe extends fe{constructor(r){super(),ce(this,r,null,Je,he,{})}}export{Xe as default};
