import{S as L,i as G,s as Q,k as $,l as I,m as E,h as v,n as O,b as U,D as p,B as P,o as at,w as W,a as A,q as N,x as j,c as B,r as V,y as H,I as F,u as it,f as X,t as Y,z as J,J as ct,K as lt}from"../../chunks/index-ffa1d1d4.js";import{A as ut,a as dt,g as ht}from"../../chunks/AttractionTableChoice-db9eeac0.js";const ft=(r,t,s,e,o)=>{const n=gt(r,e.pos,o.pos),i=s*s;if(n>i)return 0;const h=(2*3)**2;if(n<h)return-1;const d=t[e.color][o.color]??0;return d===0?0:yt(n,i/2,i,0,d)},yt=function(r,t,s,e,o){const n=t+(s-t)/2;return r<n?K(r,t,n,e,o):K(r,n,s,o,e)},K=function(r,t,s,e,o){const n=(r-t)/(s-t)*(o-e)+e;return e<o?ot(n,e,o):ot(n,o,e)},ot=function(r,t,s){return Math.max(Math.min(r,s),t)};class mt{squares;squareByCellId;worldSize;maxAttractionRadius;constructor(t){const{worldSize:s,maxAttractionRadius:e}=t;if(s.x%e!==0||s.y%e!==0)throw new Error("Screen size is not a multiple of maxAttractionRadius");this.worldSize={...s},this.maxAttractionRadius=e,this.squareByCellId=new Map,this.squares=[];const o=e,n=s.x/o,i=s.y/o;for(let l=0;l<i;l++){this.squares.push([]);for(let h=0;h<n;h++)this.squares[l].push(new Set)}}checkCoord(t){if(t.x<0||t.x>this.worldSize.x||t.y<0||t.y>this.worldSize.y)throw new Error(`The cell at position ${t.x},${t.y} is outside of the screen ${this.worldSize.x},${this.worldSize.y} `)}getSquareCoords(t){return this.checkCoord(t),{x:Math.floor(t.x*this.squares[0].length/this.worldSize.x),y:Math.floor(t.y*this.squares.length/this.worldSize.y)}}insert(t){if(this.squareByCellId.get(t.id))throw new Error("Cell already in map");const s=this.getSquareCoords(t.pos);this.squares[s.y][s.x].add(t.id),this.squareByCellId.set(t.id,s)}updateCell(t){this.checkCoord(t.pos);const s=this.squareByCellId.get(t.id);if(!s)throw new Error("Cell not in map");this.squares[s.y][s.x].delete(t.id);const e=this.getSquareCoords(t.pos);this.squares[e.y][e.x].add(t.id),this.squareByCellId.set(t.id,e)}getNeighborsIds(t){const s=this.squareByCellId.get(t.id);if(!s)throw new Error("Cell not in map");const{x:e,y:o}=s,n=e===0?this.squares[0].length-1:e-1,i=e===this.squares[0].length-1?0:e+1,l=o===0?this.squares.length-1:o-1,h=o===this.squares.length-1?0:o+1,d=[{x:n,y:l},{x:e,y:l},{x:i,y:l},{x:n,y:o},{x:e,y:o},{x:i,y:o},{x:n,y:h},{x:e,y:h},{x:i,y:h}],y=[];for(const{x:a,y:c}of d)y.push(...this.squares[c][a]);return y}}const nt=["white","red","green","blue"],xt=()=>{const r=Math.floor(Math.random()*nt.length);return nt[r]},pt=(r,t,s)=>{const e=[],o=new mt({worldSize:r,maxAttractionRadius:s});for(let n=0;n<t;n++){const i={id:n,pos:{x:Math.random()*r.x,y:Math.random()*r.y},vel:{x:0,y:0},color:xt()};e.push(i),o.insert(i)}return{cells:e,cellsMap:o}},gt=(r,t,s)=>{let e=Math.abs(s.x-t.x);e>r.x/2&&(e=r.x-e);let o=Math.abs(s.y-t.y);return o>r.y/2&&(o=r.y-o),e*e+o*o},wt=(r,t)=>{const s=Math.abs(t.x-r.x),e=Math.abs(t.y-r.y);return s*s+e*e},vt=(r,t,s,e)=>{for(let o=0;o<s.length;o++){const n=s[o];n.vel={x:0,y:0};const i=e.getNeighborsIds(n);for(const h of i){if(o===h)continue;const d=s[h];let y=ft(e.worldSize,r,t,n,d);wt(n.pos,d.pos)>e.worldSize.y*e.worldSize.y/2&&(y*=-1);const a={x:d.pos.x-n.pos.x,y:d.pos.y-n.pos.y},c=Math.sqrt(a.x*a.x+a.y*a.y);if(c===0)continue;const m={x:a.x*(1/c),y:a.y*(1/c)},b={x:m.x*y,y:m.y*y};n.vel.x+=b.x,n.vel.y+=b.y}const l=Math.sqrt(n.vel.x*n.vel.x+n.vel.y*n.vel.y);l!==0&&(n.vel.x*=1/l,n.vel.y*=1/l,bt(e.worldSize,n),e.updateCell(n))}},bt=(r,t)=>{t.pos.x+=t.vel.x,t.pos.y+=t.vel.y,t.pos.x<=0?t.pos.x=r.x+t.pos.x:t.pos.x>=r.x&&(t.pos.x=t.pos.x-r.x),t.pos.y<=0?t.pos.y=r.y+t.pos.y:t.pos.y>=r.y&&(t.pos.y=t.pos.y-r.y)};function qt(r){let t,s;return{c(){t=$("div"),s=$("canvas"),this.h()},l(e){t=I(e,"DIV",{class:!0});var o=E(t);s=I(o,"CANVAS",{id:!0,class:!0}),E(s).forEach(v),o.forEach(v),this.h()},h(){O(s,"id","canvas"),O(s,"class","svelte-bkdgvm"),O(t,"class","container svelte-bkdgvm")},m(e,o){U(e,t,o),p(t,s)},p:P,i:P,o:P,d(e){e&&v(t)}}}const R=3;function Ct(r,t,s){let{cells:e}=t,{worldSize:o}=t,n;const i=["white","red","green","blue"],l={white:0,red:1,green:2,blue:3},h=i.length,d=R*2;function y(){const a=document.getElementById("canvas");if(!a||!n)throw new Error("Canvas is not ready");const c=a.getContext("2d");if(!c)throw new Error("Ctx is not ready");if(c.fillStyle="#040411",c.fillRect(0,0,a.width,a.height),!e?.length){window.requestAnimationFrame(y);return}const m=3,b=[...e].sort((f,x)=>l[f.color]-l[x.color]);for(let f=0;f<b.length;f++){const x=b[f],q=Math.floor(K(x.pos.x,0,o.x,0,a.width)),g=Math.floor(K(x.pos.y,0,o.y,0,a.height));(f===0||x.color!==b[f-1].color)&&(c.fill(),c.fillStyle=x.color),c.beginPath(),c.arc(q,g,m,0,2*Math.PI),c.closePath();var z=l[x.color];const M=z*d,S=0,T=d,k=d,D=q-R,u=g-R,w=d,C=d;c.drawImage(n,M,S,T,k,D,u,w,C)}c.fill(),window.requestAnimationFrame(y)}return at(()=>{const a=document.getElementById("canvas");if(!a)throw new Error("Canvas is not ready");a.width=1600,a.height=960,n=document.createElement("canvas"),n.width=h*d,n.height=d;const c=n.getContext("2d");if(!c)throw new Error("Offscreen canvas is not ready");for(var m=0;m<h;++m)c.fillStyle=i[m],c.beginPath(),c.arc(m*d+R,R,R,0,2*Math.PI),c.closePath(),c.fill();window.requestAnimationFrame(y)}),r.$$set=a=>{"cells"in a&&s(0,e=a.cells),"worldSize"in a&&s(1,o=a.worldSize)},[e,o]}class _t extends L{constructor(t){super(),G(this,t,Ct,qt,Q,{cells:0,worldSize:1})}}function St(r){let t,s,e,o,n,i,l=r[3].pause?"Run":"Pause",h,d,y,a,c,m,b,z,f,x,q,g,M,S,T,k,D;return s=new _t({props:{cells:r[0],worldSize:r[1]?.worldSize}}),g=new ut({props:{updateTable:r[5]}}),S=new dt({props:{attractionTable:r[2],onUpdateTable:r[5]}}),{c(){t=$("div"),W(s.$$.fragment),e=A(),o=$("div"),n=$("div"),i=$("button"),h=N(l),d=A(),y=$("button"),a=N("Reset cells"),c=A(),m=$("button"),b=N("Rainbow"),z=A(),f=$("button"),x=N("Center"),q=A(),W(g.$$.fragment),M=A(),W(S.$$.fragment),this.h()},l(u){t=I(u,"DIV",{class:!0});var w=E(t);j(s.$$.fragment,w),w.forEach(v),e=B(u),o=I(u,"DIV",{});var C=E(o);n=I(C,"DIV",{});var _=E(n);i=I(_,"BUTTON",{});var Z=E(i);h=V(Z,l),Z.forEach(v),d=B(_),y=I(_,"BUTTON",{});var tt=E(y);a=V(tt,"Reset cells"),tt.forEach(v),c=B(_),m=I(_,"BUTTON",{});var et=E(m);b=V(et,"Rainbow"),et.forEach(v),z=B(_),f=I(_,"BUTTON",{});var st=E(f);x=V(st,"Center"),st.forEach(v),_.forEach(v),q=B(C),j(g.$$.fragment,C),M=B(C),j(S.$$.fragment,C),C.forEach(v),this.h()},h(){O(t,"class","d-flex justify-content-center")},m(u,w){U(u,t,w),H(s,t,null),U(u,e,w),U(u,o,w),p(o,n),p(n,i),p(i,h),p(n,d),p(n,y),p(y,a),p(n,c),p(n,m),p(m,b),p(n,z),p(n,f),p(f,x),p(o,q),H(g,o,null),p(o,M),H(S,o,null),T=!0,k||(D=[F(i,"click",r[8]),F(y,"click",r[4]),F(m,"click",r[6]),F(f,"click",r[7])],k=!0)},p(u,[w]){const C={};w&1&&(C.cells=u[0]),w&2&&(C.worldSize=u[1]?.worldSize),s.$set(C),(!T||w&8)&&l!==(l=u[3].pause?"Run":"Pause")&&it(h,l);const _={};w&4&&(_.attractionTable=u[2]),S.$set(_)},i(u){T||(X(s.$$.fragment,u),X(g.$$.fragment,u),X(S.$$.fragment,u),T=!0)},o(u){Y(s.$$.fragment,u),Y(g.$$.fragment,u),Y(S.$$.fragment,u),T=!1},d(u){u&&v(t),J(s),u&&v(e),u&&v(o),J(g),J(S),k=!1,ct(D)}}}const rt=32;function Mt(r,t,s){let e,o,n,i;const l={pause:!1},h={x:1600,y:960},d=()=>{const f=pt(h,2e3,rt);s(0,o=f.cells),s(1,n=f.cellsMap)};let y;const a=()=>{l.pause===!1&&vt(i,rt,o,n),y=setTimeout(a,1)},c=f=>{s(2,i=f)},m=()=>{const f=["white","red","green","blue"],x=h.x/4;for(const q of o){const g=Math.floor(q.pos.x/x),M=f[g];q.color=M}},b=()=>{for(const f of o){const x=2*Math.random(),q=Math.random()*2*Math.PI,g=h.x/2+x*Math.cos(q),M=h.y/2+x*Math.sin(q);f.pos={x:g,y:M}}};return at(()=>{d(),s(2,i=ht()),a()}),lt(()=>{e?.remove(),clearTimeout(y)}),[o,n,i,l,d,c,m,b,()=>s(3,l.pause=!l.pause,l)]}class $t extends L{constructor(t){super(),G(this,t,Mt,St,Q,{})}}function It(r){let t,s;return t=new $t({}),{c(){W(t.$$.fragment)},l(e){j(t.$$.fragment,e)},m(e,o){H(t,e,o),s=!0},p:P,i(e){s||(X(t.$$.fragment,e),s=!0)},o(e){Y(t.$$.fragment,e),s=!1},d(e){J(t,e)}}}class zt extends L{constructor(t){super(),G(this,t,null,It,Q,{})}}export{zt as default};
