import{S as J,i as Q,s as Z,k as p,a as y,q as _,l as v,m as x,h,c as B,r as m,n as z,p as ee,b as F,D as l,K as M,B as W,M as te,o as ne,R as re,w as oe,x as ae,y as ie,f as se,t as ce,z as le}from"../../../chunks/index-46ced799.js";const ue=["VERTEX_SHADER","FRAGMENT_SHADER"];function fe(){const e=document.getElementById("canvas");if(!e)throw"canvas undefined";const t=e.getContext("webgl");if(!t)throw"gl undefined";return de(t),t}function de(e){if(!e.getExtension("OES_texture_float"))throw alert("Need OES_texture_float"),"Need OES_texture_float";if(!e.getExtension("WEBGL_color_buffer_float"))throw alert("Need WEBGL_color_buffer_float"),"Need WEBGL_color_buffer_float";if(e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<1)throw alert("Can not use textures in vertex shaders"),"Can not use textures in vertex shaders"}function he(e,t,o,n){const r=e.createTexture();if(!r)throw"Can not create texture";return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,o,n,0,e.RGBA,e.FLOAT,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r}function _e(e,t,o,n,r){const a=[];for(let u=0;u<t.length;++u){const c=ue[u]==="VERTEX_SHADER"?e.VERTEX_SHADER:e.FRAGMENT_SHADER,f=me(e,t[u],c,r);if(!f)throw"Can not create shader";a.push(f)}const i=Ee(e,a,o,n,r);if(!i)throw"Can not create program";return i}function me(e,t,o,n){const r=n||console.log,a=e.createShader(o);if(!a)throw"Could not load shader";if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)){const u=e.getShaderInfoLog(a);return r(new Error("*** Error compiling shader '"+a+"':"+u+`
`+t.split(`
`).map((c,f)=>`${f+1}: ${c}`).join(`
`))),e.deleteShader(a),null}return a}function Ee(e,t,o,n,r){const a=r||console.log,i=e.createProgram();if(!i)throw"Could not create program";if(t.forEach(function(c){e.attachShader(i,c)}),o&&o.forEach(function(c,f){e.bindAttribLocation(i,n?n[f]:f,c)}),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const c=e.getProgramInfoLog(i);return a("Error in program linking:"+c),e.deleteProgram(i),null}return i}function Te(e,t){t=t||1;const o=e.clientWidth*t|0,n=e.clientHeight*t|0;return e.width!==o||e.height!==n?(e.width=o,e.height=n,!0):!1}const pe=`attribute vec2 a_position;
uniform vec2 u_worldSize;
varying vec2 v_texcoord;

void main() {
    // Convert the position from pixels to normalized space (-1 to +1)
    vec2 zeroToOne = a_position / u_worldSize;
    vec2 zeroToTwo = zeroToOne * 2.0;
    vec2 clipSpace = zeroToTwo - 1.0;

    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

    // Pass the texture coordinate to the fragment shader
    v_texcoord = zeroToOne;
}

`,ve=`precision mediump float;
uniform sampler2D u_texture;
varying vec2 v_texcoord;

void main() {
    float alive = texture2D(u_texture, v_texcoord).x;
    gl_FragColor = vec4(alive, alive, alive, 1.0);
}
`;let L,P,C;const xe=(e,t)=>{const{screenDimensions:o}=t,{height:n,width:r}=o;if(P=_e(e,[pe,ve]),L={positionLocation:e.getAttribLocation(P,"a_position"),textureLocation:e.getUniformLocation(P,"u_texture"),worldSizeLocation:e.getUniformLocation(P,"u_worldSize")},C=e.createBuffer(),!C)throw new Error("cant create buffer");e.bindBuffer(e.ARRAY_BUFFER,C),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,n,r,0,r,0,0,n,r,n]),e.STATIC_DRAW)},Re=e=>{const{gl:t,cellsTex:o,worldDimensions:n}=e;t.bindTexture(t.TEXTURE_2D,o),t.useProgram(P),t.bindBuffer(t.ARRAY_BUFFER,C),t.enableVertexAttribArray(L.positionLocation),t.vertexAttribPointer(L.positionLocation,2,t.FLOAT,!1,0,0),t.uniform1i(L.textureLocation,0),t.uniform2f(L.worldSizeLocation,n.width,n.height),t.drawArrays(t.TRIANGLES,0,6)};function we(e,t,o){function n(){const a=e.getElementById(t);a&&(e.fullscreenElement&&e.exitFullscreen&&e.exitFullscreen(),a.width=o.width,a.height=o.height)}function r(){const a=e.getElementById(t);a&&(e.fullscreenElement||a.requestFullscreen())}return e.addEventListener("fullscreenchange",()=>{e.fullscreenElement===null&&n()}),{enableFullscreen:r,disableFullscreen:n}}function j(e,t){const{worldDimensions:o}=t,n=o.width*o.height,r=new Array(n).fill(0).map(i=>Math.random()<.5?1:0);return{cellsTex:he(e,new Float32Array(r.map(i=>[i,0,0,0]).flat()),o.width,o.height)}}function Ae(e){let t,o,n,r,a,i=e[2].width+"",u,c,f=e[2].height+"",R,g,I=e[2].width*e[2].height+"",E,w,N,A,X,$,S,k,U,b,D,G,O,V;return{c(){t=p("canvas"),o=y(),n=p("div"),r=p("span"),a=_("World "),u=_(i),c=_(" x "),R=_(f),g=_(" ("),E=_(I),w=_(" cells)"),N=y(),A=p("button"),X=_("Reload program"),$=y(),S=p("button"),k=_("Fullscreen"),U=y(),b=p("div"),D=p("button"),G=_("Reset texture"),this.h()},l(s){t=v(s,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),x(t).forEach(h),o=B(s),n=v(s,"DIV",{});var d=x(n);r=v(d,"SPAN",{});var T=x(r);a=m(T,"World "),u=m(T,i),c=m(T," x "),R=m(T,f),g=m(T," ("),E=m(T,I),w=m(T," cells)"),T.forEach(h),N=B(d),A=v(d,"BUTTON",{});var q=x(A);X=m(q,"Reload program"),q.forEach(h),$=B(d),S=v(d,"BUTTON",{});var H=x(S);k=m(H,"Fullscreen"),H.forEach(h),d.forEach(h),U=B(s),b=v(s,"DIV",{});var Y=x(b);D=v(Y,"BUTTON",{});var K=x(D);G=m(K,"Reset texture"),K.forEach(h),Y.forEach(h),this.h()},h(){z(t,"id","canvas"),ee(t,"background-color","black"),z(t,"width",e[1].width),z(t,"height",e[1].height)},m(s,d){F(s,t,d),F(s,o,d),F(s,n,d),l(n,r),l(r,a),l(r,u),l(r,c),l(r,R),l(r,g),l(r,E),l(r,w),l(n,N),l(n,A),l(A,X),l(n,$),l(n,S),l(S,k),F(s,U,d),F(s,b,d),l(b,D),l(D,G),O||(V=[M(A,"click",e[5]),M(S,"click",function(){re(e[0])&&e[0].apply(this,arguments)}),M(D,"click",e[6])],O=!0)},p(s,[d]){e=s},i:W,o:W,d(s){s&&h(t),s&&h(o),s&&h(n),s&&h(U),s&&h(b),O=!1,te(V)}}}function Se(e,t,o){const n={width:900,height:300},r={width:90,height:30};let a,i,u;function c(){cancelAnimationFrame(u),i=fe(),Te(i.canvas),a=j(i,{worldDimensions:r}).cellsTex,xe(i,{screenDimensions:n});function w(){return Re({gl:i,cellsTex:a,worldDimensions:r}),u=requestAnimationFrame(w)}u=requestAnimationFrame(w)}let f;ne(()=>{c(),o(0,f=we(document,"canvas",n).enableFullscreen),document.addEventListener("keydown",E=>{E.code==="Space"&&E.preventDefault()})});const R=()=>{a=j(i,{worldDimensions:r}).cellsTex};return[f,n,r,c,R,()=>c(),()=>R()]}class be extends J{constructor(t){super(),Q(this,t,Se,Ae,Z,{})}}function De(e){let t,o;return t=new be({}),{c(){oe(t.$$.fragment)},l(n){ae(t.$$.fragment,n)},m(n,r){ie(t,n,r),o=!0},p:W,i(n){o||(se(t.$$.fragment,n),o=!0)},o(n){ce(t.$$.fragment,n),o=!1},d(n){le(t,n)}}}class Le extends J{constructor(t){super(),Q(this,t,null,De,Z,{})}}export{Le as default};
