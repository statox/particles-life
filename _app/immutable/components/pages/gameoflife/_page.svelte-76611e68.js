import{S as _e,i as me,s as Ee,k as _,a as L,q as m,l as E,m as R,h as d,c as x,r as p,n as A,p as pe,b as W,D as s,O as V,K as P,u as ie,P as q,B as ae,M as Te,o as we,R as ve,w as Ae,x as Re,y as be,f as Se,t as ge,z as De}from"../../../chunks/index-46ced799.js";const Le=["VERTEX_SHADER","FRAGMENT_SHADER"];function xe(){const e=document.getElementById("canvas");if(!e)throw"canvas undefined";const t=e.getContext("webgl");if(!t)throw"gl undefined";return Fe(t),t}function Fe(e){if(!e.getExtension("OES_texture_float"))throw alert("Need OES_texture_float"),"Need OES_texture_float";if(!e.getExtension("WEBGL_color_buffer_float"))throw alert("Need WEBGL_color_buffer_float"),"Need WEBGL_color_buffer_float";if(e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<1)throw alert("Can not use textures in vertex shaders"),"Can not use textures in vertex shaders"}function Pe(e,t,o,n){const r=e.createTexture();if(!r)throw"Can not create texture";return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,o,n,0,e.RGBA,e.FLOAT,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r}function Ue(e,t,o,n,r){const i=[];for(let h=0;h<t.length;++h){const u=Le[h]==="VERTEX_SHADER"?e.VERTEX_SHADER:e.FRAGMENT_SHADER,f=ye(e,t[h],u,r);if(!f)throw"Can not create shader";i.push(f)}const a=Be(e,i,o,n,r);if(!a)throw"Can not create program";return a}function ye(e,t,o,n){const r=n||console.log,i=e.createShader(o);if(!i)throw"Could not load shader";if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const h=e.getShaderInfoLog(i);return r(new Error("*** Error compiling shader '"+i+"':"+h+`
`+t.split(`
`).map((u,f)=>`${f+1}: ${u}`).join(`
`))),e.deleteShader(i),null}return i}function Be(e,t,o,n,r){const i=r||console.log,a=e.createProgram();if(!a)throw"Could not create program";if(t.forEach(function(u){e.attachShader(a,u)}),o&&o.forEach(function(u,f){e.bindAttribLocation(a,n?n[f]:f,u)}),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){const u=e.getProgramInfoLog(a);return i("Error in program linking:"+u),e.deleteProgram(a),null}return a}function Ie(e,t){t=t||1;const o=e.clientWidth*t|0,n=e.clientHeight*t|0;return e.width!==o||e.height!==n?(e.width=o,e.height=n,!0):!1}const Ne=`attribute vec2 a_position;
uniform vec2 u_worldSize;
varying vec2 v_texcoord;

void main() {
    // Convert the position from pixels to normalized space (-1 to +1)
    vec2 zeroToOne = a_position / u_worldSize;
    vec2 zeroToTwo = zeroToOne * 2.0;
    vec2 clipSpace = zeroToTwo - 1.0;

    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

    // Pass the texture coordinate to the fragment shader
    v_texcoord = zeroToOne;
}

`,Ce=`precision mediump float;
uniform sampler2D u_texture;
varying vec2 v_texcoord;

void main() {
    float alive = texture2D(u_texture, v_texcoord).x;
    gl_FragColor = vec4(alive, alive, alive, 1.0);
}
`;let z,M,$;const Xe=(e,t)=>{const{screenDimensions:o}=t,{height:n,width:r}=o;if(M=Ue(e,[Ne,Ce]),z={positionLocation:e.getAttribLocation(M,"a_position"),textureLocation:e.getUniformLocation(M,"u_texture"),worldSizeLocation:e.getUniformLocation(M,"u_worldSize")},$=e.createBuffer(),!$)throw new Error("cant create buffer");e.bindBuffer(e.ARRAY_BUFFER,$),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,n,r,0,r,0,0,n,r,n]),e.STATIC_DRAW)},Oe=e=>{const{gl:t,cellsTex:o,worldDimensions:n}=e;t.bindTexture(t.TEXTURE_2D,o),t.useProgram(M),t.bindBuffer(t.ARRAY_BUFFER,$),t.enableVertexAttribArray(z.positionLocation),t.vertexAttribPointer(z.positionLocation,2,t.FLOAT,!1,0,0),t.uniform1i(z.textureLocation,0),t.uniform2f(z.worldSizeLocation,n.width,n.height),t.drawArrays(t.TRIANGLES,0,6)};function Ge(e,t,o){function n(){const i=e.getElementById(t);i&&(e.fullscreenElement&&e.exitFullscreen&&e.exitFullscreen(),i.width=o.width,i.height=o.height)}function r(){const i=e.getElementById(t);i&&(e.fullscreenElement||i.requestFullscreen())}return e.addEventListener("fullscreenchange",()=>{e.fullscreenElement===null&&n()}),{enableFullscreen:r,disableFullscreen:n}}function de(e,t){const{worldDimensions:o}=t,n=o.width*o.height,r=new Array(n).fill(0).map(a=>Math.random()<.5?1:0);return{cellsTex:Pe(e,new Float32Array(r.map(a=>[a,0,0,0]).flat()),o.width,o.height)}}function We(e){let t,o,n,r,i,a=e[0].width+"",h,u,f=e[0].height+"",U,G,F=e[0].width*e[0].height+"",y,b,B,I,Y,K,N,j,k,S,C,J,Q,T,X,Z,ee,w,te,O,ne,re,v,oe,se;return{c(){t=_("canvas"),o=L(),n=_("div"),r=_("span"),i=m("World "),h=m(a),u=m(" x "),U=m(f),G=m(" ("),y=m(F),b=m(" cells)"),B=L(),I=_("button"),Y=m("Reload program"),K=L(),N=_("button"),j=m("Fullscreen"),k=L(),S=_("div"),C=_("button"),J=m("Reset world"),Q=L(),T=_("span"),X=_("label"),Z=m("World: width"),ee=L(),w=_("input"),te=L(),O=_("label"),ne=m("height"),re=L(),v=_("input"),this.h()},l(l){t=E(l,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),R(t).forEach(d),o=x(l),n=E(l,"DIV",{});var c=R(n);r=E(c,"SPAN",{});var g=R(r);i=p(g,"World "),h=p(g,a),u=p(g," x "),U=p(g,f),G=p(g," ("),y=p(g,F),b=p(g," cells)"),g.forEach(d),B=x(c),I=E(c,"BUTTON",{});var le=R(I);Y=p(le,"Reload program"),le.forEach(d),K=x(c),N=E(c,"BUTTON",{});var ce=R(N);j=p(ce,"Fullscreen"),ce.forEach(d),c.forEach(d),k=x(l),S=E(l,"DIV",{});var H=R(S);C=E(H,"BUTTON",{});var ue=R(C);J=p(ue,"Reset world"),ue.forEach(d),Q=x(H),T=E(H,"SPAN",{});var D=R(T);X=E(D,"LABEL",{for:!0});var he=R(X);Z=p(he,"World: width"),he.forEach(d),ee=x(D),w=E(D,"INPUT",{id:!0,type:!0,min:!0}),te=x(D),O=E(D,"LABEL",{for:!0});var fe=R(O);ne=p(fe,"height"),fe.forEach(d),re=x(D),v=E(D,"INPUT",{id:!0,type:!0,min:!0}),D.forEach(d),H.forEach(d),this.h()},h(){A(t,"id","canvas"),pe(t,"background-color","black"),A(t,"width",e[2].width),A(t,"height",e[2].height),A(X,"for","worldWidth"),A(w,"id","worldWidth"),A(w,"type","number"),A(w,"min",0),A(O,"for","worldHeight"),A(v,"id","worldHeight"),A(v,"type","number"),A(v,"min",0)},m(l,c){W(l,t,c),W(l,o,c),W(l,n,c),s(n,r),s(r,i),s(r,h),s(r,u),s(r,U),s(r,G),s(r,y),s(r,b),s(n,B),s(n,I),s(I,Y),s(n,K),s(n,N),s(N,j),W(l,k,c),W(l,S,c),s(S,C),s(C,J),s(S,Q),s(S,T),s(T,X),s(X,Z),s(T,ee),s(T,w),V(w,e[0].width),s(T,te),s(T,O),s(O,ne),s(T,re),s(T,v),V(v,e[0].height),oe||(se=[P(I,"click",e[5]),P(N,"click",function(){ve(e[1])&&e[1].apply(this,arguments)}),P(C,"click",e[4]),P(w,"change",e[4]),P(w,"input",e[6]),P(v,"change",e[4]),P(v,"input",e[7])],oe=!0)},p(l,[c]){e=l,c&1&&a!==(a=e[0].width+"")&&ie(h,a),c&1&&f!==(f=e[0].height+"")&&ie(U,f),c&1&&F!==(F=e[0].width*e[0].height+"")&&ie(y,F),c&1&&q(w.value)!==e[0].width&&V(w,e[0].width),c&1&&q(v.value)!==e[0].height&&V(v,e[0].height)},i:ae,o:ae,d(l){l&&d(t),l&&d(o),l&&d(n),l&&d(k),l&&d(S),oe=!1,Te(se)}}}function ze(e,t,o){const n={width:700,height:700},r={width:10,height:10};let i,a,h;function u(){cancelAnimationFrame(h),a=xe(),Ie(a.canvas),i=de(a,{worldDimensions:r}).cellsTex,Xe(a,{screenDimensions:n});function B(){return Oe({gl:a,cellsTex:i,worldDimensions:r}),h=requestAnimationFrame(B)}h=requestAnimationFrame(B)}let f;we(()=>{u(),o(1,f=Ge(document,"canvas",n).enableFullscreen),document.addEventListener("keydown",b=>{b.code==="Space"&&b.preventDefault()})});const U=()=>{o(0,r.width=Math.min(r.width,n.width),r),o(0,r.height=Math.min(r.height,n.height),r),i=de(a,{worldDimensions:r}).cellsTex},G=()=>u();function F(){r.width=q(this.value),o(0,r)}function y(){r.height=q(this.value),o(0,r)}return[r,f,n,u,U,G,F,y]}class Me extends _e{constructor(t){super(),me(this,t,ze,We,Ee,{})}}function ke(e){let t,o;return t=new Me({}),{c(){Ae(t.$$.fragment)},l(n){Re(t.$$.fragment,n)},m(n,r){be(t,n,r),o=!0},p:ae,i(n){o||(Se(t.$$.fragment,n),o=!0)},o(n){ge(t.$$.fragment,n),o=!1},d(n){De(t,n)}}}class Ve extends _e{constructor(t){super(),me(this,t,null,ke,Ee,{})}}export{Ve as default};
