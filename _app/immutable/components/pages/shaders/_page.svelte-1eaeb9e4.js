import{S as Pr,i as Cr,s as Ur,k as B,q as be,a as ne,l as I,m as V,r as xe,h as w,c as ie,n as M,b as Fe,D as p,B as Pt,o as Yr,p as Jr,K as ct,O as ke,u as Wr,P as ze,M as Si,I as tm,J as Bl,L as $s,N as rm,w as Tn,x as In,y as yn,f as Dr,t as kr,z as En,e as ca,g as ks,d as zs,v as Il}from"../../../chunks/index-2f3b6d71.js";import{T as nm,a as im,b as uc,c as dc}from"../../../chunks/TabPanel-e2218539.js";import{c as om}from"../../../chunks/_commonjsHelpers-725317a4.js";const am=["VERTEX_SHADER","FRAGMENT_SHADER"];function ni(){const t=document.getElementById("canvas");if(!t)throw"canvas undefined";const e=t.getContext("webgl");if(!e)throw"gl undefined";return ua(e),e}function ua(t){if(!t.getExtension("OES_texture_float"))throw alert("Need OES_texture_float"),"Need OES_texture_float";if(!t.getExtension("WEBGL_color_buffer_float"))throw alert("Need WEBGL_color_buffer_float"),"Need WEBGL_color_buffer_float";if(t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<1)throw alert("Can not use textures in vertex shaders"),"Can not use textures in vertex shaders"}function ir(t,e,i,n){const o=t.createTexture();if(!o)throw"Can not create texture";return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i,n,0,t.RGBA,t.FLOAT,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),o}function Sr(t,e){const i=t.createFramebuffer();if(!i)throw"Can not create frame buffer";return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),i}function dr(t,e,i,n,o){const u=[];for(let a=0;a<e.length;++a){const h=am[a]==="VERTEX_SHADER"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,v=sm(t,e[a],h,o);if(!v)throw"Can not create shader";u.push(v)}const f=fm(t,u,i,n,o);if(!f)throw"Can not create program";return f}function sm(t,e,i,n){const o=n||console.log,u=t.createShader(i);if(!u)throw"Could not load shader";if(t.shaderSource(u,e),t.compileShader(u),!t.getShaderParameter(u,t.COMPILE_STATUS)){const a=t.getShaderInfoLog(u);return o(new Error("*** Error compiling shader '"+u+"':"+a+`
`+e.split(`
`).map((h,v)=>`${v+1}: ${h}`).join(`
`))),t.deleteShader(u),null}return u}function fm(t,e,i,n,o){const u=o||console.log,f=t.createProgram();if(!f)throw"Could not create program";if(e.forEach(function(h){t.attachShader(f,h)}),i&&i.forEach(function(h,v){t.bindAttribLocation(f,n?n[v]:v,h)}),t.linkProgram(f),!t.getProgramParameter(f,t.LINK_STATUS)){const h=t.getProgramInfoLog(f);return u("Error in program linking:"+h),t.deleteProgram(f),null}return f}function kt(t,e){e=e||1;const i=t.clientWidth*e|0,n=t.clientHeight*e|0;return t.width!==i||t.height!==n?(t.width=i,t.height=n,!0):!1}function lm(t){let e,i,n,o,u,f,a,h,v,y,P,K;return{c(){e=B("p"),i=be(`This is not super impressive but this page takes 9 integers and uses a compute shader to
    multiply them by two. It's a first step!`),n=ne(),o=B("p"),u=be(`It is reusing the code from
    `),f=B("a"),a=be(`this site
    `),h=be("."),v=ne(),y=B("ul"),P=ne(),K=B("canvas"),this.h()},l(re){e=I(re,"P",{});var Z=V(e);i=xe(Z,`This is not super impressive but this page takes 9 integers and uses a compute shader to
    multiply them by two. It's a first step!`),Z.forEach(w),n=ie(re),o=I(re,"P",{});var De=V(o);u=xe(De,`It is reusing the code from
    `),f=I(De,"A",{target:!0,href:!0});var Ue=V(f);a=xe(Ue,`this site
    `),Ue.forEach(w),h=xe(De,"."),De.forEach(w),v=ie(re),y=I(re,"UL",{id:!0}),V(y).forEach(w),P=ie(re),K=I(re,"CANVAS",{id:!0}),V(K).forEach(w),this.h()},h(){M(f,"target","none"),M(f,"href","https://webglfundamentals.org/webgl/lessons/webgl-gpgpu.html"),M(y,"id","result"),M(K,"id","canvas")},m(re,Z){Fe(re,e,Z),p(e,i),Fe(re,n,Z),Fe(re,o,Z),p(o,u),p(o,f),p(f,a),p(o,h),Fe(re,v,Z),Fe(re,y,Z),Fe(re,P,Z),Fe(re,K,Z)},p:Pt,i:Pt,o:Pt,d(re){re&&w(e),re&&w(n),re&&w(o),re&&w(v),re&&w(y),re&&w(P),re&&w(K)}}}function cm(t){const e=document.createElement("li");e.textContent=t.toString();const i=document.getElementById("result");if(!i)throw"result element undefined";i.appendChild(e)}function um(t){function e(){const i=`
    attribute vec4 position;
    void main() {
      gl_Position = position;
    }
    `,n=`
    precision highp float;

    uniform sampler2D srcTex;
    uniform vec2 srcDimensions;

    void main() {
      vec2 texcoord = gl_FragCoord.xy / srcDimensions;
      vec4 value = texture2D(srcTex, texcoord);
      gl_FragColor = value * 2.0;
    }
    `,f=document.createElement("canvas");f.width=3,f.height=3;const a=f.getContext("webgl");if(!a)throw"Coulndt get context";const h=dr(a,[i,n]);if(!h)throw"Could not get program";const v=a.getAttribLocation(h,"position"),y=a.getUniformLocation(h,"srcTex"),P=a.getUniformLocation(h,"srcDimensions"),K=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,K),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),a.STATIC_DRAW),a.enableVertexAttribArray(v),a.vertexAttribPointer(v,2,a.FLOAT,!1,0,0);const re=3,Z=3,De=a.createTexture();a.bindTexture(a.TEXTURE_2D,De),a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,re,Z,0,a.LUMINANCE,a.UNSIGNED_BYTE,new Uint8Array([1,2,3,4,5,6,70,80,90])),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.useProgram(h),a.uniform1i(y,0),a.uniform2f(P,re,Z),a.drawArrays(a.TRIANGLES,0,6);const Ue=new Uint8Array(3*3*4);a.readPixels(0,0,3,3,a.RGBA,a.UNSIGNED_BYTE,Ue);for(let Ie=0;Ie<3*3;++Ie)cm(Ue[Ie*4])}return Yr(e),[]}class dm extends Pr{constructor(e){super(),Cr(this,e,um,lm,Ur,{})}}const mm=Float32Array;function mc(t,e,i,n,o,u){const f=new mm(16);return f[0]=2/(e-t),f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2/(n-i),f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2/(o-u),f[11]=0,f[12]=(t+e)/(t-e),f[13]=(i+n)/(i-n),f[14]=(o+u)/(o-u),f[15]=1,f}function hm(t){let e,i,n,o,u,f,a;return{c(){e=B("p"),i=be(`This is the simple particles simulation from
    `),n=B("a"),o=be("webglfundamentals"),u=be(" directly copied in a svelte component."),f=ne(),a=B("canvas"),this.h()},l(h){e=I(h,"P",{});var v=V(e);i=xe(v,`This is the simple particles simulation from
    `),n=I(v,"A",{target:!0,href:!0});var y=V(n);o=xe(y,"webglfundamentals"),y.forEach(w),u=xe(v," directly copied in a svelte component."),v.forEach(w),f=ie(h),a=I(h,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(a).forEach(w),this.h()},h(){M(n,"target","none"),M(n,"href","https://webglfundamentals.org/webgl/lessons/webgl-gpgpu.html"),M(a,"id","canvas"),Jr(a,"background-color","black"),M(a,"width","800"),M(a,"height","600")},m(h,v){Fe(h,e,v),p(e,i),p(e,n),p(n,o),p(e,u),Fe(h,f,v),Fe(h,a,v)},p:Pt,i:Pt,o:Pt,d(h){h&&w(e),h&&w(f),h&&w(a)}}}function pm(t){function e(){const i=`
  attribute vec4 position;
  void main() {
    gl_Position = position;
  }
  `,n=`
  precision highp float;

  uniform sampler2D positionTex;
  uniform sampler2D velocityTex;
  uniform vec2 texDimensions;
  uniform vec2 canvasDimensions;
  uniform float deltaTime;

  vec2 euclideanModulo(vec2 n, vec2 m) {
  	return mod(mod(n, m) + m, m);
  }

  void main() {
    // there will be one velocity per position
    // so the velocity texture and position texture
    // are the same size.

    // further, we're generating new positions
    // so we know our destination is the same size
    // as our source so we only need one set of 
    // shared texture dimensions

    // compute texcoord from gl_FragCoord;
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    
    vec2 position = texture2D(positionTex, texcoord).xy;
    vec2 velocity = texture2D(velocityTex, texcoord).xy;
    vec2 newPosition = euclideanModulo(position + velocity * deltaTime, canvasDimensions);

    gl_FragColor = vec4(newPosition, 0, 1);
  }
  `,o=`
  attribute float id;
  uniform sampler2D positionTex;
  uniform vec2 texDimensions;
  uniform mat4 matrix;

  vec4 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord);
  }

  void main() {
    // pull the position from the texture
    vec4 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // do the common matrix math
    gl_Position = matrix * vec4(position.xy, 0, 1);
    gl_PointSize = 10.0;
  }
  `,u=`
  precision highp float;
  void main() {
    gl_FragColor = vec4(0.4, 0.2, 0.9, 0.5);
  }
  `,f=document.getElementById("canvas");if(!f)throw"canvas undefined";const a=f.getContext("webgl");if(!a)throw"gl undefined";if(!a.getExtension("OES_texture_float"))throw alert("Need OES_texture_float"),"Need OES_texture_float";if(!a.getExtension("WEBGL_color_buffer_float"))throw alert("Need WEBGL_color_buffer_float"),"Need WEBGL_color_buffer_float";if(a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<1)throw alert("Can not use textures in vertex shaders"),"Can not use textures in vertex shaders";const y=dr(a,[i,n]),P=dr(a,[o,u]);if(!y||!P)throw"Can not create programs";const K={position:a.getAttribLocation(y,"position"),positionTex:a.getUniformLocation(y,"positionTex"),velocityTex:a.getUniformLocation(y,"velocityTex"),texDimensions:a.getUniformLocation(y,"texDimensions"),canvasDimensions:a.getUniformLocation(y,"canvasDimensions"),deltaTime:a.getUniformLocation(y,"deltaTime")},re={id:a.getAttribLocation(P,"id"),positionTex:a.getUniformLocation(P,"positionTex"),texDimensions:a.getUniformLocation(P,"texDimensions"),matrix:a.getUniformLocation(P,"matrix")},Z=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,Z),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),a.STATIC_DRAW);const De=300,Ue=20,Ie=De*Ue,je=new Array(Ie).fill(0).map((he,Ft)=>Ft),st=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,st),a.bufferData(a.ARRAY_BUFFER,new Float32Array(je),a.STATIC_DRAW),kt(a.canvas);const qe=(he,Ft)=>(Ft===void 0&&(Ft=he,he=0),Math.random()*(Ft-he)+he),tt=new Float32Array(je.map(he=>[qe(f.width),qe(f.height),0,0]).flat()),ut=new Float32Array(je.map(he=>[qe(-300,300),qe(-300,300),0,0]).flat());function rt(he,Ft,ft,Et){const Kt=he.createTexture();return he.bindTexture(he.TEXTURE_2D,Kt),he.texImage2D(he.TEXTURE_2D,0,he.RGBA,ft,Et,0,he.RGBA,he.FLOAT,Ft),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,he.NEAREST),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,he.NEAREST),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),Kt}const At=rt(a,ut,De,Ue),ht=rt(a,tt,De,Ue),Qe=rt(a,null,De,Ue);if(!ht||!Qe)throw"Can not create position textures";function _t(he,Ft){const ft=he.createFramebuffer();return he.bindFramebuffer(he.FRAMEBUFFER,ft),he.framebufferTexture2D(he.FRAMEBUFFER,he.COLOR_ATTACHMENT0,he.TEXTURE_2D,Ft,0),ft}const at=_t(a,ht),oe=_t(a,Qe);let Me={fb:at,tex:ht},pt={fb:oe,tex:Qe},yt=0;function Ot(he){if(!a)return;he*=.001;const Ft=he-yt;yt=he,kt(a.canvas),a.bindFramebuffer(a.FRAMEBUFFER,pt.fb),a.viewport(0,0,De,Ue),a.bindBuffer(a.ARRAY_BUFFER,Z),a.enableVertexAttribArray(K.position),a.vertexAttribPointer(K.position,2,a.FLOAT,!1,0,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,Me.tex),a.activeTexture(a.TEXTURE0+1),a.bindTexture(a.TEXTURE_2D,At),a.useProgram(y),a.uniform1i(K.positionTex,0),a.uniform1i(K.velocityTex,1),a.uniform2f(K.texDimensions,De,Ue),a.uniform2f(K.canvasDimensions,a.canvas.width,a.canvas.height),a.uniform1f(K.deltaTime,Ft),a.drawArrays(a.TRIANGLES,0,6),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,a.canvas.width,a.canvas.height),a.bindBuffer(a.ARRAY_BUFFER,st),a.enableVertexAttribArray(re.id),a.vertexAttribPointer(re.id,1,a.FLOAT,!1,0,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,pt.tex),a.useProgram(P),a.uniform2f(re.texDimensions,De,De),a.uniform1i(re.positionTex,0),a.uniformMatrix4fv(re.matrix,!1,mc(0,a.canvas.width,0,a.canvas.height,-1,1)),a.drawArrays(a.POINTS,0,Ie);{const ft=Me;Me=pt,pt=ft}requestAnimationFrame(Ot)}requestAnimationFrame(Ot)}return Yr(()=>e()),[]}class vm extends Pr{constructor(e){super(),Cr(this,e,pm,hm,Ur,{})}}const jo=(t,e)=>(e===void 0&&(e=t,t=0),Math.random()*(e-t)+t);function _m(t,e,i,n){const o=t*e,u=new Array(o).fill(0).map((h,v)=>v),f=new Float32Array(u.map(h=>[jo(i),jo(n),0,0]).flat()),a=new Float32Array(u.map(h=>[jo(-300,300),jo(-300,300),0,0]).flat());return{numParticles:o,ids:new Float32Array(u),positions:f,velocities:a}}const bm=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,xm=`precision highp float;

uniform sampler2D positionTex;
uniform sampler2D velocityTex;
uniform vec2 texDimensions;
uniform vec2 canvasDimensions;
uniform float deltaTime;

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    // there will be one velocity per position
    // so the velocity texture and position texture
    // are the same size.

    // further, we're generating new positions
    // so we know our destination is the same size
    // as our source so we only need one set of 
    // shared texture dimensions

    // compute texcoord from gl_FragCoord;
    vec2 texcoord = gl_FragCoord.xy / texDimensions;

    vec2 position = texture2D(positionTex, texcoord).xy;
    //vec2 velocity = texture2D(velocityTex, texcoord).xy;
    vec2 velocity = vec2(0.0, -100);
    vec2 newPosition = euclideanModulo(position + velocity * deltaTime, canvasDimensions);

    gl_FragColor = vec4(newPosition, 0, 1);
}

`,Tm=`  attribute float id;
  uniform sampler2D positionTex;
  uniform vec2 texDimensions;
  uniform mat4 matrix;

  vec4 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord);
  }

  void main() {
    // pull the position from the texture
    vec4 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // do the common matrix math
    gl_Position = matrix * vec4(position.xy, 0, 1);
    gl_PointSize = 10.0;
  }

`,ym=`precision highp float;
void main() {
    gl_FragColor = vec4(0.2, 0.4, 0.9, 0.5);
}

`;function Em(t){let e,i,n,o,u,f,a;return{c(){e=B("p"),i=be(`This is the simple particles simulation from
    `),n=B("a"),o=be("webglfundamentals"),u=be(" with the shader code extracted into separate files."),f=ne(),a=B("canvas"),this.h()},l(h){e=I(h,"P",{});var v=V(e);i=xe(v,`This is the simple particles simulation from
    `),n=I(v,"A",{target:!0,href:!0});var y=V(n);o=xe(y,"webglfundamentals"),y.forEach(w),u=xe(v," with the shader code extracted into separate files."),v.forEach(w),f=ie(h),a=I(h,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(a).forEach(w),this.h()},h(){M(n,"target","none"),M(n,"href","https://webglfundamentals.org/webgl/lessons/webgl-gpgpu.html"),M(a,"id","canvas"),Jr(a,"background-color","black"),M(a,"width","800"),M(a,"height","600")},m(h,v){Fe(h,e,v),p(e,i),p(e,n),p(n,o),p(e,u),Fe(h,f,v),Fe(h,a,v)},p:Pt,i:Pt,o:Pt,d(h){h&&w(e),h&&w(f),h&&w(a)}}}function Am(t){function e(){const o=document.getElementById("canvas");if(!o)throw"canvas undefined";const u=o.getContext("webgl");if(!u)throw"gl undefined";ua(u);const f=dr(u,[bm,xm]),a=dr(u,[Tm,ym]),h={position:u.getAttribLocation(f,"position"),positionTex:u.getUniformLocation(f,"positionTex"),velocityTex:u.getUniformLocation(f,"velocityTex"),texDimensions:u.getUniformLocation(f,"texDimensions"),canvasDimensions:u.getUniformLocation(f,"canvasDimensions"),deltaTime:u.getUniformLocation(f,"deltaTime")},v={id:u.getAttribLocation(a,"id"),positionTex:u.getUniformLocation(a,"positionTex"),texDimensions:u.getUniformLocation(a,"texDimensions"),matrix:u.getUniformLocation(a,"matrix")},y=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,y),u.bufferData(u.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),u.STATIC_DRAW);const P=300,K=20,{numParticles:re,ids:Z,positions:De,velocities:Ue}=_m(P,K,o.width,o.height),Ie=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,Ie),u.bufferData(u.ARRAY_BUFFER,new Float32Array(Z),u.STATIC_DRAW),kt(u.canvas);const je=ir(u,Ue,P,K),st=ir(u,De,P,K),qe=ir(u,null,P,K),tt=Sr(u,st),ut=Sr(u,qe);let rt={fb:tt,tex:st},At={fb:ut,tex:qe},ht=0;function Qe(_t){if(!u||!y||!Ie)throw"Undefined params to render";_t*=.001;const at=_t-ht;ht=_t,kt(u.canvas),n(u,At,P,K,y,h,rt,je,f,at),i(u,P,Ie,v,At,a,re);{const oe=rt;rt=At,At=oe}requestAnimationFrame(Qe)}requestAnimationFrame(Qe)}const i=(o,u,f,a,h,v,y)=>{o.bindFramebuffer(o.FRAMEBUFFER,null),o.viewport(0,0,o.canvas.width,o.canvas.height),o.bindBuffer(o.ARRAY_BUFFER,f),o.enableVertexAttribArray(a.id),o.vertexAttribPointer(a.id,1,o.FLOAT,!1,0,0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,h.tex),o.useProgram(v),o.uniform2f(a.texDimensions,u,u),o.uniform1i(a.positionTex,0),o.uniformMatrix4fv(a.matrix,!1,mc(0,o.canvas.width,0,o.canvas.height,-1,1)),o.drawArrays(o.POINTS,0,y)},n=(o,u,f,a,h,v,y,P,K,re)=>{o.bindFramebuffer(o.FRAMEBUFFER,u.fb),o.viewport(0,0,f,a),o.bindBuffer(o.ARRAY_BUFFER,h),o.enableVertexAttribArray(v.position),o.vertexAttribPointer(v.position,2,o.FLOAT,!1,0,0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,y.tex),o.activeTexture(o.TEXTURE0+1),o.bindTexture(o.TEXTURE_2D,P),o.useProgram(K),o.uniform1i(v.positionTex,0),o.uniform1i(v.velocityTex,1),o.uniform2f(v.texDimensions,f,a),o.uniform2f(v.canvasDimensions,o.canvas.width,o.canvas.height),o.uniform1f(v.deltaTime,re),o.drawArrays(o.TRIANGLES,0,6)};return Yr(()=>e()),[]}class gm extends Pr{constructor(e){super(),Cr(this,e,Am,Em,Ur,{})}}const wm=`attribute vec2 a_position;

uniform vec2 u_resolution;

// all shaders have a main function
void main() {
    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = a_position / u_resolution;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = 10.0;
}
`,Rm=`precision mediump float;

void main() {
    gl_FragColor = vec4(0.1, 0.5, 1.0, 1.0);
}
`;function Lm(t){let e,i,n,o,u,f,a,h,v,y,P,K;return{c(){e=B("p"),i=be(`Create an array of render-size positions. Bind this array to a buffer in the shader program. In
    each `),n=B("code"),o=be("requestAnimationFrame"),u=be(` update the positions randomly with javascript and use the
    shader program to render each position as a point.`),f=ne(),a=B("canvas"),h=ne(),v=B("button"),y=be("Add position"),this.h()},l(re){e=I(re,"P",{});var Z=V(e);i=xe(Z,`Create an array of render-size positions. Bind this array to a buffer in the shader program. In
    each `),n=I(Z,"CODE",{});var De=V(n);o=xe(De,"requestAnimationFrame"),De.forEach(w),u=xe(Z,` update the positions randomly with javascript and use the
    shader program to render each position as a point.`),Z.forEach(w),f=ie(re),a=I(re,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(a).forEach(w),h=ie(re),v=I(re,"BUTTON",{});var Ue=V(v);y=xe(Ue,"Add position"),Ue.forEach(w),this.h()},h(){M(a,"id","canvas"),Jr(a,"background-color","black"),M(a,"width","800"),M(a,"height","600")},m(re,Z){Fe(re,e,Z),p(e,i),p(e,n),p(n,o),p(e,u),Fe(re,f,Z),Fe(re,a,Z),Fe(re,h,Z),Fe(re,v,Z),p(v,y),P||(K=ct(v,"click",t[1]),P=!0)},p:Pt,i:Pt,o:Pt,d(re){re&&w(e),re&&w(f),re&&w(a),re&&w(h),re&&w(v),P=!1,K()}}}function Sm(t){const e=[50,50,50,150,150,150,150,50,200,200];function i(){const u=document.getElementById("canvas");if(!u)throw"canvas undefined";const f=u.getContext("webgl");if(!f)throw"gl undefined";ua(f);const a=dr(f,[wm,Rm]);kt(f.canvas);const h=f.getAttribLocation(a,"a_position"),v=f.getUniformLocation(a,"u_resolution"),y=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,y),f.bufferData(f.ARRAY_BUFFER,new Float32Array(e),f.STATIC_DRAW);function P(){if(!f)throw"Undefined params to render";for(let st=0;st<=e.length-2;st+=2)e[st]=(e[st]+Math.random()*2-1)%f.canvas.width,e[st+1]=(e[st+1]+Math.random()*0+1)%f.canvas.height;f.bufferData(f.ARRAY_BUFFER,new Float32Array(e),f.STATIC_DRAW),kt(f.canvas),f.viewport(0,0,f.canvas.width,f.canvas.height),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.useProgram(a),f.uniform2f(v,f.canvas.width,f.canvas.height),f.enableVertexAttribArray(h),f.bindBuffer(f.ARRAY_BUFFER,y);const K=2,re=f.FLOAT,Z=!1,De=0,Ue=0;f.vertexAttribPointer(h,K,re,Z,De,Ue);var Ie=f.POINTS,je=e.length/2;f.drawArrays(Ie,Ue,je),requestAnimationFrame(P)}requestAnimationFrame(P)}const n=()=>{e.push(Math.random()*800),e.push(Math.random()*600)};return Yr(()=>i()),[n,()=>n()]}class Fm extends Pr{constructor(e){super(),Cr(this,e,Sm,Lm,Ur,{})}}const Dm=`attribute float id;
uniform sampler2D positionTex;
uniform vec2 texDimensions;

uniform vec2 u_resolution;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / u_resolution;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = 10.0;
}
`,Pm=`precision mediump float;

void main() {
    gl_FragColor = vec4(0.1, 0.5, 1.0, 1.0);
}
`;let ji,qi;const Cm=t=>{qi=dr(t,[Dm,Pm]),ji={idAttributeLocation:t.getAttribLocation(qi,"id"),texDimensionsUniformLocation:t.getUniformLocation(qi,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(qi,"u_resolution")}},Um=t=>{const{gl:e,positionTex:i,textureDimension:n,ids:o}=t;kt(e.canvas),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT);const u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.useProgram(qi),e.uniform2f(ji.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.uniform2f(ji.texDimensionsUniformLocation,n.width,n.height),e.enableVertexAttribArray(ji.idAttributeLocation),e.bindBuffer(e.ARRAY_BUFFER,u);const f=1,a=e.FLOAT,h=!1,v=0,y=0;e.vertexAttribPointer(ji.idAttributeLocation,f,a,h,v,y);const P=e.POINTS,K=o.length;e.drawArrays(P,y,K)};function Bm(t){let e,i,n,o,u,f,a;return{c(){e=B("p"),i=be("Create an array of render-size positions. Store this array in a texture. In each "),n=B("code"),o=be("requestAnimationFrame"),u=be(` update the positions randomly with javascript and create a new texture holding the positions then
    use a shader to render the texture.`),f=ne(),a=B("canvas"),this.h()},l(h){e=I(h,"P",{});var v=V(e);i=xe(v,"Create an array of render-size positions. Store this array in a texture. In each "),n=I(v,"CODE",{});var y=V(n);o=xe(y,"requestAnimationFrame"),y.forEach(w),u=xe(v,` update the positions randomly with javascript and create a new texture holding the positions then
    use a shader to render the texture.`),v.forEach(w),f=ie(h),a=I(h,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(a).forEach(w),this.h()},h(){M(a,"id","canvas"),Jr(a,"background-color","black"),M(a,"width",hc),M(a,"height",pc)},m(h,v){Fe(h,e,v),p(e,i),p(e,n),p(n,o),p(e,u),Fe(h,f,v),Fe(h,a,v)},p:Pt,i:Pt,o:Pt,d(h){h&&w(e),h&&w(f),h&&w(a)}}}const hc=800,pc=600;function Im(t){function e(){const i=document.getElementById("canvas");if(!i)throw"canvas undefined";const n=i.getContext("webgl");if(!n)throw"gl undefined";ua(n),kt(n.canvas),Cm(n);const o=[0,1,2,3,4,5,6,7,8,9],u=o.map(a=>[Math.random()*hc,Math.random()*pc,0,0]).flat();function f(){if(!n)throw"Undefined params to render";for(let h=0;h<=u.length-2;h+=2)u[h]=(u[h]+Math.random()*2-1)%n.canvas.width,u[h+1]=(u[h+1]+Math.random()*0+1)%n.canvas.height;const a=ir(n,new Float32Array(u),3,3);Um({gl:n,positionTex:a,textureDimension:{width:3,height:3},ids:o}),requestAnimationFrame(f)}requestAnimationFrame(f)}return Yr(()=>e()),[]}let Om=class extends Pr{constructor(e){super(),Cr(this,e,Im,Bm,Ur,{})}};const Nm=`attribute float id;
uniform sampler2D positionTex;
uniform vec2 texDimensions;

uniform vec2 u_resolution;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / u_resolution;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = 3.0;
}
`,Gm=`precision mediump float;

void main() {
    gl_FragColor = vec4(0.1, 0.5, 1.0, 1.0);
}
`;let Qi,Ki,vs;const Mm=(t,e)=>{Ki=dr(t,[Nm,Gm]),Qi={idAttributeLocation:t.getAttribLocation(Ki,"id"),texDimensionsUniformLocation:t.getUniformLocation(Ki,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(Ki,"u_resolution")},vs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,vs),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)},$m=t=>{const{gl:e,positionTex:i,textureDimension:n,ids:o}=t;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,vs),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.useProgram(Ki),e.uniform2f(Qi.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.uniform2f(Qi.texDimensionsUniformLocation,n.width,n.height),e.enableVertexAttribArray(Qi.idAttributeLocation);const u=1,f=e.FLOAT,a=!1,h=0,v=0;e.vertexAttribPointer(Qi.idAttributeLocation,u,f,a,h,v),e.drawArrays(e.POINTS,v,o.length)};function km(t,e){const i=new Array(t).fill(0).map((u,f)=>f),n=i.map(u=>[Math.random()*e.width,Math.random()*e.height,0,0]).flat(),o={width:i.length,height:1};return{ids:i,positions:n,texDimensions:o}}const zm=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,Xm=`precision highp float;

uniform sampler2D positionTex;
uniform vec2 texDimensions;
uniform vec2 u_resolution;

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;

    vec2 center = u_resolution / 2.0;
    vec2 direction = (center - position) / u_resolution;

    vec2 newPosition = euclideanModulo(position + direction, u_resolution);

    gl_FragColor = vec4(newPosition, 0, 1);
}

`;let Ai,gi,_s,fs,ls,Ol,Nl,Zi,na;const Vm=(t,e)=>{const{positions:i,texDimensions:n}=e;gi=dr(t,[zm,Xm]),Ai={positionAttributeLocation:t.getAttribLocation(gi,"position"),positionTexLocation:t.getUniformLocation(gi,"positionTex"),texDimensionsUniformLocation:t.getUniformLocation(gi,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(gi,"u_resolution")},_s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,_s),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),fs=ir(t,new Float32Array(i),n.width,n.height),ls=ir(t,null,n.width,n.height),Ol=Sr(t,fs),Nl=Sr(t,ls),Zi={fb:Ol,tex:fs},na={fb:Nl,tex:ls}},Hm=t=>{const{gl:e,texDimensions:i}=t;e.bindFramebuffer(e.FRAMEBUFFER,na.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,_s),e.enableVertexAttribArray(Ai.positionAttributeLocation),e.vertexAttribPointer(Ai.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,Zi.tex),e.useProgram(gi),e.uniform1i(Ai.positionTexLocation,0),e.uniform2f(Ai.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(Ai.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.drawArrays(e.TRIANGLES,0,6);{const n=Zi;Zi=na,na=n}return Zi.tex};function Wm(t){let e,i,n,o,u,f,a,h,v,y,P,K,re;return{c(){e=B("p"),i=be("Create an array of render-size positions. Store this array in a texture."),n=ne(),o=B("p"),u=be("Create 2 textures which will be used to update the positions with a shader. In each "),f=B("code"),a=be("requestAnimationFrame"),h=be(` update the positions with the simple shader reading from the first texture and writing to the new
    one. Then use the drawing shader to render the new texture to the canvas.`),v=ne(),y=B("p"),P=be("Finally switch the two textures to read and write in the updated textures"),K=ne(),re=B("canvas"),this.h()},l(Z){e=I(Z,"P",{});var De=V(e);i=xe(De,"Create an array of render-size positions. Store this array in a texture."),De.forEach(w),n=ie(Z),o=I(Z,"P",{});var Ue=V(o);u=xe(Ue,"Create 2 textures which will be used to update the positions with a shader. In each "),f=I(Ue,"CODE",{});var Ie=V(f);a=xe(Ie,"requestAnimationFrame"),Ie.forEach(w),h=xe(Ue,` update the positions with the simple shader reading from the first texture and writing to the new
    one. Then use the drawing shader to render the new texture to the canvas.`),Ue.forEach(w),v=ie(Z),y=I(Z,"P",{});var je=V(y);P=xe(je,"Finally switch the two textures to read and write in the updated textures"),je.forEach(w),K=ie(Z),re=I(Z,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(re).forEach(w),this.h()},h(){M(re,"id","canvas"),Jr(re,"background-color","black"),M(re,"width",vc),M(re,"height",_c)},m(Z,De){Fe(Z,e,De),p(e,i),Fe(Z,n,De),Fe(Z,o,De),p(o,u),p(o,f),p(f,a),p(o,h),Fe(Z,v,De),Fe(Z,y,De),p(y,P),Fe(Z,K,De),Fe(Z,re,De)},p:Pt,i:Pt,o:Pt,d(Z){Z&&w(e),Z&&w(n),Z&&w(o),Z&&w(v),Z&&w(y),Z&&w(K),Z&&w(re)}}}const vc=800,_c=600;function Ym(t){function e(){const i=ni();kt(i.canvas);const{ids:n,positions:o,texDimensions:u}=km(100,{width:vc,height:_c});Mm(i,n),Vm(i,{positions:o,texDimensions:u});function f(){kt(i.canvas);const a=Hm({gl:i,texDimensions:u});$m({gl:i,positionTex:a,textureDimension:u,ids:n}),requestAnimationFrame(f)}requestAnimationFrame(f)}return Yr(()=>e()),[]}let jm=class extends Pr{constructor(e){super(),Cr(this,e,Ym,Wm,Ur,{})}};const qm=`attribute float id;
attribute float color;
uniform sampler2D positionTex;
uniform vec2 texDimensions;

uniform vec2 u_resolution;

varying float v_color;
varying float v_id;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / u_resolution;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = 2.0;
    v_color = color;
    v_id = id / (texDimensions.x * texDimensions.y);
}
`,Qm=`precision mediump float;
varying float v_color;
varying float v_id;

void main() {
    if (v_id < 0.1) {
        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
        return;
    }
    if (v_id > 0.45 && v_id < 0.55) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        return;
    }
    if (v_id > 0.9) {
        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);
        return;
    }
    gl_FragColor = vec4(v_id, 1.0, v_id, 1.0);

    // if (v_color == 0.0) {
    //     gl_FragColor = vec4(1.0, 0.0, 0.0, 0.3);
    // } else if (v_color == 1.0){
    //     gl_FragColor = vec4(0.0, 1.0, 0.0, 0.3);
    // } else if (v_color == 2.0){
    //     gl_FragColor = vec4(0.0, 0.0, 1.0, 0.3);
    // } else if (v_color == 3.0){
    //     gl_FragColor = vec4(1.0, 1.0, 0.0, 0.3);
    // }
}
`;let Kn,wi,bs,xs;const Km=(t,e)=>{const{ids:i,colors:n}=e;wi=dr(t,[qm,Qm]),Kn={idAttributeLocation:t.getAttribLocation(wi,"id"),colorAttributeLocation:t.getAttribLocation(wi,"color"),texDimensionsUniformLocation:t.getUniformLocation(wi,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(wi,"u_resolution")},bs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,bs),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),xs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,xs),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)},Zm=t=>{const{gl:e,positionTex:i,textureDimension:n,ids:o}=t,u=1,f=e.FLOAT,a=!1,h=0,v=0;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,bs),e.vertexAttribPointer(Kn.idAttributeLocation,u,f,a,h,v),e.enableVertexAttribArray(Kn.idAttributeLocation),e.bindBuffer(e.ARRAY_BUFFER,xs),e.vertexAttribPointer(Kn.colorAttributeLocation,u,f,a,h,v),e.enableVertexAttribArray(Kn.colorAttributeLocation),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.useProgram(wi),e.uniform2f(Kn.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.uniform2f(Kn.texDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.POINTS,v,o.length)};function Jm(t,e){const i=t.width*t.height,n=new Array(i).fill(0).map((f,a)=>a),o=new Array(i).fill(0).map(f=>Math.floor(Math.random()*4)),u=n.map(f=>{{const{x:h,y:v}=eh(e,20);return[h,v,0,0]}}).flat();return{ids:n,positions:u,texDimensions:t,colors:o}}const eh=(t,e)=>{const i=e*Math.random(),n=Math.random()*2*Math.PI,o=i*Math.cos(n)+t.width/2,u=i*Math.sin(n)+t.height/2;return{x:o,y:u}},th=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,rh=`precision highp float;

#define MIN_DISTANCE 9.0

uniform sampler2D positionTex;
uniform vec2 texDimensions;
uniform vec2 u_resolution;
uniform float deltaTime;

// We need to define the texture dimensions in constants
// because loops work only with constant values
const float texWidth = 100.0;
const float texHeight = 100.0;

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;

    vec2 direction = vec2(0.0, 0.0);

    // Iterate on the texture coordinates to compare with each other cell

    for (float y=0.0; y<1.0; y += 1.0 / texHeight) {
        for (float x=0.0; x<1.0; x += 1.0 / texWidth) {
            vec2 otherTextCoord = vec2(x, y);
            vec2 otherPosition = texture2D(positionTex, otherTextCoord).xy;

            vec2 diff = position - otherPosition;
            float mag = length(diff);
            if (mag < MIN_DISTANCE) {
                if (mag == 0.0) {
                    mag = 1.0e-10;
                }
                direction = direction + (diff * 10.0/mag);
            }
        }
    }
    direction = (direction * 0.0001) * deltaTime;

    vec2 newPosition = euclideanModulo(position + direction, u_resolution);

    gl_FragColor = vec4(newPosition, 0, 1);
}

`;let Zn,Jn,Ts,qo,cs,Gl,Ml,Ji,ia,Qo;const nh=(t,e)=>{const{positions:i,texDimensions:n}=e;return Jn=dr(t,[th,rh]),Zn={positionAttributeLocation:t.getAttribLocation(Jn,"position"),positionTexLocation:t.getUniformLocation(Jn,"positionTex"),deltaTimeUniformLocation:t.getUniformLocation(Jn,"deltaTime"),texDimensionsUniformLocation:t.getUniformLocation(Jn,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(Jn,"u_resolution")},Ts=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Ts),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),qo=ir(t,new Float32Array(i),n.width,n.height),cs=ir(t,null,n.width,n.height),Gl=Sr(t,qo),Ml=Sr(t,cs),Ji={fb:Gl,tex:qo},ia={fb:Ml,tex:cs},qo},ih=t=>{const{gl:e,texDimensions:i}=t,n=Date.now();Qo||(Qo=n-1);const o=n-Qo;Qo=n,e.bindFramebuffer(e.FRAMEBUFFER,ia.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,Ts),e.enableVertexAttribArray(Zn.positionAttributeLocation),e.vertexAttribPointer(Zn.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,Ji.tex),e.useProgram(Jn),e.uniform1i(Zn.positionTexLocation,0),e.uniform1f(Zn.deltaTimeUniformLocation,o),e.uniform2f(Zn.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(Zn.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.drawArrays(e.TRIANGLES,0,6);{const u=Ji;Ji=ia,ia=u}return Ji.tex};function oh(t){let e,i,n,o,u,f,a,h,v,y,P=t[2]?"Play":"Pause",K,re,Z,De=t[1]?"Normal Speed":"Slow Mo",Ue,Ie,je,st,qe=t[4].width*t[4].height+"",tt,ut,rt,At,ht,Qe,_t,at;return{c(){e=B("p"),i=be("Same principle with a shader to update positions and a shader to draw particles."),n=ne(),o=B("p"),u=be(`This time the update shader iterate through the texture to compute the distance of the particle
    to each other particle and if they are too close it pushes them appart.`),f=ne(),a=B("canvas"),h=ne(),v=B("div"),y=B("button"),K=be(P),re=ne(),Z=B("button"),Ue=be(De),Ie=ne(),je=B("span"),st=be("particles: "),tt=be(qe),ut=ne(),rt=B("label"),At=be("Smooth steps"),ht=ne(),Qe=B("input"),this.h()},l(oe){e=I(oe,"P",{});var Me=V(e);i=xe(Me,"Same principle with a shader to update positions and a shader to draw particles."),Me.forEach(w),n=ie(oe),o=I(oe,"P",{});var pt=V(o);u=xe(pt,`This time the update shader iterate through the texture to compute the distance of the particle
    to each other particle and if they are too close it pushes them appart.`),pt.forEach(w),f=ie(oe),a=I(oe,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(a).forEach(w),h=ie(oe),v=I(oe,"DIV",{});var yt=V(v);y=I(yt,"BUTTON",{});var Ot=V(y);K=xe(Ot,P),Ot.forEach(w),re=ie(yt),Z=I(yt,"BUTTON",{});var he=V(Z);Ue=xe(he,De),he.forEach(w),Ie=ie(yt),je=I(yt,"SPAN",{});var Ft=V(je);st=xe(Ft,"particles: "),tt=xe(Ft,qe),Ft.forEach(w),ut=ie(yt),rt=I(yt,"LABEL",{for:!0});var ft=V(rt);At=xe(ft,"Smooth steps"),ft.forEach(w),ht=ie(yt),Qe=I(yt,"INPUT",{type:!0,min:!0}),yt.forEach(w),this.h()},h(){M(a,"id","canvas"),Jr(a,"background-color","black"),M(a,"width",t[3].width),M(a,"height",t[3].height),M(rt,"for","steps"),M(Qe,"type","number"),M(Qe,"min",0)},m(oe,Me){Fe(oe,e,Me),p(e,i),Fe(oe,n,Me),Fe(oe,o,Me),p(o,u),Fe(oe,f,Me),Fe(oe,a,Me),Fe(oe,h,Me),Fe(oe,v,Me),p(v,y),p(y,K),p(v,re),p(v,Z),p(Z,Ue),p(v,Ie),p(v,je),p(je,st),p(je,tt),p(v,ut),p(v,rt),p(rt,At),p(v,ht),p(v,Qe),ke(Qe,t[0]),_t||(at=[ct(y,"click",t[5]),ct(Z,"click",t[6]),ct(Qe,"input",t[7])],_t=!0)},p(oe,[Me]){Me&4&&P!==(P=oe[2]?"Play":"Pause")&&Wr(K,P),Me&2&&De!==(De=oe[1]?"Normal Speed":"Slow Mo")&&Wr(Ue,De),Me&1&&ze(Qe.value)!==oe[0]&&ke(Qe,oe[0])},i:Pt,o:Pt,d(oe){oe&&w(e),oe&&w(n),oe&&w(o),oe&&w(f),oe&&w(a),oe&&w(h),oe&&w(v),_t=!1,Si(at)}}}function ah(t,e,i){const n={width:800,height:600},o={width:100,height:100};let u=1,f=!1,a=!0;function h(){const K=ni();kt(K.canvas);const{ids:re,positions:Z,colors:De}=Jm(o,{width:n.width,height:n.height});Km(K,{ids:re,colors:De,texDimensions:o});let Ue=nh(K,{positions:Z,texDimensions:o});function Ie(){if(kt(K.canvas),!a)for(let je=0;je<u;je++)Ue=ih({gl:K,texDimensions:o});return Zm({gl:K,positionTex:Ue,textureDimension:o,ids:re}),a?requestAnimationFrame(Ie):f?setTimeout(()=>requestAnimationFrame(Ie),1e3):requestAnimationFrame(Ie)}requestAnimationFrame(Ie)}Yr(()=>h());const v=()=>i(2,a=!a),y=()=>i(1,f=!f);function P(){u=ze(this.value),i(0,u)}return[u,f,a,n,o,v,y,P]}class sh extends Pr{constructor(e){super(),Cr(this,e,ah,oh,Ur,{})}}const fh=`attribute float id;
attribute float color;
uniform sampler2D positionTex;
uniform vec2 texDimensions;

uniform vec2 u_resolution;

varying float v_color;
varying float v_id;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / u_resolution;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = 5.0;
    v_color = color;
    v_id = id / (texDimensions.x * texDimensions.y);
}
`,lh=`precision mediump float;
varying float v_color;
varying float v_id;

void main() {
    if (v_id < 0.1) {
        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
        return;
    }
    if (v_id > 0.45 && v_id < 0.55) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        return;
    }
    if (v_id > 0.9) {
        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);
        return;
    }
    gl_FragColor = vec4(v_id, 1.0, v_id, 1.0);

    // if (v_color == 0.0) {
    //     gl_FragColor = vec4(1.0, 0.0, 0.0, 0.3);
    // } else if (v_color == 1.0){
    //     gl_FragColor = vec4(0.0, 1.0, 0.0, 0.3);
    // } else if (v_color == 2.0){
    //     gl_FragColor = vec4(0.0, 0.0, 1.0, 0.3);
    // } else if (v_color == 3.0){
    //     gl_FragColor = vec4(1.0, 1.0, 0.0, 0.3);
    // }
}
`;let ei,Ri,ys,Es;const ch=(t,e)=>{const{ids:i,colors:n}=e;Ri=dr(t,[fh,lh]),ei={idAttributeLocation:t.getAttribLocation(Ri,"id"),colorAttributeLocation:t.getAttribLocation(Ri,"color"),texDimensionsUniformLocation:t.getUniformLocation(Ri,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(Ri,"u_resolution")},ys=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,ys),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),Es=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Es),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)},uh=t=>{const{gl:e,positionTex:i,textureDimension:n,ids:o}=t,u=1,f=e.FLOAT,a=!1,h=0,v=0;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,ys),e.vertexAttribPointer(ei.idAttributeLocation,u,f,a,h,v),e.enableVertexAttribArray(ei.idAttributeLocation),e.bindBuffer(e.ARRAY_BUFFER,Es),e.vertexAttribPointer(ei.colorAttributeLocation,u,f,a,h,v),e.enableVertexAttribArray(ei.colorAttributeLocation),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.useProgram(Ri),e.uniform2f(ei.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.uniform2f(ei.texDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.POINTS,v,o.length)};function dh(t){const{texDimensions:e,screenDimensions:i,mode:n}=t,o=e.width*e.height,u=new Array(o).fill(0).map((h,v)=>v),f=new Array(o).fill(0).map(h=>Math.floor(Math.random()*4)),a=u.map(h=>{if(n==="disk"){const{x:y,y:P}=hh(i,20);return[y,P,0,0]}if(n==="square"){const{x:y,y:P}=mh(i,550);return[y,P,0,0]}if(n==="idDiagonal"){const{x:v,y}=ph(i,h,u.length);return[v,y,0,0]}if(n==="sinusoidal"){const{x:v,y}=$l(i,h,u.length,{x:1,y:5});return[v,y,0,0]}if(n==="circle"){const{x:v,y}=$l(i,h,u.length,{x:1,y:1});return[v,y,0,0]}}).flat();return{ids:u,positions:a,texDimensions:e,colors:f}}const mh=(t,e)=>{const i=Math.random()*e-e/2+t.width/2,n=Math.random()*e-e/2+t.height/2;return{x:i,y:n}},hh=(t,e)=>{const i=e*Math.random(),n=Math.random()*2*Math.PI,o=i*Math.cos(n)+t.width/2,u=i*Math.sin(n)+t.height/2;return{x:o,y:u}},ph=(t,e,i)=>{const n=As(e,0,i,0,t.width,!1),o=As(e,0,i,0,t.height,!1);return{x:n,y:o}},$l=(t,e,i,n)=>{const o=As(e,0,i,0,1,!0)*2*Math.PI,u=n.x,a=Math.cos(u*o)*200+t.width/2,h=n.y,y=Math.sin(h*o)*200+t.height/2;return{x:a,y}},As=function(t,e,i,n,o,u){const f=(t-e)/(i-e)*(o-n)+n;return u?n<o?kl(f,n,o):kl(f,o,n):f},kl=function(t,e,i){return Math.max(Math.min(t,i),e)},vh=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,_h=`precision highp float;

uniform sampler2D positionTex;
uniform vec2 texDimensions;
uniform vec2 u_resolution;
uniform float interactionRange;
uniform float deltaTime;
uniform float drag;

// We need to define the texture dimensions in constants
// because loops work only with constant values
const float texWidth = 100.0;
const float texHeight = 100.0;

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;

    vec2 direction = vec2(0.0, 0.0);

    // Iterate on the texture coordinates to compare with each other cell

    for (float y=0.0; y<1.0; y += 1.0 / texHeight) {
        for (float x=0.0; x<1.0; x += 1.0 / texWidth) {
            vec2 otherTextCoord = vec2(x, y);
            vec2 otherPosition = texture2D(positionTex, otherTextCoord).xy;

            vec2 diff = position - otherPosition;
            float mag = length(diff);
            if (mag < interactionRange) {
                float diffCoef = 1.0 / mag;
                if (mag < 1.0) {
                    diffCoef = 1.0;
                }
                direction = direction + (diff * diffCoef);
            }
        }
    }
    direction = (direction * deltaTime) / drag;

    vec2 newPosition = euclideanModulo(position + direction, u_resolution);

    gl_FragColor = vec4(newPosition, 0, 1);
}

`;let hn,pn,gs,Ko,us,zl,Xl,eo,oa;const bh=(t,e)=>{const{positions:i,texDimensions:n}=e;return pn=dr(t,[vh,_h]),hn={positionAttributeLocation:t.getAttribLocation(pn,"position"),positionTexLocation:t.getUniformLocation(pn,"positionTex"),interactionRangeUniformLocation:t.getUniformLocation(pn,"interactionRange"),dragUniformLocation:t.getUniformLocation(pn,"drag"),deltaTimeUniformLocation:t.getUniformLocation(pn,"deltaTime"),texDimensionsUniformLocation:t.getUniformLocation(pn,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(pn,"u_resolution")},gs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,gs),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),Ko=ir(t,new Float32Array(i),n.width,n.height),us=ir(t,null,n.width,n.height),zl=Sr(t,Ko),Xl=Sr(t,us),eo={fb:zl,tex:Ko},oa={fb:Xl,tex:us},Ko},xh=t=>{const{gl:e,texDimensions:i,interactionRange:n,drag:o,deltaTime:u}=t;e.bindFramebuffer(e.FRAMEBUFFER,oa.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,gs),e.enableVertexAttribArray(hn.positionAttributeLocation),e.vertexAttribPointer(hn.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,eo.tex),e.useProgram(pn),e.uniform1i(hn.positionTexLocation,0),e.uniform1f(hn.dragUniformLocation,o),e.uniform1f(hn.interactionRangeUniformLocation,n),e.uniform1f(hn.deltaTimeUniformLocation,u),e.uniform2f(hn.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(hn.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.drawArrays(e.TRIANGLES,0,6);{const f=eo;eo=oa,oa=f}return eo.tex};function Th(t){let e,i,n,o,u,f,a,h,v,y,P=t[2]?"Play":"Pause",K,re,Z,De=t[1]?"Normal Speed":"Slow Mo",Ue,Ie,je,st,qe=t[5].width*t[5].height+"",tt,ut,rt,At,ht,Qe,_t,at,oe,Me,pt,yt,Ot,he,Ft,ft,Et,Kt,Wt,nt,or,Dt,gt,ar,Yt,it,sr,Ut,Lt,fr;return{c(){e=B("p"),i=be("Same principle with a shader to update positions and a shader to draw particles."),n=ne(),o=B("p"),u=be(`This time the update shader iterate through the texture to compute the distance of the particle
    to each other particle and if they are too close it pushes them appart.`),f=ne(),a=B("canvas"),h=ne(),v=B("div"),y=B("button"),K=be(P),re=ne(),Z=B("button"),Ue=be(De),Ie=ne(),je=B("span"),st=be("particles: "),tt=be(qe),ut=ne(),rt=B("label"),At=be("Smooth steps"),ht=ne(),Qe=B("input"),_t=ne(),at=B("div"),oe=B("ul"),Me=B("li"),pt=B("label"),yt=be("Interaction Range"),Ot=ne(),he=B("input"),Ft=ne(),ft=B("li"),Et=B("label"),Kt=be("Drag"),Wt=ne(),nt=B("input"),or=ne(),Dt=B("li"),gt=B("label"),ar=be("Time step"),Yt=ne(),it=B("input"),sr=ne(),Ut=B("ul"),this.h()},l(He){e=I(He,"P",{});var We=V(e);i=xe(We,"Same principle with a shader to update positions and a shader to draw particles."),We.forEach(w),n=ie(He),o=I(He,"P",{});var pr=V(o);u=xe(pr,`This time the update shader iterate through the texture to compute the distance of the particle
    to each other particle and if they are too close it pushes them appart.`),pr.forEach(w),f=ie(He),a=I(He,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(a).forEach(w),h=ie(He),v=I(He,"DIV",{});var de=V(v);y=I(de,"BUTTON",{});var dt=V(y);K=xe(dt,P),dt.forEach(w),re=ie(de),Z=I(de,"BUTTON",{});var tr=V(Z);Ue=xe(tr,De),tr.forEach(w),Ie=ie(de),je=I(de,"SPAN",{});var mr=V(je);st=xe(mr,"particles: "),tt=xe(mr,qe),mr.forEach(w),ut=ie(de),rt=I(de,"LABEL",{for:!0});var mt=V(rt);At=xe(mt,"Smooth steps"),mt.forEach(w),ht=ie(de),Qe=I(de,"INPUT",{type:!0,min:!0}),de.forEach(w),_t=ie(He),at=I(He,"DIV",{});var l=V(at);oe=I(l,"UL",{});var Rt=V(oe);Me=I(Rt,"LI",{});var jt=V(Me);pt=I(jt,"LABEL",{for:!0});var vr=V(pt);yt=xe(vr,"Interaction Range"),vr.forEach(w),Ot=ie(jt),he=I(jt,"INPUT",{id:!0,type:!0,min:!0}),jt.forEach(w),Ft=ie(Rt),ft=I(Rt,"LI",{});var Bt=V(ft);Et=I(Bt,"LABEL",{for:!0});var St=V(Et);Kt=xe(St,"Drag"),St.forEach(w),Wt=ie(Bt),nt=I(Bt,"INPUT",{id:!0,type:!0,min:!0}),Bt.forEach(w),or=ie(Rt),Dt=I(Rt,"LI",{});var zt=V(Dt);gt=I(zt,"LABEL",{for:!0});var Xt=V(gt);ar=xe(Xt,"Time step"),Xt.forEach(w),Yt=ie(zt),it=I(zt,"INPUT",{id:!0,type:!0,min:!0}),zt.forEach(w),sr=ie(Rt),Ut=I(Rt,"UL",{}),V(Ut).forEach(w),Rt.forEach(w),l.forEach(w),this.h()},h(){M(a,"id","canvas"),Jr(a,"background-color","black"),M(a,"width",t[4].width),M(a,"height",t[4].height),M(rt,"for","steps"),M(Qe,"type","number"),M(Qe,"min",0),M(pt,"for","interactionRange"),M(he,"id","interactionRange"),M(he,"type","number"),M(he,"min",0),M(Et,"for","drag"),M(nt,"id","drag"),M(nt,"type","number"),M(nt,"min",0),M(gt,"for","deltaTime"),M(it,"id","deltaTime"),M(it,"type","number"),M(it,"min",0)},m(He,We){Fe(He,e,We),p(e,i),Fe(He,n,We),Fe(He,o,We),p(o,u),Fe(He,f,We),Fe(He,a,We),Fe(He,h,We),Fe(He,v,We),p(v,y),p(y,K),p(v,re),p(v,Z),p(Z,Ue),p(v,Ie),p(v,je),p(je,st),p(je,tt),p(v,ut),p(v,rt),p(rt,At),p(v,ht),p(v,Qe),ke(Qe,t[0]),Fe(He,_t,We),Fe(He,at,We),p(at,oe),p(oe,Me),p(Me,pt),p(pt,yt),p(Me,Ot),p(Me,he),ke(he,t[3].interactionRange),p(oe,Ft),p(oe,ft),p(ft,Et),p(Et,Kt),p(ft,Wt),p(ft,nt),ke(nt,t[3].drag),p(oe,or),p(oe,Dt),p(Dt,gt),p(gt,ar),p(Dt,Yt),p(Dt,it),ke(it,t[3].timeStep),p(oe,sr),p(oe,Ut),Lt||(fr=[ct(y,"click",t[6]),ct(Z,"click",t[7]),ct(Qe,"input",t[8]),ct(he,"input",t[9]),ct(nt,"input",t[10]),ct(it,"input",t[11])],Lt=!0)},p(He,[We]){We&4&&P!==(P=He[2]?"Play":"Pause")&&Wr(K,P),We&2&&De!==(De=He[1]?"Normal Speed":"Slow Mo")&&Wr(Ue,De),We&1&&ze(Qe.value)!==He[0]&&ke(Qe,He[0]),We&8&&ze(he.value)!==He[3].interactionRange&&ke(he,He[3].interactionRange),We&8&&ze(nt.value)!==He[3].drag&&ke(nt,He[3].drag),We&8&&ze(it.value)!==He[3].timeStep&&ke(it,He[3].timeStep)},i:Pt,o:Pt,d(He){He&&w(e),He&&w(n),He&&w(o),He&&w(f),He&&w(a),He&&w(h),He&&w(v),He&&w(_t),He&&w(at),Lt=!1,Si(fr)}}}function yh(t,e,i){const n={width:800,height:600},o={width:10,height:10};let u=1,f=!1,a=!0;const h={interactionRange:70,drag:1e3,timeStep:10};function v(){const Ue=ni();kt(Ue.canvas);const{ids:Ie,positions:je,colors:st}=dh({texDimensions:o,screenDimensions:{width:n.width,height:n.height},mode:"circle"});ch(Ue,{ids:Ie,colors:st,texDimensions:o});let qe=bh(Ue,{positions:je,texDimensions:o});function tt(){if(kt(Ue.canvas),!a)for(let ut=0;ut<u;ut++)qe=xh({gl:Ue,texDimensions:o,interactionRange:h.interactionRange,drag:h.drag,deltaTime:h.timeStep});return uh({gl:Ue,positionTex:qe,textureDimension:o,ids:Ie}),a?requestAnimationFrame(tt):f?setTimeout(()=>requestAnimationFrame(tt),1e3):requestAnimationFrame(tt)}requestAnimationFrame(tt)}Yr(()=>v());const y=()=>i(2,a=!a),P=()=>i(1,f=!f);function K(){u=ze(this.value),i(0,u)}function re(){h.interactionRange=ze(this.value),i(3,h)}function Z(){h.drag=ze(this.value),i(3,h)}function De(){h.timeStep=ze(this.value),i(3,h)}return[u,f,a,h,n,o,y,P,K,re,Z,De]}class Eh extends Pr{constructor(e){super(),Cr(this,e,yh,Th,Ur,{})}}const Ah=`attribute float id;
attribute float color;
uniform sampler2D positionTex;
uniform vec2 texDimensions;

uniform vec2 u_resolution;

varying float v_color;
varying float v_id;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / u_resolution;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = 5.0;
    v_color = color;
    v_id = id / (texDimensions.x * texDimensions.y);
}
`,gh=`precision mediump float;
varying float v_color;
varying float v_id;

void main() {
    // if (v_id < 0.1) {
    //     gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    //     return;
    // }
    // if (v_id > 0.45 && v_id < 0.55) {
    //     gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
    //     return;
    // }
    // if (v_id > 0.9) {
    //     gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);
    //     return;
    // }
    gl_FragColor = vec4(0.2, 0.2, v_id, 1.0);
    gl_FragColor = vec4(0.2, 0.2, 1.0, 1.0);

    // if (v_color == 0.0) {
    //     gl_FragColor = vec4(1.0, 0.0, 0.0, 0.3);
    // } else if (v_color == 1.0){
    //     gl_FragColor = vec4(0.0, 1.0, 0.0, 0.3);
    // } else if (v_color == 2.0){
    //     gl_FragColor = vec4(0.0, 0.0, 1.0, 0.3);
    // } else if (v_color == 3.0){
    //     gl_FragColor = vec4(1.0, 1.0, 0.0, 0.3);
    // }
}
`;let ti,Li,ws,Rs;const wh=(t,e)=>{const{ids:i,colors:n}=e;Li=dr(t,[Ah,gh]),ti={idAttributeLocation:t.getAttribLocation(Li,"id"),colorAttributeLocation:t.getAttribLocation(Li,"color"),texDimensionsUniformLocation:t.getUniformLocation(Li,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(Li,"u_resolution")},ws=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,ws),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),Rs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Rs),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)},Rh=t=>{const{gl:e,positionTex:i,textureDimension:n,ids:o}=t,u=1,f=e.FLOAT,a=!1,h=0,v=0;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,ws),e.vertexAttribPointer(ti.idAttributeLocation,u,f,a,h,v),e.enableVertexAttribArray(ti.idAttributeLocation),e.bindBuffer(e.ARRAY_BUFFER,Rs),e.vertexAttribPointer(ti.colorAttributeLocation,u,f,a,h,v),e.enableVertexAttribArray(ti.colorAttributeLocation),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.useProgram(Li),e.uniform2f(ti.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.uniform2f(ti.texDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.POINTS,v,o.length)};function Lh(t){const{texDimensions:e,screenDimensions:i,mode:n}=t,o=e.width*e.height,u=new Array(o).fill(0).map((h,v)=>v),f=new Array(o).fill(0).map(h=>Math.floor(Math.random()*4)),a=u.map(h=>{if(n==="random"){const{x:v,y}=Sh(i);return[v,y,0,0]}if(n==="disk"){const{x:y,y:P}=Dh(i,200);return[y,P,0,0]}if(n==="square"){const{x:y,y:P}=Fh(i,300);return[y,P,0,0]}if(n==="idDiagonal"){const{x:v,y}=Ph(i,h,u.length);return[v,y,0,0]}if(n==="sinusoidal"){const{x:v,y}=Vl(i,h,u.length,{x:1,y:5});return[v,y,0,0]}if(n==="circle"){const{x:v,y}=Vl(i,h,u.length,{x:1,y:1});return[v,y,0,0]}}).flat();return{ids:u,positions:a,texDimensions:e,colors:f}}const Sh=t=>{const e=20+Math.random()*(t.width-40),i=Math.random()*(t.height-150);return{x:e,y:i}},Fh=(t,e)=>{const i=Math.random()*e-e/2+t.width/2,n=Math.random()*e-e/2+t.height/2;return{x:i,y:n}},Dh=(t,e)=>{const i=e*Math.random(),n=Math.random()*2*Math.PI,o=i*Math.cos(n)+t.width/2,u=i*Math.sin(n)+t.height/2;return{x:o,y:u}},Ph=(t,e,i)=>{const n=Ls(e,0,i,0,t.width,!1),o=Ls(e,0,i,0,t.height,!1);return{x:n,y:o}},Vl=(t,e,i,n)=>{const o=Ls(e,0,i,0,1,!0)*2*Math.PI,u=n.x,a=Math.cos(u*o)*200+t.width/2,h=n.y,y=Math.sin(h*o)*200+t.height/2;return{x:a,y}},Ls=function(t,e,i,n,o,u){const f=(t-e)/(i-e)*(o-n)+n;return u?n<o?Hl(f,n,o):Hl(f,o,n):f},Hl=function(t,e,i){return Math.max(Math.min(t,i),e)},Ch=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,Uh=`precision highp float;

uniform sampler2D positionTex;
uniform vec2 texDimensions;
uniform vec2 u_resolution;
uniform float interactionRange;
uniform float deltaTime;
uniform float drag;

// We need to define the texture dimensions in constants
// because loops work only with constant values
const float texWidth = {{TEX_WIDTH}};
const float texHeight = {{TEX_HEIGHT}};

const vec2 gravity = vec2(0.0, 0.5);

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

float euclideanModulo(float n, float m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;

    vec2 direction = vec2(0.0, 0.0);

    // Iterate on the texture coordinates to compare with each other cell

    for (float y=0.0; y<1.0; y += 1.0 / texHeight) {
        for (float x=0.0; x<1.0; x += 1.0 / texWidth) {
            vec2 otherTextCoord = vec2(x, y);
            vec2 otherPosition = texture2D(positionTex, otherTextCoord).xy;

            vec2 diff = position - otherPosition;
            float mag = length(diff);
            if (mag < interactionRange) {
                float diffCoef = 1.0 / mag;
                if (mag < 1.0) {
                    diffCoef = 1.0;
                }
                direction = direction + (diff * diffCoef);
            }
        }
    }
    direction = (direction * deltaTime) / drag;
    direction = direction + gravity;

    vec2 newPosition = position + direction;
    newPosition.x = euclideanModulo(position.x + direction.x, u_resolution.x);

    if (newPosition.y >= u_resolution.y - 5.0) {
        newPosition.y = u_resolution.y - 7.0;
    }

    // if (newPosition.x >= u_resolution.x - 5.0) {
    //     newPosition.x = u_resolution.x - 7.0;
    // }

    // if (newPosition.x <  5.0) {
    //     newPosition.x = 7.0;
    // }

    gl_FragColor = vec4(newPosition, 0, 1);
}

`;let vn,_n,Ss,Zo,ds,Wl,Yl,to,aa;const Bh=(t,e)=>{const{positions:i,texDimensions:n}=e,o=Uh.replace("{{TEX_WIDTH}}",n.width.toFixed(1)).replace("{{TEX_HEIGHT}}",n.height.toFixed(1));return _n=dr(t,[Ch,o]),vn={positionAttributeLocation:t.getAttribLocation(_n,"position"),positionTexLocation:t.getUniformLocation(_n,"positionTex"),interactionRangeUniformLocation:t.getUniformLocation(_n,"interactionRange"),dragUniformLocation:t.getUniformLocation(_n,"drag"),deltaTimeUniformLocation:t.getUniformLocation(_n,"deltaTime"),texDimensionsUniformLocation:t.getUniformLocation(_n,"texDimensions"),resolutionUniformLocation:t.getUniformLocation(_n,"u_resolution")},Ss=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Ss),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),Zo=ir(t,new Float32Array(i),n.width,n.height),ds=ir(t,null,n.width,n.height),Wl=Sr(t,Zo),Yl=Sr(t,ds),to={fb:Wl,tex:Zo},aa={fb:Yl,tex:ds},Zo},Ih=t=>{const{gl:e,texDimensions:i,interactionRange:n,drag:o,deltaTime:u}=t;e.bindFramebuffer(e.FRAMEBUFFER,aa.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,Ss),e.enableVertexAttribArray(vn.positionAttributeLocation),e.vertexAttribPointer(vn.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,to.tex),e.useProgram(_n),e.uniform1i(vn.positionTexLocation,0),e.uniform1f(vn.dragUniformLocation,o),e.uniform1f(vn.interactionRangeUniformLocation,n),e.uniform1f(vn.deltaTimeUniformLocation,u),e.uniform2f(vn.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(vn.resolutionUniformLocation,e.canvas.width,e.canvas.height),e.drawArrays(e.TRIANGLES,0,6);{const f=to;to=aa,aa=f}return to.tex};function Oh(t){let e,i,n,o,u,f,a,h,v,y,P,K,re,Z=t[2]?"Play":"Pause",De,Ue,Ie,je=t[1]?"Normal Speed":"Slow Mo",st,qe,tt,ut,rt=t[5].width*t[5].height+"",At,ht,Qe,_t,at,oe,Me,pt,yt,Ot,he,Ft,ft,Et,Kt,Wt,nt,or,Dt,gt,ar,Yt,it,sr,Ut,Lt,fr,He,We,pr;return{c(){e=B("p"),i=be("This could be a kind of water simulation."),n=ne(),o=B("p"),u=be(`Here we added a gravity force to the shader which pulls cells apart and we can experiment with
    different values of the parameters.`),f=ne(),a=B("p"),h=be("For now creating vertical walls create a bug so we warp the horizontal coordinates."),v=ne(),y=B("canvas"),P=ne(),K=B("div"),re=B("button"),De=be(Z),Ue=ne(),Ie=B("button"),st=be(je),qe=ne(),tt=B("span"),ut=be("particles: "),At=be(rt),ht=ne(),Qe=B("label"),_t=be("Smooth steps"),at=ne(),oe=B("input"),Me=ne(),pt=B("div"),yt=B("ul"),Ot=B("li"),he=B("label"),Ft=be("Interaction Range"),ft=ne(),Et=B("input"),Kt=ne(),Wt=B("li"),nt=B("label"),or=be("Drag"),Dt=ne(),gt=B("input"),ar=ne(),Yt=B("li"),it=B("label"),sr=be("Time step"),Ut=ne(),Lt=B("input"),fr=ne(),He=B("ul"),this.h()},l(de){e=I(de,"P",{});var dt=V(e);i=xe(dt,"This could be a kind of water simulation."),dt.forEach(w),n=ie(de),o=I(de,"P",{});var tr=V(o);u=xe(tr,`Here we added a gravity force to the shader which pulls cells apart and we can experiment with
    different values of the parameters.`),tr.forEach(w),f=ie(de),a=I(de,"P",{});var mr=V(a);h=xe(mr,"For now creating vertical walls create a bug so we warp the horizontal coordinates."),mr.forEach(w),v=ie(de),y=I(de,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(y).forEach(w),P=ie(de),K=I(de,"DIV",{});var mt=V(K);re=I(mt,"BUTTON",{});var l=V(re);De=xe(l,Z),l.forEach(w),Ue=ie(mt),Ie=I(mt,"BUTTON",{});var Rt=V(Ie);st=xe(Rt,je),Rt.forEach(w),qe=ie(mt),tt=I(mt,"SPAN",{});var jt=V(tt);ut=xe(jt,"particles: "),At=xe(jt,rt),jt.forEach(w),ht=ie(mt),Qe=I(mt,"LABEL",{for:!0});var vr=V(Qe);_t=xe(vr,"Smooth steps"),vr.forEach(w),at=ie(mt),oe=I(mt,"INPUT",{type:!0,min:!0}),mt.forEach(w),Me=ie(de),pt=I(de,"DIV",{});var Bt=V(pt);yt=I(Bt,"UL",{});var St=V(yt);Ot=I(St,"LI",{});var zt=V(Ot);he=I(zt,"LABEL",{for:!0});var Xt=V(he);Ft=xe(Xt,"Interaction Range"),Xt.forEach(w),ft=ie(zt),Et=I(zt,"INPUT",{id:!0,type:!0,min:!0}),zt.forEach(w),Kt=ie(St),Wt=I(St,"LI",{});var gr=V(Wt);nt=I(gr,"LABEL",{for:!0});var Le=V(nt);or=xe(Le,"Drag"),Le.forEach(w),Dt=ie(gr),gt=I(gr,"INPUT",{id:!0,type:!0,min:!0}),gr.forEach(w),ar=ie(St),Yt=I(St,"LI",{});var Oe=V(Yt);it=I(Oe,"LABEL",{for:!0});var qt=V(it);sr=xe(qt,"Time step"),qt.forEach(w),Ut=ie(Oe),Lt=I(Oe,"INPUT",{id:!0,type:!0,min:!0}),Oe.forEach(w),fr=ie(St),He=I(St,"UL",{}),V(He).forEach(w),St.forEach(w),Bt.forEach(w),this.h()},h(){M(y,"id","canvas"),Jr(y,"background-color","black"),M(y,"width",t[4].width),M(y,"height",t[4].height),M(Qe,"for","steps"),M(oe,"type","number"),M(oe,"min",0),M(he,"for","interactionRange"),M(Et,"id","interactionRange"),M(Et,"type","number"),M(Et,"min",0),M(nt,"for","drag"),M(gt,"id","drag"),M(gt,"type","number"),M(gt,"min",0),M(it,"for","deltaTime"),M(Lt,"id","deltaTime"),M(Lt,"type","number"),M(Lt,"min",0)},m(de,dt){Fe(de,e,dt),p(e,i),Fe(de,n,dt),Fe(de,o,dt),p(o,u),Fe(de,f,dt),Fe(de,a,dt),p(a,h),Fe(de,v,dt),Fe(de,y,dt),Fe(de,P,dt),Fe(de,K,dt),p(K,re),p(re,De),p(K,Ue),p(K,Ie),p(Ie,st),p(K,qe),p(K,tt),p(tt,ut),p(tt,At),p(K,ht),p(K,Qe),p(Qe,_t),p(K,at),p(K,oe),ke(oe,t[0]),Fe(de,Me,dt),Fe(de,pt,dt),p(pt,yt),p(yt,Ot),p(Ot,he),p(he,Ft),p(Ot,ft),p(Ot,Et),ke(Et,t[3].interactionRange),p(yt,Kt),p(yt,Wt),p(Wt,nt),p(nt,or),p(Wt,Dt),p(Wt,gt),ke(gt,t[3].drag),p(yt,ar),p(yt,Yt),p(Yt,it),p(it,sr),p(Yt,Ut),p(Yt,Lt),ke(Lt,t[3].timeStep),p(yt,fr),p(yt,He),We||(pr=[ct(re,"click",t[6]),ct(Ie,"click",t[7]),ct(oe,"input",t[8]),ct(Et,"input",t[9]),ct(gt,"input",t[10]),ct(Lt,"input",t[11])],We=!0)},p(de,[dt]){dt&4&&Z!==(Z=de[2]?"Play":"Pause")&&Wr(De,Z),dt&2&&je!==(je=de[1]?"Normal Speed":"Slow Mo")&&Wr(st,je),dt&1&&ze(oe.value)!==de[0]&&ke(oe,de[0]),dt&8&&ze(Et.value)!==de[3].interactionRange&&ke(Et,de[3].interactionRange),dt&8&&ze(gt.value)!==de[3].drag&&ke(gt,de[3].drag),dt&8&&ze(Lt.value)!==de[3].timeStep&&ke(Lt,de[3].timeStep)},i:Pt,o:Pt,d(de){de&&w(e),de&&w(n),de&&w(o),de&&w(f),de&&w(a),de&&w(v),de&&w(y),de&&w(P),de&&w(K),de&&w(Me),de&&w(pt),We=!1,Si(pr)}}}function Nh(t,e,i){const n={width:800,height:600},o={width:500,height:20};let u=1,f=!1,a=!0;const h={interactionRange:6,drag:5,timeStep:10};function v(){const Ue=ni();kt(Ue.canvas);const{ids:Ie,positions:je,colors:st}=Lh({texDimensions:o,screenDimensions:{width:n.width,height:n.height},mode:"disk"});wh(Ue,{ids:Ie,colors:st,texDimensions:o});let qe=Bh(Ue,{positions:je,texDimensions:o});function tt(){if(kt(Ue.canvas),!a)for(let ut=0;ut<u;ut++)qe=Ih({gl:Ue,texDimensions:o,interactionRange:h.interactionRange,drag:h.drag,deltaTime:h.timeStep});return Rh({gl:Ue,positionTex:qe,textureDimension:o,ids:Ie}),a?requestAnimationFrame(tt):f?setTimeout(()=>requestAnimationFrame(tt),1e3):requestAnimationFrame(tt)}requestAnimationFrame(tt)}Yr(()=>v());const y=()=>i(2,a=!a),P=()=>i(1,f=!f);function K(){u=ze(this.value),i(0,u)}function re(){h.interactionRange=ze(this.value),i(3,h)}function Z(){h.drag=ze(this.value),i(3,h)}function De(){h.timeStep=ze(this.value),i(3,h)}return[u,f,a,h,n,o,y,P,K,re,Z,De]}class Gh extends Pr{constructor(e){super(),Cr(this,e,Nh,Oh,Ur,{})}}const Mh=`attribute float id;
attribute float color;
uniform sampler2D positionTex;
uniform vec2 texDimensions;

uniform vec2 worldDimensions;
uniform float size;


varying float v_color;
varying float v_id;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / worldDimensions;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = size;
    v_color = color;
    v_id = id / (texDimensions.x * texDimensions.y);
}
`,$h=`precision mediump float;
varying float v_color;
varying float v_id;

const float u_radius = 0.5; // The radius of the particles

void main() {
    float dist = length(gl_PointCoord - vec2(0.5, 0.5)); // Calculate the distance to the center
    if (dist > u_radius) { // If outside the circle, discard the fragment
        discard;
    }
    gl_FragColor = vec4(0.2, 0.2, 1.0, 0.4);
}
`;let Dn,ri,Fs,Ds;const kh=(t,e)=>{const{ids:i,colors:n}=e;ri=dr(t,[Mh,$h]),Dn={idAttributeLocation:t.getAttribLocation(ri,"id"),colorAttributeLocation:t.getAttribLocation(ri,"color"),sizeUniformLocation:t.getUniformLocation(ri,"size"),texDimensionsUniformLocation:t.getUniformLocation(ri,"texDimensions"),worldDimensionsUniformLocation:t.getUniformLocation(ri,"worldDimensions")},Fs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Fs),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),Ds=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Ds),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)},zh=t=>{const{gl:e,positionTex:i,texDimensions:n,worldDimensions:o,particlesSize:u,ids:f}=t,a=1,h=e.FLOAT,v=!1,y=0,P=0;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,Fs),e.vertexAttribPointer(Dn.idAttributeLocation,a,h,v,y,P),e.enableVertexAttribArray(Dn.idAttributeLocation),e.bindBuffer(e.ARRAY_BUFFER,Ds),e.vertexAttribPointer(Dn.colorAttributeLocation,a,h,v,y,P),e.enableVertexAttribArray(Dn.colorAttributeLocation),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.useProgram(ri),e.uniform1f(Dn.sizeUniformLocation,u),e.uniform2f(Dn.worldDimensionsUniformLocation,o.width,o.height),e.uniform2f(Dn.texDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.POINTS,P,f.length)};function Xh(t){const{texDimensions:e,worldDimensions:i,mode:n}=t,o=e.width*e.height,u=new Array(o).fill(0).map((h,v)=>v),f=new Array(o).fill(0).map(h=>Math.floor(Math.random()*4)),a=u.map(h=>{if(n==="random"){const{x:v,y}=Vh(i);return[v,y,0,0]}if(n==="disk"){const{x:y,y:P}=Wh(i,200);return[y,P,0,0]}if(n==="square"){const{x:y,y:P}=Hh(i,300);return[y,P,0,0]}if(n==="idDiagonal"){const{x:v,y}=Yh(i,h,u.length);return[v,y,0,0]}if(n==="sinusoidal"){const{x:v,y}=jl(i,h,u.length,{x:1,y:5});return[v,y,0,0]}if(n==="circle"){const{x:v,y}=jl(i,h,u.length,{x:1,y:1});return[v,y,0,0]}}).flat();return{ids:u,positions:a,texDimensions:e,colors:f}}const Vh=t=>{const e=20+Math.random()*(t.width-40),i=Math.random()*(t.height-150);return{x:e,y:i}},Hh=(t,e)=>{const i=Math.random()*e-e/2+t.width/2,n=Math.random()*e-e/2+t.height/2;return{x:i,y:n}},Wh=(t,e)=>{const i=e*Math.random(),n=Math.random()*2*Math.PI,o=i*Math.cos(n)+t.width/2,u=i*Math.sin(n)+t.height/2;return{x:o,y:u}},Yh=(t,e,i)=>{const n=Ps(e,0,i,0,t.width,!1),o=Ps(e,0,i,0,t.height,!1);return{x:n,y:o}},jl=(t,e,i,n)=>{const o=Ps(e,0,i,0,1,!0)*2*Math.PI,u=n.x,a=Math.cos(u*o)*200+t.width/2,h=n.y,y=Math.sin(h*o)*200+t.height/2;return{x:a,y}},Ps=function(t,e,i,n,o,u){const f=(t-e)/(i-e)*(o-n)+n;return u?n<o?ql(f,n,o):ql(f,o,n):f},ql=function(t,e,i){return Math.max(Math.min(t,i),e)},jh=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,qh=`precision highp float;

uniform sampler2D positionTex;
uniform vec2 texDimensions;
uniform vec2 worldDimensions;
uniform float interactionRange;
uniform float deltaTime;
uniform float drag;

// We need to define the texture dimensions in constants
// because loops work only with constant values
const float texWidth = {{TEX_WIDTH}};
const float texHeight = {{TEX_HEIGHT}};

const vec2 gravity = vec2(0.0, 0.5);

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

float euclideanModulo(float n, float m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;

    vec2 direction = vec2(0.0, 0.0);

    // Iterate on the texture coordinates to compare with each other cell

    for (float y=0.0; y<1.0; y += 1.0 / texHeight) {
        for (float x=0.0; x<1.0; x += 1.0 / texWidth) {
            vec2 otherTextCoord = vec2(x, y);
            vec2 otherPosition = texture2D(positionTex, otherTextCoord).xy;

            vec2 diff = position - otherPosition;
            float mag = length(diff);
            if (mag < interactionRange) {
                float diffCoef = 1.0 / mag;
                if (mag < 1.0) {
                    diffCoef = 1.0;
                }
                direction = direction + (diff * diffCoef);
            }
        }
    }
    direction = (direction * deltaTime) / drag;
    direction = direction + gravity;

    vec2 newPosition = position + direction;
    newPosition.x = euclideanModulo(position.x + direction.x, worldDimensions.x);

    if (newPosition.y >= worldDimensions.y - 5.0) {
        newPosition.y = worldDimensions.y - 7.0;
    }

    // if (newPosition.x >= worldDimensions.x - 5.0) {
    //     newPosition.x = worldDimensions.x - 7.0;
    // }

    // if (newPosition.x <  5.0) {
    //     newPosition.x = 7.0;
    // }

    gl_FragColor = vec4(newPosition, 0, 1);
}

`;let bn,xn,Cs,Jo,ms,Ql,Kl,ro,sa;const Qh=(t,e)=>{const{positions:i,texDimensions:n}=e,o=qh.replace("{{TEX_WIDTH}}",n.width.toFixed(1)).replace("{{TEX_HEIGHT}}",n.height.toFixed(1));return xn=dr(t,[jh,o]),bn={positionAttributeLocation:t.getAttribLocation(xn,"position"),positionTexLocation:t.getUniformLocation(xn,"positionTex"),interactionRangeUniformLocation:t.getUniformLocation(xn,"interactionRange"),dragUniformLocation:t.getUniformLocation(xn,"drag"),deltaTimeUniformLocation:t.getUniformLocation(xn,"deltaTime"),texDimensionsUniformLocation:t.getUniformLocation(xn,"texDimensions"),worldDimensionsUniformLocation:t.getUniformLocation(xn,"worldDimensions")},Cs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Cs),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),Jo=ir(t,new Float32Array(i),n.width,n.height),ms=ir(t,null,n.width,n.height),Ql=Sr(t,Jo),Kl=Sr(t,ms),ro={fb:Ql,tex:Jo},sa={fb:Kl,tex:ms},Jo},Kh=t=>{const{gl:e,texDimensions:i,worldDimensions:n,interactionRange:o,drag:u,deltaTime:f}=t;e.bindFramebuffer(e.FRAMEBUFFER,sa.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,Cs),e.enableVertexAttribArray(bn.positionAttributeLocation),e.vertexAttribPointer(bn.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,ro.tex),e.useProgram(xn),e.uniform1i(bn.positionTexLocation,0),e.uniform1f(bn.dragUniformLocation,u),e.uniform1f(bn.interactionRangeUniformLocation,o),e.uniform1f(bn.deltaTimeUniformLocation,f),e.uniform2f(bn.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(bn.worldDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.TRIANGLES,0,6);{const a=ro;ro=sa,sa=a}return ro.tex};function Zh(t){let e,i,n,o,u,f,a,h=t[3]?"Play":"Pause",v,y,P,K=t[2]?"Normal Speed":"Slow Mo",re,Z,De,Ue,Ie=t[6].width*t[6].height+"",je,st,qe,tt,ut,rt,At,ht,Qe,_t,at,oe,Me,pt,yt,Ot,he,Ft,ft,Et,Kt,Wt,nt,or,Dt,gt,ar,Yt,it,sr,Ut,Lt,fr,He,We,pr,de,dt,tr,mr,mt,l,Rt,jt,vr,Bt,St,zt,Xt,gr;return{c(){e=B("p"),i=be(`Add parameters to the simulation. The dimensions of the world in which the particles evolve can
    be changed as well as their size. With larger particles size the effect looks more like a fluid.`),n=ne(),o=B("canvas"),u=ne(),f=B("div"),a=B("button"),v=be(h),y=ne(),P=B("button"),re=be(K),Z=ne(),De=B("span"),Ue=be("particles: "),je=be(Ie),st=ne(),qe=B("label"),tt=be("Smooth steps"),ut=ne(),rt=B("input"),At=ne(),ht=B("button"),Qe=be("Reset"),_t=ne(),at=B("div"),oe=B("ul"),Me=B("li"),pt=B("label"),yt=be("Interaction Range"),Ot=ne(),he=B("input"),Ft=ne(),ft=B("li"),Et=B("label"),Kt=be("Drag"),Wt=ne(),nt=B("input"),or=ne(),Dt=B("li"),gt=B("label"),ar=be("Time step"),Yt=ne(),it=B("input"),sr=ne(),Ut=B("li"),Lt=B("label"),fr=be("Particles size"),He=ne(),We=B("input"),pr=ne(),de=B("li"),dt=B("label"),tr=be("World: width"),mr=ne(),mt=B("input"),l=ne(),Rt=B("label"),jt=be("height"),vr=ne(),Bt=B("input"),St=ne(),zt=B("ul"),this.h()},l(Le){e=I(Le,"P",{});var Oe=V(e);i=xe(Oe,`Add parameters to the simulation. The dimensions of the world in which the particles evolve can
    be changed as well as their size. With larger particles size the effect looks more like a fluid.`),Oe.forEach(w),n=ie(Le),o=I(Le,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(o).forEach(w),u=ie(Le),f=I(Le,"DIV",{});var qt=V(f);a=I(qt,"BUTTON",{});var Mt=V(a);v=xe(Mt,h),Mt.forEach(w),y=ie(qt),P=I(qt,"BUTTON",{});var wr=V(P);re=xe(wr,K),wr.forEach(w),Z=ie(qt),De=I(qt,"SPAN",{});var Nr=V(De);Ue=xe(Nr,"particles: "),je=xe(Nr,Ie),Nr.forEach(w),st=ie(qt),qe=I(qt,"LABEL",{for:!0});var jr=V(qe);tt=xe(jr,"Smooth steps"),jr.forEach(w),ut=ie(qt),rt=I(qt,"INPUT",{type:!0,min:!0}),At=ie(qt),ht=I(qt,"BUTTON",{});var Rr=V(ht);Qe=xe(Rr,"Reset"),Rr.forEach(w),qt.forEach(w),_t=ie(Le),at=I(Le,"DIV",{});var qr=V(at);oe=I(qr,"UL",{});var Nt=V(oe);Me=I(Nt,"LI",{});var Fr=V(Me);pt=I(Fr,"LABEL",{for:!0});var Qr=V(pt);yt=xe(Qr,"Interaction Range"),Qr.forEach(w),Ot=ie(Fr),he=I(Fr,"INPUT",{id:!0,type:!0,min:!0}),Fr.forEach(w),Ft=ie(Nt),ft=I(Nt,"LI",{});var Br=V(ft);Et=I(Br,"LABEL",{for:!0});var Gr=V(Et);Kt=xe(Gr,"Drag"),Gr.forEach(w),Wt=ie(Br),nt=I(Br,"INPUT",{id:!0,type:!0,min:!0}),Br.forEach(w),or=ie(Nt),Dt=I(Nt,"LI",{});var Ke=V(Dt);gt=I(Ke,"LABEL",{for:!0});var ot=V(gt);ar=xe(ot,"Time step"),ot.forEach(w),Yt=ie(Ke),it=I(Ke,"INPUT",{id:!0,type:!0,min:!0}),Ke.forEach(w),sr=ie(Nt),Ut=I(Nt,"LI",{});var br=V(Ut);Lt=I(br,"LABEL",{for:!0});var en=V(Lt);fr=xe(en,"Particles size"),en.forEach(w),He=ie(br),We=I(br,"INPUT",{id:!0,type:!0,min:!0}),br.forEach(w),pr=ie(Nt),de=I(Nt,"LI",{});var Zt=V(de);dt=I(Zt,"LABEL",{for:!0});var tn=V(dt);tr=xe(tn,"World: width"),tn.forEach(w),mr=ie(Zt),mt=I(Zt,"INPUT",{id:!0,type:!0,min:!0}),l=ie(Zt),Rt=I(Zt,"LABEL",{for:!0});var rn=V(Rt);jt=xe(rn,"height"),rn.forEach(w),vr=ie(Zt),Bt=I(Zt,"INPUT",{id:!0,type:!0,min:!0}),Zt.forEach(w),St=ie(Nt),zt=I(Nt,"UL",{}),V(zt).forEach(w),Nt.forEach(w),qr.forEach(w),this.h()},h(){M(o,"id","canvas"),Jr(o,"background-color","black"),M(o,"width",t[5].width),M(o,"height",t[5].height),M(qe,"for","steps"),M(rt,"type","number"),M(rt,"min",0),M(pt,"for","interactionRange"),M(he,"id","interactionRange"),M(he,"type","number"),M(he,"min",0),M(Et,"for","drag"),M(nt,"id","drag"),M(nt,"type","number"),M(nt,"min",0),M(gt,"for","deltaTime"),M(it,"id","deltaTime"),M(it,"type","number"),M(it,"min",0),M(Lt,"for","particlesSize"),M(We,"id","particlesSize"),M(We,"type","number"),M(We,"min",0),M(dt,"for","worldWidth"),M(mt,"id","worldWidth"),M(mt,"type","number"),M(mt,"min",0),M(Rt,"for","worldHeight"),M(Bt,"id","worldHeight"),M(Bt,"type","number"),M(Bt,"min",0)},m(Le,Oe){Fe(Le,e,Oe),p(e,i),Fe(Le,n,Oe),Fe(Le,o,Oe),Fe(Le,u,Oe),Fe(Le,f,Oe),p(f,a),p(a,v),p(f,y),p(f,P),p(P,re),p(f,Z),p(f,De),p(De,Ue),p(De,je),p(f,st),p(f,qe),p(qe,tt),p(f,ut),p(f,rt),ke(rt,t[1]),p(f,At),p(f,ht),p(ht,Qe),Fe(Le,_t,Oe),Fe(Le,at,Oe),p(at,oe),p(oe,Me),p(Me,pt),p(pt,yt),p(Me,Ot),p(Me,he),ke(he,t[4].interactionRange),p(oe,Ft),p(oe,ft),p(ft,Et),p(Et,Kt),p(ft,Wt),p(ft,nt),ke(nt,t[4].drag),p(oe,or),p(oe,Dt),p(Dt,gt),p(gt,ar),p(Dt,Yt),p(Dt,it),ke(it,t[4].timeStep),p(oe,sr),p(oe,Ut),p(Ut,Lt),p(Lt,fr),p(Ut,He),p(Ut,We),ke(We,t[4].particlesSize),p(oe,pr),p(oe,de),p(de,dt),p(dt,tr),p(de,mr),p(de,mt),ke(mt,t[0].width),p(de,l),p(de,Rt),p(Rt,jt),p(de,vr),p(de,Bt),ke(Bt,t[0].height),p(oe,St),p(oe,zt),Xt||(gr=[ct(a,"click",t[8]),ct(P,"click",t[9]),ct(rt,"input",t[10]),ct(ht,"click",t[11]),ct(he,"input",t[12]),ct(nt,"input",t[13]),ct(it,"input",t[14]),ct(We,"input",t[15]),ct(mt,"input",t[16]),ct(Bt,"input",t[17])],Xt=!0)},p(Le,[Oe]){Oe&8&&h!==(h=Le[3]?"Play":"Pause")&&Wr(v,h),Oe&4&&K!==(K=Le[2]?"Normal Speed":"Slow Mo")&&Wr(re,K),Oe&2&&ze(rt.value)!==Le[1]&&ke(rt,Le[1]),Oe&16&&ze(he.value)!==Le[4].interactionRange&&ke(he,Le[4].interactionRange),Oe&16&&ze(nt.value)!==Le[4].drag&&ke(nt,Le[4].drag),Oe&16&&ze(it.value)!==Le[4].timeStep&&ke(it,Le[4].timeStep),Oe&16&&ze(We.value)!==Le[4].particlesSize&&ke(We,Le[4].particlesSize),Oe&1&&ze(mt.value)!==Le[0].width&&ke(mt,Le[0].width),Oe&1&&ze(Bt.value)!==Le[0].height&&ke(Bt,Le[0].height)},i:Pt,o:Pt,d(Le){Le&&w(e),Le&&w(n),Le&&w(o),Le&&w(u),Le&&w(f),Le&&w(_t),Le&&w(at),Xt=!1,Si(gr)}}}function Jh(t,e,i){const n={width:800,height:600},o={width:1200,height:500},u={width:200,height:20};let f=10,a=!1,h=!0;const v={interactionRange:6,drag:5,timeStep:10,particlesSize:20};let y,P;function K(){cancelAnimationFrame(P),y=ni(),kt(y.canvas);const{ids:rt,positions:At,colors:ht}=Xh({texDimensions:u,worldDimensions:o,mode:"disk"});kh(y,{ids:rt,colors:ht,texDimensions:u});let Qe=Qh(y,{positions:At,texDimensions:u});function _t(){if(kt(y.canvas),!h)for(let at=0;at<f;at++)Qe=Kh({gl:y,texDimensions:u,worldDimensions:o,interactionRange:v.interactionRange,drag:v.drag,deltaTime:v.timeStep});return zh({gl:y,positionTex:Qe,texDimensions:u,worldDimensions:o,particlesSize:v.particlesSize,ids:rt}),a?setTimeout(()=>P=requestAnimationFrame(_t),1e3):P=requestAnimationFrame(_t)}P=requestAnimationFrame(_t)}Yr(()=>K());const re=()=>i(3,h=!h),Z=()=>i(2,a=!a);function De(){f=ze(this.value),i(1,f)}const Ue=()=>K();function Ie(){v.interactionRange=ze(this.value),i(4,v)}function je(){v.drag=ze(this.value),i(4,v)}function st(){v.timeStep=ze(this.value),i(4,v)}function qe(){v.particlesSize=ze(this.value),i(4,v)}function tt(){o.width=ze(this.value),i(0,o)}function ut(){o.height=ze(this.value),i(0,o)}return[o,f,a,h,v,n,u,K,re,Z,De,Ue,Ie,je,st,qe,tt,ut]}class ep extends Pr{constructor(e){super(),Cr(this,e,Jh,Zh,Ur,{})}}const tp=`attribute float id;

uniform float size;
uniform vec2 texDimensions;
uniform vec2 worldDimensions;

uniform sampler2D positionTex;
uniform sampler2D colorTex;

varying float v_color;
varying float v_id;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the color from the texture
    float colorFromTex = getValueFrom2DTextureAs1DArray(colorTex, texDimensions, id).x;

    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / worldDimensions;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = size;
    v_color = colorFromTex;
    v_id = id / (texDimensions.x * texDimensions.y);
}
`,rp=`precision mediump float;
varying float v_color;
varying float v_id;

const float u_radius = 0.5; // The radius of the particles

void main() {
    float dist = length(gl_PointCoord - vec2(0.5, 0.5)); // Calculate the distance to the center
    if (dist > u_radius) { // If outside the circle, discard the fragment
        discard;
    }

    // if (v_color == 0.0) {
    //     gl_FragColor = vec4(1.0, 0.3, 0.6, 1.0);
    // } else {
    //     gl_FragColor = vec4(0.6, 0.3, 1.0, 1.0);
    // }

    if (v_color == 0.0) {
        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    } else if (v_color == 1.0) {
        gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
    } else if (v_color == 2.0) {
        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);
    } else {
        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
    }

}
`;let Pn,Cn,Us,bc;const np=(t,e)=>{const{ids:i,colors:n,texDimensions:o}=e;Cn=dr(t,[tp,rp]),Pn={idAttributeLocation:t.getAttribLocation(Cn,"id"),sizeUniformLocation:t.getUniformLocation(Cn,"size"),texDimensionsUniformLocation:t.getUniformLocation(Cn,"texDimensions"),worldDimensionsUniformLocation:t.getUniformLocation(Cn,"worldDimensions"),positionTexUniformLocation:t.getUniformLocation(Cn,"positionTex"),colorTexUniformLocation:t.getUniformLocation(Cn,"colorTex")},Us=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Us),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW);const u=n.map(f=>[f,0,0,0]).flat();bc=ir(t,new Float32Array(u),o.width,o.height)},ip=t=>{const{gl:e,positionTex:i,texDimensions:n,worldDimensions:o,particlesSize:u,ids:f}=t,a=1,h=e.FLOAT,v=!1,y=0,P=0;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,Us),e.vertexAttribPointer(Pn.idAttributeLocation,a,h,v,y,P),e.enableVertexAttribArray(Pn.idAttributeLocation),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,bc),e.useProgram(Cn),e.uniform1f(Pn.sizeUniformLocation,u),e.uniform2f(Pn.worldDimensionsUniformLocation,o.width,o.height),e.uniform2f(Pn.texDimensionsUniformLocation,n.width,n.height),e.uniform1i(Pn.positionTexUniformLocation,0),e.uniform1i(Pn.colorTexUniformLocation,1),e.drawArrays(e.POINTS,P,f.length)};function op(t,e,i){function n(){const u=t.getElementById(e);u&&(t.fullscreenElement&&t.exitFullscreen&&t.exitFullscreen(),u.width=i.width,u.height=i.height)}function o(){const u=t.getElementById(e);u&&(t.fullscreenElement||u.requestFullscreen())}return t.addEventListener("fullscreenchange",()=>{t.fullscreenElement===null&&n()}),{enableFullscreen:o,disableFullscreen:n}}function ap(t){const{texDimensions:e,worldDimensions:i,mode:n}=t,o=e.width*e.height,u=new Array(o).fill(0).map((h,v)=>v),f=new Array(o).fill(0).map(h=>Math.floor(Math.random()*3)),a=u.map(h=>{if(n==="random"){const{x:v,y}=sp(i);return[v,y,0,0]}if(n==="disk"){const{x:y,y:P}=lp(i,200);return[y,P,0,0]}if(n==="square"){const{x:y,y:P}=fp(i,300);return[y,P,0,0]}if(n==="idDiagonal"){const{x:v,y}=cp(i,h,u.length);return[v,y,0,0]}if(n==="sinusoidal"){const{x:v,y}=Zl(i,h,u.length,{x:1,y:5});return[v,y,0,0]}if(n==="circle"){const{x:v,y}=Zl(i,h,u.length,{x:1,y:1});return[v,y,0,0]}}).flat();return{ids:u,positions:a,texDimensions:e,colors:f}}const sp=t=>{const e=20+Math.random()*(t.width-40),i=Math.random()*(t.height-150);return{x:e,y:i}},fp=(t,e)=>{const i=Math.random()*e-e/2+t.width/2,n=Math.random()*e-e/2+t.height/2;return{x:i,y:n}},lp=(t,e)=>{const i=e*Math.random(),n=Math.random()*2*Math.PI,o=i*Math.cos(n)+t.width/2,u=i*Math.sin(n)+t.height/2;return{x:o,y:u}},cp=(t,e,i)=>{const n=Bs(e,0,i,0,t.width,!1),o=Bs(e,0,i,0,t.height,!1);return{x:n,y:o}},Zl=(t,e,i,n)=>{const o=Bs(e,0,i,0,1,!0)*2*Math.PI,u=n.x,a=Math.cos(u*o)*200+t.width/2,h=n.y,y=Math.sin(h*o)*200+t.height/2;return{x:a,y}},Bs=function(t,e,i,n,o,u){const f=(t-e)/(i-e)*(o-n)+n;return u?n<o?Jl(f,n,o):Jl(f,o,n):f},Jl=function(t,e,i){return Math.max(Math.min(t,i),e)},up=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,dp=`precision highp float;

uniform float interactionRange;
uniform float drag;
uniform float deltaTime;
uniform vec2 texDimensions;
uniform vec2 worldDimensions;

uniform sampler2D positionTex;
uniform sampler2D colorTex;

// We need to define the texture dimensions in constants
// because loops work only with constant values
const float texWidth = {{TEX_WIDTH}};
const float texHeight = {{TEX_HEIGHT}};

const vec2 gravity = vec2(0.0, 0.5);

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

float euclideanModulo(float n, float m) {
    return mod(mod(n, m) + m, m);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;
    float color = texture2D(colorTex, texcoord).x;

    vec2 direction = vec2(0.0, 0.0);

    // Iterate on the texture coordinates to compare with each other cell

    for (float y=0.0; y<1.0; y += 1.0 / texHeight) {
        for (float x=0.0; x<1.0; x += 1.0 / texWidth) {
            vec2 otherTextCoord = vec2(x, y);
            vec2 otherPosition = texture2D(positionTex, otherTextCoord).xy;

            vec2 diff = position - otherPosition;
            float mag = length(diff);
            if (mag < interactionRange) {
                float diffCoef = 1.0 / mag;
                if (mag < 1.0) {
                    diffCoef = 1.0;
                }
                direction = direction + (diff * diffCoef);
            }
        }
    }
    direction = (direction * deltaTime * color) / drag;
    direction = direction + gravity;

    vec2 newPosition = position + direction;
    newPosition.x = euclideanModulo(position.x + direction.x, worldDimensions.x);

    if (newPosition.y >= worldDimensions.y - 5.0) {
        newPosition.y = worldDimensions.y - 7.0;
    }

    // if (newPosition.x >= worldDimensions.x - 5.0) {
    //     newPosition.x = worldDimensions.x - 7.0;
    // }

    // if (newPosition.x <  5.0) {
    //     newPosition.x = 7.0;
    // }

    gl_FragColor = vec4(newPosition, 0, 1);
}

`;let ln,cn,Is,ea,hs,ec,tc,no,fa,xc;const mp=(t,e)=>{const{positions:i,colors:n,texDimensions:o}=e,u=dp.replace("{{TEX_WIDTH}}",o.width.toFixed(1)).replace("{{TEX_HEIGHT}}",o.height.toFixed(1));cn=dr(t,[up,u]),ln={positionAttributeLocation:t.getAttribLocation(cn,"position"),interactionRangeUniformLocation:t.getUniformLocation(cn,"interactionRange"),dragUniformLocation:t.getUniformLocation(cn,"drag"),deltaTimeUniformLocation:t.getUniformLocation(cn,"deltaTime"),texDimensionsUniformLocation:t.getUniformLocation(cn,"texDimensions"),worldDimensionsUniformLocation:t.getUniformLocation(cn,"worldDimensions"),positionTexUniformLocation:t.getUniformLocation(cn,"positionTex"),colorTexUniformLocation:t.getUniformLocation(cn,"colorTex")},Is=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Is),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),ea=ir(t,new Float32Array(i),o.width,o.height),hs=ir(t,null,o.width,o.height);const f=n.map(a=>[a,0,0,0]).flat();return xc=ir(t,new Float32Array(f),o.width,o.height),ec=Sr(t,ea),tc=Sr(t,hs),no={fb:ec,tex:ea},fa={fb:tc,tex:hs},ea},hp=t=>{const{gl:e,texDimensions:i,worldDimensions:n,interactionRange:o,drag:u,deltaTime:f}=t;e.bindFramebuffer(e.FRAMEBUFFER,fa.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,Is),e.enableVertexAttribArray(ln.positionAttributeLocation),e.vertexAttribPointer(ln.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,no.tex),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,xc),e.useProgram(cn),e.uniform1i(ln.positionTexUniformLocation,0),e.uniform1i(ln.colorTexUniformLocation,1),e.uniform1f(ln.dragUniformLocation,u),e.uniform1f(ln.interactionRangeUniformLocation,o),e.uniform1f(ln.deltaTimeUniformLocation,f),e.uniform2f(ln.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(ln.worldDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.TRIANGLES,0,6);{const a=no;no=fa,fa=a}return no.tex};function pp(t){let e,i,n,o,u=t[3]?"Play":"Pause",f,a,h,v=t[2]?"Normal Speed":"Slow Mo",y,P,K,re,Z=t[6].width*t[6].height+"",De,Ue,Ie,je,st,qe,tt,ut,rt,At,ht,Qe,_t,at,oe,Me,pt,yt,Ot,he,Ft,ft,Et,Kt,Wt,nt,or,Dt,gt,ar,Yt,it,sr,Ut,Lt,fr,He,We,pr,de,dt,tr,mr,mt,l,Rt,jt,vr,Bt,St,zt,Xt,gr;return{c(){e=B("canvas"),i=ne(),n=B("div"),o=B("button"),f=be(u),a=ne(),h=B("button"),y=be(v),P=ne(),K=B("span"),re=be("particles: "),De=be(Z),Ue=ne(),Ie=B("label"),je=be("Smooth steps"),st=ne(),qe=B("input"),tt=ne(),ut=B("button"),rt=be("Reset"),At=ne(),ht=B("button"),Qe=be("Fullscreen"),_t=ne(),at=B("div"),oe=B("ul"),Me=B("li"),pt=B("label"),yt=be("Interaction Range"),Ot=ne(),he=B("input"),Ft=ne(),ft=B("li"),Et=B("label"),Kt=be("Drag"),Wt=ne(),nt=B("input"),or=ne(),Dt=B("li"),gt=B("label"),ar=be("Time step"),Yt=ne(),it=B("input"),sr=ne(),Ut=B("li"),Lt=B("label"),fr=be("Particles size"),He=ne(),We=B("input"),pr=ne(),de=B("li"),dt=B("label"),tr=be("World: width"),mr=ne(),mt=B("input"),l=ne(),Rt=B("label"),jt=be("height"),vr=ne(),Bt=B("input"),St=ne(),zt=B("ul"),this.h()},l(Le){e=I(Le,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(e).forEach(w),i=ie(Le),n=I(Le,"DIV",{});var Oe=V(n);o=I(Oe,"BUTTON",{});var qt=V(o);f=xe(qt,u),qt.forEach(w),a=ie(Oe),h=I(Oe,"BUTTON",{});var Mt=V(h);y=xe(Mt,v),Mt.forEach(w),P=ie(Oe),K=I(Oe,"SPAN",{});var wr=V(K);re=xe(wr,"particles: "),De=xe(wr,Z),wr.forEach(w),Ue=ie(Oe),Ie=I(Oe,"LABEL",{for:!0});var Nr=V(Ie);je=xe(Nr,"Smooth steps"),Nr.forEach(w),st=ie(Oe),qe=I(Oe,"INPUT",{type:!0,min:!0}),tt=ie(Oe),ut=I(Oe,"BUTTON",{});var jr=V(ut);rt=xe(jr,"Reset"),jr.forEach(w),At=ie(Oe),ht=I(Oe,"BUTTON",{});var Rr=V(ht);Qe=xe(Rr,"Fullscreen"),Rr.forEach(w),Oe.forEach(w),_t=ie(Le),at=I(Le,"DIV",{});var qr=V(at);oe=I(qr,"UL",{});var Nt=V(oe);Me=I(Nt,"LI",{});var Fr=V(Me);pt=I(Fr,"LABEL",{for:!0});var Qr=V(pt);yt=xe(Qr,"Interaction Range"),Qr.forEach(w),Ot=ie(Fr),he=I(Fr,"INPUT",{id:!0,type:!0,min:!0}),Fr.forEach(w),Ft=ie(Nt),ft=I(Nt,"LI",{});var Br=V(ft);Et=I(Br,"LABEL",{for:!0});var Gr=V(Et);Kt=xe(Gr,"Drag"),Gr.forEach(w),Wt=ie(Br),nt=I(Br,"INPUT",{id:!0,type:!0,min:!0}),Br.forEach(w),or=ie(Nt),Dt=I(Nt,"LI",{});var Ke=V(Dt);gt=I(Ke,"LABEL",{for:!0});var ot=V(gt);ar=xe(ot,"Time step"),ot.forEach(w),Yt=ie(Ke),it=I(Ke,"INPUT",{id:!0,type:!0,min:!0}),Ke.forEach(w),sr=ie(Nt),Ut=I(Nt,"LI",{});var br=V(Ut);Lt=I(br,"LABEL",{for:!0});var en=V(Lt);fr=xe(en,"Particles size"),en.forEach(w),He=ie(br),We=I(br,"INPUT",{id:!0,type:!0,min:!0}),br.forEach(w),pr=ie(Nt),de=I(Nt,"LI",{});var Zt=V(de);dt=I(Zt,"LABEL",{for:!0});var tn=V(dt);tr=xe(tn,"World: width"),tn.forEach(w),mr=ie(Zt),mt=I(Zt,"INPUT",{id:!0,type:!0,min:!0}),l=ie(Zt),Rt=I(Zt,"LABEL",{for:!0});var rn=V(Rt);jt=xe(rn,"height"),rn.forEach(w),vr=ie(Zt),Bt=I(Zt,"INPUT",{id:!0,type:!0,min:!0}),Zt.forEach(w),St=ie(Nt),zt=I(Nt,"UL",{}),V(zt).forEach(w),Nt.forEach(w),qr.forEach(w),this.h()},h(){M(e,"id","canvas"),Jr(e,"background-color","black"),M(e,"width",t[5].width),M(e,"height",t[5].height),M(Ie,"for","steps"),M(qe,"type","number"),M(qe,"min",0),M(pt,"for","interactionRange"),M(he,"id","interactionRange"),M(he,"type","number"),M(he,"min",0),M(Et,"for","drag"),M(nt,"id","drag"),M(nt,"type","number"),M(nt,"min",0),M(gt,"for","deltaTime"),M(it,"id","deltaTime"),M(it,"type","number"),M(it,"min",0),M(Lt,"for","particlesSize"),M(We,"id","particlesSize"),M(We,"type","number"),M(We,"min",0),M(dt,"for","worldWidth"),M(mt,"id","worldWidth"),M(mt,"type","number"),M(mt,"min",0),M(Rt,"for","worldHeight"),M(Bt,"id","worldHeight"),M(Bt,"type","number"),M(Bt,"min",0)},m(Le,Oe){Fe(Le,e,Oe),Fe(Le,i,Oe),Fe(Le,n,Oe),p(n,o),p(o,f),p(n,a),p(n,h),p(h,y),p(n,P),p(n,K),p(K,re),p(K,De),p(n,Ue),p(n,Ie),p(Ie,je),p(n,st),p(n,qe),ke(qe,t[1]),p(n,tt),p(n,ut),p(ut,rt),p(n,At),p(n,ht),p(ht,Qe),Fe(Le,_t,Oe),Fe(Le,at,Oe),p(at,oe),p(oe,Me),p(Me,pt),p(pt,yt),p(Me,Ot),p(Me,he),ke(he,t[4].interactionRange),p(oe,Ft),p(oe,ft),p(ft,Et),p(Et,Kt),p(ft,Wt),p(ft,nt),ke(nt,t[4].drag),p(oe,or),p(oe,Dt),p(Dt,gt),p(gt,ar),p(Dt,Yt),p(Dt,it),ke(it,t[4].timeStep),p(oe,sr),p(oe,Ut),p(Ut,Lt),p(Lt,fr),p(Ut,He),p(Ut,We),ke(We,t[4].particlesSize),p(oe,pr),p(oe,de),p(de,dt),p(dt,tr),p(de,mr),p(de,mt),ke(mt,t[0].width),p(de,l),p(de,Rt),p(Rt,jt),p(de,vr),p(de,Bt),ke(Bt,t[0].height),p(oe,St),p(oe,zt),Xt||(gr=[ct(o,"click",t[9]),ct(h,"click",t[10]),ct(qe,"input",t[11]),ct(ut,"click",t[12]),ct(ht,"click",t[8]),ct(he,"input",t[13]),ct(nt,"input",t[14]),ct(it,"input",t[15]),ct(We,"input",t[16]),ct(mt,"input",t[17]),ct(Bt,"input",t[18])],Xt=!0)},p(Le,[Oe]){Oe&8&&u!==(u=Le[3]?"Play":"Pause")&&Wr(f,u),Oe&4&&v!==(v=Le[2]?"Normal Speed":"Slow Mo")&&Wr(y,v),Oe&2&&ze(qe.value)!==Le[1]&&ke(qe,Le[1]),Oe&16&&ze(he.value)!==Le[4].interactionRange&&ke(he,Le[4].interactionRange),Oe&16&&ze(nt.value)!==Le[4].drag&&ke(nt,Le[4].drag),Oe&16&&ze(it.value)!==Le[4].timeStep&&ke(it,Le[4].timeStep),Oe&16&&ze(We.value)!==Le[4].particlesSize&&ke(We,Le[4].particlesSize),Oe&1&&ze(mt.value)!==Le[0].width&&ke(mt,Le[0].width),Oe&1&&ze(Bt.value)!==Le[0].height&&ke(Bt,Le[0].height)},i:Pt,o:Pt,d(Le){Le&&w(e),Le&&w(i),Le&&w(n),Le&&w(_t),Le&&w(at),Xt=!1,Si(gr)}}}function vp(t,e,i){const n={width:800,height:600},o={width:800,height:600},u={width:500,height:10};let f=10,a=!1,h=!0;const v={interactionRange:6,drag:5,timeStep:10,particlesSize:4};let y,P;function K(){cancelAnimationFrame(P),y=ni(),kt(y.canvas);const{ids:At,positions:ht,colors:Qe}=ap({texDimensions:u,worldDimensions:o,mode:"disk"});np(y,{ids:At,colors:Qe,texDimensions:u});let _t=mp(y,{positions:ht,colors:Qe,texDimensions:u});function at(){if(!h)for(let oe=0;oe<f;oe++)_t=hp({gl:y,texDimensions:u,worldDimensions:o,interactionRange:v.interactionRange,drag:v.drag,deltaTime:v.timeStep});return ip({gl:y,positionTex:_t,texDimensions:u,worldDimensions:o,particlesSize:v.particlesSize,ids:At}),a?setTimeout(()=>P=requestAnimationFrame(at),1e3):P=requestAnimationFrame(at)}P=requestAnimationFrame(at)}const{enableFullscreen:re}=op(document,"canvas",n);document.addEventListener("keydown",At=>{At.code==="Space"&&(i(3,h=!h),At.preventDefault())}),Yr(()=>K());const Z=()=>i(3,h=!h),De=()=>i(2,a=!a);function Ue(){f=ze(this.value),i(1,f)}const Ie=()=>K();function je(){v.interactionRange=ze(this.value),i(4,v)}function st(){v.drag=ze(this.value),i(4,v)}function qe(){v.timeStep=ze(this.value),i(4,v)}function tt(){v.particlesSize=ze(this.value),i(4,v)}function ut(){o.width=ze(this.value),i(0,o)}function rt(){o.height=ze(this.value),i(0,o)}return[o,f,a,h,v,n,u,K,re,Z,De,Ue,Ie,je,st,qe,tt,ut,rt]}class _p extends Pr{constructor(e){super(),Cr(this,e,vp,pp,Ur,{})}}const bp=`attribute float id;

uniform float size;
uniform vec2 texDimensions;
uniform vec2 worldDimensions;

uniform sampler2D positionTex;
uniform sampler2D colorTex;

varying float v_color;
varying float v_id;

vec2 getValueFrom2DTextureAs1DArray(sampler2D tex, vec2 dimensions, float index) {
    float y = floor(index / dimensions.x);
    float x = mod(index, dimensions.x);
    vec2 texcoord = (vec2(x, y) + 0.5) / dimensions;
    return texture2D(tex, texcoord).xy;
}

// all shaders have a main function
void main() {
    // pull the color from the texture
    float colorFromTex = getValueFrom2DTextureAs1DArray(colorTex, texDimensions, id).x;

    // pull the position from the texture
    vec2 position = getValueFrom2DTextureAs1DArray(positionTex, texDimensions, id);

    // convert the position from pixels to 0.0 to 1.0
    vec2 zeroToOne = position / worldDimensions;
 
    // convert from 0->1 to 0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
 
    // convert from 0->2 to -1->+1 (clip space)
    vec2 clipSpace = zeroToTwo - 1.0;
 
    // Translate to have 0, 0 on top left
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    gl_PointSize = size;
    v_color = colorFromTex;
    v_id = id / (texDimensions.x * texDimensions.y);
}
`,xp=`precision mediump float;
varying float v_color;
varying float v_id;

const float u_radius = 0.5; // The radius of the particles

void main() {
    float dist = length(gl_PointCoord - vec2(0.5, 0.5)); // Calculate the distance to the center
    if (dist > u_radius) { // If outside the circle, discard the fragment
        discard;
    }

    if (v_color == 0.0) {
        gl_FragColor = vec4(0.21, 0.64, 0.84, 1.0);
    } else if (v_color == 1.0) {
        gl_FragColor = vec4(0.84, 0.21, 0.64, 1.0);
    } else if (v_color == 2.0) {
        gl_FragColor = vec4(0.64, 0.84, 0.21, 1.0);
    } else {
        // Should not happen
        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }

}
`;let Un,Bn,Os,Tc;const Tp=(t,e)=>{const{ids:i,colors:n,texDimensions:o}=e;Bn=dr(t,[bp,xp]),Un={idAttributeLocation:t.getAttribLocation(Bn,"id"),sizeUniformLocation:t.getUniformLocation(Bn,"size"),texDimensionsUniformLocation:t.getUniformLocation(Bn,"texDimensions"),worldDimensionsUniformLocation:t.getUniformLocation(Bn,"worldDimensions"),positionTexUniformLocation:t.getUniformLocation(Bn,"positionTex"),colorTexUniformLocation:t.getUniformLocation(Bn,"colorTex")},Os=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Os),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW);const u=n.map(f=>[f,0,0,0]).flat();Tc=ir(t,new Float32Array(u),o.width,o.height)},yp=t=>{const{gl:e,positionTex:i,texDimensions:n,worldDimensions:o,particlesSize:u,ids:f}=t,a=1,h=e.FLOAT,v=!1,y=0,P=0;kt(e.canvas),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindBuffer(e.ARRAY_BUFFER,Os),e.vertexAttribPointer(Un.idAttributeLocation,a,h,v,y,P),e.enableVertexAttribArray(Un.idAttributeLocation),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,Tc),e.useProgram(Bn),e.uniform1f(Un.sizeUniformLocation,u),e.uniform2f(Un.worldDimensionsUniformLocation,o.width,o.height),e.uniform2f(Un.texDimensionsUniformLocation,n.width,n.height),e.uniform1i(Un.positionTexUniformLocation,0),e.uniform1i(Un.colorTexUniformLocation,1),e.drawArrays(e.POINTS,P,f.length)};function Ep(t,e,i){function n(){const u=t.getElementById(e);u&&(t.fullscreenElement&&t.exitFullscreen&&t.exitFullscreen(),u.width=i.width,u.height=i.height)}function o(){const u=t.getElementById(e);u&&(t.fullscreenElement||u.requestFullscreen())}return t.addEventListener("fullscreenchange",()=>{t.fullscreenElement===null&&n()}),{enableFullscreen:o,disableFullscreen:n}}function Ap(t){const{texDimensions:e,worldDimensions:i,mode:n,nbColors:o}=t,u=e.width*e.height,f=new Array(u).fill(0).map((v,y)=>y),a=new Array(u).fill(0).map(v=>Math.floor(Math.random()*o)),h=f.map(v=>{if(n==="random"){const{x:y,y:P}=gp(i);return[y,P,0,0]}if(n==="mesh"){const{x:y,y:P}=Fp(i,v,u);return[y,P,0,0]}if(n==="disk"){const y=Math.min(i.width,i.height)*.3,{x:P,y:K}=Rp(i,y);return[P,K,0,0]}if(n==="disk_offset"){const{x:K,y:re}=Lp(i,100,-150);return[K,re,0,0]}if(n==="square"){const{x:P,y:K}=wp(i,300);return[P,K,0,0]}if(n==="idDiagonal"){const{x:y,y:P}=Sp(i,v,f.length);return[y,P,0,0]}if(n==="sinusoidal"){const{x:y,y:P}=rc(i,v,f.length,{x:1,y:5});return[y,P,0,0]}if(n==="circle"){const{x:y,y:P}=rc(i,v,f.length,{x:1,y:1});return[y,P,0,0]}}).flat();return{ids:f,positions:h,texDimensions:e,colors:a}}const gp=t=>{const e=20+Math.random()*(t.width-40),i=Math.random()*(t.height-150);return{x:e,y:i}},wp=(t,e)=>{const i=Math.random()*e-e/2+t.width/2,n=Math.random()*e-e/2+t.height/2;return{x:i,y:n}},Rp=(t,e)=>{const i=e*Math.random(),n=Math.random()*2*Math.PI,o=i*Math.cos(n)+t.width/2,u=i*Math.sin(n)+t.height/2;return{x:o,y:u}},Lp=(t,e,i)=>{const n=e*Math.random(),o=Math.random()*2*Math.PI,u=n*Math.cos(o)+t.width/2,f=n*Math.sin(o)+t.height/2;return{x:u+i,y:f}},Sp=(t,e,i)=>{const n=Ns(e,0,i,0,t.width,!1),o=Ns(e,0,i,0,t.height,!1);return{x:n,y:o}},rc=(t,e,i,n)=>{const o=Ns(e,0,i,0,1,!0)*2*Math.PI,u=n.x,a=Math.cos(u*o)*200+t.width/2,h=n.y,y=Math.sin(h*o)*200+t.height/2;return{x:a,y}},Fp=(t,e,i)=>{const n=Math.sqrt(i),o=Math.ceil(i/n),u=t.width/o,f=t.height/n,a=e%o*u+u/2,h=Math.floor(e/o)*f+f/2;return{x:a,y:h}},Ns=function(t,e,i,n,o,u){const f=(t-e)/(i-e)*(o-n)+n;return u?n<o?nc(f,n,o):nc(f,o,n):f},nc=function(t,e,i){return Math.max(Math.min(t,i),e)},Dp=`attribute vec4 position;
void main() {
    gl_Position = position;
}
`,Pp=`precision highp float;

uniform float wallsMode;    // 0.0: wraped 1.0: box 2.0: bottom wall
uniform float gravityFactor;
uniform float interactionRange;
uniform float drag;
uniform float deltaTime;
uniform vec2 texDimensions;
uniform vec2 worldDimensions;

uniform sampler2D positionTex;
uniform sampler2D colorTex;

// We need to define the texture dimensions in constants
// because loops work only with constant values
const float texWidth = {{TEX_WIDTH}};
const float texHeight = {{TEX_HEIGHT}};

const vec2 gravity = vec2(0.0, 0.5);

vec2 euclideanModulo(vec2 n, vec2 m) {
    return mod(mod(n, m) + m, m);
}

float euclideanModulo(float n, float m) {
    return mod(mod(n, m) + m, m);
}

vec2 newPosition_box(vec2 position, vec2 direction) {
    vec2 newPosition = position + direction;
    if (newPosition.y >= worldDimensions.y - 5.0) {
        newPosition.y = worldDimensions.y - 7.0;
    } else if (newPosition.y <  5.0) {
        newPosition.y = 7.0;
    }

    if (newPosition.x >= worldDimensions.x - 5.0) {
        newPosition.x = worldDimensions.x - 7.0;
    } else if (newPosition.x <  5.0) {
        newPosition.x = 7.0;
    }
    return newPosition;
}

vec2 newPosition_bottomWall(vec2 position, vec2 direction) {
    vec2 newPosition = position + direction;
    newPosition.x = euclideanModulo(position.x + direction.x, worldDimensions.x);
    if (newPosition.y >= worldDimensions.y - 5.0) {
        newPosition.y = worldDimensions.y - 7.0;
    }
    return newPosition;
}

vec2 newPosition_wrapWorld(vec2 position, vec2 direction) {
    return euclideanModulo(position + direction, worldDimensions);
}

vec2 getNewPosition(float wallsMode, vec2 position, vec2 direction) {
    if (wallsMode == 0.0) {
        // Wrapped world
        return newPosition_wrapWorld(position, direction);
    }

    if (wallsMode == 1.0) {
        // Box
        return newPosition_box(position, direction);
    }

    // Bottom wall - horizontal wrap
    return newPosition_bottomWall(position, direction);
}

void main() {
    vec2 texcoord = gl_FragCoord.xy / texDimensions;
    vec2 position = texture2D(positionTex, texcoord).xy;
    float color = texture2D(colorTex, texcoord).x;

    vec2 direction = vec2(0.0, 0.0);

    // Iterate on the texture coordinates to compare with each other cell

    for (float y=0.0; y<1.0; y += 1.0 / texHeight) {
        for (float x=0.0; x<1.0; x += 1.0 / texWidth) {
            vec2 otherTextCoord = vec2(x, y);
            vec2 otherPosition = texture2D(positionTex, otherTextCoord).xy;
            float otherColor = texture2D(colorTex, otherTextCoord).x;

            vec2 diff = position - otherPosition;
            float mag = length(diff);
            if (mag < interactionRange) {
                float diffCoef = 1.0 / mag;
                if (mag < 1.0) {
                    diffCoef = 1.0;
                }

                float colorCoef = 1.0;
                // if (color == otherColor) {
                //     colorCoef = 2.0;
                // }

                direction = direction + (diff * diffCoef * colorCoef);
            }
        }
    }
    direction = (direction * deltaTime) / drag;
    direction = direction + gravity * gravityFactor;

    vec2 newPosition = getNewPosition(wallsMode, position, direction);

    gl_FragColor = vec4(newPosition, 0, 1);
}
`;let Vr,Hr,Gs,ta,ps,ic,oc,io,la,yc;const Cp=(t,e)=>{const{positions:i,colors:n,texDimensions:o}=e,u=Pp.replace("{{TEX_WIDTH}}",o.width.toFixed(1)).replace("{{TEX_HEIGHT}}",o.height.toFixed(1));Hr=dr(t,[Dp,u]),Vr={positionAttributeLocation:t.getAttribLocation(Hr,"position"),wallsModeUniformLocation:t.getUniformLocation(Hr,"wallsMode"),gravityFactorUniformLocation:t.getUniformLocation(Hr,"gravityFactor"),interactionRangeUniformLocation:t.getUniformLocation(Hr,"interactionRange"),dragUniformLocation:t.getUniformLocation(Hr,"drag"),deltaTimeUniformLocation:t.getUniformLocation(Hr,"deltaTime"),texDimensionsUniformLocation:t.getUniformLocation(Hr,"texDimensions"),worldDimensionsUniformLocation:t.getUniformLocation(Hr,"worldDimensions"),positionTexUniformLocation:t.getUniformLocation(Hr,"positionTex"),colorTexUniformLocation:t.getUniformLocation(Hr,"colorTex")},Gs=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,Gs),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),ta=ir(t,new Float32Array(i),o.width,o.height),ps=ir(t,null,o.width,o.height);const f=n.map(a=>[a,0,0,0]).flat();return yc=ir(t,new Float32Array(f),o.width,o.height),ic=Sr(t,ta),oc=Sr(t,ps),io={fb:ic,tex:ta},la={fb:oc,tex:ps},ta},Up=t=>{const{gl:e,texDimensions:i,worldDimensions:n,wallsMode:o,gravityFactor:u,interactionRange:f,drag:a,deltaTime:h}=t;e.bindFramebuffer(e.FRAMEBUFFER,la.fb),e.viewport(0,0,i.width,i.height),e.bindBuffer(e.ARRAY_BUFFER,Gs),e.enableVertexAttribArray(Vr.positionAttributeLocation),e.vertexAttribPointer(Vr.positionAttributeLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,io.tex),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,yc),e.useProgram(Hr),e.uniform1i(Vr.positionTexUniformLocation,0),e.uniform1i(Vr.colorTexUniformLocation,1);const y={wraped:0,box:1,bottom_wall:2}[o];e.uniform1f(Vr.wallsModeUniformLocation,y),e.uniform1f(Vr.gravityFactorUniformLocation,u),e.uniform1f(Vr.dragUniformLocation,a),e.uniform1f(Vr.interactionRangeUniformLocation,f),e.uniform1f(Vr.deltaTimeUniformLocation,h),e.uniform2f(Vr.texDimensionsUniformLocation,i.width,i.height),e.uniform2f(Vr.worldDimensionsUniformLocation,n.width,n.height),e.drawArrays(e.TRIANGLES,0,6);{const P=io;io=la,la=P}return io.tex};function Bp(t,e,i){const n=t.slice();return n[23]=e[i],n}function Ip(t){let e,i;return{c(){e=B("option"),i=be(t[23]),this.h()},l(n){e=I(n,"OPTION",{});var o=V(e);i=xe(o,t[23]),o.forEach(w),this.h()},h(){e.__value=t[23],e.value=e.__value},m(n,o){Fe(n,e,o),p(e,i)},p:Pt,d(n){n&&w(e)}}}function Op(t){let e,i,n,o,u=t[3]?"Play":"Pause",f,a,h,v=t[2]?"Normal Speed":"Slow Mo",y,P,K,re,Z=t[6].width*t[6].height+"",De,Ue,Ie,je,st,qe,tt,ut,rt,At,ht,Qe,_t,at,oe,Me,pt,yt,Ot,he,Ft,ft,Et,Kt,Wt,nt,or,Dt,gt,ar,Yt,it,sr,Ut,Lt,fr,He,We,pr,de,dt,tr,mr,mt,l,Rt,jt,vr,Bt,St,zt,Xt,gr,Le,Oe,qt,Mt,wr,Nr,jr,Rr,qr,Nt,Fr,Qr,Br=["box","wraped","bottom_wall"],Gr=[];for(let Ke=0;Ke<3;Ke+=1)Gr[Ke]=Ip(Bp(t,Br,Ke));return{c(){e=B("canvas"),i=ne(),n=B("div"),o=B("button"),f=be(u),a=ne(),h=B("button"),y=be(v),P=ne(),K=B("span"),re=be("particles: "),De=be(Z),Ue=ne(),Ie=B("label"),je=be("Smooth steps"),st=ne(),qe=B("input"),tt=ne(),ut=B("button"),rt=be("Reset"),At=ne(),ht=B("button"),Qe=be("Fullscreen"),_t=ne(),at=B("div"),oe=B("ul"),Me=B("li"),pt=B("label"),yt=be("Interaction Range"),Ot=ne(),he=B("input"),Ft=ne(),ft=B("li"),Et=B("label"),Kt=be("Drag"),Wt=ne(),nt=B("input"),or=ne(),Dt=B("li"),gt=B("label"),ar=be("Time step"),Yt=ne(),it=B("input"),sr=ne(),Ut=B("li"),Lt=B("label"),fr=be("Gravity factor"),He=ne(),We=B("input"),pr=ne(),de=B("li"),dt=B("label"),tr=be("Particles size"),mr=ne(),mt=B("input"),l=ne(),Rt=B("li"),jt=B("label"),vr=be("World: width"),Bt=ne(),St=B("input"),zt=ne(),Xt=B("label"),gr=be("height"),Le=ne(),Oe=B("input"),qt=ne(),Mt=B("li"),wr=B("label"),Nr=be("Walls mode"),jr=ne(),Rr=B("select");for(let Ke=0;Ke<3;Ke+=1)Gr[Ke].c();qr=ne(),Nt=B("ul"),this.h()},l(Ke){e=I(Ke,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),V(e).forEach(w),i=ie(Ke),n=I(Ke,"DIV",{});var ot=V(n);o=I(ot,"BUTTON",{});var br=V(o);f=xe(br,u),br.forEach(w),a=ie(ot),h=I(ot,"BUTTON",{});var en=V(h);y=xe(en,v),en.forEach(w),P=ie(ot),K=I(ot,"SPAN",{});var Zt=V(K);re=xe(Zt,"particles: "),De=xe(Zt,Z),Zt.forEach(w),Ue=ie(ot),Ie=I(ot,"LABEL",{for:!0});var tn=V(Ie);je=xe(tn,"Smooth steps"),tn.forEach(w),st=ie(ot),qe=I(ot,"INPUT",{type:!0,min:!0}),tt=ie(ot),ut=I(ot,"BUTTON",{});var rn=V(ut);rt=xe(rn,"Reset"),rn.forEach(w),At=ie(ot),ht=I(ot,"BUTTON",{});var oo=V(ht);Qe=xe(oo,"Fullscreen"),oo.forEach(w),ot.forEach(w),_t=ie(Ke),at=I(Ke,"DIV",{});var ao=V(at);oe=I(ao,"UL",{});var xr=V(oe);Me=I(xr,"LI",{});var On=V(Me);pt=I(On,"LABEL",{for:!0});var Fi=V(pt);yt=xe(Fi,"Interaction Range"),Fi.forEach(w),Ot=ie(On),he=I(On,"INPUT",{id:!0,type:!0,min:!0}),On.forEach(w),Ft=ie(xr),ft=I(xr,"LI",{});var $t=V(ft);Et=I($t,"LABEL",{for:!0});var so=V(Et);Kt=xe(so,"Drag"),so.forEach(w),Wt=ie($t),nt=I($t,"INPUT",{id:!0,type:!0,min:!0}),$t.forEach(w),or=ie(xr),Dt=I(xr,"LI",{});var ii=V(Dt);gt=I(ii,"LABEL",{for:!0});var fo=V(gt);ar=xe(fo,"Time step"),fo.forEach(w),Yt=ie(ii),it=I(ii,"INPUT",{id:!0,type:!0,min:!0}),ii.forEach(w),sr=ie(xr),Ut=I(xr,"LI",{});var oi=V(Ut);Lt=I(oi,"LABEL",{for:!0});var lo=V(Lt);fr=xe(lo,"Gravity factor"),lo.forEach(w),He=ie(oi),We=I(oi,"INPUT",{id:!0,type:!0,min:!0,max:!0}),oi.forEach(w),pr=ie(xr),de=I(xr,"LI",{});var ai=V(de);dt=I(ai,"LABEL",{for:!0});var co=V(dt);tr=xe(co,"Particles size"),co.forEach(w),mr=ie(ai),mt=I(ai,"INPUT",{id:!0,type:!0,min:!0}),ai.forEach(w),l=ie(xr),Rt=I(xr,"LI",{});var nn=V(Rt);jt=I(nn,"LABEL",{for:!0});var uo=V(jt);vr=xe(uo,"World: width"),uo.forEach(w),Bt=ie(nn),St=I(nn,"INPUT",{id:!0,type:!0,min:!0}),zt=ie(nn),Xt=I(nn,"LABEL",{for:!0});var mo=V(Xt);gr=xe(mo,"height"),mo.forEach(w),Le=ie(nn),Oe=I(nn,"INPUT",{id:!0,type:!0,min:!0}),nn.forEach(w),qt=ie(xr),Mt=I(xr,"LI",{});var si=V(Mt);wr=I(si,"LABEL",{for:!0});var ho=V(wr);Nr=xe(ho,"Walls mode"),ho.forEach(w),jr=ie(si),Rr=I(si,"SELECT",{});var po=V(Rr);for(let Di=0;Di<3;Di+=1)Gr[Di].l(po);po.forEach(w),si.forEach(w),qr=ie(xr),Nt=I(xr,"UL",{}),V(Nt).forEach(w),xr.forEach(w),ao.forEach(w),this.h()},h(){M(e,"id","canvas"),Jr(e,"background-color","black"),M(e,"width",t[5].width),M(e,"height",t[5].height),M(Ie,"for","steps"),M(qe,"type","number"),M(qe,"min",0),M(pt,"for","interactionRange"),M(he,"id","interactionRange"),M(he,"type","number"),M(he,"min",0),M(Et,"for","drag"),M(nt,"id","drag"),M(nt,"type","number"),M(nt,"min",0),M(gt,"for","deltaTime"),M(it,"id","deltaTime"),M(it,"type","number"),M(it,"min",0),M(Lt,"for","gravityFactor"),M(We,"id","gravityFactor"),M(We,"type","number"),M(We,"min",-5),M(We,"max",5),M(dt,"for","particlesSize"),M(mt,"id","particlesSize"),M(mt,"type","number"),M(mt,"min",0),M(jt,"for","worldWidth"),M(St,"id","worldWidth"),M(St,"type","number"),M(St,"min",0),M(Xt,"for","worldHeight"),M(Oe,"id","worldHeight"),M(Oe,"type","number"),M(Oe,"min",0),M(wr,"for","wallsMode"),t[4].wallsMode===void 0&&tm(()=>t[20].call(Rr))},m(Ke,ot){Fe(Ke,e,ot),Fe(Ke,i,ot),Fe(Ke,n,ot),p(n,o),p(o,f),p(n,a),p(n,h),p(h,y),p(n,P),p(n,K),p(K,re),p(K,De),p(n,Ue),p(n,Ie),p(Ie,je),p(n,st),p(n,qe),ke(qe,t[1]),p(n,tt),p(n,ut),p(ut,rt),p(n,At),p(n,ht),p(ht,Qe),Fe(Ke,_t,ot),Fe(Ke,at,ot),p(at,oe),p(oe,Me),p(Me,pt),p(pt,yt),p(Me,Ot),p(Me,he),ke(he,t[4].interactionRange),p(oe,Ft),p(oe,ft),p(ft,Et),p(Et,Kt),p(ft,Wt),p(ft,nt),ke(nt,t[4].drag),p(oe,or),p(oe,Dt),p(Dt,gt),p(gt,ar),p(Dt,Yt),p(Dt,it),ke(it,t[4].timeStep),p(oe,sr),p(oe,Ut),p(Ut,Lt),p(Lt,fr),p(Ut,He),p(Ut,We),ke(We,t[4].gravityFactor),p(oe,pr),p(oe,de),p(de,dt),p(dt,tr),p(de,mr),p(de,mt),ke(mt,t[4].particlesSize),p(oe,l),p(oe,Rt),p(Rt,jt),p(jt,vr),p(Rt,Bt),p(Rt,St),ke(St,t[0].width),p(Rt,zt),p(Rt,Xt),p(Xt,gr),p(Rt,Le),p(Rt,Oe),ke(Oe,t[0].height),p(oe,qt),p(oe,Mt),p(Mt,wr),p(wr,Nr),p(Mt,jr),p(Mt,Rr);for(let br=0;br<3;br+=1)Gr[br].m(Rr,null);Bl(Rr,t[4].wallsMode),p(oe,qr),p(oe,Nt),Fr||(Qr=[ct(o,"click",t[9]),ct(h,"click",t[10]),ct(qe,"input",t[11]),ct(ut,"click",t[12]),ct(ht,"click",t[8]),ct(he,"input",t[13]),ct(nt,"input",t[14]),ct(it,"input",t[15]),ct(We,"input",t[16]),ct(mt,"input",t[17]),ct(St,"input",t[18]),ct(Oe,"input",t[19]),ct(Rr,"change",t[20])],Fr=!0)},p(Ke,[ot]){ot&8&&u!==(u=Ke[3]?"Play":"Pause")&&Wr(f,u),ot&4&&v!==(v=Ke[2]?"Normal Speed":"Slow Mo")&&Wr(y,v),ot&2&&ze(qe.value)!==Ke[1]&&ke(qe,Ke[1]),ot&16&&ze(he.value)!==Ke[4].interactionRange&&ke(he,Ke[4].interactionRange),ot&16&&ze(nt.value)!==Ke[4].drag&&ke(nt,Ke[4].drag),ot&16&&ze(it.value)!==Ke[4].timeStep&&ke(it,Ke[4].timeStep),ot&16&&ze(We.value)!==Ke[4].gravityFactor&&ke(We,Ke[4].gravityFactor),ot&16&&ze(mt.value)!==Ke[4].particlesSize&&ke(mt,Ke[4].particlesSize),ot&1&&ze(St.value)!==Ke[0].width&&ke(St,Ke[0].width),ot&1&&ze(Oe.value)!==Ke[0].height&&ke(Oe,Ke[0].height),ot&16&&Bl(Rr,Ke[4].wallsMode)},i:Pt,o:Pt,d(Ke){Ke&&w(e),Ke&&w(i),Ke&&w(n),Ke&&w(_t),Ke&&w(at),$s(Gr,Ke),Fr=!1,Si(Qr)}}}function Np(t,e,i){const n={width:800,height:600},o={width:800,height:600},u={width:500,height:10};let f=10,a=!1,h=!0;const v={interactionRange:10,drag:5,timeStep:10,particlesSize:3,gravityFactor:0,wallsMode:"wraped"};let y,P;function K(){cancelAnimationFrame(P),y=ni(),kt(y.canvas);const{ids:Qe,positions:_t,colors:at}=Ap({texDimensions:u,worldDimensions:o,mode:"mesh",nbColors:1});Tp(y,{ids:Qe,colors:at,texDimensions:u});let oe=Cp(y,{positions:_t,colors:at,texDimensions:u});function Me(){if(!h)for(let pt=0;pt<f;pt++)oe=Up({gl:y,texDimensions:u,worldDimensions:o,interactionRange:v.interactionRange,drag:v.drag,deltaTime:v.timeStep,gravityFactor:v.gravityFactor,wallsMode:v.wallsMode});return yp({gl:y,positionTex:oe,texDimensions:u,worldDimensions:o,particlesSize:v.particlesSize,ids:Qe}),a?setTimeout(()=>P=requestAnimationFrame(Me),1e3):P=requestAnimationFrame(Me)}P=requestAnimationFrame(Me)}const{enableFullscreen:re}=Ep(document,"canvas",n);document.addEventListener("keydown",Qe=>{Qe.code==="Space"&&(i(3,h=!h),Qe.preventDefault())}),Yr(()=>K());const Z=()=>i(3,h=!h),De=()=>i(2,a=!a);function Ue(){f=ze(this.value),i(1,f)}const Ie=()=>K();function je(){v.interactionRange=ze(this.value),i(4,v)}function st(){v.drag=ze(this.value),i(4,v)}function qe(){v.timeStep=ze(this.value),i(4,v)}function tt(){v.gravityFactor=ze(this.value),i(4,v)}function ut(){v.particlesSize=ze(this.value),i(4,v)}function rt(){o.width=ze(this.value),i(0,o)}function At(){o.height=ze(this.value),i(0,o)}function ht(){v.wallsMode=rm(this),i(4,v)}return[o,f,a,h,v,n,u,K,re,Z,De,Ue,Ie,je,st,qe,tt,ut,rt,At,ht]}class Gp extends Pr{constructor(e){super(),Cr(this,e,Np,Op,Ur,{})}}var Ms={},Mp={get exports(){return Ms},set exports(t){Ms=t}};(function(t,e){(function(i,n){t.exports=n()})(om,function(){var i=function(r){return r instanceof Uint8Array||r instanceof Uint16Array||r instanceof Uint32Array||r instanceof Int8Array||r instanceof Int16Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array||r instanceof Uint8ClampedArray},n=function(r,c){for(var T=Object.keys(c),N=0;N<T.length;++N)r[T[N]]=c[T[N]];return r},o=`
`;function u(r){return typeof atob<"u"?atob(r):"base64:"+r}function f(r){var c=new Error("(regl) "+r);throw console.error(c),c}function a(r,c){r||f(c)}function h(r){return r?": "+r:""}function v(r,c,T){r in c||f("unknown parameter ("+r+")"+h(T)+". possible values: "+Object.keys(c).join())}function y(r,c){i(r)||f("invalid parameter type"+h(c)+". must be a typed array")}function P(r,c){switch(c){case"number":return typeof r=="number";case"object":return typeof r=="object";case"string":return typeof r=="string";case"boolean":return typeof r=="boolean";case"function":return typeof r=="function";case"undefined":return typeof r>"u";case"symbol":return typeof r=="symbol"}}function K(r,c,T){P(r,c)||f("invalid parameter type"+h(T)+". expected "+c+", got "+typeof r)}function re(r,c){r>=0&&(r|0)===r||f("invalid parameter type, ("+r+")"+h(c)+". must be a nonnegative integer")}function Z(r,c,T){c.indexOf(r)<0&&f("invalid value"+h(T)+". must be one of: "+c)}var De=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ue(r){Object.keys(r).forEach(function(c){De.indexOf(c)<0&&f('invalid regl constructor argument "'+c+'". must be one of '+De)})}function Ie(r,c){for(r=r+"";r.length<c;)r=" "+r;return r}function je(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function st(r,c){this.number=r,this.line=c,this.errors=[]}function qe(r,c,T){this.file=r,this.line=c,this.message=T}function tt(){var r=new Error,c=(r.stack||r).toString(),T=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(c);if(T)return T[1];var N=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(c);return N?N[1]:"unknown"}function ut(){var r=new Error,c=(r.stack||r).toString(),T=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(c);if(T)return T[1];var N=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(c);return N?N[1]:"unknown"}function rt(r,c){var T=r.split(`
`),N=1,W=0,O={unknown:new je,0:new je};O.unknown.name=O[0].name=c||tt(),O.unknown.lines.push(new st(0,""));for(var k=0;k<T.length;++k){var ee=T[k],J=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ee);if(J)switch(J[1]){case"line":var le=/(\d+)(\s+\d+)?/.exec(J[2]);le&&(N=le[1]|0,le[2]&&(W=le[2]|0,W in O||(O[W]=new je)));break;case"define":var ue=/SHADER_NAME(_B64)?\s+(.*)$/.exec(J[2]);ue&&(O[W].name=ue[1]?u(ue[2]):ue[2]);break}O[W].lines.push(new st(N++,ee))}return Object.keys(O).forEach(function(ce){var pe=O[ce];pe.lines.forEach(function(te){pe.index[te.number]=te})}),O}function At(r){var c=[];return r.split(`
`).forEach(function(T){if(!(T.length<5)){var N=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(T);N?c.push(new qe(N[1]|0,N[2]|0,N[3].trim())):T.length>0&&c.push(new qe("unknown",0,T))}}),c}function ht(r,c){c.forEach(function(T){var N=r[T.file];if(N){var W=N.index[T.line];if(W){W.errors.push(T),N.hasErrors=!0;return}}r.unknown.hasErrors=!0,r.unknown.lines[0].errors.push(T)})}function Qe(r,c,T,N,W){if(!r.getShaderParameter(c,r.COMPILE_STATUS)){var O=r.getShaderInfoLog(c),k=N===r.FRAGMENT_SHADER?"fragment":"vertex";Ot(T,"string",k+" shader source must be a string",W);var ee=rt(T,W),J=At(O);ht(ee,J),Object.keys(ee).forEach(function(le){var ue=ee[le];if(!ue.hasErrors)return;var ce=[""],pe=[""];function te(fe,S){ce.push(fe),pe.push(S||"")}te("file number "+le+": "+ue.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ue.lines.forEach(function(fe){if(fe.errors.length>0){te(Ie(fe.number,4)+"|  ","background-color:yellow; font-weight:bold"),te(fe.line+o,"color:red; background-color:yellow; font-weight:bold");var S=0;fe.errors.forEach(function($){var se=$.message,we=/^\s*'(.*)'\s*:\s*(.*)$/.exec(se);if(we){var Q=we[1];switch(se=we[2],Q){case"assign":Q="=";break}S=Math.max(fe.line.indexOf(Q,S),0)}else S=0;te(Ie("| ",6)),te(Ie("^^^",S+3)+o,"font-weight:bold"),te(Ie("| ",6)),te(se+o,"font-weight:bold")}),te(Ie("| ",6)+o)}else te(Ie(fe.number,4)+"|  "),te(fe.line+o,"color:red")}),typeof document<"u"&&!window.chrome?(pe[0]=ce.join("%c"),console.log.apply(console,pe)):console.log(ce.join(""))}),a.raise("Error compiling "+k+" shader, "+ee[0].name)}}function _t(r,c,T,N,W){if(!r.getProgramParameter(c,r.LINK_STATUS)){var O=r.getProgramInfoLog(c),k=rt(T,W),ee=rt(N,W),J='Error linking program with vertex shader, "'+ee[0].name+'", and fragment shader "'+k[0].name+'"';typeof document<"u"?console.log("%c"+J+o+"%c"+O,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(J+o+O),a.raise(J)}}function at(r){r._commandRef=tt()}function oe(r,c,T,N){at(r);function W(J){return J?N.id(J):0}r._fragId=W(r.static.frag),r._vertId=W(r.static.vert);function O(J,le){Object.keys(le).forEach(function(ue){J[N.id(ue)]=!0})}var k=r._uniformSet={};O(k,c.static),O(k,c.dynamic);var ee=r._attributeSet={};O(ee,T.static),O(ee,T.dynamic),r._hasCount="count"in r.static||"count"in r.dynamic||"elements"in r.static||"elements"in r.dynamic}function Me(r,c){var T=ut();f(r+" in command "+(c||tt())+(T==="unknown"?"":" called from "+T))}function pt(r,c,T){r||Me(c,T||tt())}function yt(r,c,T,N){r in c||Me("unknown parameter ("+r+")"+h(T)+". possible values: "+Object.keys(c).join(),N||tt())}function Ot(r,c,T,N){P(r,c)||Me("invalid parameter type"+h(T)+". expected "+c+", got "+typeof r,N||tt())}function he(r){r()}function Ft(r,c,T){r.texture?Z(r.texture._texture.internalformat,c,"unsupported texture format for attachment"):Z(r.renderbuffer._renderbuffer.format,T,"unsupported renderbuffer format for attachment")}var ft=33071,Et=9728,Kt=9984,Wt=9985,nt=9986,or=9987,Dt=5120,gt=5121,ar=5122,Yt=5123,it=5124,sr=5125,Ut=5126,Lt=32819,fr=32820,He=33635,We=34042,pr=36193,de={};de[Dt]=de[gt]=1,de[ar]=de[Yt]=de[pr]=de[He]=de[Lt]=de[fr]=2,de[it]=de[sr]=de[Ut]=de[We]=4;function dt(r,c){return r===fr||r===Lt||r===He?2:r===We?4:de[r]*c}function tr(r){return!(r&r-1)&&!!r}function mr(r,c,T){var N,W=c.width,O=c.height,k=c.channels;a(W>0&&W<=T.maxTextureSize&&O>0&&O<=T.maxTextureSize,"invalid texture shape"),(r.wrapS!==ft||r.wrapT!==ft)&&a(tr(W)&&tr(O),"incompatible wrap mode for texture, both width and height must be power of 2"),c.mipmask===1?W!==1&&O!==1&&a(r.minFilter!==Kt&&r.minFilter!==nt&&r.minFilter!==Wt&&r.minFilter!==or,"min filter requires mipmap"):(a(tr(W)&&tr(O),"texture must be a square power of 2 to support mipmapping"),a(c.mipmask===(W<<1)-1,"missing or incomplete mipmap data")),c.type===Ut&&(T.extensions.indexOf("oes_texture_float_linear")<0&&a(r.minFilter===Et&&r.magFilter===Et,"filter not supported, must enable oes_texture_float_linear"),a(!r.genMipmaps,"mipmap generation not supported with float textures"));var ee=c.images;for(N=0;N<16;++N)if(ee[N]){var J=W>>N,le=O>>N;a(c.mipmask&1<<N,"missing mipmap data");var ue=ee[N];if(a(ue.width===J&&ue.height===le,"invalid shape for mip images"),a(ue.format===c.format&&ue.internalformat===c.internalformat&&ue.type===c.type,"incompatible type for mip image"),!ue.compressed)if(ue.data){var ce=Math.ceil(dt(ue.type,k)*J/ue.unpackAlignment)*ue.unpackAlignment;a(ue.data.byteLength===ce*le,"invalid data for image, buffer size is inconsistent with image format")}else ue.element||ue.copy}else r.genMipmaps||a((c.mipmask&1<<N)===0,"extra mipmap data");c.compressed&&a(!r.genMipmaps,"mipmap generation for compressed images not supported")}function mt(r,c,T,N){var W=r.width,O=r.height,k=r.channels;a(W>0&&W<=N.maxTextureSize&&O>0&&O<=N.maxTextureSize,"invalid texture shape"),a(W===O,"cube map must be square"),a(c.wrapS===ft&&c.wrapT===ft,"wrap mode not supported by cube map");for(var ee=0;ee<T.length;++ee){var J=T[ee];a(J.width===W&&J.height===O,"inconsistent cube map face shape"),c.genMipmaps&&(a(!J.compressed,"can not generate mipmap for compressed textures"),a(J.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var le=J.images,ue=0;ue<16;++ue){var ce=le[ue];if(ce){var pe=W>>ue,te=O>>ue;a(J.mipmask&1<<ue,"missing mipmap data"),a(ce.width===pe&&ce.height===te,"invalid shape for mip images"),a(ce.format===r.format&&ce.internalformat===r.internalformat&&ce.type===r.type,"incompatible type for mip image"),ce.compressed||(ce.data?a(ce.data.byteLength===pe*te*Math.max(dt(ce.type,k),ce.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ce.element||ce.copy)}}}}var l=n(a,{optional:he,raise:f,commandRaise:Me,command:pt,parameter:v,commandParameter:yt,constructor:Ue,type:K,commandType:Ot,isTypedArray:y,nni:re,oneOf:Z,shaderError:Qe,linkError:_t,callSite:ut,saveCommandRef:at,saveDrawInfo:oe,framebufferFormat:Ft,guessCommand:tt,texture2D:mr,textureCube:mt}),Rt=0,jt=0,vr=5,Bt=6;function St(r,c){this.id=Rt++,this.type=r,this.data=c}function zt(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Xt(r){if(r.length===0)return[];var c=r.charAt(0),T=r.charAt(r.length-1);if(r.length>1&&c===T&&(c==='"'||c==="'"))return['"'+zt(r.substr(1,r.length-2))+'"'];var N=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(r);if(N)return Xt(r.substr(0,N.index)).concat(Xt(N[1])).concat(Xt(r.substr(N.index+N[0].length)));var W=r.split(".");if(W.length===1)return['"'+zt(r)+'"'];for(var O=[],k=0;k<W.length;++k)O=O.concat(Xt(W[k]));return O}function gr(r){return"["+Xt(r).join("][")+"]"}function Le(r,c){return new St(r,gr(c+""))}function Oe(r){return typeof r=="function"&&!r._reglType||r instanceof St}function qt(r,c){if(typeof r=="function")return new St(jt,r);if(typeof r=="number"||typeof r=="boolean")return new St(vr,r);if(Array.isArray(r))return new St(Bt,r.map(function(T,N){return qt(T,c+"["+N+"]")}));if(r instanceof St)return r;l(!1,"invalid option type in uniform "+c)}var Mt={DynamicVariable:St,define:Le,isDynamic:Oe,unbox:qt,accessor:gr},wr={next:typeof requestAnimationFrame=="function"?function(r){return requestAnimationFrame(r)}:function(r){return setTimeout(r,16)},cancel:typeof cancelAnimationFrame=="function"?function(r){return cancelAnimationFrame(r)}:clearTimeout},Nr=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function jr(){var r={"":0},c=[""];return{id:function(T){var N=r[T];return N||(N=r[T]=c.length,c.push(T),N)},str:function(T){return c[T]}}}function Rr(r,c,T){var N=document.createElement("canvas");n(N.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),r.appendChild(N),r===document.body&&(N.style.position="absolute",n(r.style,{margin:0,padding:0}));function W(){var ee=window.innerWidth,J=window.innerHeight;if(r!==document.body){var le=N.getBoundingClientRect();ee=le.right-le.left,J=le.bottom-le.top}N.width=T*ee,N.height=T*J}var O;r!==document.body&&typeof ResizeObserver=="function"?(O=new ResizeObserver(function(){setTimeout(W)}),O.observe(r)):window.addEventListener("resize",W,!1);function k(){O?O.disconnect():window.removeEventListener("resize",W),r.removeChild(N)}return W(),{canvas:N,onDestroy:k}}function qr(r,c){function T(N){try{return r.getContext(N,c)}catch{return null}}return T("webgl")||T("experimental-webgl")||T("webgl-experimental")}function Nt(r){return typeof r.nodeName=="string"&&typeof r.appendChild=="function"&&typeof r.getBoundingClientRect=="function"}function Fr(r){return typeof r.drawArrays=="function"||typeof r.drawElements=="function"}function Qr(r){return typeof r=="string"?r.split():(l(Array.isArray(r),"invalid extension array"),r)}function Br(r){return typeof r=="string"?(l(typeof document<"u","not supported outside of DOM"),document.querySelector(r)):r}function Gr(r){var c=r||{},T,N,W,O,k={},ee=[],J=[],le=typeof window>"u"?1:window.devicePixelRatio,ue=!1,ce=function(fe){fe&&l.raise(fe)},pe=function(){};if(typeof c=="string"?(l(typeof document<"u","selector queries only supported in DOM enviroments"),T=document.querySelector(c),l(T,"invalid query string for element")):typeof c=="object"?Nt(c)?T=c:Fr(c)?(O=c,W=O.canvas):(l.constructor(c),"gl"in c?O=c.gl:"canvas"in c?W=Br(c.canvas):"container"in c&&(N=Br(c.container)),"attributes"in c&&(k=c.attributes,l.type(k,"object","invalid context attributes")),"extensions"in c&&(ee=Qr(c.extensions)),"optionalExtensions"in c&&(J=Qr(c.optionalExtensions)),"onDone"in c&&(l.type(c.onDone,"function","invalid or missing onDone callback"),ce=c.onDone),"profile"in c&&(ue=!!c.profile),"pixelRatio"in c&&(le=+c.pixelRatio,l(le>0,"invalid pixel ratio"))):l.raise("invalid arguments to regl"),T&&(T.nodeName.toLowerCase()==="canvas"?W=T:N=T),!O){if(!W){l(typeof document<"u","must manually specify webgl context outside of DOM environments");var te=Rr(N||document.body,ce,le);if(!te)return null;W=te.canvas,pe=te.onDestroy}k.premultipliedAlpha===void 0&&(k.premultipliedAlpha=!0),O=qr(W,k)}return O?{gl:O,canvas:W,container:N,extensions:ee,optionalExtensions:J,pixelRatio:le,profile:ue,onDone:ce,onDestroy:pe}:(pe(),ce("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ke(r,c){var T={};function N(k){l.type(k,"string","extension name must be string");var ee=k.toLowerCase(),J;try{J=T[ee]=r.getExtension(ee)}catch{}return!!J}for(var W=0;W<c.extensions.length;++W){var O=c.extensions[W];if(!N(O))return c.onDestroy(),c.onDone('"'+O+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return c.optionalExtensions.forEach(N),{extensions:T,restore:function(){Object.keys(T).forEach(function(k){if(T[k]&&!N(k))throw new Error("(regl): error restoring extension "+k)})}}}function ot(r,c){for(var T=Array(r),N=0;N<r;++N)T[N]=c(N);return T}var br=5120,en=5121,Zt=5122,tn=5123,rn=5124,oo=5125,ao=5126;function xr(r){for(var c=16;c<=1<<28;c*=16)if(r<=c)return c;return 0}function On(r){var c,T;return c=(r>65535)<<4,r>>>=c,T=(r>255)<<3,r>>>=T,c|=T,T=(r>15)<<2,r>>>=T,c|=T,T=(r>3)<<1,r>>>=T,c|=T,c|r>>1}function Fi(){var r=ot(8,function(){return[]});function c(O){var k=xr(O),ee=r[On(k)>>2];return ee.length>0?ee.pop():new ArrayBuffer(k)}function T(O){r[On(O.byteLength)>>2].push(O)}function N(O,k){var ee=null;switch(O){case br:ee=new Int8Array(c(k),0,k);break;case en:ee=new Uint8Array(c(k),0,k);break;case Zt:ee=new Int16Array(c(2*k),0,k);break;case tn:ee=new Uint16Array(c(2*k),0,k);break;case rn:ee=new Int32Array(c(4*k),0,k);break;case oo:ee=new Uint32Array(c(4*k),0,k);break;case ao:ee=new Float32Array(c(4*k),0,k);break;default:return null}return ee.length!==k?ee.subarray(0,k):ee}function W(O){T(O.buffer)}return{alloc:c,free:T,allocType:N,freeType:W}}var $t=Fi();$t.zero=Fi();var so=3408,ii=3410,fo=3411,oi=3412,lo=3413,ai=3414,co=3415,nn=33901,uo=33902,mo=3379,si=3386,ho=34921,po=36347,Di=36348,Ec=35661,Ac=35660,gc=34930,wc=36349,Rc=34076,Lc=34024,Sc=7936,Fc=7937,Dc=7938,Pc=35724,Cc=34047,Uc=36063,Bc=34852,vo=3553,Xs=34067,Ic=34069,Oc=33984,Pi=6408,da=5126,Vs=5121,ma=36160,Nc=36053,Gc=36064,Mc=16384,$c=function(r,c){var T=1;c.ext_texture_filter_anisotropic&&(T=r.getParameter(Cc));var N=1,W=1;c.webgl_draw_buffers&&(N=r.getParameter(Bc),W=r.getParameter(Uc));var O=!!c.oes_texture_float;if(O){var k=r.createTexture();r.bindTexture(vo,k),r.texImage2D(vo,0,Pi,1,1,0,Pi,da,null);var ee=r.createFramebuffer();if(r.bindFramebuffer(ma,ee),r.framebufferTexture2D(ma,Gc,vo,k,0),r.bindTexture(vo,null),r.checkFramebufferStatus(ma)!==Nc)O=!1;else{r.viewport(0,0,1,1),r.clearColor(1,0,0,1),r.clear(Mc);var J=$t.allocType(da,4);r.readPixels(0,0,1,1,Pi,da,J),r.getError()?O=!1:(r.deleteFramebuffer(ee),r.deleteTexture(k),O=J[0]===1),$t.freeType(J)}}var le=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ue=!0;if(!le){var ce=r.createTexture(),pe=$t.allocType(Vs,36);r.activeTexture(Oc),r.bindTexture(Xs,ce),r.texImage2D(Ic,0,Pi,3,3,0,Pi,Vs,pe),$t.freeType(pe),r.bindTexture(Xs,null),r.deleteTexture(ce),ue=!r.getError()}return{colorBits:[r.getParameter(ii),r.getParameter(fo),r.getParameter(oi),r.getParameter(lo)],depthBits:r.getParameter(ai),stencilBits:r.getParameter(co),subpixelBits:r.getParameter(so),extensions:Object.keys(c).filter(function(te){return!!c[te]}),maxAnisotropic:T,maxDrawbuffers:N,maxColorAttachments:W,pointSizeDims:r.getParameter(nn),lineWidthDims:r.getParameter(uo),maxViewportDims:r.getParameter(si),maxCombinedTextureUnits:r.getParameter(Ec),maxCubeMapSize:r.getParameter(Rc),maxRenderbufferSize:r.getParameter(Lc),maxTextureUnits:r.getParameter(gc),maxTextureSize:r.getParameter(mo),maxAttributes:r.getParameter(ho),maxVertexUniforms:r.getParameter(po),maxVertexTextureUnits:r.getParameter(Ac),maxVaryingVectors:r.getParameter(Di),maxFragmentUniforms:r.getParameter(wc),glsl:r.getParameter(Pc),renderer:r.getParameter(Fc),vendor:r.getParameter(Sc),version:r.getParameter(Dc),readFloat:O,npotTextureCube:ue}};function Kr(r){return!!r&&typeof r=="object"&&Array.isArray(r.shape)&&Array.isArray(r.stride)&&typeof r.offset=="number"&&r.shape.length===r.stride.length&&(Array.isArray(r.data)||i(r.data))}var Mr=function(r){return Object.keys(r).map(function(c){return r[c]})},_o={shape:Vc,flatten:Xc};function kc(r,c,T){for(var N=0;N<c;++N)T[N]=r[N]}function zc(r,c,T,N){for(var W=0,O=0;O<c;++O)for(var k=r[O],ee=0;ee<T;++ee)N[W++]=k[ee]}function Hs(r,c,T,N,W,O){for(var k=O,ee=0;ee<c;++ee)for(var J=r[ee],le=0;le<T;++le)for(var ue=J[le],ce=0;ce<N;++ce)W[k++]=ue[ce]}function Ws(r,c,T,N,W){for(var O=1,k=T+1;k<c.length;++k)O*=c[k];var ee=c[T];if(c.length-T===4){var J=c[T+1],le=c[T+2],ue=c[T+3];for(k=0;k<ee;++k)Hs(r[k],J,le,ue,N,W),W+=O}else for(k=0;k<ee;++k)Ws(r[k],c,T+1,N,W),W+=O}function Xc(r,c,T,N){var W=1;if(c.length)for(var O=0;O<c.length;++O)W*=c[O];else W=0;var k=N||$t.allocType(T,W);switch(c.length){case 0:break;case 1:kc(r,c[0],k);break;case 2:zc(r,c[0],c[1],k);break;case 3:Hs(r,c[0],c[1],c[2],k,0);break;default:Ws(r,c,0,k,0)}return k}function Vc(r){for(var c=[],T=r;T.length;T=T[0])c.push(T.length);return c}var ha={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Hc=5120,Wc=5122,Yc=5124,jc=5121,qc=5123,Qc=5125,Kc=5126,Zc=5126,Nn={int8:Hc,int16:Wc,int32:Yc,uint8:jc,uint16:qc,uint32:Qc,float:Kc,float32:Zc},Jc=35048,eu=35040,bo={dynamic:Jc,stream:eu,static:35044},pa=_o.flatten,Ys=_o.shape,js=35044,tu=35040,va=5121,_a=5126,An=[];An[5120]=1,An[5122]=2,An[5124]=4,An[5121]=1,An[5123]=2,An[5125]=4,An[5126]=4;function xo(r){return ha[Object.prototype.toString.call(r)]|0}function qs(r,c){for(var T=0;T<c.length;++T)r[T]=c[T]}function Qs(r,c,T,N,W,O,k){for(var ee=0,J=0;J<T;++J)for(var le=0;le<N;++le)r[ee++]=c[W*J+O*le+k]}function ru(r,c,T,N){var W=0,O={};function k(S){this.id=W++,this.buffer=r.createBuffer(),this.type=S,this.usage=js,this.byteLength=0,this.dimension=1,this.dtype=va,this.persistentData=null,T.profile&&(this.stats={size:0})}k.prototype.bind=function(){r.bindBuffer(this.type,this.buffer)},k.prototype.destroy=function(){pe(this)};var ee=[];function J(S,$){var se=ee.pop();return se||(se=new k(S)),se.bind(),ce(se,$,tu,0,1,!1),se}function le(S){ee.push(S)}function ue(S,$,se){S.byteLength=$.byteLength,r.bufferData(S.type,$,se)}function ce(S,$,se,we,Q,Ae){var ye;if(S.usage=se,Array.isArray($)){if(S.dtype=we||_a,$.length>0){var Ge;if(Array.isArray($[0])){ye=Ys($);for(var Y=1,H=1;H<ye.length;++H)Y*=ye[H];S.dimension=Y,Ge=pa($,ye,S.dtype),ue(S,Ge,se),Ae?S.persistentData=Ge:$t.freeType(Ge)}else if(typeof $[0]=="number"){S.dimension=Q;var Pe=$t.allocType(S.dtype,$.length);qs(Pe,$),ue(S,Pe,se),Ae?S.persistentData=Pe:$t.freeType(Pe)}else i($[0])?(S.dimension=$[0].length,S.dtype=we||xo($[0])||_a,Ge=pa($,[$.length,$[0].length],S.dtype),ue(S,Ge,se),Ae?S.persistentData=Ge:$t.freeType(Ge)):l.raise("invalid buffer data")}}else if(i($))S.dtype=we||xo($),S.dimension=Q,ue(S,$,se),Ae&&(S.persistentData=new Uint8Array(new Uint8Array($.buffer)));else if(Kr($)){ye=$.shape;var ve=$.stride,ae=$.offset,_e=0,Te=0,Je=0,Ze=0;ye.length===1?(_e=ye[0],Te=1,Je=ve[0],Ze=0):ye.length===2?(_e=ye[0],Te=ye[1],Je=ve[0],Ze=ve[1]):l.raise("invalid shape"),S.dtype=we||xo($.data)||_a,S.dimension=Te;var Ee=$t.allocType(S.dtype,_e*Te);Qs(Ee,$.data,_e,Te,Je,Ze,ae),ue(S,Ee,se),Ae?S.persistentData=Ee:$t.freeType(Ee)}else $ instanceof ArrayBuffer?(S.dtype=va,S.dimension=Q,ue(S,$,se),Ae&&(S.persistentData=new Uint8Array(new Uint8Array($)))):l.raise("invalid buffer data")}function pe(S){c.bufferCount--,N(S);var $=S.buffer;l($,"buffer must not be deleted already"),r.deleteBuffer($),S.buffer=null,delete O[S.id]}function te(S,$,se,we){c.bufferCount++;var Q=new k($);O[Q.id]=Q;function Ae(Y){var H=js,Pe=null,ve=0,ae=0,_e=1;return Array.isArray(Y)||i(Y)||Kr(Y)||Y instanceof ArrayBuffer?Pe=Y:typeof Y=="number"?ve=Y|0:Y&&(l.type(Y,"object","buffer arguments must be an object, a number or an array"),"data"in Y&&(l(Pe===null||Array.isArray(Pe)||i(Pe)||Kr(Pe),"invalid data for buffer"),Pe=Y.data),"usage"in Y&&(l.parameter(Y.usage,bo,"invalid buffer usage"),H=bo[Y.usage]),"type"in Y&&(l.parameter(Y.type,Nn,"invalid buffer type"),ae=Nn[Y.type]),"dimension"in Y&&(l.type(Y.dimension,"number","invalid dimension"),_e=Y.dimension|0),"length"in Y&&(l.nni(ve,"buffer length must be a nonnegative integer"),ve=Y.length|0)),Q.bind(),Pe?ce(Q,Pe,H,ae,_e,we):(ve&&r.bufferData(Q.type,ve,H),Q.dtype=ae||va,Q.usage=H,Q.dimension=_e,Q.byteLength=ve),T.profile&&(Q.stats.size=Q.byteLength*An[Q.dtype]),Ae}function ye(Y,H){l(H+Y.byteLength<=Q.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Y.byteLength+" starting from offset "+H+" to a buffer of size "+Q.byteLength),r.bufferSubData(Q.type,H,Y)}function Ge(Y,H){var Pe=(H||0)|0,ve;if(Q.bind(),i(Y)||Y instanceof ArrayBuffer)ye(Y,Pe);else if(Array.isArray(Y)){if(Y.length>0)if(typeof Y[0]=="number"){var ae=$t.allocType(Q.dtype,Y.length);qs(ae,Y),ye(ae,Pe),$t.freeType(ae)}else if(Array.isArray(Y[0])||i(Y[0])){ve=Ys(Y);var _e=pa(Y,ve,Q.dtype);ye(_e,Pe),$t.freeType(_e)}else l.raise("invalid buffer data")}else if(Kr(Y)){ve=Y.shape;var Te=Y.stride,Je=0,Ze=0,Ee=0,ge=0;ve.length===1?(Je=ve[0],Ze=1,Ee=Te[0],ge=0):ve.length===2?(Je=ve[0],Ze=ve[1],Ee=Te[0],ge=Te[1]):l.raise("invalid shape");var Xe=Array.isArray(Y.data)?Q.dtype:xo(Y.data),et=$t.allocType(Xe,Je*Ze);Qs(et,Y.data,Je,Ze,Ee,ge,Y.offset),ye(et,Pe),$t.freeType(et)}else l.raise("invalid data for buffer subdata");return Ae}return se||Ae(S),Ae._reglType="buffer",Ae._buffer=Q,Ae.subdata=Ge,T.profile&&(Ae.stats=Q.stats),Ae.destroy=function(){pe(Q)},Ae}function fe(){Mr(O).forEach(function(S){S.buffer=r.createBuffer(),r.bindBuffer(S.type,S.buffer),r.bufferData(S.type,S.persistentData||S.byteLength,S.usage)})}return T.profile&&(c.getTotalBufferSize=function(){var S=0;return Object.keys(O).forEach(function($){S+=O[$].stats.size}),S}),{create:te,createStream:J,destroyStream:le,clear:function(){Mr(O).forEach(pe),ee.forEach(pe)},getBuffer:function(S){return S&&S._buffer instanceof k?S._buffer:null},restore:fe,_initBuffer:ce}}var nu=0,iu=0,ou=1,au=1,su=4,fu=4,gn={points:nu,point:iu,lines:ou,line:au,triangles:su,triangle:fu,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},lu=0,cu=1,Ci=4,uu=5120,fi=5121,Ks=5122,li=5123,Zs=5124,Gn=5125,ba=34963,du=35040,mu=35044;function hu(r,c,T,N){var W={},O=0,k={uint8:fi,uint16:li};c.oes_element_index_uint&&(k.uint32=Gn);function ee(fe){this.id=O++,W[this.id]=this,this.buffer=fe,this.primType=Ci,this.vertCount=0,this.type=0}ee.prototype.bind=function(){this.buffer.bind()};var J=[];function le(fe){var S=J.pop();return S||(S=new ee(T.create(null,ba,!0,!1)._buffer)),ce(S,fe,du,-1,-1,0,0),S}function ue(fe){J.push(fe)}function ce(fe,S,$,se,we,Q,Ae){fe.buffer.bind();var ye;if(S){var Ge=Ae;!Ae&&(!i(S)||Kr(S)&&!i(S.data))&&(Ge=c.oes_element_index_uint?Gn:li),T._initBuffer(fe.buffer,S,$,Ge,3)}else r.bufferData(ba,Q,$),fe.buffer.dtype=ye||fi,fe.buffer.usage=$,fe.buffer.dimension=3,fe.buffer.byteLength=Q;if(ye=Ae,!Ae){switch(fe.buffer.dtype){case fi:case uu:ye=fi;break;case li:case Ks:ye=li;break;case Gn:case Zs:ye=Gn;break;default:l.raise("unsupported type for element array")}fe.buffer.dtype=ye}fe.type=ye,l(ye!==Gn||!!c.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Y=we;Y<0&&(Y=fe.buffer.byteLength,ye===li?Y>>=1:ye===Gn&&(Y>>=2)),fe.vertCount=Y;var H=se;if(se<0){H=Ci;var Pe=fe.buffer.dimension;Pe===1&&(H=lu),Pe===2&&(H=cu),Pe===3&&(H=Ci)}fe.primType=H}function pe(fe){N.elementsCount--,l(fe.buffer!==null,"must not double destroy elements"),delete W[fe.id],fe.buffer.destroy(),fe.buffer=null}function te(fe,S){var $=T.create(null,ba,!0),se=new ee($._buffer);N.elementsCount++;function we(Q){if(!Q)$(),se.primType=Ci,se.vertCount=0,se.type=fi;else if(typeof Q=="number")$(Q),se.primType=Ci,se.vertCount=Q|0,se.type=fi;else{var Ae=null,ye=mu,Ge=-1,Y=-1,H=0,Pe=0;Array.isArray(Q)||i(Q)||Kr(Q)?Ae=Q:(l.type(Q,"object","invalid arguments for elements"),"data"in Q&&(Ae=Q.data,l(Array.isArray(Ae)||i(Ae)||Kr(Ae),"invalid data for element buffer")),"usage"in Q&&(l.parameter(Q.usage,bo,"invalid element buffer usage"),ye=bo[Q.usage]),"primitive"in Q&&(l.parameter(Q.primitive,gn,"invalid element buffer primitive"),Ge=gn[Q.primitive]),"count"in Q&&(l(typeof Q.count=="number"&&Q.count>=0,"invalid vertex count for elements"),Y=Q.count|0),"type"in Q&&(l.parameter(Q.type,k,"invalid buffer type"),Pe=k[Q.type]),"length"in Q?H=Q.length|0:(H=Y,Pe===li||Pe===Ks?H*=2:(Pe===Gn||Pe===Zs)&&(H*=4))),ce(se,Ae,ye,Ge,Y,H,Pe)}return we}return we(fe),we._reglType="elements",we._elements=se,we.subdata=function(Q,Ae){return $.subdata(Q,Ae),we},we.destroy=function(){pe(se)},we}return{create:te,createStream:le,destroyStream:ue,getElements:function(fe){return typeof fe=="function"&&fe._elements instanceof ee?fe._elements:null},clear:function(){Mr(W).forEach(pe)}}}var Js=new Float32Array(1),pu=new Uint32Array(Js.buffer),vu=5123;function ef(r){for(var c=$t.allocType(vu,r.length),T=0;T<r.length;++T)if(isNaN(r[T]))c[T]=65535;else if(r[T]===1/0)c[T]=31744;else if(r[T]===-1/0)c[T]=64512;else{Js[0]=r[T];var N=pu[0],W=N>>>31<<15,O=(N<<1>>>24)-127,k=N>>13&(1<<10)-1;if(O<-24)c[T]=W;else if(O<-14){var ee=-14-O;c[T]=W+(k+(1<<10)>>ee)}else O>15?c[T]=W+31744:c[T]=W+(O+15<<10)+k}return c}function Vt(r){return Array.isArray(r)||i(r)}var tf=function(r){return!(r&r-1)&&!!r},_u=34467,on=3553,xa=34067,To=34069,Mn=6408,Ta=6406,yo=6407,Ui=6409,Eo=6410,rf=32854,ya=32855,nf=36194,bu=32819,xu=32820,Tu=33635,yu=34042,Ea=6402,Ao=34041,Aa=35904,ga=35906,ci=36193,wa=33776,Ra=33777,La=33778,Sa=33779,of=35986,af=35987,sf=34798,ff=35840,lf=35841,cf=35842,uf=35843,df=36196,ui=5121,Fa=5123,Da=5125,Bi=5126,Eu=10242,Au=10243,gu=10497,Pa=33071,wu=33648,Ru=10240,Lu=10241,Ca=9728,Su=9729,Ua=9984,mf=9985,hf=9986,Ba=9987,Fu=33170,go=4352,Du=4353,Pu=4354,Cu=34046,Uu=3317,Bu=37440,Iu=37441,Ou=37443,pf=37444,Ii=33984,Nu=[Ua,hf,mf,Ba],wo=[0,Ui,Eo,yo,Mn],zr={};zr[Ui]=zr[Ta]=zr[Ea]=1,zr[Ao]=zr[Eo]=2,zr[yo]=zr[Aa]=3,zr[Mn]=zr[ga]=4;function di(r){return"[object "+r+"]"}var vf=di("HTMLCanvasElement"),_f=di("OffscreenCanvas"),bf=di("CanvasRenderingContext2D"),xf=di("ImageBitmap"),Tf=di("HTMLImageElement"),yf=di("HTMLVideoElement"),Gu=Object.keys(ha).concat([vf,_f,bf,xf,Tf,yf]),mi=[];mi[ui]=1,mi[Bi]=4,mi[ci]=2,mi[Fa]=2,mi[Da]=4;var Tr=[];Tr[rf]=2,Tr[ya]=2,Tr[nf]=2,Tr[Ao]=4,Tr[wa]=.5,Tr[Ra]=.5,Tr[La]=1,Tr[Sa]=1,Tr[of]=.5,Tr[af]=1,Tr[sf]=1,Tr[ff]=.5,Tr[lf]=.25,Tr[cf]=.5,Tr[uf]=.25,Tr[df]=.5;function Ef(r){return Array.isArray(r)&&(r.length===0||typeof r[0]=="number")}function Af(r){if(!Array.isArray(r))return!1;var c=r.length;return!(c===0||!Vt(r[0]))}function $n(r){return Object.prototype.toString.call(r)}function gf(r){return $n(r)===vf}function wf(r){return $n(r)===_f}function Mu(r){return $n(r)===bf}function $u(r){return $n(r)===xf}function ku(r){return $n(r)===Tf}function zu(r){return $n(r)===yf}function Ia(r){if(!r)return!1;var c=$n(r);return Gu.indexOf(c)>=0?!0:Ef(r)||Af(r)||Kr(r)}function Rf(r){return ha[Object.prototype.toString.call(r)]|0}function Xu(r,c){var T=c.length;switch(r.type){case ui:case Fa:case Da:case Bi:var N=$t.allocType(r.type,T);N.set(c),r.data=N;break;case ci:r.data=ef(c);break;default:l.raise("unsupported texture type, must specify a typed array")}}function Lf(r,c){return $t.allocType(r.type===ci?Bi:r.type,c)}function Sf(r,c){r.type===ci?(r.data=ef(c),$t.freeType(c)):r.data=c}function Vu(r,c,T,N,W,O){for(var k=r.width,ee=r.height,J=r.channels,le=k*ee*J,ue=Lf(r,le),ce=0,pe=0;pe<ee;++pe)for(var te=0;te<k;++te)for(var fe=0;fe<J;++fe)ue[ce++]=c[T*te+N*pe+W*fe+O];Sf(r,ue)}function Ro(r,c,T,N,W,O){var k;if(typeof Tr[r]<"u"?k=Tr[r]:k=zr[r]*mi[c],O&&(k*=6),W){for(var ee=0,J=T;J>=1;)ee+=k*J*J,J/=2;return ee}else return k*T*N}function Hu(r,c,T,N,W,O,k){var ee={"don't care":go,"dont care":go,nice:Pu,fast:Du},J={repeat:gu,clamp:Pa,mirror:wu},le={nearest:Ca,linear:Su},ue=n({mipmap:Ba,"nearest mipmap nearest":Ua,"linear mipmap nearest":mf,"nearest mipmap linear":hf,"linear mipmap linear":Ba},le),ce={none:0,browser:pf},pe={uint8:ui,rgba4:bu,rgb565:Tu,"rgb5 a1":xu},te={alpha:Ta,luminance:Ui,"luminance alpha":Eo,rgb:yo,rgba:Mn,rgba4:rf,"rgb5 a1":ya,rgb565:nf},fe={};c.ext_srgb&&(te.srgb=Aa,te.srgba=ga),c.oes_texture_float&&(pe.float32=pe.float=Bi),c.oes_texture_half_float&&(pe.float16=pe["half float"]=ci),c.webgl_depth_texture&&(n(te,{depth:Ea,"depth stencil":Ao}),n(pe,{uint16:Fa,uint32:Da,"depth stencil":yu})),c.webgl_compressed_texture_s3tc&&n(fe,{"rgb s3tc dxt1":wa,"rgba s3tc dxt1":Ra,"rgba s3tc dxt3":La,"rgba s3tc dxt5":Sa}),c.webgl_compressed_texture_atc&&n(fe,{"rgb atc":of,"rgba atc explicit alpha":af,"rgba atc interpolated alpha":sf}),c.webgl_compressed_texture_pvrtc&&n(fe,{"rgb pvrtc 4bppv1":ff,"rgb pvrtc 2bppv1":lf,"rgba pvrtc 4bppv1":cf,"rgba pvrtc 2bppv1":uf}),c.webgl_compressed_texture_etc1&&(fe["rgb etc1"]=df);var S=Array.prototype.slice.call(r.getParameter(_u));Object.keys(fe).forEach(function(b){var G=fe[b];S.indexOf(G)>=0&&(te[b]=G)});var $=Object.keys(te);T.textureFormats=$;var se=[];Object.keys(te).forEach(function(b){var G=te[b];se[G]=b});var we=[];Object.keys(pe).forEach(function(b){var G=pe[b];we[G]=b});var Q=[];Object.keys(le).forEach(function(b){var G=le[b];Q[G]=b});var Ae=[];Object.keys(ue).forEach(function(b){var G=ue[b];Ae[G]=b});var ye=[];Object.keys(J).forEach(function(b){var G=J[b];ye[G]=b});var Ge=$.reduce(function(b,G){var U=te[G];return U===Ui||U===Ta||U===Ui||U===Eo||U===Ea||U===Ao||c.ext_srgb&&(U===Aa||U===ga)?b[U]=U:U===ya||G.indexOf("rgba")>=0?b[U]=Mn:b[U]=yo,b},{});function Y(){this.internalformat=Mn,this.format=Mn,this.type=ui,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=pf,this.width=0,this.height=0,this.channels=0}function H(b,G){b.internalformat=G.internalformat,b.format=G.format,b.type=G.type,b.compressed=G.compressed,b.premultiplyAlpha=G.premultiplyAlpha,b.flipY=G.flipY,b.unpackAlignment=G.unpackAlignment,b.colorSpace=G.colorSpace,b.width=G.width,b.height=G.height,b.channels=G.channels}function Pe(b,G){if(!(typeof G!="object"||!G)){if("premultiplyAlpha"in G&&(l.type(G.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),b.premultiplyAlpha=G.premultiplyAlpha),"flipY"in G&&(l.type(G.flipY,"boolean","invalid texture flip"),b.flipY=G.flipY),"alignment"in G&&(l.oneOf(G.alignment,[1,2,4,8],"invalid texture unpack alignment"),b.unpackAlignment=G.alignment),"colorSpace"in G&&(l.parameter(G.colorSpace,ce,"invalid colorSpace"),b.colorSpace=ce[G.colorSpace]),"type"in G){var U=G.type;l(c.oes_texture_float||!(U==="float"||U==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),l(c.oes_texture_half_float||!(U==="half float"||U==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),l(c.webgl_depth_texture||!(U==="uint16"||U==="uint32"||U==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),l.parameter(U,pe,"invalid texture type"),b.type=pe[U]}var Se=b.width,vt=b.height,d=b.channels,s=!1;"shape"in G?(l(Array.isArray(G.shape)&&G.shape.length>=2,"shape must be an array"),Se=G.shape[0],vt=G.shape[1],G.shape.length===3&&(d=G.shape[2],l(d>0&&d<=4,"invalid number of channels"),s=!0),l(Se>=0&&Se<=T.maxTextureSize,"invalid width"),l(vt>=0&&vt<=T.maxTextureSize,"invalid height")):("radius"in G&&(Se=vt=G.radius,l(Se>=0&&Se<=T.maxTextureSize,"invalid radius")),"width"in G&&(Se=G.width,l(Se>=0&&Se<=T.maxTextureSize,"invalid width")),"height"in G&&(vt=G.height,l(vt>=0&&vt<=T.maxTextureSize,"invalid height")),"channels"in G&&(d=G.channels,l(d>0&&d<=4,"invalid number of channels"),s=!0)),b.width=Se|0,b.height=vt|0,b.channels=d|0;var E=!1;if("format"in G){var L=G.format;l(c.webgl_depth_texture||!(L==="depth"||L==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),l.parameter(L,te,"invalid texture format");var F=b.internalformat=te[L];b.format=Ge[F],L in pe&&("type"in G||(b.type=pe[L])),L in fe&&(b.compressed=!0),E=!0}!s&&E?b.channels=zr[b.format]:s&&!E?b.channels!==wo[b.format]&&(b.format=b.internalformat=wo[b.channels]):E&&s&&l(b.channels===zr[b.format],"number of channels inconsistent with specified format")}}function ve(b){r.pixelStorei(Bu,b.flipY),r.pixelStorei(Iu,b.premultiplyAlpha),r.pixelStorei(Ou,b.colorSpace),r.pixelStorei(Uu,b.unpackAlignment)}function ae(){Y.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function _e(b,G){var U=null;if(Ia(G)?U=G:G&&(l.type(G,"object","invalid pixel data type"),Pe(b,G),"x"in G&&(b.xOffset=G.x|0),"y"in G&&(b.yOffset=G.y|0),Ia(G.data)&&(U=G.data)),l(!b.compressed||U instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),G.copy){l(!U,"can not specify copy and data field for the same texture");var Se=W.viewportWidth,vt=W.viewportHeight;b.width=b.width||Se-b.xOffset,b.height=b.height||vt-b.yOffset,b.needsCopy=!0,l(b.xOffset>=0&&b.xOffset<Se&&b.yOffset>=0&&b.yOffset<vt&&b.width>0&&b.width<=Se&&b.height>0&&b.height<=vt,"copy texture read out of bounds")}else if(!U)b.width=b.width||1,b.height=b.height||1,b.channels=b.channels||4;else if(i(U))b.channels=b.channels||4,b.data=U,!("type"in G)&&b.type===ui&&(b.type=Rf(U));else if(Ef(U))b.channels=b.channels||4,Xu(b,U),b.alignment=1,b.needsFree=!0;else if(Kr(U)){var d=U.data;!Array.isArray(d)&&b.type===ui&&(b.type=Rf(d));var s=U.shape,E=U.stride,L,F,g,A,R,m;s.length===3?(g=s[2],m=E[2]):(l(s.length===2,"invalid ndarray pixel data, must be 2 or 3D"),g=1,m=1),L=s[0],F=s[1],A=E[0],R=E[1],b.alignment=1,b.width=L,b.height=F,b.channels=g,b.format=b.internalformat=wo[g],b.needsFree=!0,Vu(b,d,A,R,m,U.offset)}else if(gf(U)||wf(U)||Mu(U))gf(U)||wf(U)?b.element=U:b.element=U.canvas,b.width=b.element.width,b.height=b.element.height,b.channels=4;else if($u(U))b.element=U,b.width=U.width,b.height=U.height,b.channels=4;else if(ku(U))b.element=U,b.width=U.naturalWidth,b.height=U.naturalHeight,b.channels=4;else if(zu(U))b.element=U,b.width=U.videoWidth,b.height=U.videoHeight,b.channels=4;else if(Af(U)){var x=b.width||U[0].length,_=b.height||U.length,C=b.channels;Vt(U[0][0])?C=C||U[0][0].length:C=C||1;for(var D=_o.shape(U),X=1,j=0;j<D.length;++j)X*=D[j];var me=Lf(b,X);_o.flatten(U,D,"",me),Sf(b,me),b.alignment=1,b.width=x,b.height=_,b.channels=C,b.format=b.internalformat=wo[C],b.needsFree=!0}b.type===Bi?l(T.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):b.type===ci&&l(T.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Te(b,G,U){var Se=b.element,vt=b.data,d=b.internalformat,s=b.format,E=b.type,L=b.width,F=b.height;ve(b),Se?r.texImage2D(G,U,s,s,E,Se):b.compressed?r.compressedTexImage2D(G,U,d,L,F,0,vt):b.needsCopy?(N(),r.copyTexImage2D(G,U,s,b.xOffset,b.yOffset,L,F,0)):r.texImage2D(G,U,s,L,F,0,s,E,vt||null)}function Je(b,G,U,Se,vt){var d=b.element,s=b.data,E=b.internalformat,L=b.format,F=b.type,g=b.width,A=b.height;ve(b),d?r.texSubImage2D(G,vt,U,Se,L,F,d):b.compressed?r.compressedTexSubImage2D(G,vt,U,Se,E,g,A,s):b.needsCopy?(N(),r.copyTexSubImage2D(G,vt,U,Se,b.xOffset,b.yOffset,g,A)):r.texSubImage2D(G,vt,U,Se,g,A,L,F,s)}var Ze=[];function Ee(){return Ze.pop()||new ae}function ge(b){b.needsFree&&$t.freeType(b.data),ae.call(b),Ze.push(b)}function Xe(){Y.call(this),this.genMipmaps=!1,this.mipmapHint=go,this.mipmask=0,this.images=Array(16)}function et(b,G,U){var Se=b.images[0]=Ee();b.mipmask=1,Se.width=b.width=G,Se.height=b.height=U,Se.channels=b.channels=4}function bt(b,G){var U=null;if(Ia(G))U=b.images[0]=Ee(),H(U,b),_e(U,G),b.mipmask=1;else if(Pe(b,G),Array.isArray(G.mipmap))for(var Se=G.mipmap,vt=0;vt<Se.length;++vt)U=b.images[vt]=Ee(),H(U,b),U.width>>=vt,U.height>>=vt,_e(U,Se[vt]),b.mipmask|=1<<vt;else U=b.images[0]=Ee(),H(U,b),_e(U,G),b.mipmask=1;H(b,b.images[0]),b.compressed&&(b.internalformat===wa||b.internalformat===Ra||b.internalformat===La||b.internalformat===Sa)&&l(b.width%4===0&&b.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ht(b,G){for(var U=b.images,Se=0;Se<U.length;++Se){if(!U[Se])return;Te(U[Se],G,Se)}}var Qt=[];function Tt(){var b=Qt.pop()||new Xe;Y.call(b),b.mipmask=0;for(var G=0;G<16;++G)b.images[G]=null;return b}function lr(b){for(var G=b.images,U=0;U<G.length;++U)G[U]&&ge(G[U]),G[U]=null;Qt.push(b)}function Gt(){this.minFilter=Ca,this.magFilter=Ca,this.wrapS=Pa,this.wrapT=Pa,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=go}function nr(b,G){if("min"in G){var U=G.min;l.parameter(U,ue),b.minFilter=ue[U],Nu.indexOf(b.minFilter)>=0&&!("faces"in G)&&(b.genMipmaps=!0)}if("mag"in G){var Se=G.mag;l.parameter(Se,le),b.magFilter=le[Se]}var vt=b.wrapS,d=b.wrapT;if("wrap"in G){var s=G.wrap;typeof s=="string"?(l.parameter(s,J),vt=d=J[s]):Array.isArray(s)&&(l.parameter(s[0],J),l.parameter(s[1],J),vt=J[s[0]],d=J[s[1]])}else{if("wrapS"in G){var E=G.wrapS;l.parameter(E,J),vt=J[E]}if("wrapT"in G){var L=G.wrapT;l.parameter(L,J),d=J[L]}}if(b.wrapS=vt,b.wrapT=d,"anisotropic"in G){var F=G.anisotropic;l(typeof F=="number"&&F>=1&&F<=T.maxAnisotropic,"aniso samples must be between 1 and "),b.anisotropic=G.anisotropic}if("mipmap"in G){var g=!1;switch(typeof G.mipmap){case"string":l.parameter(G.mipmap,ee,"invalid mipmap hint"),b.mipmapHint=ee[G.mipmap],b.genMipmaps=!0,g=!0;break;case"boolean":g=b.genMipmaps=G.mipmap;break;case"object":l(Array.isArray(G.mipmap),"invalid mipmap type"),b.genMipmaps=!1,g=!0;break;default:l.raise("invalid mipmap type")}g&&!("min"in G)&&(b.minFilter=Ua)}}function cr(b,G){r.texParameteri(G,Lu,b.minFilter),r.texParameteri(G,Ru,b.magFilter),r.texParameteri(G,Eu,b.wrapS),r.texParameteri(G,Au,b.wrapT),c.ext_texture_filter_anisotropic&&r.texParameteri(G,Cu,b.anisotropic),b.genMipmaps&&(r.hint(Fu,b.mipmapHint),r.generateMipmap(G))}var ur=0,_r={},yr=T.maxTextureUnits,Jt=Array(yr).map(function(){return null});function lt(b){Y.call(this),this.mipmask=0,this.internalformat=Mn,this.id=ur++,this.refCount=1,this.target=b,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Gt,k.profile&&(this.stats={size:0})}function Er(b){r.activeTexture(Ii),r.bindTexture(b.target,b.texture)}function Ct(){var b=Jt[0];b?r.bindTexture(b.target,b.texture):r.bindTexture(on,null)}function $e(b){var G=b.texture;l(G,"must not double destroy texture");var U=b.unit,Se=b.target;U>=0&&(r.activeTexture(Ii+U),r.bindTexture(Se,null),Jt[U]=null),r.deleteTexture(G),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete _r[b.id],O.textureCount--}n(lt.prototype,{bind:function(){var b=this;b.bindCount+=1;var G=b.unit;if(G<0){for(var U=0;U<yr;++U){var Se=Jt[U];if(Se){if(Se.bindCount>0)continue;Se.unit=-1}Jt[U]=b,G=U;break}G>=yr&&l.raise("insufficient number of texture units"),k.profile&&O.maxTextureUnits<G+1&&(O.maxTextureUnits=G+1),b.unit=G,r.activeTexture(Ii+G),r.bindTexture(b.target,b.texture)}return G},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&$e(this)}});function xt(b,G){var U=new lt(on);_r[U.id]=U,O.textureCount++;function Se(s,E){var L=U.texInfo;Gt.call(L);var F=Tt();return typeof s=="number"?typeof E=="number"?et(F,s|0,E|0):et(F,s|0,s|0):s?(l.type(s,"object","invalid arguments to regl.texture"),nr(L,s),bt(F,s)):et(F,1,1),L.genMipmaps&&(F.mipmask=(F.width<<1)-1),U.mipmask=F.mipmask,H(U,F),l.texture2D(L,F,T),U.internalformat=F.internalformat,Se.width=F.width,Se.height=F.height,Er(U),Ht(F,on),cr(L,on),Ct(),lr(F),k.profile&&(U.stats.size=Ro(U.internalformat,U.type,F.width,F.height,L.genMipmaps,!1)),Se.format=se[U.internalformat],Se.type=we[U.type],Se.mag=Q[L.magFilter],Se.min=Ae[L.minFilter],Se.wrapS=ye[L.wrapS],Se.wrapT=ye[L.wrapT],Se}function vt(s,E,L,F){l(!!s,"must specify image data");var g=E|0,A=L|0,R=F|0,m=Ee();return H(m,U),m.width=0,m.height=0,_e(m,s),m.width=m.width||(U.width>>R)-g,m.height=m.height||(U.height>>R)-A,l(U.type===m.type&&U.format===m.format&&U.internalformat===m.internalformat,"incompatible format for texture.subimage"),l(g>=0&&A>=0&&g+m.width<=U.width&&A+m.height<=U.height,"texture.subimage write out of bounds"),l(U.mipmask&1<<R,"missing mipmap data"),l(m.data||m.element||m.needsCopy,"missing image data"),Er(U),Je(m,on,g,A,R),Ct(),ge(m),Se}function d(s,E){var L=s|0,F=E|0||L;if(L===U.width&&F===U.height)return Se;Se.width=U.width=L,Se.height=U.height=F,Er(U);for(var g=0;U.mipmask>>g;++g){var A=L>>g,R=F>>g;if(!A||!R)break;r.texImage2D(on,g,U.format,A,R,0,U.format,U.type,null)}return Ct(),k.profile&&(U.stats.size=Ro(U.internalformat,U.type,L,F,!1,!1)),Se}return Se(b,G),Se.subimage=vt,Se.resize=d,Se._reglType="texture2d",Se._texture=U,k.profile&&(Se.stats=U.stats),Se.destroy=function(){U.decRef()},Se}function wt(b,G,U,Se,vt,d){var s=new lt(xa);_r[s.id]=s,O.cubeCount++;var E=new Array(6);function L(A,R,m,x,_,C){var D,X=s.texInfo;for(Gt.call(X),D=0;D<6;++D)E[D]=Tt();if(typeof A=="number"||!A){var j=A|0||1;for(D=0;D<6;++D)et(E[D],j,j)}else if(typeof A=="object")if(R)bt(E[0],A),bt(E[1],R),bt(E[2],m),bt(E[3],x),bt(E[4],_),bt(E[5],C);else if(nr(X,A),Pe(s,A),"faces"in A){var me=A.faces;for(l(Array.isArray(me)&&me.length===6,"cube faces must be a length 6 array"),D=0;D<6;++D)l(typeof me[D]=="object"&&!!me[D],"invalid input for cube map face"),H(E[D],s),bt(E[D],me[D])}else for(D=0;D<6;++D)bt(E[D],A);else l.raise("invalid arguments to cube map");for(H(s,E[0]),l.optional(function(){T.npotTextureCube||l(tf(s.width)&&tf(s.height),"your browser does not support non power or two texture dimensions")}),X.genMipmaps?s.mipmask=(E[0].width<<1)-1:s.mipmask=E[0].mipmask,l.textureCube(s,X,E,T),s.internalformat=E[0].internalformat,L.width=E[0].width,L.height=E[0].height,Er(s),D=0;D<6;++D)Ht(E[D],To+D);for(cr(X,xa),Ct(),k.profile&&(s.stats.size=Ro(s.internalformat,s.type,L.width,L.height,X.genMipmaps,!0)),L.format=se[s.internalformat],L.type=we[s.type],L.mag=Q[X.magFilter],L.min=Ae[X.minFilter],L.wrapS=ye[X.wrapS],L.wrapT=ye[X.wrapT],D=0;D<6;++D)lr(E[D]);return L}function F(A,R,m,x,_){l(!!R,"must specify image data"),l(typeof A=="number"&&A===(A|0)&&A>=0&&A<6,"invalid face");var C=m|0,D=x|0,X=_|0,j=Ee();return H(j,s),j.width=0,j.height=0,_e(j,R),j.width=j.width||(s.width>>X)-C,j.height=j.height||(s.height>>X)-D,l(s.type===j.type&&s.format===j.format&&s.internalformat===j.internalformat,"incompatible format for texture.subimage"),l(C>=0&&D>=0&&C+j.width<=s.width&&D+j.height<=s.height,"texture.subimage write out of bounds"),l(s.mipmask&1<<X,"missing mipmap data"),l(j.data||j.element||j.needsCopy,"missing image data"),Er(s),Je(j,To+A,C,D,X),Ct(),ge(j),L}function g(A){var R=A|0;if(R!==s.width){L.width=s.width=R,L.height=s.height=R,Er(s);for(var m=0;m<6;++m)for(var x=0;s.mipmask>>x;++x)r.texImage2D(To+m,x,s.format,R>>x,R>>x,0,s.format,s.type,null);return Ct(),k.profile&&(s.stats.size=Ro(s.internalformat,s.type,L.width,L.height,!1,!0)),L}}return L(b,G,U,Se,vt,d),L.subimage=F,L.resize=g,L._reglType="textureCube",L._texture=s,k.profile&&(L.stats=s.stats),L.destroy=function(){s.decRef()},L}function er(){for(var b=0;b<yr;++b)r.activeTexture(Ii+b),r.bindTexture(on,null),Jt[b]=null;Mr(_r).forEach($e),O.cubeCount=0,O.textureCount=0}k.profile&&(O.getTotalTextureSize=function(){var b=0;return Object.keys(_r).forEach(function(G){b+=_r[G].stats.size}),b});function sn(){for(var b=0;b<yr;++b){var G=Jt[b];G&&(G.bindCount=0,G.unit=-1,Jt[b]=null)}Mr(_r).forEach(function(U){U.texture=r.createTexture(),r.bindTexture(U.target,U.texture);for(var Se=0;Se<32;++Se)if(U.mipmask&1<<Se)if(U.target===on)r.texImage2D(on,Se,U.internalformat,U.width>>Se,U.height>>Se,0,U.internalformat,U.type,null);else for(var vt=0;vt<6;++vt)r.texImage2D(To+vt,Se,U.internalformat,U.width>>Se,U.height>>Se,0,U.internalformat,U.type,null);cr(U.texInfo,U.target)})}function Yn(){for(var b=0;b<yr;++b){var G=Jt[b];G&&(G.bindCount=0,G.unit=-1,Jt[b]=null),r.activeTexture(Ii+b),r.bindTexture(on,null),r.bindTexture(xa,null)}}return{create2D:xt,createCube:wt,clear:er,getTexture:function(b){return null},restore:sn,refresh:Yn}}var wn=36161,Lo=32854,Ff=32855,Df=36194,Pf=33189,Cf=36168,Uf=34041,Bf=35907,If=34836,Of=34842,Nf=34843,Zr=[];Zr[Lo]=2,Zr[Ff]=2,Zr[Df]=2,Zr[Pf]=2,Zr[Cf]=1,Zr[Uf]=4,Zr[Bf]=4,Zr[If]=16,Zr[Of]=8,Zr[Nf]=6;function Gf(r,c,T){return Zr[r]*c*T}var Wu=function(r,c,T,N,W){var O={rgba4:Lo,rgb565:Df,"rgb5 a1":Ff,depth:Pf,stencil:Cf,"depth stencil":Uf};c.ext_srgb&&(O.srgba=Bf),c.ext_color_buffer_half_float&&(O.rgba16f=Of,O.rgb16f=Nf),c.webgl_color_buffer_float&&(O.rgba32f=If);var k=[];Object.keys(O).forEach(function(te){var fe=O[te];k[fe]=te});var ee=0,J={};function le(te){this.id=ee++,this.refCount=1,this.renderbuffer=te,this.format=Lo,this.width=0,this.height=0,W.profile&&(this.stats={size:0})}le.prototype.decRef=function(){--this.refCount<=0&&ue(this)};function ue(te){var fe=te.renderbuffer;l(fe,"must not double destroy renderbuffer"),r.bindRenderbuffer(wn,null),r.deleteRenderbuffer(fe),te.renderbuffer=null,te.refCount=0,delete J[te.id],N.renderbufferCount--}function ce(te,fe){var S=new le(r.createRenderbuffer());J[S.id]=S,N.renderbufferCount++;function $(we,Q){var Ae=0,ye=0,Ge=Lo;if(typeof we=="object"&&we){var Y=we;if("shape"in Y){var H=Y.shape;l(Array.isArray(H)&&H.length>=2,"invalid renderbuffer shape"),Ae=H[0]|0,ye=H[1]|0}else"radius"in Y&&(Ae=ye=Y.radius|0),"width"in Y&&(Ae=Y.width|0),"height"in Y&&(ye=Y.height|0);"format"in Y&&(l.parameter(Y.format,O,"invalid renderbuffer format"),Ge=O[Y.format])}else typeof we=="number"?(Ae=we|0,typeof Q=="number"?ye=Q|0:ye=Ae):we?l.raise("invalid arguments to renderbuffer constructor"):Ae=ye=1;if(l(Ae>0&&ye>0&&Ae<=T.maxRenderbufferSize&&ye<=T.maxRenderbufferSize,"invalid renderbuffer size"),!(Ae===S.width&&ye===S.height&&Ge===S.format))return $.width=S.width=Ae,$.height=S.height=ye,S.format=Ge,r.bindRenderbuffer(wn,S.renderbuffer),r.renderbufferStorage(wn,Ge,Ae,ye),l(r.getError()===0,"invalid render buffer format"),W.profile&&(S.stats.size=Gf(S.format,S.width,S.height)),$.format=k[S.format],$}function se(we,Q){var Ae=we|0,ye=Q|0||Ae;return Ae===S.width&&ye===S.height||(l(Ae>0&&ye>0&&Ae<=T.maxRenderbufferSize&&ye<=T.maxRenderbufferSize,"invalid renderbuffer size"),$.width=S.width=Ae,$.height=S.height=ye,r.bindRenderbuffer(wn,S.renderbuffer),r.renderbufferStorage(wn,S.format,Ae,ye),l(r.getError()===0,"invalid render buffer format"),W.profile&&(S.stats.size=Gf(S.format,S.width,S.height))),$}return $(te,fe),$.resize=se,$._reglType="renderbuffer",$._renderbuffer=S,W.profile&&($.stats=S.stats),$.destroy=function(){S.decRef()},$}W.profile&&(N.getTotalRenderbufferSize=function(){var te=0;return Object.keys(J).forEach(function(fe){te+=J[fe].stats.size}),te});function pe(){Mr(J).forEach(function(te){te.renderbuffer=r.createRenderbuffer(),r.bindRenderbuffer(wn,te.renderbuffer),r.renderbufferStorage(wn,te.format,te.width,te.height)}),r.bindRenderbuffer(wn,null)}return{create:ce,clear:function(){Mr(J).forEach(ue)},restore:pe}},un=36160,Oa=36161,kn=3553,So=34069,Mf=36064,$f=36096,kf=36128,zf=33306,Xf=36053,Yu=36054,ju=36055,qu=36057,Qu=36061,Ku=36193,Zu=5121,Ju=5126,Vf=6407,Hf=6408,ed=6402,td=[Vf,Hf],Na=[];Na[Hf]=4,Na[Vf]=3;var Fo=[];Fo[Zu]=1,Fo[Ju]=4,Fo[Ku]=2;var rd=32854,nd=32855,id=36194,od=33189,ad=36168,Wf=34041,sd=35907,fd=34836,ld=34842,cd=34843,ud=[rd,nd,id,sd,ld,cd,fd],hi={};hi[Xf]="complete",hi[Yu]="incomplete attachment",hi[qu]="incomplete dimensions",hi[ju]="incomplete, missing attachment",hi[Qu]="unsupported";function dd(r,c,T,N,W,O){var k={cur:null,next:null,dirty:!1,setFBO:null},ee=["rgba"],J=["rgba4","rgb565","rgb5 a1"];c.ext_srgb&&J.push("srgba"),c.ext_color_buffer_half_float&&J.push("rgba16f","rgb16f"),c.webgl_color_buffer_float&&J.push("rgba32f");var le=["uint8"];c.oes_texture_half_float&&le.push("half float","float16"),c.oes_texture_float&&le.push("float","float32");function ue(ae,_e,Te){this.target=ae,this.texture=_e,this.renderbuffer=Te;var Je=0,Ze=0;_e?(Je=_e.width,Ze=_e.height):Te&&(Je=Te.width,Ze=Te.height),this.width=Je,this.height=Ze}function ce(ae){ae&&(ae.texture&&ae.texture._texture.decRef(),ae.renderbuffer&&ae.renderbuffer._renderbuffer.decRef())}function pe(ae,_e,Te){if(ae)if(ae.texture){var Je=ae.texture._texture,Ze=Math.max(1,Je.width),Ee=Math.max(1,Je.height);l(Ze===_e&&Ee===Te,"inconsistent width/height for supplied texture"),Je.refCount+=1}else{var ge=ae.renderbuffer._renderbuffer;l(ge.width===_e&&ge.height===Te,"inconsistent width/height for renderbuffer"),ge.refCount+=1}}function te(ae,_e){_e&&(_e.texture?r.framebufferTexture2D(un,ae,_e.target,_e.texture._texture.texture,0):r.framebufferRenderbuffer(un,ae,Oa,_e.renderbuffer._renderbuffer.renderbuffer))}function fe(ae){var _e=kn,Te=null,Je=null,Ze=ae;typeof ae=="object"&&(Ze=ae.data,"target"in ae&&(_e=ae.target|0)),l.type(Ze,"function","invalid attachment data");var Ee=Ze._reglType;return Ee==="texture2d"?(Te=Ze,l(_e===kn)):Ee==="textureCube"?(Te=Ze,l(_e>=So&&_e<So+6,"invalid cube map target")):Ee==="renderbuffer"?(Je=Ze,_e=Oa):l.raise("invalid regl object for attachment"),new ue(_e,Te,Je)}function S(ae,_e,Te,Je,Ze){if(Te){var Ee=N.create2D({width:ae,height:_e,format:Je,type:Ze});return Ee._texture.refCount=0,new ue(kn,Ee,null)}else{var ge=W.create({width:ae,height:_e,format:Je});return ge._renderbuffer.refCount=0,new ue(Oa,null,ge)}}function $(ae){return ae&&(ae.texture||ae.renderbuffer)}function se(ae,_e,Te){ae&&(ae.texture?ae.texture.resize(_e,Te):ae.renderbuffer&&ae.renderbuffer.resize(_e,Te),ae.width=_e,ae.height=Te)}var we=0,Q={};function Ae(){this.id=we++,Q[this.id]=this,this.framebuffer=r.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ye(ae){ae.colorAttachments.forEach(ce),ce(ae.depthAttachment),ce(ae.stencilAttachment),ce(ae.depthStencilAttachment)}function Ge(ae){var _e=ae.framebuffer;l(_e,"must not double destroy framebuffer"),r.deleteFramebuffer(_e),ae.framebuffer=null,O.framebufferCount--,delete Q[ae.id]}function Y(ae){var _e;r.bindFramebuffer(un,ae.framebuffer);var Te=ae.colorAttachments;for(_e=0;_e<Te.length;++_e)te(Mf+_e,Te[_e]);for(_e=Te.length;_e<T.maxColorAttachments;++_e)r.framebufferTexture2D(un,Mf+_e,kn,null,0);r.framebufferTexture2D(un,zf,kn,null,0),r.framebufferTexture2D(un,$f,kn,null,0),r.framebufferTexture2D(un,kf,kn,null,0),te($f,ae.depthAttachment),te(kf,ae.stencilAttachment),te(zf,ae.depthStencilAttachment);var Je=r.checkFramebufferStatus(un);!r.isContextLost()&&Je!==Xf&&l.raise("framebuffer configuration not supported, status = "+hi[Je]),r.bindFramebuffer(un,k.next?k.next.framebuffer:null),k.cur=k.next,r.getError()}function H(ae,_e){var Te=new Ae;O.framebufferCount++;function Je(Ee,ge){var Xe;l(k.next!==Te,"can not update framebuffer which is currently in use");var et=0,bt=0,Ht=!0,Qt=!0,Tt=null,lr=!0,Gt="rgba",nr="uint8",cr=1,ur=null,_r=null,yr=null,Jt=!1;if(typeof Ee=="number")et=Ee|0,bt=ge|0||et;else if(!Ee)et=bt=1;else{l.type(Ee,"object","invalid arguments for framebuffer");var lt=Ee;if("shape"in lt){var Er=lt.shape;l(Array.isArray(Er)&&Er.length>=2,"invalid shape for framebuffer"),et=Er[0],bt=Er[1]}else"radius"in lt&&(et=bt=lt.radius),"width"in lt&&(et=lt.width),"height"in lt&&(bt=lt.height);("color"in lt||"colors"in lt)&&(Tt=lt.color||lt.colors,Array.isArray(Tt)&&l(Tt.length===1||c.webgl_draw_buffers,"multiple render targets not supported")),Tt||("colorCount"in lt&&(cr=lt.colorCount|0,l(cr>0,"invalid color buffer count")),"colorTexture"in lt&&(lr=!!lt.colorTexture,Gt="rgba4"),"colorType"in lt&&(nr=lt.colorType,lr?(l(c.oes_texture_float||!(nr==="float"||nr==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),l(c.oes_texture_half_float||!(nr==="half float"||nr==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):nr==="half float"||nr==="float16"?(l(c.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Gt="rgba16f"):(nr==="float"||nr==="float32")&&(l(c.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Gt="rgba32f"),l.oneOf(nr,le,"invalid color type")),"colorFormat"in lt&&(Gt=lt.colorFormat,ee.indexOf(Gt)>=0?lr=!0:J.indexOf(Gt)>=0?lr=!1:l.optional(function(){lr?l.oneOf(lt.colorFormat,ee,"invalid color format for texture"):l.oneOf(lt.colorFormat,J,"invalid color format for renderbuffer")}))),("depthTexture"in lt||"depthStencilTexture"in lt)&&(Jt=!!(lt.depthTexture||lt.depthStencilTexture),l(!Jt||c.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in lt&&(typeof lt.depth=="boolean"?Ht=lt.depth:(ur=lt.depth,Qt=!1)),"stencil"in lt&&(typeof lt.stencil=="boolean"?Qt=lt.stencil:(_r=lt.stencil,Ht=!1)),"depthStencil"in lt&&(typeof lt.depthStencil=="boolean"?Ht=Qt=lt.depthStencil:(yr=lt.depthStencil,Ht=!1,Qt=!1))}var Ct=null,$e=null,xt=null,wt=null;if(Array.isArray(Tt))Ct=Tt.map(fe);else if(Tt)Ct=[fe(Tt)];else for(Ct=new Array(cr),Xe=0;Xe<cr;++Xe)Ct[Xe]=S(et,bt,lr,Gt,nr);l(c.webgl_draw_buffers||Ct.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),l(Ct.length<=T.maxColorAttachments,"too many color attachments, not supported"),et=et||Ct[0].width,bt=bt||Ct[0].height,ur?$e=fe(ur):Ht&&!Qt&&($e=S(et,bt,Jt,"depth","uint32")),_r?xt=fe(_r):Qt&&!Ht&&(xt=S(et,bt,!1,"stencil","uint8")),yr?wt=fe(yr):!ur&&!_r&&Qt&&Ht&&(wt=S(et,bt,Jt,"depth stencil","depth stencil")),l(!!ur+!!_r+!!yr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var er=null;for(Xe=0;Xe<Ct.length;++Xe)if(pe(Ct[Xe],et,bt),l(!Ct[Xe]||Ct[Xe].texture&&td.indexOf(Ct[Xe].texture._texture.format)>=0||Ct[Xe].renderbuffer&&ud.indexOf(Ct[Xe].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Xe+" is invalid"),Ct[Xe]&&Ct[Xe].texture){var sn=Na[Ct[Xe].texture._texture.format]*Fo[Ct[Xe].texture._texture.type];er===null?er=sn:l(er===sn,"all color attachments much have the same number of bits per pixel.")}return pe($e,et,bt),l(!$e||$e.texture&&$e.texture._texture.format===ed||$e.renderbuffer&&$e.renderbuffer._renderbuffer.format===od,"invalid depth attachment for framebuffer object"),pe(xt,et,bt),l(!xt||xt.renderbuffer&&xt.renderbuffer._renderbuffer.format===ad,"invalid stencil attachment for framebuffer object"),pe(wt,et,bt),l(!wt||wt.texture&&wt.texture._texture.format===Wf||wt.renderbuffer&&wt.renderbuffer._renderbuffer.format===Wf,"invalid depth-stencil attachment for framebuffer object"),ye(Te),Te.width=et,Te.height=bt,Te.colorAttachments=Ct,Te.depthAttachment=$e,Te.stencilAttachment=xt,Te.depthStencilAttachment=wt,Je.color=Ct.map($),Je.depth=$($e),Je.stencil=$(xt),Je.depthStencil=$(wt),Je.width=Te.width,Je.height=Te.height,Y(Te),Je}function Ze(Ee,ge){l(k.next!==Te,"can not resize a framebuffer which is currently in use");var Xe=Math.max(Ee|0,1),et=Math.max(ge|0||Xe,1);if(Xe===Te.width&&et===Te.height)return Je;for(var bt=Te.colorAttachments,Ht=0;Ht<bt.length;++Ht)se(bt[Ht],Xe,et);return se(Te.depthAttachment,Xe,et),se(Te.stencilAttachment,Xe,et),se(Te.depthStencilAttachment,Xe,et),Te.width=Je.width=Xe,Te.height=Je.height=et,Y(Te),Je}return Je(ae,_e),n(Je,{resize:Ze,_reglType:"framebuffer",_framebuffer:Te,destroy:function(){Ge(Te),ye(Te)},use:function(Ee){k.setFBO({framebuffer:Je},Ee)}})}function Pe(ae){var _e=Array(6);function Te(Ze){var Ee;l(_e.indexOf(k.next)<0,"can not update framebuffer which is currently in use");var ge={color:null},Xe=0,et=null,bt="rgba",Ht="uint8",Qt=1;if(typeof Ze=="number")Xe=Ze|0;else if(!Ze)Xe=1;else{l.type(Ze,"object","invalid arguments for framebuffer");var Tt=Ze;if("shape"in Tt){var lr=Tt.shape;l(Array.isArray(lr)&&lr.length>=2,"invalid shape for framebuffer"),l(lr[0]===lr[1],"cube framebuffer must be square"),Xe=lr[0]}else"radius"in Tt&&(Xe=Tt.radius|0),"width"in Tt?(Xe=Tt.width|0,"height"in Tt&&l(Tt.height===Xe,"must be square")):"height"in Tt&&(Xe=Tt.height|0);("color"in Tt||"colors"in Tt)&&(et=Tt.color||Tt.colors,Array.isArray(et)&&l(et.length===1||c.webgl_draw_buffers,"multiple render targets not supported")),et||("colorCount"in Tt&&(Qt=Tt.colorCount|0,l(Qt>0,"invalid color buffer count")),"colorType"in Tt&&(l.oneOf(Tt.colorType,le,"invalid color type"),Ht=Tt.colorType),"colorFormat"in Tt&&(bt=Tt.colorFormat,l.oneOf(Tt.colorFormat,ee,"invalid color format for texture"))),"depth"in Tt&&(ge.depth=Tt.depth),"stencil"in Tt&&(ge.stencil=Tt.stencil),"depthStencil"in Tt&&(ge.depthStencil=Tt.depthStencil)}var Gt;if(et)if(Array.isArray(et))for(Gt=[],Ee=0;Ee<et.length;++Ee)Gt[Ee]=et[Ee];else Gt=[et];else{Gt=Array(Qt);var nr={radius:Xe,format:bt,type:Ht};for(Ee=0;Ee<Qt;++Ee)Gt[Ee]=N.createCube(nr)}for(ge.color=Array(Gt.length),Ee=0;Ee<Gt.length;++Ee){var cr=Gt[Ee];l(typeof cr=="function"&&cr._reglType==="textureCube","invalid cube map"),Xe=Xe||cr.width,l(cr.width===Xe&&cr.height===Xe,"invalid cube map shape"),ge.color[Ee]={target:So,data:Gt[Ee]}}for(Ee=0;Ee<6;++Ee){for(var ur=0;ur<Gt.length;++ur)ge.color[ur].target=So+Ee;Ee>0&&(ge.depth=_e[0].depth,ge.stencil=_e[0].stencil,ge.depthStencil=_e[0].depthStencil),_e[Ee]?_e[Ee](ge):_e[Ee]=H(ge)}return n(Te,{width:Xe,height:Xe,color:Gt})}function Je(Ze){var Ee,ge=Ze|0;if(l(ge>0&&ge<=T.maxCubeMapSize,"invalid radius for cube fbo"),ge===Te.width)return Te;var Xe=Te.color;for(Ee=0;Ee<Xe.length;++Ee)Xe[Ee].resize(ge);for(Ee=0;Ee<6;++Ee)_e[Ee].resize(ge);return Te.width=Te.height=ge,Te}return Te(ae),n(Te,{faces:_e,resize:Je,_reglType:"framebufferCube",destroy:function(){_e.forEach(function(Ze){Ze.destroy()})}})}function ve(){k.cur=null,k.next=null,k.dirty=!0,Mr(Q).forEach(function(ae){ae.framebuffer=r.createFramebuffer(),Y(ae)})}return n(k,{getFramebuffer:function(ae){if(typeof ae=="function"&&ae._reglType==="framebuffer"){var _e=ae._framebuffer;if(_e instanceof Ae)return _e}return null},create:H,createCube:Pe,clear:function(){Mr(Q).forEach(Ge)},restore:ve})}var md=5126,Yf=34962,Do=34963,jf=["attributes","elements","offset","count","primitive","instances"];function Ga(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=md,this.offset=0,this.stride=0,this.divisor=0}function hd(r,c,T,N,W,O,k){for(var ee=T.maxAttributes,J=new Array(ee),le=0;le<ee;++le)J[le]=new Ga;var ue=0,ce={},pe={Record:Ga,scope:{},state:J,currentVAO:null,targetVAO:null,restore:fe()?ye:function(){},createVAO:Ge,getVAO:$,destroyBuffer:te,setVAO:fe()?se:we,clear:fe()?Q:function(){}};function te(Y){for(var H=0;H<J.length;++H){var Pe=J[H];Pe.buffer===Y&&(r.disableVertexAttribArray(H),Pe.buffer=null)}}function fe(){return c.oes_vertex_array_object}function S(){return c.angle_instanced_arrays}function $(Y){return typeof Y=="function"&&Y._vao?Y._vao:null}function se(Y){if(Y!==pe.currentVAO){var H=fe();Y?H.bindVertexArrayOES(Y.vao):H.bindVertexArrayOES(null),pe.currentVAO=Y}}function we(Y){if(Y!==pe.currentVAO){if(Y)Y.bindAttrs();else{for(var H=S(),Pe=0;Pe<J.length;++Pe){var ve=J[Pe];ve.buffer?(r.enableVertexAttribArray(Pe),ve.buffer.bind(),r.vertexAttribPointer(Pe,ve.size,ve.type,ve.normalized,ve.stride,ve.offfset),H&&ve.divisor&&H.vertexAttribDivisorANGLE(Pe,ve.divisor)):(r.disableVertexAttribArray(Pe),r.vertexAttrib4f(Pe,ve.x,ve.y,ve.z,ve.w))}k.elements?r.bindBuffer(Do,k.elements.buffer.buffer):r.bindBuffer(Do,null)}pe.currentVAO=Y}}function Q(){Mr(ce).forEach(function(Y){Y.destroy()})}function Ae(){this.id=++ue,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Y=fe();Y?this.vao=Y.createVertexArrayOES():this.vao=null,ce[this.id]=this,this.buffers=[]}Ae.prototype.bindAttrs=function(){for(var Y=S(),H=this.attributes,Pe=0;Pe<H.length;++Pe){var ve=H[Pe];ve.buffer?(r.enableVertexAttribArray(Pe),r.bindBuffer(Yf,ve.buffer.buffer),r.vertexAttribPointer(Pe,ve.size,ve.type,ve.normalized,ve.stride,ve.offset),Y&&ve.divisor&&Y.vertexAttribDivisorANGLE(Pe,ve.divisor)):(r.disableVertexAttribArray(Pe),r.vertexAttrib4f(Pe,ve.x,ve.y,ve.z,ve.w))}for(var ae=H.length;ae<ee;++ae)r.disableVertexAttribArray(ae);var _e=O.getElements(this.elements);_e?r.bindBuffer(Do,_e.buffer.buffer):r.bindBuffer(Do,null)},Ae.prototype.refresh=function(){var Y=fe();Y&&(Y.bindVertexArrayOES(this.vao),this.bindAttrs(),pe.currentVAO=null,Y.bindVertexArrayOES(null))},Ae.prototype.destroy=function(){if(this.vao){var Y=fe();this===pe.currentVAO&&(pe.currentVAO=null,Y.bindVertexArrayOES(null)),Y.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),ce[this.id]&&(delete ce[this.id],N.vaoCount-=1)};function ye(){var Y=fe();Y&&Mr(ce).forEach(function(H){H.refresh()})}function Ge(Y){var H=new Ae;N.vaoCount+=1;function Pe(ve){var ae;if(Array.isArray(ve))ae=ve,H.elements&&H.ownsElements&&H.elements.destroy(),H.elements=null,H.ownsElements=!1,H.offset=0,H.count=0,H.instances=-1,H.primitive=4;else{if(l(typeof ve=="object","invalid arguments for create vao"),l("attributes"in ve,"must specify attributes for vao"),ve.elements){var _e=ve.elements;H.ownsElements?typeof _e=="function"&&_e._reglType==="elements"?(H.elements.destroy(),H.ownsElements=!1):(H.elements(_e),H.ownsElements=!1):O.getElements(ve.elements)?(H.elements=ve.elements,H.ownsElements=!1):(H.elements=O.create(ve.elements),H.ownsElements=!0)}else H.elements=null,H.ownsElements=!1;ae=ve.attributes,H.offset=0,H.count=-1,H.instances=-1,H.primitive=4,H.elements&&(H.count=H.elements._elements.vertCount,H.primitive=H.elements._elements.primType),"offset"in ve&&(H.offset=ve.offset|0),"count"in ve&&(H.count=ve.count|0),"instances"in ve&&(H.instances=ve.instances|0),"primitive"in ve&&(l(ve.primitive in gn,"bad primitive type: "+ve.primitive),H.primitive=gn[ve.primitive]),l.optional(()=>{for(var Ht=Object.keys(ve),Qt=0;Qt<Ht.length;++Qt)l(jf.indexOf(Ht[Qt])>=0,'invalid option for vao: "'+Ht[Qt]+'" valid options are '+jf)}),l(Array.isArray(ae),"attributes must be an array")}l(ae.length<ee,"too many attributes"),l(ae.length>0,"must specify at least one attribute");var Te={},Je=H.attributes;Je.length=ae.length;for(var Ze=0;Ze<ae.length;++Ze){var Ee=ae[Ze],ge=Je[Ze]=new Ga,Xe=Ee.data||Ee;if(Array.isArray(Xe)||i(Xe)||Kr(Xe)){var et;H.buffers[Ze]&&(et=H.buffers[Ze],i(Xe)&&et._buffer.byteLength>=Xe.byteLength?et.subdata(Xe):(et.destroy(),H.buffers[Ze]=null)),H.buffers[Ze]||(et=H.buffers[Ze]=W.create(Ee,Yf,!1,!0)),ge.buffer=W.getBuffer(et),ge.size=ge.buffer.dimension|0,ge.normalized=!1,ge.type=ge.buffer.dtype,ge.offset=0,ge.stride=0,ge.divisor=0,ge.state=1,Te[Ze]=1}else W.getBuffer(Ee)?(ge.buffer=W.getBuffer(Ee),ge.size=ge.buffer.dimension|0,ge.normalized=!1,ge.type=ge.buffer.dtype,ge.offset=0,ge.stride=0,ge.divisor=0,ge.state=1):W.getBuffer(Ee.buffer)?(ge.buffer=W.getBuffer(Ee.buffer),ge.size=(+Ee.size||ge.buffer.dimension)|0,ge.normalized=!!Ee.normalized||!1,"type"in Ee?(l.parameter(Ee.type,Nn,"invalid buffer type"),ge.type=Nn[Ee.type]):ge.type=ge.buffer.dtype,ge.offset=(Ee.offset||0)|0,ge.stride=(Ee.stride||0)|0,ge.divisor=(Ee.divisor||0)|0,ge.state=1,l(ge.size>=1&&ge.size<=4,"size must be between 1 and 4"),l(ge.offset>=0,"invalid offset"),l(ge.stride>=0&&ge.stride<=255,"stride must be between 0 and 255"),l(ge.divisor>=0,"divisor must be positive"),l(!ge.divisor||!!c.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Ee?(l(Ze>0,"first attribute must not be a constant"),ge.x=+Ee.x||0,ge.y=+Ee.y||0,ge.z=+Ee.z||0,ge.w=+Ee.w||0,ge.state=2):l(!1,"invalid attribute spec for location "+Ze)}for(var bt=0;bt<H.buffers.length;++bt)!Te[bt]&&H.buffers[bt]&&(H.buffers[bt].destroy(),H.buffers[bt]=null);return H.refresh(),Pe}return Pe.destroy=function(){for(var ve=0;ve<H.buffers.length;++ve)H.buffers[ve]&&H.buffers[ve].destroy();H.buffers.length=0,H.ownsElements&&(H.elements.destroy(),H.elements=null,H.ownsElements=!1),H.destroy()},Pe._vao=H,Pe._reglType="vao",Pe(Y)}return pe}var qf=35632,pd=35633,vd=35718,_d=35721;function bd(r,c,T,N){var W={},O={};function k(S,$,se,we){this.name=S,this.id=$,this.location=se,this.info=we}function ee(S,$){for(var se=0;se<S.length;++se)if(S[se].id===$.id){S[se].location=$.location;return}S.push($)}function J(S,$,se){var we=S===qf?W:O,Q=we[$];if(!Q){var Ae=c.str($);Q=r.createShader(S),r.shaderSource(Q,Ae),r.compileShader(Q),l.shaderError(r,Q,Ae,S,se),we[$]=Q}return Q}var le={},ue=[],ce=0;function pe(S,$){this.id=ce++,this.fragId=S,this.vertId=$,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,N.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function te(S,$,se){var we,Q,Ae=J(qf,S.fragId),ye=J(pd,S.vertId),Ge=S.program=r.createProgram();if(r.attachShader(Ge,Ae),r.attachShader(Ge,ye),se)for(we=0;we<se.length;++we){var Y=se[we];r.bindAttribLocation(Ge,Y[0],Y[1])}r.linkProgram(Ge),l.linkError(r,Ge,c.str(S.fragId),c.str(S.vertId),$);var H=r.getProgramParameter(Ge,vd);N.profile&&(S.stats.uniformsCount=H);var Pe=S.uniforms;for(we=0;we<H;++we)if(Q=r.getActiveUniform(Ge,we),Q){if(Q.size>1)for(var ve=0;ve<Q.size;++ve){var ae=Q.name.replace("[0]","["+ve+"]");ee(Pe,new k(ae,c.id(ae),r.getUniformLocation(Ge,ae),Q))}var _e=Q.name;Q.size>1&&(_e=_e.replace("[0]","")),ee(Pe,new k(_e,c.id(_e),r.getUniformLocation(Ge,_e),Q))}var Te=r.getProgramParameter(Ge,_d);N.profile&&(S.stats.attributesCount=Te);var Je=S.attributes;for(we=0;we<Te;++we)Q=r.getActiveAttrib(Ge,we),Q&&ee(Je,new k(Q.name,c.id(Q.name),r.getAttribLocation(Ge,Q.name),Q))}N.profile&&(T.getMaxUniformsCount=function(){var S=0;return ue.forEach(function($){$.stats.uniformsCount>S&&(S=$.stats.uniformsCount)}),S},T.getMaxAttributesCount=function(){var S=0;return ue.forEach(function($){$.stats.attributesCount>S&&(S=$.stats.attributesCount)}),S});function fe(){W={},O={};for(var S=0;S<ue.length;++S)te(ue[S],null,ue[S].attributes.map(function($){return[$.location,$.name]}))}return{clear:function(){var S=r.deleteShader.bind(r);Mr(W).forEach(S),W={},Mr(O).forEach(S),O={},ue.forEach(function($){r.deleteProgram($.program)}),ue.length=0,le={},T.shaderCount=0},program:function(S,$,se,we){l.command(S>=0,"missing vertex shader",se),l.command($>=0,"missing fragment shader",se);var Q=le[$];Q||(Q=le[$]={});var Ae=Q[S];if(Ae&&(Ae.refCount++,!we))return Ae;var ye=new pe($,S);return T.shaderCount++,te(ye,se,we),Ae||(Q[S]=ye),ue.push(ye),n(ye,{destroy:function(){if(ye.refCount--,ye.refCount<=0){r.deleteProgram(ye.program);var Ge=ue.indexOf(ye);ue.splice(Ge,1),T.shaderCount--}Q[ye.vertId].refCount<=0&&(r.deleteShader(O[ye.vertId]),delete O[ye.vertId],delete le[ye.fragId][ye.vertId]),Object.keys(le[ye.fragId]).length||(r.deleteShader(W[ye.fragId]),delete W[ye.fragId],delete le[ye.fragId])}})},restore:fe,shader:J,frag:-1,vert:-1}}var xd=6408,Oi=5121,Td=3333,Po=5126;function yd(r,c,T,N,W,O,k){function ee(ue){var ce;c.next===null?(l(W.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ce=Oi):(l(c.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ce=c.next.colorAttachments[0].texture._texture.type,l.optional(function(){O.oes_texture_float?(l(ce===Oi||ce===Po,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ce===Po&&l(k.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):l(ce===Oi,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var pe=0,te=0,fe=N.framebufferWidth,S=N.framebufferHeight,$=null;i(ue)?$=ue:ue&&(l.type(ue,"object","invalid arguments to regl.read()"),pe=ue.x|0,te=ue.y|0,l(pe>=0&&pe<N.framebufferWidth,"invalid x offset for regl.read"),l(te>=0&&te<N.framebufferHeight,"invalid y offset for regl.read"),fe=(ue.width||N.framebufferWidth-pe)|0,S=(ue.height||N.framebufferHeight-te)|0,$=ue.data||null),$&&(ce===Oi?l($ instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ce===Po&&l($ instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),l(fe>0&&fe+pe<=N.framebufferWidth,"invalid width for read pixels"),l(S>0&&S+te<=N.framebufferHeight,"invalid height for read pixels"),T();var se=fe*S*4;return $||(ce===Oi?$=new Uint8Array(se):ce===Po&&($=$||new Float32Array(se))),l.isTypedArray($,"data buffer for regl.read() must be a typedarray"),l($.byteLength>=se,"data buffer for regl.read() too small"),r.pixelStorei(Td,4),r.readPixels(pe,te,fe,S,xd,ce,$),$}function J(ue){var ce;return c.setFBO({framebuffer:ue.framebuffer},function(){ce=ee(ue)}),ce}function le(ue){return!ue||!("framebuffer"in ue)?ee(ue):J(ue)}return le}function pi(r){return Array.prototype.slice.call(r)}function vi(r){return pi(r).join("")}function Ed(){var r=0,c=[],T=[];function N(ce){for(var pe=0;pe<T.length;++pe)if(T[pe]===ce)return c[pe];var te="g"+r++;return c.push(te),T.push(ce),te}function W(){var ce=[];function pe(){ce.push.apply(ce,pi(arguments))}var te=[];function fe(){var S="v"+r++;return te.push(S),arguments.length>0&&(ce.push(S,"="),ce.push.apply(ce,pi(arguments)),ce.push(";")),S}return n(pe,{def:fe,toString:function(){return vi([te.length>0?"var "+te.join(",")+";":"",vi(ce)])}})}function O(){var ce=W(),pe=W(),te=ce.toString,fe=pe.toString;function S($,se){pe($,se,"=",ce.def($,se),";")}return n(function(){ce.apply(ce,pi(arguments))},{def:ce.def,entry:ce,exit:pe,save:S,set:function($,se,we){S($,se),ce($,se,"=",we,";")},toString:function(){return te()+fe()}})}function k(){var ce=vi(arguments),pe=O(),te=O(),fe=pe.toString,S=te.toString;return n(pe,{then:function(){return pe.apply(pe,pi(arguments)),this},else:function(){return te.apply(te,pi(arguments)),this},toString:function(){var $=S();return $&&($="else{"+$+"}"),vi(["if(",ce,"){",fe(),"}",$])}})}var ee=W(),J={};function le(ce,pe){var te=[];function fe(){var Q="a"+te.length;return te.push(Q),Q}pe=pe||0;for(var S=0;S<pe;++S)fe();var $=O(),se=$.toString,we=J[ce]=n($,{arg:fe,toString:function(){return vi(["function(",te.join(),"){",se(),"}"])}});return we}function ue(){var ce=['"use strict";',ee,"return {"];Object.keys(J).forEach(function(fe){ce.push('"',fe,'":',J[fe].toString(),",")}),ce.push("}");var pe=vi(ce).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),te=Function.apply(null,c.concat(pe));return te.apply(null,T)}return{global:ee,link:N,block:W,proc:le,scope:O,cond:k,compile:ue}}var _i="xyzw".split(""),Qf=5121,bi=1,Ma=2,$a=0,ka=1,za=2,Xa=3,Co=4,Kf=5,Zf=6,Jf="dither",el="blend.enable",tl="blend.color",Va="blend.equation",Ha="blend.func",rl="depth.enable",nl="depth.func",il="depth.range",ol="depth.mask",Wa="colorMask",al="cull.enable",sl="cull.face",Ya="frontFace",ja="lineWidth",fl="polygonOffset.enable",qa="polygonOffset.offset",ll="sample.alpha",cl="sample.enable",Qa="sample.coverage",ul="stencil.enable",dl="stencil.mask",Ka="stencil.func",Za="stencil.opFront",Ni="stencil.opBack",ml="scissor.enable",Uo="scissor.box",dn="viewport",Gi="profile",zn="framebuffer",Mi="vert",$i="frag",Xn="elements",Vn="primitive",Hn="count",Bo="offset",Io="instances",ki="vao",Ja="Width",es="Height",xi=zn+Ja,Ti=zn+es,Ad=dn+Ja,gd=dn+es,hl="drawingBuffer",pl=hl+Ja,vl=hl+es,wd=[Ha,Va,Ka,Za,Ni,Qa,dn,Uo,qa],yi=34962,ts=34963,Rd=35632,Ld=35633,_l=3553,Sd=34067,Fd=2884,Dd=3042,Pd=3024,Cd=2960,Ud=2929,Bd=3089,Id=32823,Od=32926,Nd=32928,rs=5126,Oo=35664,No=35665,Go=35666,ns=5124,Mo=35667,$o=35668,ko=35669,is=35670,zo=35671,Xo=35672,Vo=35673,zi=35674,Xi=35675,Vi=35676,Hi=35678,Wi=35680,os=4,Yi=1028,Wn=1029,bl=2304,as=2305,Gd=32775,Md=32776,$d=519,Rn=7680,xl=0,Tl=1,yl=32774,kd=513,El=36160,zd=36064,an={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Al=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ei={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ln={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},gl={frag:Rd,vert:Ld},ss={cw:bl,ccw:as};function Ho(r){return Array.isArray(r)||i(r)||Kr(r)}function wl(r){return r.sort(function(c,T){return c===dn?-1:T===dn?1:c<T?-1:1})}function hr(r,c,T,N){this.thisDep=r,this.contextDep=c,this.propDep=T,this.append=N}function Sn(r){return r&&!(r.thisDep||r.contextDep||r.propDep)}function rr(r){return new hr(!1,!1,!1,r)}function Ir(r,c){var T=r.type;if(T===$a){var N=r.data.length;return new hr(!0,N>=1,N>=2,c)}else if(T===Co){var W=r.data;return new hr(W.thisDep,W.contextDep,W.propDep,c)}else{if(T===Kf)return new hr(!1,!1,!1,c);if(T===Zf){for(var O=!1,k=!1,ee=!1,J=0;J<r.data.length;++J){var le=r.data[J];if(le.type===ka)ee=!0;else if(le.type===za)k=!0;else if(le.type===Xa)O=!0;else if(le.type===$a){O=!0;var ue=le.data;ue>=1&&(k=!0),ue>=2&&(ee=!0)}else le.type===Co&&(O=O||le.data.thisDep,k=k||le.data.contextDep,ee=ee||le.data.propDep)}return new hr(O,k,ee,c)}else return new hr(T===Xa,T===za,T===ka,c)}}var Rl=new hr(!1,!1,!1,function(){});function Xd(r,c,T,N,W,O,k,ee,J,le,ue,ce,pe,te,fe){var S=le.Record,$={add:32774,subtract:32778,"reverse subtract":32779};T.ext_blend_minmax&&($.min=Gd,$.max=Md);var se=T.angle_instanced_arrays,we=T.webgl_draw_buffers,Q=T.oes_vertex_array_object,Ae={dirty:!0,profile:fe.profile},ye={},Ge=[],Y={},H={};function Pe(d){return d.replace(".","_")}function ve(d,s,E){var L=Pe(d);Ge.push(d),ye[L]=Ae[L]=!!E,Y[L]=s}function ae(d,s,E){var L=Pe(d);Ge.push(d),Array.isArray(E)?(Ae[L]=E.slice(),ye[L]=E.slice()):Ae[L]=ye[L]=E,H[L]=s}ve(Jf,Pd),ve(el,Dd),ae(tl,"blendColor",[0,0,0,0]),ae(Va,"blendEquationSeparate",[yl,yl]),ae(Ha,"blendFuncSeparate",[Tl,xl,Tl,xl]),ve(rl,Ud,!0),ae(nl,"depthFunc",kd),ae(il,"depthRange",[0,1]),ae(ol,"depthMask",!0),ae(Wa,Wa,[!0,!0,!0,!0]),ve(al,Fd),ae(sl,"cullFace",Wn),ae(Ya,Ya,as),ae(ja,ja,1),ve(fl,Id),ae(qa,"polygonOffset",[0,0]),ve(ll,Od),ve(cl,Nd),ae(Qa,"sampleCoverage",[1,!1]),ve(ul,Cd),ae(dl,"stencilMask",-1),ae(Ka,"stencilFunc",[$d,0,-1]),ae(Za,"stencilOpSeparate",[Yi,Rn,Rn,Rn]),ae(Ni,"stencilOpSeparate",[Wn,Rn,Rn,Rn]),ve(ml,Bd),ae(Uo,"scissor",[0,0,r.drawingBufferWidth,r.drawingBufferHeight]),ae(dn,dn,[0,0,r.drawingBufferWidth,r.drawingBufferHeight]);var _e={gl:r,context:pe,strings:c,next:ye,current:Ae,draw:ce,elements:O,buffer:W,shader:ue,attributes:le.state,vao:le,uniforms:J,framebuffer:ee,extensions:T,timer:te,isBufferArgs:Ho},Te={primTypes:gn,compareFuncs:Ei,blendFuncs:an,blendEquations:$,stencilOps:Ln,glTypes:Nn,orientationType:ss};l.optional(function(){_e.isArrayLike=Vt}),we&&(Te.backBuffer=[Wn],Te.drawBuffer=ot(N.maxDrawbuffers,function(d){return d===0?[0]:ot(d,function(s){return zd+s})}));var Je=0;function Ze(){var d=Ed(),s=d.link,E=d.global;d.id=Je++,d.batchId="0";var L=s(_e),F=d.shared={props:"a0"};Object.keys(_e).forEach(function(x){F[x]=E.def(L,".",x)}),l.optional(function(){d.CHECK=s(l),d.commandStr=l.guessCommand(),d.command=s(d.commandStr),d.assert=function(x,_,C){x("if(!(",_,"))",this.CHECK,".commandRaise(",s(C),",",this.command,");")},Te.invalidBlendCombinations=Al});var g=d.next={},A=d.current={};Object.keys(H).forEach(function(x){Array.isArray(Ae[x])&&(g[x]=E.def(F.next,".",x),A[x]=E.def(F.current,".",x))});var R=d.constants={};Object.keys(Te).forEach(function(x){R[x]=E.def(JSON.stringify(Te[x]))}),d.invoke=function(x,_){switch(_.type){case $a:var C=["this",F.context,F.props,d.batchId];return x.def(s(_.data),".call(",C.slice(0,Math.max(_.data.length+1,4)),")");case ka:return x.def(F.props,_.data);case za:return x.def(F.context,_.data);case Xa:return x.def("this",_.data);case Co:return _.data.append(d,x),_.data.ref;case Kf:return _.data.toString();case Zf:return _.data.map(function(D){return d.invoke(x,D)})}},d.attribCache={};var m={};return d.scopeAttrib=function(x){var _=c.id(x);if(_ in m)return m[_];var C=le.scope[_];C||(C=le.scope[_]=new S);var D=m[_]=s(C);return D},d}function Ee(d){var s=d.static,E=d.dynamic,L;if(Gi in s){var F=!!s[Gi];L=rr(function(A,R){return F}),L.enable=F}else if(Gi in E){var g=E[Gi];L=Ir(g,function(A,R){return A.invoke(R,g)})}return L}function ge(d,s){var E=d.static,L=d.dynamic;if(zn in E){var F=E[zn];return F?(F=ee.getFramebuffer(F),l.command(F,"invalid framebuffer object"),rr(function(A,R){var m=A.link(F),x=A.shared;R.set(x.framebuffer,".next",m);var _=x.context;return R.set(_,"."+xi,m+".width"),R.set(_,"."+Ti,m+".height"),m})):rr(function(A,R){var m=A.shared;R.set(m.framebuffer,".next","null");var x=m.context;return R.set(x,"."+xi,x+"."+pl),R.set(x,"."+Ti,x+"."+vl),"null"})}else if(zn in L){var g=L[zn];return Ir(g,function(A,R){var m=A.invoke(R,g),x=A.shared,_=x.framebuffer,C=R.def(_,".getFramebuffer(",m,")");l.optional(function(){A.assert(R,"!"+m+"||"+C,"invalid framebuffer object")}),R.set(_,".next",C);var D=x.context;return R.set(D,"."+xi,C+"?"+C+".width:"+D+"."+pl),R.set(D,"."+Ti,C+"?"+C+".height:"+D+"."+vl),C})}else return null}function Xe(d,s,E){var L=d.static,F=d.dynamic;function g(m){if(m in L){var x=L[m];l.commandType(x,"object","invalid "+m,E.commandStr);var _=!0,C=x.x|0,D=x.y|0,X,j;return"width"in x?(X=x.width|0,l.command(X>=0,"invalid "+m,E.commandStr)):_=!1,"height"in x?(j=x.height|0,l.command(j>=0,"invalid "+m,E.commandStr)):_=!1,new hr(!_&&s&&s.thisDep,!_&&s&&s.contextDep,!_&&s&&s.propDep,function(Ne,Re){var q=Ne.shared.context,z=X;"width"in x||(z=Re.def(q,".",xi,"-",C));var Be=j;return"height"in x||(Be=Re.def(q,".",Ti,"-",D)),[C,D,z,Be]})}else if(m in F){var me=F[m],Ye=Ir(me,function(Ne,Re){var q=Ne.invoke(Re,me);l.optional(function(){Ne.assert(Re,q+"&&typeof "+q+'==="object"',"invalid "+m)});var z=Ne.shared.context,Be=Re.def(q,".x|0"),Ce=Re.def(q,".y|0"),Ve=Re.def('"width" in ',q,"?",q,".width|0:","(",z,".",xi,"-",Be,")"),It=Re.def('"height" in ',q,"?",q,".height|0:","(",z,".",Ti,"-",Ce,")");return l.optional(function(){Ne.assert(Re,Ve+">=0&&"+It+">=0","invalid "+m)}),[Be,Ce,Ve,It]});return s&&(Ye.thisDep=Ye.thisDep||s.thisDep,Ye.contextDep=Ye.contextDep||s.contextDep,Ye.propDep=Ye.propDep||s.propDep),Ye}else return s?new hr(s.thisDep,s.contextDep,s.propDep,function(Ne,Re){var q=Ne.shared.context;return[0,0,Re.def(q,".",xi),Re.def(q,".",Ti)]}):null}var A=g(dn);if(A){var R=A;A=new hr(A.thisDep,A.contextDep,A.propDep,function(m,x){var _=R.append(m,x),C=m.shared.context;return x.set(C,"."+Ad,_[2]),x.set(C,"."+gd,_[3]),_})}return{viewport:A,scissor_box:g(Uo)}}function et(d,s){var E=d.static,L=typeof E[$i]=="string"&&typeof E[Mi]=="string";if(L){if(Object.keys(s.dynamic).length>0)return null;var F=s.static,g=Object.keys(F);if(g.length>0&&typeof F[g[0]]=="number"){for(var A=[],R=0;R<g.length;++R)l(typeof F[g[R]]=="number","must specify all vertex attribute locations when using vaos"),A.push([F[g[R]]|0,g[R]]);return A}}return null}function bt(d,s,E){var L=d.static,F=d.dynamic;function g(_){if(_ in L){var C=c.id(L[_]);l.optional(function(){ue.shader(gl[_],C,l.guessCommand())});var D=rr(function(){return C});return D.id=C,D}else if(_ in F){var X=F[_];return Ir(X,function(j,me){var Ye=j.invoke(me,X),Ne=me.def(j.shared.strings,".id(",Ye,")");return l.optional(function(){me(j.shared.shader,".shader(",gl[_],",",Ne,",",j.command,");")}),Ne})}return null}var A=g($i),R=g(Mi),m=null,x;return Sn(A)&&Sn(R)?(m=ue.program(R.id,A.id,null,E),x=rr(function(_,C){return _.link(m)})):x=new hr(A&&A.thisDep||R&&R.thisDep,A&&A.contextDep||R&&R.contextDep,A&&A.propDep||R&&R.propDep,function(_,C){var D=_.shared.shader,X;A?X=A.append(_,C):X=C.def(D,".",$i);var j;R?j=R.append(_,C):j=C.def(D,".",Mi);var me=D+".program("+j+","+X;return l.optional(function(){me+=","+_.command}),C.def(me+")")}),{frag:A,vert:R,progVar:x,program:m}}function Ht(d,s){var E=d.static,L=d.dynamic,F={},g=!1;function A(){if(ki in E){var Re=E[ki];return Re!==null&&le.getVAO(Re)===null&&(Re=le.createVAO(Re)),g=!0,F.vao=Re,rr(function(z){var Be=le.getVAO(Re);return Be?z.link(Be):"null"})}else if(ki in L){g=!0;var q=L[ki];return Ir(q,function(z,Be){var Ce=z.invoke(Be,q);return Be.def(z.shared.vao+".getVAO("+Ce+")")})}return null}var R=A(),m=!1;function x(){if(Xn in E){var Re=E[Xn];if(F.elements=Re,Ho(Re)){var q=F.elements=O.create(Re,!0);Re=O.getElements(q),m=!0}else Re&&(Re=O.getElements(Re),m=!0,l.command(Re,"invalid elements",s.commandStr));var z=rr(function(Ce,Ve){if(Re){var It=Ce.link(Re);return Ce.ELEMENTS=It,It}return Ce.ELEMENTS=null,null});return z.value=Re,z}else if(Xn in L){m=!0;var Be=L[Xn];return Ir(Be,function(Ce,Ve){var It=Ce.shared,Ar=It.isBufferArgs,jn=It.elements,mn=Ce.invoke(Ve,Be),fn=Ve.def("null"),Fn=Ve.def(Ar,"(",mn,")"),qn=Ce.cond(Fn).then(fn,"=",jn,".createStream(",mn,");").else(fn,"=",jn,".getElements(",mn,");");return l.optional(function(){Ce.assert(qn.else,"!"+mn+"||"+fn,"invalid elements")}),Ve.entry(qn),Ve.exit(Ce.cond(Fn).then(jn,".destroyStream(",fn,");")),Ce.ELEMENTS=fn,fn})}else if(g)return new hr(R.thisDep,R.contextDep,R.propDep,function(Ce,Ve){return Ve.def(Ce.shared.vao+".currentVAO?"+Ce.shared.elements+".getElements("+Ce.shared.vao+".currentVAO.elements):null")});return null}var _=x();function C(){if(Vn in E){var Re=E[Vn];return F.primitive=Re,l.commandParameter(Re,gn,"invalid primitve",s.commandStr),rr(function(z,Be){return gn[Re]})}else if(Vn in L){var q=L[Vn];return Ir(q,function(z,Be){var Ce=z.constants.primTypes,Ve=z.invoke(Be,q);return l.optional(function(){z.assert(Be,Ve+" in "+Ce,"invalid primitive, must be one of "+Object.keys(gn))}),Be.def(Ce,"[",Ve,"]")})}else{if(m)return Sn(_)?_.value?rr(function(z,Be){return Be.def(z.ELEMENTS,".primType")}):rr(function(){return os}):new hr(_.thisDep,_.contextDep,_.propDep,function(z,Be){var Ce=z.ELEMENTS;return Be.def(Ce,"?",Ce,".primType:",os)});if(g)return new hr(R.thisDep,R.contextDep,R.propDep,function(z,Be){return Be.def(z.shared.vao+".currentVAO?"+z.shared.vao+".currentVAO.primitive:"+os)})}return null}function D(Re,q){if(Re in E){var z=E[Re]|0;return q?F.offset=z:F.instances=z,l.command(!q||z>=0,"invalid "+Re,s.commandStr),rr(function(Ce,Ve){return q&&(Ce.OFFSET=z),z})}else if(Re in L){var Be=L[Re];return Ir(Be,function(Ce,Ve){var It=Ce.invoke(Ve,Be);return q&&(Ce.OFFSET=It,l.optional(function(){Ce.assert(Ve,It+">=0","invalid "+Re)})),It})}else if(q){if(m)return rr(function(Ce,Ve){return Ce.OFFSET=0,0});if(g)return new hr(R.thisDep,R.contextDep,R.propDep,function(Ce,Ve){return Ve.def(Ce.shared.vao+".currentVAO?"+Ce.shared.vao+".currentVAO.offset:0")})}else if(g)return new hr(R.thisDep,R.contextDep,R.propDep,function(Ce,Ve){return Ve.def(Ce.shared.vao+".currentVAO?"+Ce.shared.vao+".currentVAO.instances:-1")});return null}var X=D(Bo,!0);function j(){if(Hn in E){var Re=E[Hn]|0;return F.count=Re,l.command(typeof Re=="number"&&Re>=0,"invalid vertex count",s.commandStr),rr(function(){return Re})}else if(Hn in L){var q=L[Hn];return Ir(q,function(Ve,It){var Ar=Ve.invoke(It,q);return l.optional(function(){Ve.assert(It,"typeof "+Ar+'==="number"&&'+Ar+">=0&&"+Ar+"===("+Ar+"|0)","invalid vertex count")}),Ar})}else if(m)if(Sn(_)){if(_)return X?new hr(X.thisDep,X.contextDep,X.propDep,function(Ve,It){var Ar=It.def(Ve.ELEMENTS,".vertCount-",Ve.OFFSET);return l.optional(function(){Ve.assert(It,Ar+">=0","invalid vertex offset/element buffer too small")}),Ar}):rr(function(Ve,It){return It.def(Ve.ELEMENTS,".vertCount")});var z=rr(function(){return-1});return l.optional(function(){z.MISSING=!0}),z}else{var Be=new hr(_.thisDep||X.thisDep,_.contextDep||X.contextDep,_.propDep||X.propDep,function(Ve,It){var Ar=Ve.ELEMENTS;return Ve.OFFSET?It.def(Ar,"?",Ar,".vertCount-",Ve.OFFSET,":-1"):It.def(Ar,"?",Ar,".vertCount:-1")});return l.optional(function(){Be.DYNAMIC=!0}),Be}else if(g){var Ce=new hr(R.thisDep,R.contextDep,R.propDep,function(Ve,It){return It.def(Ve.shared.vao,".currentVAO?",Ve.shared.vao,".currentVAO.count:-1")});return Ce}return null}var me=C(),Ye=j(),Ne=D(Io,!1);return{elements:_,primitive:me,count:Ye,instances:Ne,offset:X,vao:R,vaoActive:g,elementsActive:m,static:F}}function Qt(d,s){var E=d.static,L=d.dynamic,F={};return Ge.forEach(function(g){var A=Pe(g);function R(m,x){if(g in E){var _=m(E[g]);F[A]=rr(function(){return _})}else if(g in L){var C=L[g];F[A]=Ir(C,function(D,X){return x(D,X,D.invoke(X,C))})}}switch(g){case al:case el:case Jf:case ul:case rl:case ml:case fl:case ll:case cl:case ol:return R(function(m){return l.commandType(m,"boolean",g,s.commandStr),m},function(m,x,_){return l.optional(function(){m.assert(x,"typeof "+_+'==="boolean"',"invalid flag "+g,m.commandStr)}),_});case nl:return R(function(m){return l.commandParameter(m,Ei,"invalid "+g,s.commandStr),Ei[m]},function(m,x,_){var C=m.constants.compareFuncs;return l.optional(function(){m.assert(x,_+" in "+C,"invalid "+g+", must be one of "+Object.keys(Ei))}),x.def(C,"[",_,"]")});case il:return R(function(m){return l.command(Vt(m)&&m.length===2&&typeof m[0]=="number"&&typeof m[1]=="number"&&m[0]<=m[1],"depth range is 2d array",s.commandStr),m},function(m,x,_){l.optional(function(){m.assert(x,m.shared.isArrayLike+"("+_+")&&"+_+".length===2&&typeof "+_+'[0]==="number"&&typeof '+_+'[1]==="number"&&'+_+"[0]<="+_+"[1]","depth range must be a 2d array")});var C=x.def("+",_,"[0]"),D=x.def("+",_,"[1]");return[C,D]});case Ha:return R(function(m){l.commandType(m,"object","blend.func",s.commandStr);var x="srcRGB"in m?m.srcRGB:m.src,_="srcAlpha"in m?m.srcAlpha:m.src,C="dstRGB"in m?m.dstRGB:m.dst,D="dstAlpha"in m?m.dstAlpha:m.dst;return l.commandParameter(x,an,A+".srcRGB",s.commandStr),l.commandParameter(_,an,A+".srcAlpha",s.commandStr),l.commandParameter(C,an,A+".dstRGB",s.commandStr),l.commandParameter(D,an,A+".dstAlpha",s.commandStr),l.command(Al.indexOf(x+", "+C)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+x+", "+C+")",s.commandStr),[an[x],an[C],an[_],an[D]]},function(m,x,_){var C=m.constants.blendFuncs;l.optional(function(){m.assert(x,_+"&&typeof "+_+'==="object"',"invalid blend func, must be an object")});function D(q,z){var Be=x.def('"',q,z,'" in ',_,"?",_,".",q,z,":",_,".",q);return l.optional(function(){m.assert(x,Be+" in "+C,"invalid "+g+"."+q+z+", must be one of "+Object.keys(an))}),Be}var X=D("src","RGB"),j=D("dst","RGB");l.optional(function(){var q=m.constants.invalidBlendCombinations;m.assert(x,q+".indexOf("+X+'+", "+'+j+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var me=x.def(C,"[",X,"]"),Ye=x.def(C,"[",D("src","Alpha"),"]"),Ne=x.def(C,"[",j,"]"),Re=x.def(C,"[",D("dst","Alpha"),"]");return[me,Ne,Ye,Re]});case Va:return R(function(m){if(typeof m=="string")return l.commandParameter(m,$,"invalid "+g,s.commandStr),[$[m],$[m]];if(typeof m=="object")return l.commandParameter(m.rgb,$,g+".rgb",s.commandStr),l.commandParameter(m.alpha,$,g+".alpha",s.commandStr),[$[m.rgb],$[m.alpha]];l.commandRaise("invalid blend.equation",s.commandStr)},function(m,x,_){var C=m.constants.blendEquations,D=x.def(),X=x.def(),j=m.cond("typeof ",_,'==="string"');return l.optional(function(){function me(Ye,Ne,Re){m.assert(Ye,Re+" in "+C,"invalid "+Ne+", must be one of "+Object.keys($))}me(j.then,g,_),m.assert(j.else,_+"&&typeof "+_+'==="object"',"invalid "+g),me(j.else,g+".rgb",_+".rgb"),me(j.else,g+".alpha",_+".alpha")}),j.then(D,"=",X,"=",C,"[",_,"];"),j.else(D,"=",C,"[",_,".rgb];",X,"=",C,"[",_,".alpha];"),x(j),[D,X]});case tl:return R(function(m){return l.command(Vt(m)&&m.length===4,"blend.color must be a 4d array",s.commandStr),ot(4,function(x){return+m[x]})},function(m,x,_){return l.optional(function(){m.assert(x,m.shared.isArrayLike+"("+_+")&&"+_+".length===4","blend.color must be a 4d array")}),ot(4,function(C){return x.def("+",_,"[",C,"]")})});case dl:return R(function(m){return l.commandType(m,"number",A,s.commandStr),m|0},function(m,x,_){return l.optional(function(){m.assert(x,"typeof "+_+'==="number"',"invalid stencil.mask")}),x.def(_,"|0")});case Ka:return R(function(m){l.commandType(m,"object",A,s.commandStr);var x=m.cmp||"keep",_=m.ref||0,C="mask"in m?m.mask:-1;return l.commandParameter(x,Ei,g+".cmp",s.commandStr),l.commandType(_,"number",g+".ref",s.commandStr),l.commandType(C,"number",g+".mask",s.commandStr),[Ei[x],_,C]},function(m,x,_){var C=m.constants.compareFuncs;l.optional(function(){function me(){m.assert(x,Array.prototype.join.call(arguments,""),"invalid stencil.func")}me(_+"&&typeof ",_,'==="object"'),me('!("cmp" in ',_,")||(",_,".cmp in ",C,")")});var D=x.def('"cmp" in ',_,"?",C,"[",_,".cmp]",":",Rn),X=x.def(_,".ref|0"),j=x.def('"mask" in ',_,"?",_,".mask|0:-1");return[D,X,j]});case Za:case Ni:return R(function(m){l.commandType(m,"object",A,s.commandStr);var x=m.fail||"keep",_=m.zfail||"keep",C=m.zpass||"keep";return l.commandParameter(x,Ln,g+".fail",s.commandStr),l.commandParameter(_,Ln,g+".zfail",s.commandStr),l.commandParameter(C,Ln,g+".zpass",s.commandStr),[g===Ni?Wn:Yi,Ln[x],Ln[_],Ln[C]]},function(m,x,_){var C=m.constants.stencilOps;l.optional(function(){m.assert(x,_+"&&typeof "+_+'==="object"',"invalid "+g)});function D(X){return l.optional(function(){m.assert(x,'!("'+X+'" in '+_+")||("+_+"."+X+" in "+C+")","invalid "+g+"."+X+", must be one of "+Object.keys(Ln))}),x.def('"',X,'" in ',_,"?",C,"[",_,".",X,"]:",Rn)}return[g===Ni?Wn:Yi,D("fail"),D("zfail"),D("zpass")]});case qa:return R(function(m){l.commandType(m,"object",A,s.commandStr);var x=m.factor|0,_=m.units|0;return l.commandType(x,"number",A+".factor",s.commandStr),l.commandType(_,"number",A+".units",s.commandStr),[x,_]},function(m,x,_){l.optional(function(){m.assert(x,_+"&&typeof "+_+'==="object"',"invalid "+g)});var C=x.def(_,".factor|0"),D=x.def(_,".units|0");return[C,D]});case sl:return R(function(m){var x=0;return m==="front"?x=Yi:m==="back"&&(x=Wn),l.command(!!x,A,s.commandStr),x},function(m,x,_){return l.optional(function(){m.assert(x,_+'==="front"||'+_+'==="back"',"invalid cull.face")}),x.def(_,'==="front"?',Yi,":",Wn)});case ja:return R(function(m){return l.command(typeof m=="number"&&m>=N.lineWidthDims[0]&&m<=N.lineWidthDims[1],"invalid line width, must be a positive number between "+N.lineWidthDims[0]+" and "+N.lineWidthDims[1],s.commandStr),m},function(m,x,_){return l.optional(function(){m.assert(x,"typeof "+_+'==="number"&&'+_+">="+N.lineWidthDims[0]+"&&"+_+"<="+N.lineWidthDims[1],"invalid line width")}),_});case Ya:return R(function(m){return l.commandParameter(m,ss,A,s.commandStr),ss[m]},function(m,x,_){return l.optional(function(){m.assert(x,_+'==="cw"||'+_+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),x.def(_+'==="cw"?'+bl+":"+as)});case Wa:return R(function(m){return l.command(Vt(m)&&m.length===4,"color.mask must be length 4 array",s.commandStr),m.map(function(x){return!!x})},function(m,x,_){return l.optional(function(){m.assert(x,m.shared.isArrayLike+"("+_+")&&"+_+".length===4","invalid color.mask")}),ot(4,function(C){return"!!"+_+"["+C+"]"})});case Qa:return R(function(m){l.command(typeof m=="object"&&m,A,s.commandStr);var x="value"in m?m.value:1,_=!!m.invert;return l.command(typeof x=="number"&&x>=0&&x<=1,"sample.coverage.value must be a number between 0 and 1",s.commandStr),[x,_]},function(m,x,_){l.optional(function(){m.assert(x,_+"&&typeof "+_+'==="object"',"invalid sample.coverage")});var C=x.def('"value" in ',_,"?+",_,".value:1"),D=x.def("!!",_,".invert");return[C,D]})}}),F}function Tt(d,s){var E=d.static,L=d.dynamic,F={};return Object.keys(E).forEach(function(g){var A=E[g],R;if(typeof A=="number"||typeof A=="boolean")R=rr(function(){return A});else if(typeof A=="function"){var m=A._reglType;m==="texture2d"||m==="textureCube"?R=rr(function(x){return x.link(A)}):m==="framebuffer"||m==="framebufferCube"?(l.command(A.color.length>0,'missing color attachment for framebuffer sent to uniform "'+g+'"',s.commandStr),R=rr(function(x){return x.link(A.color[0])})):l.commandRaise('invalid data for uniform "'+g+'"',s.commandStr)}else Vt(A)?R=rr(function(x){var _=x.global.def("[",ot(A.length,function(C){return l.command(typeof A[C]=="number"||typeof A[C]=="boolean","invalid uniform "+g,x.commandStr),A[C]}),"]");return _}):l.commandRaise('invalid or missing data for uniform "'+g+'"',s.commandStr);R.value=A,F[g]=R}),Object.keys(L).forEach(function(g){var A=L[g];F[g]=Ir(A,function(R,m){return R.invoke(m,A)})}),F}function lr(d,s){var E=d.static,L=d.dynamic,F={};return Object.keys(E).forEach(function(g){var A=E[g],R=c.id(g),m=new S;if(Ho(A))m.state=bi,m.buffer=W.getBuffer(W.create(A,yi,!1,!0)),m.type=0;else{var x=W.getBuffer(A);if(x)m.state=bi,m.buffer=x,m.type=0;else if(l.command(typeof A=="object"&&A,"invalid data for attribute "+g,s.commandStr),"constant"in A){var _=A.constant;m.buffer="null",m.state=Ma,typeof _=="number"?m.x=_:(l.command(Vt(_)&&_.length>0&&_.length<=4,"invalid constant for attribute "+g,s.commandStr),_i.forEach(function(Ne,Re){Re<_.length&&(m[Ne]=_[Re])}))}else{Ho(A.buffer)?x=W.getBuffer(W.create(A.buffer,yi,!1,!0)):x=W.getBuffer(A.buffer),l.command(!!x,'missing buffer for attribute "'+g+'"',s.commandStr);var C=A.offset|0;l.command(C>=0,'invalid offset for attribute "'+g+'"',s.commandStr);var D=A.stride|0;l.command(D>=0&&D<256,'invalid stride for attribute "'+g+'", must be integer betweeen [0, 255]',s.commandStr);var X=A.size|0;l.command(!("size"in A)||X>0&&X<=4,'invalid size for attribute "'+g+'", must be 1,2,3,4',s.commandStr);var j=!!A.normalized,me=0;"type"in A&&(l.commandParameter(A.type,Nn,"invalid type for attribute "+g,s.commandStr),me=Nn[A.type]);var Ye=A.divisor|0;l.optional(function(){"divisor"in A&&(l.command(Ye===0||se,'cannot specify divisor for attribute "'+g+'", instancing not supported',s.commandStr),l.command(Ye>=0,'invalid divisor for attribute "'+g+'"',s.commandStr));var Ne=s.commandStr,Re=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(A).forEach(function(q){l.command(Re.indexOf(q)>=0,'unknown parameter "'+q+'" for attribute pointer "'+g+'" (valid parameters are '+Re+")",Ne)})}),m.buffer=x,m.state=bi,m.size=X,m.normalized=j,m.type=me||x.dtype,m.offset=C,m.stride=D,m.divisor=Ye}}F[g]=rr(function(Ne,Re){var q=Ne.attribCache;if(R in q)return q[R];var z={isStream:!1};return Object.keys(m).forEach(function(Be){z[Be]=m[Be]}),m.buffer&&(z.buffer=Ne.link(m.buffer),z.type=z.type||z.buffer+".dtype"),q[R]=z,z})}),Object.keys(L).forEach(function(g){var A=L[g];function R(m,x){var _=m.invoke(x,A),C=m.shared,D=m.constants,X=C.isBufferArgs,j=C.buffer;l.optional(function(){m.assert(x,_+"&&(typeof "+_+'==="object"||typeof '+_+'==="function")&&('+X+"("+_+")||"+j+".getBuffer("+_+")||"+j+".getBuffer("+_+".buffer)||"+X+"("+_+'.buffer)||("constant" in '+_+"&&(typeof "+_+'.constant==="number"||'+C.isArrayLike+"("+_+".constant))))",'invalid dynamic attribute "'+g+'"')});var me={isStream:x.def(!1)},Ye=new S;Ye.state=bi,Object.keys(Ye).forEach(function(z){me[z]=x.def(""+Ye[z])});var Ne=me.buffer,Re=me.type;x("if(",X,"(",_,")){",me.isStream,"=true;",Ne,"=",j,".createStream(",yi,",",_,");",Re,"=",Ne,".dtype;","}else{",Ne,"=",j,".getBuffer(",_,");","if(",Ne,"){",Re,"=",Ne,".dtype;",'}else if("constant" in ',_,"){",me.state,"=",Ma,";","if(typeof "+_+'.constant === "number"){',me[_i[0]],"=",_,".constant;",_i.slice(1).map(function(z){return me[z]}).join("="),"=0;","}else{",_i.map(function(z,Be){return me[z]+"="+_+".constant.length>"+Be+"?"+_+".constant["+Be+"]:0;"}).join(""),"}}else{","if(",X,"(",_,".buffer)){",Ne,"=",j,".createStream(",yi,",",_,".buffer);","}else{",Ne,"=",j,".getBuffer(",_,".buffer);","}",Re,'="type" in ',_,"?",D.glTypes,"[",_,".type]:",Ne,".dtype;",me.normalized,"=!!",_,".normalized;");function q(z){x(me[z],"=",_,".",z,"|0;")}return q("size"),q("offset"),q("stride"),q("divisor"),x("}}"),x.exit("if(",me.isStream,"){",j,".destroyStream(",Ne,");","}"),me}F[g]=Ir(A,R)}),F}function Gt(d){var s=d.static,E=d.dynamic,L={};return Object.keys(s).forEach(function(F){var g=s[F];L[F]=rr(function(A,R){return typeof g=="number"||typeof g=="boolean"?""+g:A.link(g)})}),Object.keys(E).forEach(function(F){var g=E[F];L[F]=Ir(g,function(A,R){return A.invoke(R,g)})}),L}function nr(d,s,E,L,F){var g=d.static,A=d.dynamic;l.optional(function(){var q=[zn,Mi,$i,Xn,Vn,Bo,Hn,Io,Gi,ki].concat(Ge);function z(Be){Object.keys(Be).forEach(function(Ce){l.command(q.indexOf(Ce)>=0,'unknown parameter "'+Ce+'"',F.commandStr)})}z(g),z(A)});var R=et(d,s),m=ge(d),x=Xe(d,m,F),_=Ht(d,F),C=Qt(d,F),D=bt(d,F,R);function X(q){var z=x[q];z&&(C[q]=z)}X(dn),X(Pe(Uo));var j=Object.keys(C).length>0,me={framebuffer:m,draw:_,shader:D,state:C,dirty:j,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(me.profile=Ee(d),me.uniforms=Tt(E,F),me.drawVAO=me.scopeVAO=_.vao,!me.drawVAO&&D.program&&!R&&T.angle_instanced_arrays&&_.static.elements){var Ye=!0,Ne=D.program.attributes.map(function(q){var z=s.static[q];return Ye=Ye&&!!z,z});if(Ye&&Ne.length>0){var Re=le.getVAO(le.createVAO({attributes:Ne,elements:_.static.elements}));me.drawVAO=new hr(null,null,null,function(q,z){return q.link(Re)}),me.useVAO=!0}}return R?me.useVAO=!0:me.attributes=lr(s,F),me.context=Gt(L),me}function cr(d,s,E){var L=d.shared,F=L.context,g=d.scope();Object.keys(E).forEach(function(A){s.save(F,"."+A);var R=E[A],m=R.append(d,s);Array.isArray(m)?g(F,".",A,"=[",m.join(),"];"):g(F,".",A,"=",m,";")}),s(g)}function ur(d,s,E,L){var F=d.shared,g=F.gl,A=F.framebuffer,R;we&&(R=s.def(F.extensions,".webgl_draw_buffers"));var m=d.constants,x=m.drawBuffer,_=m.backBuffer,C;E?C=E.append(d,s):C=s.def(A,".next"),L||s("if(",C,"!==",A,".cur){"),s("if(",C,"){",g,".bindFramebuffer(",El,",",C,".framebuffer);"),we&&s(R,".drawBuffersWEBGL(",x,"[",C,".colorAttachments.length]);"),s("}else{",g,".bindFramebuffer(",El,",null);"),we&&s(R,".drawBuffersWEBGL(",_,");"),s("}",A,".cur=",C,";"),L||s("}")}function _r(d,s,E){var L=d.shared,F=L.gl,g=d.current,A=d.next,R=L.current,m=L.next,x=d.cond(R,".dirty");Ge.forEach(function(_){var C=Pe(_);if(!(C in E.state)){var D,X;if(C in A){D=A[C],X=g[C];var j=ot(Ae[C].length,function(Ye){return x.def(D,"[",Ye,"]")});x(d.cond(j.map(function(Ye,Ne){return Ye+"!=="+X+"["+Ne+"]"}).join("||")).then(F,".",H[C],"(",j,");",j.map(function(Ye,Ne){return X+"["+Ne+"]="+Ye}).join(";"),";"))}else{D=x.def(m,".",C);var me=d.cond(D,"!==",R,".",C);x(me),C in Y?me(d.cond(D).then(F,".enable(",Y[C],");").else(F,".disable(",Y[C],");"),R,".",C,"=",D,";"):me(F,".",H[C],"(",D,");",R,".",C,"=",D,";")}}}),Object.keys(E.state).length===0&&x(R,".dirty=false;"),s(x)}function yr(d,s,E,L){var F=d.shared,g=d.current,A=F.current,R=F.gl;wl(Object.keys(E)).forEach(function(m){var x=E[m];if(!(L&&!L(x))){var _=x.append(d,s);if(Y[m]){var C=Y[m];Sn(x)?_?s(R,".enable(",C,");"):s(R,".disable(",C,");"):s(d.cond(_).then(R,".enable(",C,");").else(R,".disable(",C,");")),s(A,".",m,"=",_,";")}else if(Vt(_)){var D=g[m];s(R,".",H[m],"(",_,");",_.map(function(X,j){return D+"["+j+"]="+X}).join(";"),";")}else s(R,".",H[m],"(",_,");",A,".",m,"=",_,";")}})}function Jt(d,s){se&&(d.instancing=s.def(d.shared.extensions,".angle_instanced_arrays"))}function lt(d,s,E,L,F){var g=d.shared,A=d.stats,R=g.current,m=g.timer,x=E.profile;function _(){return typeof performance>"u"?"Date.now()":"performance.now()"}var C,D;function X(q){C=s.def(),q(C,"=",_(),";"),typeof F=="string"?q(A,".count+=",F,";"):q(A,".count++;"),te&&(L?(D=s.def(),q(D,"=",m,".getNumPendingQueries();")):q(m,".beginQuery(",A,");"))}function j(q){q(A,".cpuTime+=",_(),"-",C,";"),te&&(L?q(m,".pushScopeStats(",D,",",m,".getNumPendingQueries(),",A,");"):q(m,".endQuery();"))}function me(q){var z=s.def(R,".profile");s(R,".profile=",q,";"),s.exit(R,".profile=",z,";")}var Ye;if(x){if(Sn(x)){x.enable?(X(s),j(s.exit),me("true")):me("false");return}Ye=x.append(d,s),me(Ye)}else Ye=s.def(R,".profile");var Ne=d.block();X(Ne),s("if(",Ye,"){",Ne,"}");var Re=d.block();j(Re),s.exit("if(",Ye,"){",Re,"}")}function Er(d,s,E,L,F){var g=d.shared;function A(m){switch(m){case Oo:case Mo:case zo:return 2;case No:case $o:case Xo:return 3;case Go:case ko:case Vo:return 4;default:return 1}}function R(m,x,_){var C=g.gl,D=s.def(m,".location"),X=s.def(g.attributes,"[",D,"]"),j=_.state,me=_.buffer,Ye=[_.x,_.y,_.z,_.w],Ne=["buffer","normalized","offset","stride"];function Re(){s("if(!",X,".buffer){",C,".enableVertexAttribArray(",D,");}");var z=_.type,Be;if(_.size?Be=s.def(_.size,"||",x):Be=x,s("if(",X,".type!==",z,"||",X,".size!==",Be,"||",Ne.map(function(Ve){return X+"."+Ve+"!=="+_[Ve]}).join("||"),"){",C,".bindBuffer(",yi,",",me,".buffer);",C,".vertexAttribPointer(",[D,Be,z,_.normalized,_.stride,_.offset],");",X,".type=",z,";",X,".size=",Be,";",Ne.map(function(Ve){return X+"."+Ve+"="+_[Ve]+";"}).join(""),"}"),se){var Ce=_.divisor;s("if(",X,".divisor!==",Ce,"){",d.instancing,".vertexAttribDivisorANGLE(",[D,Ce],");",X,".divisor=",Ce,";}")}}function q(){s("if(",X,".buffer){",C,".disableVertexAttribArray(",D,");",X,".buffer=null;","}if(",_i.map(function(z,Be){return X+"."+z+"!=="+Ye[Be]}).join("||"),"){",C,".vertexAttrib4f(",D,",",Ye,");",_i.map(function(z,Be){return X+"."+z+"="+Ye[Be]+";"}).join(""),"}")}j===bi?Re():j===Ma?q():(s("if(",j,"===",bi,"){"),Re(),s("}else{"),q(),s("}"))}L.forEach(function(m){var x=m.name,_=E.attributes[x],C;if(_){if(!F(_))return;C=_.append(d,s)}else{if(!F(Rl))return;var D=d.scopeAttrib(x);l.optional(function(){d.assert(s,D+".state","missing attribute "+x)}),C={},Object.keys(new S).forEach(function(X){C[X]=s.def(D,".",X)})}R(d.link(m),A(m.info.type),C)})}function Ct(d,s,E,L,F,g){for(var A=d.shared,R=A.gl,m={},x,_=0;_<L.length;++_){var C=L[_],D=C.name,X=C.info.type,j=C.info.size,me=E.uniforms[D];if(j>1){if(!me)continue;var Ye=D.replace("[0]","");if(m[Ye])continue;m[Ye]=1}var Ne=d.link(C),Re=Ne+".location",q;if(me){if(!F(me))continue;if(Sn(me)){var z=me.value;if(l.command(z!==null&&typeof z<"u",'missing uniform "'+D+'"',d.commandStr),X===Hi||X===Wi){l.command(typeof z=="function"&&(X===Hi&&(z._reglType==="texture2d"||z._reglType==="framebuffer")||X===Wi&&(z._reglType==="textureCube"||z._reglType==="framebufferCube")),"invalid texture for uniform "+D,d.commandStr);var Be=d.link(z._texture||z.color[0]._texture);s(R,".uniform1i(",Re,",",Be+".bind());"),s.exit(Be,".unbind();")}else if(X===zi||X===Xi||X===Vi){l.optional(function(){l.command(Vt(z),"invalid matrix for uniform "+D,d.commandStr),l.command(X===zi&&z.length===4||X===Xi&&z.length===9||X===Vi&&z.length===16,"invalid length for matrix uniform "+D,d.commandStr)});var Ce=d.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])"),Ve=2;X===Xi?Ve=3:X===Vi&&(Ve=4),s(R,".uniformMatrix",Ve,"fv(",Re,",false,",Ce,");")}else{switch(X){case rs:j===1?l.commandType(z,"number","uniform "+D,d.commandStr):l.command(Vt(z)&&z.length===j,"uniform "+D,d.commandStr),x="1f";break;case Oo:l.command(Vt(z)&&z.length&&z.length%2===0&&z.length<=j*2,"uniform "+D,d.commandStr),x="2f";break;case No:l.command(Vt(z)&&z.length&&z.length%3===0&&z.length<=j*3,"uniform "+D,d.commandStr),x="3f";break;case Go:l.command(Vt(z)&&z.length&&z.length%4===0&&z.length<=j*4,"uniform "+D,d.commandStr),x="4f";break;case is:j===1?l.commandType(z,"boolean","uniform "+D,d.commandStr):l.command(Vt(z)&&z.length===j,"uniform "+D,d.commandStr),x="1i";break;case ns:j===1?l.commandType(z,"number","uniform "+D,d.commandStr):l.command(Vt(z)&&z.length===j,"uniform "+D,d.commandStr),x="1i";break;case zo:l.command(Vt(z)&&z.length&&z.length%2===0&&z.length<=j*2,"uniform "+D,d.commandStr),x="2i";break;case Mo:l.command(Vt(z)&&z.length&&z.length%2===0&&z.length<=j*2,"uniform "+D,d.commandStr),x="2i";break;case Xo:l.command(Vt(z)&&z.length&&z.length%3===0&&z.length<=j*3,"uniform "+D,d.commandStr),x="3i";break;case $o:l.command(Vt(z)&&z.length&&z.length%3===0&&z.length<=j*3,"uniform "+D,d.commandStr),x="3i";break;case Vo:l.command(Vt(z)&&z.length&&z.length%4===0&&z.length<=j*4,"uniform "+D,d.commandStr),x="4i";break;case ko:l.command(Vt(z)&&z.length&&z.length%4===0&&z.length<=j*4,"uniform "+D,d.commandStr),x="4i";break}j>1?(x+="v",z=d.global.def("["+Array.prototype.slice.call(z)+"]")):z=Vt(z)?Array.prototype.slice.call(z):z,s(R,".uniform",x,"(",Re,",",z,");")}continue}else q=me.append(d,s)}else{if(!F(Rl))continue;q=s.def(A.uniforms,"[",c.id(D),"]")}X===Hi?(l(!Array.isArray(q),"must specify a scalar prop for textures"),s("if(",q,"&&",q,'._reglType==="framebuffer"){',q,"=",q,".color[0];","}")):X===Wi&&(l(!Array.isArray(q),"must specify a scalar prop for cube maps"),s("if(",q,"&&",q,'._reglType==="framebufferCube"){',q,"=",q,".color[0];","}")),l.optional(function(){function $r(Or,Wo){d.assert(s,Or,'bad data or missing for uniform "'+D+'".  '+Wo)}function Qn(Or,Wo){Wo===1&&l(!Array.isArray(q),"must not specify an array type for uniform"),$r("Array.isArray("+q+") && typeof "+q+'[0]===" '+Or+'" || typeof '+q+'==="'+Or+'"',"invalid type, expected "+Or)}function Xr(Or,Wo,Yo){Array.isArray(q)?l(q.length&&q.length%Or===0&&q.length<=Or*Yo,"must have length of "+(Yo===1?"":"n * ")+Or):$r(A.isArrayLike+"("+q+")&&"+q+".length && "+q+".length % "+Or+" === 0 && "+q+".length<="+Or*Yo,"invalid vector, should have length of "+(Yo===1?"":"n * ")+Or,d.commandStr)}function Ul(Or){l(!Array.isArray(q),"must not specify a value type"),$r("typeof "+q+'==="function"&&'+q+'._reglType==="texture'+(Or===_l?"2d":"Cube")+'"',"invalid texture type",d.commandStr)}switch(X){case ns:Qn("number",j);break;case Mo:Xr(2,"number",j);break;case $o:Xr(3,"number",j);break;case ko:Xr(4,"number",j);break;case rs:Qn("number",j);break;case Oo:Xr(2,"number",j);break;case No:Xr(3,"number",j);break;case Go:Xr(4,"number",j);break;case is:Qn("boolean",j);break;case zo:Xr(2,"boolean",j);break;case Xo:Xr(3,"boolean",j);break;case Vo:Xr(4,"boolean",j);break;case zi:Xr(4,"number",j);break;case Xi:Xr(9,"number",j);break;case Vi:Xr(16,"number",j);break;case Hi:Ul(_l);break;case Wi:Ul(Sd);break}});var It=1;switch(X){case Hi:case Wi:var Ar=s.def(q,"._texture");s(R,".uniform1i(",Re,",",Ar,".bind());"),s.exit(Ar,".unbind();");continue;case ns:case is:x="1i";break;case Mo:case zo:x="2i",It=2;break;case $o:case Xo:x="3i",It=3;break;case ko:case Vo:x="4i",It=4;break;case rs:x="1f";break;case Oo:x="2f",It=2;break;case No:x="3f",It=3;break;case Go:x="4f",It=4;break;case zi:x="Matrix2fv";break;case Xi:x="Matrix3fv";break;case Vi:x="Matrix4fv";break}if(x.indexOf("Matrix")===-1&&j>1&&(x+="v",It=1),x.charAt(0)==="M"){s(R,".uniform",x,"(",Re,",");var jn=Math.pow(X-zi+2,2),mn=d.global.def("new Float32Array(",jn,")");Array.isArray(q)?s("false,(",ot(jn,function($r){return mn+"["+$r+"]="+q[$r]}),",",mn,")"):s("false,(Array.isArray(",q,")||",q," instanceof Float32Array)?",q,":(",ot(jn,function($r){return mn+"["+$r+"]="+q+"["+$r+"]"}),",",mn,")"),s(");")}else if(It>1){for(var fn=[],Fn=[],qn=0;qn<It;++qn)Array.isArray(q)?Fn.push(q[qn]):Fn.push(s.def(q+"["+qn+"]")),g&&fn.push(s.def());g&&s("if(!",d.batchId,"||",fn.map(function($r,Qn){return $r+"!=="+Fn[Qn]}).join("||"),"){",fn.map(function($r,Qn){return $r+"="+Fn[Qn]+";"}).join("")),s(R,".uniform",x,"(",Re,",",Fn.join(","),");"),g&&s("}")}else{if(l(!Array.isArray(q),"uniform value must not be an array"),g){var Cl=s.def();s("if(!",d.batchId,"||",Cl,"!==",q,"){",Cl,"=",q,";")}s(R,".uniform",x,"(",Re,",",q,");"),g&&s("}")}}}function $e(d,s,E,L){var F=d.shared,g=F.gl,A=F.draw,R=L.draw;function m(){var Be=R.elements,Ce,Ve=s;return Be?((Be.contextDep&&L.contextDynamic||Be.propDep)&&(Ve=E),Ce=Be.append(d,Ve),R.elementsActive&&Ve("if("+Ce+")"+g+".bindBuffer("+ts+","+Ce+".buffer.buffer);")):(Ce=Ve.def(),Ve(Ce,"=",A,".",Xn,";","if(",Ce,"){",g,".bindBuffer(",ts,",",Ce,".buffer.buffer);}","else if(",F.vao,".currentVAO){",Ce,"=",d.shared.elements+".getElements("+F.vao,".currentVAO.elements);",Q?"":"if("+Ce+")"+g+".bindBuffer("+ts+","+Ce+".buffer.buffer);","}")),Ce}function x(){var Be=R.count,Ce,Ve=s;return Be?((Be.contextDep&&L.contextDynamic||Be.propDep)&&(Ve=E),Ce=Be.append(d,Ve),l.optional(function(){Be.MISSING&&d.assert(s,"false","missing vertex count"),Be.DYNAMIC&&d.assert(Ve,Ce+">=0","missing vertex count")})):(Ce=Ve.def(A,".",Hn),l.optional(function(){d.assert(Ve,Ce+">=0","missing vertex count")})),Ce}var _=m();function C(Be){var Ce=R[Be];return Ce?Ce.contextDep&&L.contextDynamic||Ce.propDep?Ce.append(d,E):Ce.append(d,s):s.def(A,".",Be)}var D=C(Vn),X=C(Bo),j=x();if(typeof j=="number"){if(j===0)return}else E("if(",j,"){"),E.exit("}");var me,Ye;se&&(me=C(Io),Ye=d.instancing);var Ne=_+".type",Re=R.elements&&Sn(R.elements)&&!R.vaoActive;function q(){function Be(){E(Ye,".drawElementsInstancedANGLE(",[D,j,Ne,X+"<<(("+Ne+"-"+Qf+")>>1)",me],");")}function Ce(){E(Ye,".drawArraysInstancedANGLE(",[D,X,j,me],");")}_&&_!=="null"?Re?Be():(E("if(",_,"){"),Be(),E("}else{"),Ce(),E("}")):Ce()}function z(){function Be(){E(g+".drawElements("+[D,j,Ne,X+"<<(("+Ne+"-"+Qf+")>>1)"]+");")}function Ce(){E(g+".drawArrays("+[D,X,j]+");")}_&&_!=="null"?Re?Be():(E("if(",_,"){"),Be(),E("}else{"),Ce(),E("}")):Ce()}se&&(typeof me!="number"||me>=0)?typeof me=="string"?(E("if(",me,">0){"),q(),E("}else if(",me,"<0){"),z(),E("}")):q():z()}function xt(d,s,E,L,F){var g=Ze(),A=g.proc("body",F);return l.optional(function(){g.commandStr=s.commandStr,g.command=g.link(s.commandStr)}),se&&(g.instancing=A.def(g.shared.extensions,".angle_instanced_arrays")),d(g,A,E,L),g.compile().body}function wt(d,s,E,L){Jt(d,s),E.useVAO?E.drawVAO?s(d.shared.vao,".setVAO(",E.drawVAO.append(d,s),");"):s(d.shared.vao,".setVAO(",d.shared.vao,".targetVAO);"):(s(d.shared.vao,".setVAO(null);"),Er(d,s,E,L.attributes,function(){return!0})),Ct(d,s,E,L.uniforms,function(){return!0},!1),$e(d,s,s,E)}function er(d,s){var E=d.proc("draw",1);Jt(d,E),cr(d,E,s.context),ur(d,E,s.framebuffer),_r(d,E,s),yr(d,E,s.state),lt(d,E,s,!1,!0);var L=s.shader.progVar.append(d,E);if(E(d.shared.gl,".useProgram(",L,".program);"),s.shader.program)wt(d,E,s,s.shader.program);else{E(d.shared.vao,".setVAO(null);");var F=d.global.def("{}"),g=E.def(L,".id"),A=E.def(F,"[",g,"]");E(d.cond(A).then(A,".call(this,a0);").else(A,"=",F,"[",g,"]=",d.link(function(R){return xt(wt,d,s,R,1)}),"(",L,");",A,".call(this,a0);"))}Object.keys(s.state).length>0&&E(d.shared.current,".dirty=true;"),d.shared.vao&&E(d.shared.vao,".setVAO(null);")}function sn(d,s,E,L){d.batchId="a1",Jt(d,s);function F(){return!0}Er(d,s,E,L.attributes,F),Ct(d,s,E,L.uniforms,F,!1),$e(d,s,s,E)}function Yn(d,s,E,L){Jt(d,s);var F=E.contextDep,g=s.def(),A="a0",R="a1",m=s.def();d.shared.props=m,d.batchId=g;var x=d.scope(),_=d.scope();s(x.entry,"for(",g,"=0;",g,"<",R,";++",g,"){",m,"=",A,"[",g,"];",_,"}",x.exit);function C(Ne){return Ne.contextDep&&F||Ne.propDep}function D(Ne){return!C(Ne)}if(E.needsContext&&cr(d,_,E.context),E.needsFramebuffer&&ur(d,_,E.framebuffer),yr(d,_,E.state,C),E.profile&&C(E.profile)&&lt(d,_,E,!1,!0),L)E.useVAO?E.drawVAO?C(E.drawVAO)?_(d.shared.vao,".setVAO(",E.drawVAO.append(d,_),");"):x(d.shared.vao,".setVAO(",E.drawVAO.append(d,x),");"):x(d.shared.vao,".setVAO(",d.shared.vao,".targetVAO);"):(x(d.shared.vao,".setVAO(null);"),Er(d,x,E,L.attributes,D),Er(d,_,E,L.attributes,C)),Ct(d,x,E,L.uniforms,D,!1),Ct(d,_,E,L.uniforms,C,!0),$e(d,x,_,E);else{var X=d.global.def("{}"),j=E.shader.progVar.append(d,_),me=_.def(j,".id"),Ye=_.def(X,"[",me,"]");_(d.shared.gl,".useProgram(",j,".program);","if(!",Ye,"){",Ye,"=",X,"[",me,"]=",d.link(function(Ne){return xt(sn,d,E,Ne,2)}),"(",j,");}",Ye,".call(this,a0[",g,"],",g,");")}}function b(d,s){var E=d.proc("batch",2);d.batchId="0",Jt(d,E);var L=!1,F=!0;Object.keys(s.context).forEach(function(X){L=L||s.context[X].propDep}),L||(cr(d,E,s.context),F=!1);var g=s.framebuffer,A=!1;g?(g.propDep?L=A=!0:g.contextDep&&L&&(A=!0),A||ur(d,E,g)):ur(d,E,null),s.state.viewport&&s.state.viewport.propDep&&(L=!0);function R(X){return X.contextDep&&L||X.propDep}_r(d,E,s),yr(d,E,s.state,function(X){return!R(X)}),(!s.profile||!R(s.profile))&&lt(d,E,s,!1,"a1"),s.contextDep=L,s.needsContext=F,s.needsFramebuffer=A;var m=s.shader.progVar;if(m.contextDep&&L||m.propDep)Yn(d,E,s,null);else{var x=m.append(d,E);if(E(d.shared.gl,".useProgram(",x,".program);"),s.shader.program)Yn(d,E,s,s.shader.program);else{E(d.shared.vao,".setVAO(null);");var _=d.global.def("{}"),C=E.def(x,".id"),D=E.def(_,"[",C,"]");E(d.cond(D).then(D,".call(this,a0,a1);").else(D,"=",_,"[",C,"]=",d.link(function(X){return xt(Yn,d,s,X,2)}),"(",x,");",D,".call(this,a0,a1);"))}}Object.keys(s.state).length>0&&E(d.shared.current,".dirty=true;"),d.shared.vao&&E(d.shared.vao,".setVAO(null);")}function G(d,s){var E=d.proc("scope",3);d.batchId="a2";var L=d.shared,F=L.current;cr(d,E,s.context),s.framebuffer&&s.framebuffer.append(d,E),wl(Object.keys(s.state)).forEach(function(A){var R=s.state[A],m=R.append(d,E);Vt(m)?m.forEach(function(x,_){E.set(d.next[A],"["+_+"]",x)}):E.set(L.next,"."+A,m)}),lt(d,E,s,!0,!0),[Xn,Bo,Hn,Io,Vn].forEach(function(A){var R=s.draw[A];R&&E.set(L.draw,"."+A,""+R.append(d,E))}),Object.keys(s.uniforms).forEach(function(A){var R=s.uniforms[A].append(d,E);Array.isArray(R)&&(R="["+R.join()+"]"),E.set(L.uniforms,"["+c.id(A)+"]",R)}),Object.keys(s.attributes).forEach(function(A){var R=s.attributes[A].append(d,E),m=d.scopeAttrib(A);Object.keys(new S).forEach(function(x){E.set(m,"."+x,R[x])})}),s.scopeVAO&&E.set(L.vao,".targetVAO",s.scopeVAO.append(d,E));function g(A){var R=s.shader[A];R&&E.set(L.shader,"."+A,R.append(d,E))}g(Mi),g($i),Object.keys(s.state).length>0&&(E(F,".dirty=true;"),E.exit(F,".dirty=true;")),E("a1(",d.shared.context,",a0,",d.batchId,");")}function U(d){if(!(typeof d!="object"||Vt(d))){for(var s=Object.keys(d),E=0;E<s.length;++E)if(Mt.isDynamic(d[s[E]]))return!0;return!1}}function Se(d,s,E){var L=s.static[E];if(!L||!U(L))return;var F=d.global,g=Object.keys(L),A=!1,R=!1,m=!1,x=d.global.def("{}");g.forEach(function(C){var D=L[C];if(Mt.isDynamic(D)){typeof D=="function"&&(D=L[C]=Mt.unbox(D));var X=Ir(D,null);A=A||X.thisDep,m=m||X.propDep,R=R||X.contextDep}else{switch(F(x,".",C,"="),typeof D){case"number":F(D);break;case"string":F('"',D,'"');break;case"object":Array.isArray(D)&&F("[",D.join(),"]");break;default:F(d.link(D));break}F(";")}});function _(C,D){g.forEach(function(X){var j=L[X];if(Mt.isDynamic(j)){var me=C.invoke(D,j);D(x,".",X,"=",me,";")}})}s.dynamic[E]=new Mt.DynamicVariable(Co,{thisDep:A,contextDep:R,propDep:m,ref:x,append:_}),delete s.static[E]}function vt(d,s,E,L,F){var g=Ze();g.stats=g.link(F),Object.keys(s.static).forEach(function(R){Se(g,s,R)}),wd.forEach(function(R){Se(g,d,R)});var A=nr(d,s,E,L,g);return er(g,A),G(g,A),b(g,A),n(g.compile(),{destroy:function(){A.shader.program.destroy()}})}return{next:ye,current:Ae,procs:function(){var d=Ze(),s=d.proc("poll"),E=d.proc("refresh"),L=d.block();s(L),E(L);var F=d.shared,g=F.gl,A=F.next,R=F.current;L(R,".dirty=false;"),ur(d,s),ur(d,E,null,!0);var m;se&&(m=d.link(se)),T.oes_vertex_array_object&&E(d.link(T.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var x=0;x<N.maxAttributes;++x){var _=E.def(F.attributes,"[",x,"]"),C=d.cond(_,".buffer");C.then(g,".enableVertexAttribArray(",x,");",g,".bindBuffer(",yi,",",_,".buffer.buffer);",g,".vertexAttribPointer(",x,",",_,".size,",_,".type,",_,".normalized,",_,".stride,",_,".offset);").else(g,".disableVertexAttribArray(",x,");",g,".vertexAttrib4f(",x,",",_,".x,",_,".y,",_,".z,",_,".w);",_,".buffer=null;"),E(C),se&&E(m,".vertexAttribDivisorANGLE(",x,",",_,".divisor);")}return E(d.shared.vao,".currentVAO=null;",d.shared.vao,".setVAO(",d.shared.vao,".targetVAO);"),Object.keys(Y).forEach(function(D){var X=Y[D],j=L.def(A,".",D),me=d.block();me("if(",j,"){",g,".enable(",X,")}else{",g,".disable(",X,")}",R,".",D,"=",j,";"),E(me),s("if(",j,"!==",R,".",D,"){",me,"}")}),Object.keys(H).forEach(function(D){var X=H[D],j=Ae[D],me,Ye,Ne=d.block();if(Ne(g,".",X,"("),Vt(j)){var Re=j.length;me=d.global.def(A,".",D),Ye=d.global.def(R,".",D),Ne(ot(Re,function(q){return me+"["+q+"]"}),");",ot(Re,function(q){return Ye+"["+q+"]="+me+"["+q+"];"}).join("")),s("if(",ot(Re,function(q){return me+"["+q+"]!=="+Ye+"["+q+"]"}).join("||"),"){",Ne,"}")}else me=L.def(A,".",D),Ye=L.def(R,".",D),Ne(me,");",R,".",D,"=",me,";"),s("if(",me,"!==",Ye,"){",Ne,"}");E(Ne)}),d.compile()}(),compile:vt}}function Vd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hd=34918,Wd=34919,Ll=35007,Yd=function(r,c){if(!c.ext_disjoint_timer_query)return null;var T=[];function N(){return T.pop()||c.ext_disjoint_timer_query.createQueryEXT()}function W(se){T.push(se)}var O=[];function k(se){var we=N();c.ext_disjoint_timer_query.beginQueryEXT(Ll,we),O.push(we),te(O.length-1,O.length,se)}function ee(){c.ext_disjoint_timer_query.endQueryEXT(Ll)}function J(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var le=[];function ue(){return le.pop()||new J}function ce(se){le.push(se)}var pe=[];function te(se,we,Q){var Ae=ue();Ae.startQueryIndex=se,Ae.endQueryIndex=we,Ae.sum=0,Ae.stats=Q,pe.push(Ae)}var fe=[],S=[];function $(){var se,we,Q=O.length;if(Q!==0){S.length=Math.max(S.length,Q+1),fe.length=Math.max(fe.length,Q+1),fe[0]=0,S[0]=0;var Ae=0;for(se=0,we=0;we<O.length;++we){var ye=O[we];c.ext_disjoint_timer_query.getQueryObjectEXT(ye,Wd)?(Ae+=c.ext_disjoint_timer_query.getQueryObjectEXT(ye,Hd),W(ye)):O[se++]=ye,fe[we+1]=Ae,S[we+1]=se}for(O.length=se,se=0,we=0;we<pe.length;++we){var Ge=pe[we],Y=Ge.startQueryIndex,H=Ge.endQueryIndex;Ge.sum+=fe[H]-fe[Y];var Pe=S[Y],ve=S[H];ve===Pe?(Ge.stats.gpuTime+=Ge.sum/1e6,ce(Ge)):(Ge.startQueryIndex=Pe,Ge.endQueryIndex=ve,pe[se++]=Ge)}pe.length=se}}return{beginQuery:k,endQuery:ee,pushScopeStats:te,update:$,getNumPendingQueries:function(){return O.length},clear:function(){T.push.apply(T,O);for(var se=0;se<T.length;se++)c.ext_disjoint_timer_query.deleteQueryEXT(T[se]);O.length=0,T.length=0},restore:function(){O.length=0,T.length=0}}},jd=16384,qd=256,Qd=1024,Kd=34962,Sl="webglcontextlost",Fl="webglcontextrestored",Dl=1,Zd=2,Jd=3;function Pl(r,c){for(var T=0;T<r.length;++T)if(r[T]===c)return T;return-1}function em(r){var c=Gr(r);if(!c)return null;var T=c.gl,N=T.getContextAttributes(),W=T.isContextLost(),O=Ke(T,c);if(!O)return null;var k=jr(),ee=Vd(),J=O.extensions,le=Yd(T,J),ue=Nr(),ce=T.drawingBufferWidth,pe=T.drawingBufferHeight,te={tick:0,time:0,viewportWidth:ce,viewportHeight:pe,framebufferWidth:ce,framebufferHeight:pe,drawingBufferWidth:ce,drawingBufferHeight:pe,pixelRatio:c.pixelRatio},fe={},S={elements:null,primitive:4,count:-1,offset:0,instances:-1},$=$c(T,J),se=ru(T,ee,c,Ae),we=hu(T,J,se,ee),Q=hd(T,J,$,ee,se,we,S);function Ae($e){return Q.destroyBuffer($e)}var ye=bd(T,k,ee,c),Ge=Hu(T,J,$,function(){Pe.procs.poll()},te,ee,c),Y=Wu(T,J,$,ee,c),H=dd(T,J,$,Ge,Y,ee),Pe=Xd(T,k,J,$,se,we,Ge,H,fe,Q,ye,S,te,le,c),ve=yd(T,H,Pe.procs.poll,te,N,J,$),ae=Pe.next,_e=T.canvas,Te=[],Je=[],Ze=[],Ee=[c.onDestroy],ge=null;function Xe(){if(Te.length===0){le&&le.update(),ge=null;return}ge=wr.next(Xe),yr();for(var $e=Te.length-1;$e>=0;--$e){var xt=Te[$e];xt&&xt(te,null,0)}T.flush(),le&&le.update()}function et(){!ge&&Te.length>0&&(ge=wr.next(Xe))}function bt(){ge&&(wr.cancel(Xe),ge=null)}function Ht($e){$e.preventDefault(),W=!0,bt(),Je.forEach(function(xt){xt()})}function Qt($e){T.getError(),W=!1,O.restore(),ye.restore(),se.restore(),Ge.restore(),Y.restore(),H.restore(),Q.restore(),le&&le.restore(),Pe.procs.refresh(),et(),Ze.forEach(function(xt){xt()})}_e&&(_e.addEventListener(Sl,Ht,!1),_e.addEventListener(Fl,Qt,!1));function Tt(){Te.length=0,bt(),_e&&(_e.removeEventListener(Sl,Ht),_e.removeEventListener(Fl,Qt)),ye.clear(),H.clear(),Y.clear(),Q.clear(),Ge.clear(),we.clear(),se.clear(),le&&le.clear(),Ee.forEach(function($e){$e()})}function lr($e){l(!!$e,"invalid args to regl({...})"),l.type($e,"object","invalid args to regl({...})");function xt(F){var g=n({},F);delete g.uniforms,delete g.attributes,delete g.context,delete g.vao,"stencil"in g&&g.stencil.op&&(g.stencil.opBack=g.stencil.opFront=g.stencil.op,delete g.stencil.op);function A(R){if(R in g){var m=g[R];delete g[R],Object.keys(m).forEach(function(x){g[R+"."+x]=m[x]})}}return A("blend"),A("depth"),A("cull"),A("stencil"),A("polygonOffset"),A("scissor"),A("sample"),"vao"in F&&(g.vao=F.vao),g}function wt(F,g){var A={},R={};return Object.keys(F).forEach(function(m){var x=F[m];if(Mt.isDynamic(x)){R[m]=Mt.unbox(x,m);return}else if(g&&Array.isArray(x)){for(var _=0;_<x.length;++_)if(Mt.isDynamic(x[_])){R[m]=Mt.unbox(x,m);return}}A[m]=x}),{dynamic:R,static:A}}var er=wt($e.context||{},!0),sn=wt($e.uniforms||{},!0),Yn=wt($e.attributes||{},!1),b=wt(xt($e),!1),G={gpuTime:0,cpuTime:0,count:0},U=Pe.compile(b,Yn,sn,er,G),Se=U.draw,vt=U.batch,d=U.scope,s=[];function E(F){for(;s.length<F;)s.push(null);return s}function L(F,g){var A;if(W&&l.raise("context lost"),typeof F=="function")return d.call(this,null,F,0);if(typeof g=="function")if(typeof F=="number")for(A=0;A<F;++A)d.call(this,null,g,A);else if(Array.isArray(F))for(A=0;A<F.length;++A)d.call(this,F[A],g,A);else return d.call(this,F,g,0);else if(typeof F=="number"){if(F>0)return vt.call(this,E(F|0),F|0)}else if(Array.isArray(F)){if(F.length)return vt.call(this,F,F.length)}else return Se.call(this,F)}return n(L,{stats:G,destroy:function(){U.destroy()}})}var Gt=H.setFBO=lr({framebuffer:Mt.define.call(null,Dl,"framebuffer")});function nr($e,xt){var wt=0;Pe.procs.poll();var er=xt.color;er&&(T.clearColor(+er[0]||0,+er[1]||0,+er[2]||0,+er[3]||0),wt|=jd),"depth"in xt&&(T.clearDepth(+xt.depth),wt|=qd),"stencil"in xt&&(T.clearStencil(xt.stencil|0),wt|=Qd),l(!!wt,"called regl.clear with no buffer specified"),T.clear(wt)}function cr($e){if(l(typeof $e=="object"&&$e,"regl.clear() takes an object as input"),"framebuffer"in $e)if($e.framebuffer&&$e.framebuffer_reglType==="framebufferCube")for(var xt=0;xt<6;++xt)Gt(n({framebuffer:$e.framebuffer.faces[xt]},$e),nr);else Gt($e,nr);else nr(null,$e)}function ur($e){l.type($e,"function","regl.frame() callback must be a function"),Te.push($e);function xt(){var wt=Pl(Te,$e);l(wt>=0,"cannot cancel a frame twice");function er(){var sn=Pl(Te,er);Te[sn]=Te[Te.length-1],Te.length-=1,Te.length<=0&&bt()}Te[wt]=er}return et(),{cancel:xt}}function _r(){var $e=ae.viewport,xt=ae.scissor_box;$e[0]=$e[1]=xt[0]=xt[1]=0,te.viewportWidth=te.framebufferWidth=te.drawingBufferWidth=$e[2]=xt[2]=T.drawingBufferWidth,te.viewportHeight=te.framebufferHeight=te.drawingBufferHeight=$e[3]=xt[3]=T.drawingBufferHeight}function yr(){te.tick+=1,te.time=lt(),_r(),Pe.procs.poll()}function Jt(){Ge.refresh(),_r(),Pe.procs.refresh(),le&&le.update()}function lt(){return(Nr()-ue)/1e3}Jt();function Er($e,xt){l.type(xt,"function","listener callback must be a function");var wt;switch($e){case"frame":return ur(xt);case"lost":wt=Je;break;case"restore":wt=Ze;break;case"destroy":wt=Ee;break;default:l.raise("invalid event, must be one of frame,lost,restore,destroy")}return wt.push(xt),{cancel:function(){for(var er=0;er<wt.length;++er)if(wt[er]===xt){wt[er]=wt[wt.length-1],wt.pop();return}}}}var Ct=n(lr,{clear:cr,prop:Mt.define.bind(null,Dl),context:Mt.define.bind(null,Zd),this:Mt.define.bind(null,Jd),draw:lr({}),buffer:function($e){return se.create($e,Kd,!1,!1)},elements:function($e){return we.create($e,!1)},texture:Ge.create2D,cube:Ge.createCube,renderbuffer:Y.create,framebuffer:H.create,framebufferCube:H.createCube,vao:Q.createVAO,attributes:N,frame:ur,on:Er,limits:$,hasExtension:function($e){return $.extensions.indexOf($e.toLowerCase())>=0},read:ve,destroy:Tt,_gl:T,_refresh:Jt,poll:function(){yr(),le&&le.update()},now:lt,stats:ee});return c.onDone(null,Ct),Ct}return em})})(Mp);const $p=Ms;function kp(t){let e,i;return{c(){e=B("h1"),i=be("Coucou")},l(n){e=I(n,"H1",{});var o=V(e);i=xe(o,"Coucou"),o.forEach(w)},m(n,o){Fe(n,e,o),p(e,i)},p:Pt,i:Pt,o:Pt,d(n){n&&w(e)}}}const Lr=512,ra=64;function ac(t,e,i){return Math.min(Math.max(2*i*t/e-1,-.999),.999)}function zp(t){const e=$p({extensions:["OES_texture_float"]}),i=Array(2).fill(0).map(()=>e.framebuffer({radius:Lr,colorType:"float",depthStencil:!1})),n=e({vert:`
  precision mediump float;
  attribute vec2 position;
  void main () {
    gl_Position = vec4(position, 0, 1);
  }
  `,frag:`
  precision highp float;
  uniform sampler2D state;
  uniform float shapeX, shapeY, deltaT, gravity;
  void main () {
    vec2 shape = vec2(shapeX, shapeY);
    vec4 prevState = texture2D(state,
      gl_FragCoord.xy / shape);
    vec2 position = prevState.xy;
    vec2 velocity = prevState.zw;
    position += 0.5 * velocity * deltaT;
    if (position.x < -1.0 || position.x > 1.0) {
      velocity.x *= -1.0;
    }
    if (position.y < -1.0 || position.y > 1.0) {
      velocity.y *= -1.0;
    }
    position += 0.5 * velocity * deltaT;
    velocity.y = velocity.y + gravity * deltaT;
    gl_FragColor = vec4(position, velocity);
  }
  `,depth:{enable:!1},framebuffer:({tick:h})=>i[(h+1)%2],uniforms:{state:({tick:h})=>i[h%2],shapeX:e.context("viewportWidth"),shapeY:e.context("viewportHeight"),deltaT:.1,gravity:-.5},attributes:{position:[0,-4,4,4,-4,4]},primitive:"triangles",elements:null,offset:0,count:3}),o=e({vert:`
  precision highp float;
  attribute vec2 sprite;
  uniform sampler2D state;
  varying vec2 rg;
  void main () {
    vec2 position = texture2D(state, sprite).xy;
    gl_PointSize = 16.0;
    rg = sprite;
    gl_Position = vec4(position, 0, 1);
  }
  `,frag:`
  precision highp float;
  varying vec2 rg;
  void main () {
    gl_FragColor = vec4(rg, 1.0 - max(rg.x, rg.y), 1);
  }
  `,attributes:{sprite:Array(Lr*Lr).fill(0).map(function(h,v){const y=v%Lr,P=v/Lr|0;return[y/Lr,P/Lr]}).reverse()},uniforms:{state:({tick:h})=>i[h%2]},primitive:"points",offset:(h,{count:v})=>Lr*Lr-v,elements:null,count:e.prop("count")});let u=0;const f={data:new Float32Array(4*ra),width:ra,height:1},a=document.createElement("div");return Object.assign(a.style,{color:"white",position:"absolute",left:"20px",top:"20px","z-index":20}),document.body.appendChild(a),e.frame(({tick:h,drawingBufferWidth:v,drawingBufferHeight:y,pixelRatio:P})=>{const K=ac(100,v,P),re=-ac(100,y,P);if(Math.random()<.01){for(let Z=0;Z<ra;++Z)f.data[4*Z]=K,f.data[4*Z+1]=re,f.data[4*Z+2]=.25*(Math.random()-.5),f.data[4*Z+3]=Math.random();i[h%2].color[0].subimage(f,u%Lr,(u/Lr|0)%Lr),u+=ra,a.innerText=Math.min(u,Lr*Lr)}n(),e.clear({color:[0,0,0,1],depth:1}),o({count:Math.min(u,Lr*Lr)})}),[]}class Xp extends Pr{constructor(e){super(),Cr(this,e,zp,kp,Ur,{})}}function sc(t,e,i){const n=t.slice();return n[1]=e[i],n}function fc(t,e,i){const n=t.slice();return n[1]=e[i],n}function Vp(t){let e;return{c(){e=be("About")},l(i){e=xe(i,"About")},m(i,n){Fe(i,e,n)},d(i){i&&w(e)}}}function Hp(t){let e=t[1].title+"",i;return{c(){i=be(e)},l(n){i=xe(n,e)},m(n,o){Fe(n,i,o)},p:Pt,d(n){n&&w(i)}}}function lc(t){let e,i;return e=new dc({props:{$$slots:{default:[Hp]},$$scope:{ctx:t}}}),{c(){Tn(e.$$.fragment)},l(n){In(e.$$.fragment,n)},m(n,o){yn(e,n,o),i=!0},p(n,o){const u={};o&64&&(u.$$scope={dirty:o,ctx:n}),e.$set(u)},i(n){i||(Dr(e.$$.fragment,n),i=!0)},o(n){kr(e.$$.fragment,n),i=!1},d(n){En(e,n)}}}function Wp(t){let e,i,n,o;e=new dc({props:{$$slots:{default:[Vp]},$$scope:{ctx:t}}});let u=t[0],f=[];for(let h=0;h<u.length;h+=1)f[h]=lc(fc(t,u,h));const a=h=>kr(f[h],1,1,()=>{f[h]=null});return{c(){Tn(e.$$.fragment),i=ne();for(let h=0;h<f.length;h+=1)f[h].c();n=ca()},l(h){In(e.$$.fragment,h),i=ie(h);for(let v=0;v<f.length;v+=1)f[v].l(h);n=ca()},m(h,v){yn(e,h,v),Fe(h,i,v);for(let y=0;y<f.length;y+=1)f[y].m(h,v);Fe(h,n,v),o=!0},p(h,v){const y={};if(v&64&&(y.$$scope={dirty:v,ctx:h}),e.$set(y),v&1){u=h[0];let P;for(P=0;P<u.length;P+=1){const K=fc(h,u,P);f[P]?(f[P].p(K,v),Dr(f[P],1)):(f[P]=lc(K),f[P].c(),Dr(f[P],1),f[P].m(n.parentNode,n))}for(ks(),P=u.length;P<f.length;P+=1)a(P);zs()}},i(h){if(!o){Dr(e.$$.fragment,h);for(let v=0;v<u.length;v+=1)Dr(f[v]);o=!0}},o(h){kr(e.$$.fragment,h),f=f.filter(Boolean);for(let v=0;v<f.length;v+=1)kr(f[v]);o=!1},d(h){En(e,h),h&&w(i),$s(f,h),h&&w(n)}}}function Yp(t){let e,i;return{c(){e=B("p"),i=be("This page is an experiment to run simulation on the GPU.")},l(n){e=I(n,"P",{});var o=V(e);i=xe(o,"This page is an experiment to run simulation on the GPU."),o.forEach(w)},m(n,o){Fe(n,e,o),p(e,i)},p:Pt,d(n){n&&w(e)}}}function jp(t){let e,i,n;var o=t[1].component;function u(f){return{}}return o&&(e=Il(o,u())),{c(){e&&Tn(e.$$.fragment),i=ne()},l(f){e&&In(e.$$.fragment,f),i=ie(f)},m(f,a){e&&yn(e,f,a),Fe(f,i,a),n=!0},p(f,a){if(o!==(o=f[1].component)){if(e){ks();const h=e;kr(h.$$.fragment,1,0,()=>{En(h,1)}),zs()}o?(e=Il(o,u()),Tn(e.$$.fragment),Dr(e.$$.fragment,1),yn(e,i.parentNode,i)):e=null}},i(f){n||(e&&Dr(e.$$.fragment,f),n=!0)},o(f){e&&kr(e.$$.fragment,f),n=!1},d(f){e&&En(e,f),f&&w(i)}}}function cc(t){let e,i;return e=new uc({props:{$$slots:{default:[jp]},$$scope:{ctx:t}}}),{c(){Tn(e.$$.fragment)},l(n){In(e.$$.fragment,n)},m(n,o){yn(e,n,o),i=!0},p(n,o){const u={};o&64&&(u.$$scope={dirty:o,ctx:n}),e.$set(u)},i(n){i||(Dr(e.$$.fragment,n),i=!0)},o(n){kr(e.$$.fragment,n),i=!1},d(n){En(e,n)}}}function qp(t){let e,i,n,o,u,f;e=new im({props:{$$slots:{default:[Wp]},$$scope:{ctx:t}}}),n=new uc({props:{$$slots:{default:[Yp]},$$scope:{ctx:t}}});let a=t[0],h=[];for(let y=0;y<a.length;y+=1)h[y]=cc(sc(t,a,y));const v=y=>kr(h[y],1,1,()=>{h[y]=null});return{c(){Tn(e.$$.fragment),i=ne(),Tn(n.$$.fragment),o=ne();for(let y=0;y<h.length;y+=1)h[y].c();u=ca()},l(y){In(e.$$.fragment,y),i=ie(y),In(n.$$.fragment,y),o=ie(y);for(let P=0;P<h.length;P+=1)h[P].l(y);u=ca()},m(y,P){yn(e,y,P),Fe(y,i,P),yn(n,y,P),Fe(y,o,P);for(let K=0;K<h.length;K+=1)h[K].m(y,P);Fe(y,u,P),f=!0},p(y,P){const K={};P&64&&(K.$$scope={dirty:P,ctx:y}),e.$set(K);const re={};if(P&64&&(re.$$scope={dirty:P,ctx:y}),n.$set(re),P&1){a=y[0];let Z;for(Z=0;Z<a.length;Z+=1){const De=sc(y,a,Z);h[Z]?(h[Z].p(De,P),Dr(h[Z],1)):(h[Z]=cc(De),h[Z].c(),Dr(h[Z],1),h[Z].m(u.parentNode,u))}for(ks(),Z=a.length;Z<h.length;Z+=1)v(Z);zs()}},i(y){if(!f){Dr(e.$$.fragment,y),Dr(n.$$.fragment,y);for(let P=0;P<a.length;P+=1)Dr(h[P]);f=!0}},o(y){kr(e.$$.fragment,y),kr(n.$$.fragment,y),h=h.filter(Boolean);for(let P=0;P<h.length;P+=1)kr(h[P]);f=!1},d(y){En(e,y),y&&w(i),En(n,y),y&&w(o),$s(h,y),y&&w(u)}}}function Qp(t){let e,i,n;return i=new nm({props:{$$slots:{default:[qp]},$$scope:{ctx:t}}}),{c(){e=B("div"),Tn(i.$$.fragment)},l(o){e=I(o,"DIV",{});var u=V(e);In(i.$$.fragment,u),u.forEach(w)},m(o,u){Fe(o,e,u),yn(i,e,null),n=!0},p(o,[u]){const f={};u&64&&(f.$$scope={dirty:u,ctx:o}),i.$set(f)},i(o){n||(Dr(i.$$.fragment,o),n=!0)},o(o){kr(i.$$.fragment,o),n=!1},d(o){o&&w(e),En(i)}}}function Kp(t){return[[{title:"test 1",component:dm},{title:"test 2",component:vm},{title:"test 3",component:gm},{title:"test 4",component:Fm},{title:"test 5",component:Om},{title:"test 6",component:jm},{title:"test 7",component:sh},{title:"test 8",component:Eh},{title:"test 9",component:Gh},{title:"test 10",component:ep},{title:"test 11",component:_p},{title:"test 12",component:Gp},{title:"regl",component:Xp}]]}class Zp extends Pr{constructor(e){super(),Cr(this,e,Kp,Qp,Ur,{})}}function Jp(t){let e,i;return e=new Zp({}),{c(){Tn(e.$$.fragment)},l(n){In(e.$$.fragment,n)},m(n,o){yn(e,n,o),i=!0},p:Pt,i(n){i||(Dr(e.$$.fragment,n),i=!0)},o(n){kr(e.$$.fragment,n),i=!1},d(n){En(e,n)}}}class ov extends Pr{constructor(e){super(),Cr(this,e,null,Jp,Ur,{})}}export{ov as default};
